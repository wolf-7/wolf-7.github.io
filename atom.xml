<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>一匹来自北方的狼</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://wolf-7.github.io/"/>
  <updated>2019-01-24T08:24:34.000Z</updated>
  <id>https://wolf-7.github.io/</id>
  
  <author>
    <name>一匹来自北方的狼</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>错误预算上线机制</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/%E9%94%99%E8%AF%AF%E9%A2%84%E7%AE%97%E4%B8%8A%E7%BA%BF%E6%9C%BA%E5%88%B6.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/错误预算上线机制.html</id>
    <published>2019-01-24T08:15:01.000Z</published>
    <updated>2019-01-24T08:24:34.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&#x5728;&#x8BFB;&#x300A;SRE - Google&#x8FD0;&#x7EF4;&#x89E3;&#x5BC6;&#x300B;&#x7684;&#x65F6;&#x5019;&#x770B;&#x5230;Google&#x63D0;&#x51FA;&#x7684;&#x9519;&#x8BEF;&#x9884;&#x7B97;&#x4E0A;&#x7EBF;&#x673A;&#x5236;&#xFF0C;&#x89C9;&#x5F97;&#x4E0D;&#x9519;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x7EC6;&#x5316;&#x4E00;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x4EEC;&#x516C;&#x53F8;&#x7EBF;&#x4E0A;&#x53D8;&#x66F4;&#x8001;&#x662F;&#x51FA;&#x95EE;&#x9898;&#xFF0C;&#x6216;&#x8BB8;&#x53EF;&#x4EE5;&#x5C06;&#x8FD9;&#x4E2A;&#x673A;&#x5236;&#x5F15;&#x5165;&#x3002;</p><a id="more"></a><figure class="highlight fix"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&#x9519;&#x8BEF;&#x9884;&#x7B97; </span>=<span class="string"> 1 - &#x53EF;&#x9760;&#x6027;&#x76EE;&#x6807;</span></span><br></pre></td></tr></tbody></table></figure><p>&#x6BD4;&#x5982;&#x67D0;&#x4EA7;&#x54C1;&#x7684;&#x53EF;&#x9760;&#x6027;&#x76EE;&#x6807;&#x662F;4&#x4E2A;9&#xFF0C;&#x5373;99.99%&#xFF0C;&#x90A3;&#x4E48;&#x9519;&#x8BEF;&#x9884;&#x7B97;&#x5C31;&#x662F;0.01%&#xFF0C;&#x5373;&#xFF0C;&#x4E00;&#x4E2A;&#x6708;&#x5185;&#x603B;&#x5171;&#x7684;&#x4E0D;&#x53EF;&#x7528;&#x65F6;&#x957F;&#x662F;&#xFF1A;</p><figure class="highlight basic"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">1440 </span>* <span class="number">30</span> * <span class="number">0.01</span>% = <span class="number">4.32</span>&#x5206;&#x949F;</span><br></pre></td></tr></tbody></table></figure><p>&#x4E00;&#x6B21;&#x4E0A;&#x7EBF;&#xFF0C;&#x9020;&#x6210;&#x4E0D;&#x53EF;&#x7528;&#x65F6;&#x957F;1.22&#x5206;&#x949F;&#xFF0C;&#x90A3;&#x4E48;&#x8FD8;&#x5269;3.1&#x5206;&#x949F;&#xFF0C;&#x53C8;&#x4E00;&#x6B21;&#x4E0A;&#x7EBF;&#xFF0C;&#x9020;&#x6210;&#x4E0D;&#x53EF;&#x7528;&#x65F6;&#x957F;4&#x5206;&#x949F;&#xFF0C;&#x8FD8;&#x5269;-0.9&#x5206;&#x949F;&#xFF0C;&#x8D85;&#x8FC7;&#x4E86;&#x9884;&#x7B97;&#xFF0C;&#x90A3;&#x4E48;&#xFF0C;&#x672C;&#x6708;&#xFF08;&#x4E00;&#x4E2A;&#x6708;&#x662F;&#x4E00;&#x4E2A;&#x8BB0;&#x5206;&#x5468;&#x671F;&#xFF09;&#x5C31;&#x4E0D;&#x80FD;&#x518D;&#x4E0A;&#x7EBF;&#x4E86;&#x3002;</p><p>&#x5982;&#x679C;&#x975E;&#x8981;&#x4E0A;&#x7EBF;&#x4E0D;&#x53EF;&#xFF0C;&#x9700;&#x7814;&#x53D1;&#x90E8;&#x95E8;&#x5927;&#x8001;&#x677F;&#x786E;&#x8BA4;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#xFF1A;&#x5E73;&#x65F6;&#x5927;&#x8001;&#x677F;&#x6839;&#x672C;&#x4E0D;&#x7528;&#x5BA1;&#x6838;&#x4E0A;&#x7EBF;&#x5355;&#xFF0C;&#x5982;&#x679C;&#x771F;&#x6709;&#x4E0A;&#x7EBF;&#x5355;&#x8D70;&#x5230;&#x5927;&#x8001;&#x677F;&#x8FD9;&#x4E86;&#xFF0C;&#x8BF4;&#x660E;&#x8FD9;&#x4E2A;&#x56E2;&#x961F;&#x5DF2;&#x7ECF;&#x7528;&#x5149;&#x4E86;&#x4ED6;&#x4EEC;&#x7684;&#x9519;&#x8BEF;&#x9884;&#x7B97;&#x3002;&#x7814;&#x53D1;&#x7684;&#x5927;&#x8001;&#x677F;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5E94;&#x8BE5;&#x5E72;&#x70B9;&#x5565;&#x4E86;&#x3002;</p><p>&#x5E74;&#x5E95;&#x53EF;&#x4EE5;&#x5EFA;&#x7ACB;&#x5956;&#x52B1;&#x673A;&#x5236;&#xFF1A;</p><p>&#x4E0D;&#x53EF;&#x7528;&#x65F6;&#x957F;&#x6700;&#x5C11;&#x7684;&#x56E2;&#x961F;&#xFF0C;&#x9881;&#x53D1;&#x6700;&#x4F73;&#x8D28;&#x91CF;&#x5956; :)</p><p>*<em>&#x9519;&#x8BEF;&#x9884;&#x7B97;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x4EC0;&#x4E48;&#x8303;&#x7574;&#x5462;&#xFF1F;</em></p><p>&#x5EFA;&#x8BAE;&#x53EA;&#x7528;&#x4E8E;&#x4E0A;&#x7EBF;&#x5347;&#x7EA7;&#x8FC7;&#x7A0B;&#x5BFC;&#x81F4;&#x7684;&#x670D;&#x52A1;&#x77ED;&#x6682;&#x4E0D;&#x53EF;&#x7528;&#xFF0C;&#x4E3B;&#x6293;&#x4E0A;&#x7EBF;&#x9020;&#x6210;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5176;&#x4ED6;&#x6545;&#x969C;&#x7528;&#x5176;&#x4ED6;&#x673A;&#x5236;&#x907F;&#x514D;&#xFF0C;&#x907F;&#x514D;&#x626F;&#x76AE;&#x3002;</p><p>*<em>&#x90E8;&#x5206;&#x53EF;&#x7528;&#x7684;&#x60C5;&#x51B5;&#x5982;&#x4F55;&#x8BA1;&#x7B97;&#xFF1F;</em></p><p>&#x5C06;&#x4E0D;&#x53EF;&#x7528;&#x65F6;&#x957F;&#x6309;&#x5BB9;&#x91CF;&#x6BD4;&#x4F8B;&#x8BA1;&#x7B97;&#x3002;&#x6BD4;&#x5982;&#x67D0;&#x4EA7;&#x54C1;&#x90E8;&#x7F72;&#x4E86;&#x5317;&#x4EAC;&#x3001;&#x4E0A;&#x6D77;&#x4E24;&#x4E2A;&#x673A;&#x623F;&#xFF0C;&#x5BB9;&#x91CF;&#x6BD4;&#x4F8B;&#x662F;1023&#xFF1A;2765&#xFF0C;&#x67D0;&#x4E2A;&#x4E0A;&#x7EBF;&#xFF0C;&#x5F53;&#x524D;&#x53EA;&#x662F;&#x7070;&#x5EA6;&#x4E86;&#x5317;&#x4EAC;&#x673A;&#x623F;&#xFF0C;&#x9020;&#x6210;&#x8FD9;&#x4E2A;&#x673A;&#x623F;3&#x5206;&#x949F;&#x4E0D;&#x53EF;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x53EA;&#x5360;&#x4E86;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#x5BB9;&#x91CF;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x6574;&#x4E2A;&#x4EA7;&#x54C1;&#x7684;&#x4E0D;&#x53EF;&#x7528;&#x65F6;&#x957F;&#xFF1A;</p><figure class="highlight basic"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">3 </span>* <span class="number">1023</span> / (<span class="number">1023</span> + <span class="number">2765</span>) = <span class="number">0.81</span>&#x5206;&#x949F;</span><br></pre></td></tr></tbody></table></figure><p>*<em>&#x8FD9;&#x4F1A;&#x5E26;&#x6765;&#x54EA;&#x4E9B;&#x597D;&#x5904;&#xFF1F;</em></p><ul><li><p>&#x7814;&#x53D1;&#x540C;&#x5B66;&#x5FC3;&#x7406;&#x4E0A;&#x4F1A;&#x7279;&#x522B;&#x5C0F;&#x5FC3;&#xFF0C;&#x63D0;&#x9AD8;&#x98CE;&#x9669;&#x610F;&#x8BC6;</p></li><li><p>&#x4F1A;&#x60F3;&#x5404;&#x79CD;&#x62DB;&#x6765;&#x51CF;&#x5C11;&#x4E0D;&#x53EF;&#x7528;&#x65F6;&#x957F;&#xFF0C;&#x6BD4;&#x5982;&#x7070;&#x5EA6;&#x4E0A;&#x7EBF;&#x3001;AB&#x4E0A;&#x7EBF;</p></li><li><p>&#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x5C31;&#x662F;&#x670D;&#x52A1;&#x53EF;&#x9760;&#x6027;&#x63D0;&#x9AD8;</p></li></ul><p>&#x55EF;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x662F;&#x67D0;&#x516C;&#x53F8;&#x8FD0;&#x7EF4;&#x603B;&#x76D1;&#xFF0C;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x5C06;&#x4E0A;&#x9762;&#x8FD9;&#x4E2A;&#x673A;&#x5236;&#x9002;&#x914D;&#x5230;&#x81EA;&#x5DF1;&#x516C;&#x53F8;:)</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在读《SRE - Google运维解密》的时候看到Google提出的错误预算上线机制，觉得不错，在这里细化一下，如果你们公司线上变更老是出问题，或许可以将这个机制引入。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Moosefs概念总结</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/Moosefs%E6%A6%82%E5%BF%B5%E6%80%BB%E7%BB%93.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/Moosefs概念总结.html</id>
    <published>2019-01-24T08:04:02.000Z</published>
    <updated>2019-01-24T08:24:58.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&#x8FD1;&#x6765;&#x4E86;&#x89E3;&#x4E86;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x2014;&#x2014;MooseFS&#xFF0C;&#x4E4B;&#x524D;&#x5BF9;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x4E1C;&#x897F;&#x77E5;&#x9053;&#x7684;&#x5F88;&#x5C11;&#xFF0C;&#x5206;&#x5E03;&#x5F0F;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3001;&#x5206;&#x5E03;&#x5F0F;&#x6570;&#x636E;&#x5E93;&#x90FD;&#x662F;&#x8FD1;&#x800C;&#x8FDC;&#x4E4B;&#xFF0C;&#x89C9;&#x5F97;&#x592A;&#x6742;&#x4E71;&#x4E86;&#x79BB;&#x6211;&#x8FD8;&#x5F88;&#x60A0;&#x8FDC;&#x3002;&#x5728;&#x5404;&#x4F4D;&#x6559;&#x5E08;&#x7684;&#x63A8;&#x52A8;&#x4E0B;&#x6211;&#x7528;6&#x53F0;&#x673A;&#x5668;&#x5B9E;&#x4E60;&#x4E86;&#x4E00;&#x4E0B;moosefs&#xFF0C;moosefs&#x7684;&#x5B89;&#x7F6E;&#x4ECD;&#x662F;&#x5F88;&#x7B80;&#x7565;&#x7684;&#xFF0C;&#x548C;&#x88C5;&#x5907;NFS&#x5F88;&#x50CF;&#xFF0C;&#x4FBF;&#x662F;&#x591A;&#x4E86;&#x4E24;&#x79CD;&#x4EBA;&#x7269;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x6070;&#x662F;&#x6709;&#x4E86;&#x5B83;&#x4EEC;&#xFF0C;&#x624D;&#x4F7F;&#x5F97;moosefs&#x5728;&#x53EF;&#x6269;&#x5C55;&#x6027;&#x548C;&#x7A33;&#x5B9A;&#x6027;&#x4E0A;&#x90FD;&#x8981;&#x8FDC;&#x597D;&#x4E8E;NFS&#xFF0C;&#x5728;&#x8BFB;&#x5199;&#x7684;&#x529F;&#x7528;&#x65B9;&#x9762;&#xFF0C;&#x901A;&#x8FC7;dd&#x8FDB;&#x884C;&#x7684;&#x7B80;&#x7565;&#x68C0;&#x9A8C;&#x6765;&#x770B;&#xFF0C;moosefs&#x4E5F;&#x4FBF;&#x662F;&#x5199;&#x5165;&#x7684;&#x901F;&#x5EA6;&#x7A0D;&#x5FAE;&#x597D;&#x4E8E;NFS&#xFF0C;&#x8BFB;&#x4E0A;&#x6CA1;&#x6709;&#x4E0D;&#x540C;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x5173;&#x4E8E;MFS&#x77E5;&#x8BC6;&#x70B9;&#x7684;&#x4E00;&#x4E9B;&#x603B;&#x7ED3;&#x3002;</p><a id="more"></a><p>MFS&#x7CFB;&#x7EDF;&#x7531;4&#x4E2A;&#x6709;&#x4E9B;&#x6784;&#x6210;&#xFF1A;<br><strong>master&#x3001;metalogger&#x3001;chunkserver&#x3001;client</strong></p><p><strong>Master</strong> &#x2014;&#x2014; mfs&#x7684;&#x5927;&#x8111;&#xFF0C;&#x8BB0;&#x5F55;&#x7740;&#x5904;&#x7406;&#x4FE1;&#x606F;&#xFF0C;&#x6BD4;&#x65B9;&#xFF1A;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#xFF0C;&#x5B58;&#x50A8;&#x7684;&#x65B9;&#x4F4D;&#xFF0C;&#x4EFD;&#x6570;&#x7B49;&#xFF0C;&#x548C;innodb&#x4E2D;&#x540C;&#x4EAB;&#x7A7A;&#x95F4;&#xFF08;ibdata&#xFF09;&#x4E2D;&#x5B58;&#x50A8;&#x7684;&#x4FE1;&#x606F;&#x7C7B;&#x4F3C;&#xFF0C;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x88AB;&#x8BB0;&#x5F55;&#x5230;metadata.mfs&#x4E2D;&#xFF0C;&#x5F53;&#x8BE5;&#x6587;&#x4EF6;&#x88AB;&#x8F7D;&#x5165;&#x5185;&#x5B58;&#x540E;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x4F1A;&#x91CD;&#x547D;&#x540D;&#x4E3A;metadata.mfs.back&#xFF0C;&#x5F53;chunkserver&#x4E0A;&#x6709;&#x66F4;&#x65B0;&#x65F6;&#xFF0C;master&#x4F1A;&#x5B88;&#x65F6;&#x5C06;&#x53D6;&#x5F97;&#x7684;&#x65B0;&#x7684;&#x4FE1;&#x606F;&#x56DE;&#x5199;&#x5230;metadata.mfs.back&#x4E2D;&#xFF0C;&#x4FDD;&#x8BC1;&#x5143;&#x6570;&#x636E;&#x7684;&#x53EF;&#x9760;&#x3002;</p><p><strong>&#x786C;&#x4EF6;&#x63A8;&#x8350;</strong>&#xFF1A;&#x5927;&#x5185;&#x5B58;&#xFF0C;&#x7531;&#x4E8E;&#x5185;&#x5B58;&#x4E2D;&#x9700;&#x8981;&#x5C06;metadata.mfs&#x52A0;&#x8F7D;&#x8FDB;&#x6765;&#xFF0C;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#x53D6;&#x51B3;&#x4E8E;&#x4F60;chunkserver&#x4E0A;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x91CF;&#xFF0C;&#x5185;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#x4F1A;&#x6210;&#x4E3A;&#x4EE5;&#x540E;&#x7684;&#x7591;&#x95EE;&#xFF0C;&#x8981;ECC&#x7684;&#x53EF;&#x4EE5;&#x8FDB;&#x884C;&#x5DEE;&#x9519;&#x6821;&#x9A8C;&#xFF0C;&#x5F53;&#x5185;&#x5B58;&#x4E2D;&#x6570;&#x636E;&#x91CF;&#x62B5;&#x8FBE;&#x5FC5;&#x5B9A;&#x7A0B;&#x5EA6;&#xFF0C;&#x5047;&#x8BBE;&#x6CA1;&#x6709;&#x4E2A;&#x5BB9;&#x9519;&#x7684;&#x673A;&#x5236;&#xFF0C;&#x4F1A;&#x5F88;&#x53EF;&#x6015;&#xFF1B;&#x5197;&#x4F59;&#x7535;&#x6C60;&#xFF0C;&#x548C;&#x78C1;&#x76D8;&#x88C5;&#x5907;RAID1/RAID5/RAID10&#xFF0C;&#x90FD;&#x662F;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x9AD8;&#x53EF;&#x9760;&#x3002;</p><p><strong>Metalogge</strong>r &#x2014;&#x2014; mfs&#x7684;&#x5907;&#x4EFD;&#xFF0C;&#x6BD4;&#x65B9;mysql&#x4E2D;&#x7684;m-s&#x7ED3;&#x6784;&#xFF0C;metalogger&#x4F1A;&#x5B88;&#x65F6;&#x91CD;master&#x5927;&#x5C06;&#x7684;metadata&#x3001;changelog&#x3001;session&#x7C7B;&#x578B;&#x7684;&#x6587;&#x4EF6;&#x4E0B;&#x8F7D;&#x540C;&#x6B65;&#x5230;&#x672C;&#x5730;&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x5E76;&#x52A0;&#x540E;&#x7F00;&#x201D;_ml&#x201D;&#x5C06;&#x5176;&#x91CD;&#x547D;&#x540D;&#x3002;</p><p><strong>&#x786C;&#x4EF6;&#x63A8;&#x8350;</strong>&#xFF1A;&#x4E0E;master&#x673A;&#x5668;&#x88C5;&#x5907;&#x4E00;&#x8D77;&#xFF0C;metalogger&#x672C;&#x8EAB;&#x4FBF;&#x662F;master&#x7684;&#x4E00;&#x4E2A;&#x5907;&#x673A;&#xFF0C;&#x5F53;master&#x5B95;&#x673A;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5C06;metalogger&#x63D0;&#x5347;&#x4E3A;master&#x3002;</p><p><strong>Chunkserver</strong> &#x2014;&#x2014; &#x6570;&#x636E;&#x5B58;&#x50A8;&#x5730;&#xFF0C;&#x6587;&#x4EF6;&#x4EE5;chunk&#x5927;&#x5C0F;&#x5B58;&#x50A8;&#xFF0C;&#x6BCF;chunk&#x6700;&#x5927;&#x4E3A;64M&#xFF0C;&#x5C0F;&#x4E8E;64M&#x7684;&#xFF0C;&#x8BE5;chunk&#x7684;&#x5927;&#x5C0F;&#x5373;&#x4E3A;&#x8BE5;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#xFF0C;&#x903E;&#x8D8A;64M&#x7684;&#x6587;&#x4EF6;&#x5C06;&#x88AB;&#x5747;&#x5206;&#xFF0C;&#x6BCF;&#x4E00;&#x4EFD;&#xFF08;chunk&#xFF09;&#x7684;&#x5927;&#x5C0F;&#x4EE5;&#x4E0D;&#x903E;&#x8D8A;64M&#x4E3A;&#x539F;&#x5219;&#xFF1B;&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4EFD;copy&#xFF0C;&#x5373;&#x9664;&#x4E86;&#x521D;&#x59CB;&#x6587;&#x4EF6;&#x4EE5;&#x5916;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x8FD8;&#x5B58;&#x50A8;&#x7684;&#x4EFD;&#x6570;&#xFF0C;&#x5F53;goal&#x4E3A;1&#x65F6;&#xFF0C;&#x6807;&#x660E;&#x53EA;&#x9700;&#x4E00;&#x4EFD;copy&#xFF0C;&#x8FD9;&#x4EFD;copy&#x4F1A;&#x88AB;&#x968F;&#x673A;&#x5B58;&#x5230;&#x4E00;&#x53F0;chunkserver&#x4E0A;&#xFF0C;&#x5F53;goal&#x7684;&#x6570;&#x5927;&#x4E8E;1&#x65F6;&#xFF0C;&#x6BCF;&#x4E00;&#x4EFD;copy&#x4F1A;&#x88AB;&#x522B;&#x79BB;&#x4FDD;&#x5B58;&#x5230;&#x6BCF;&#x4E00;&#x4E2A;chunkserver&#x4E0A;&#xFF0C;goal&#x7684;&#x5927;&#x5C0F;&#x4E0D;&#x8981;&#x903E;&#x8D8A;chunkserver&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x5426;&#x5219;&#x591A;&#x51FA;&#x7684;copy&#xFF0C;&#x4E0D;&#x4F1A;&#x6709;chunkserver&#x53BB;&#x5B58;&#xFF0C;goal&#x8BBE;&#x7F6E;&#x518D;&#x591A;&#x5B9E;&#x4E60;&#x4E0A;&#x4E5F;&#x5C31;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#x7684;&#x3002;Copy&#x7684;&#x4EFD;&#x6570;&#xFF0C;&#x901A;&#x5E38;&#x8BBE;&#x4E3A;&#x5927;&#x4E8E;1&#x4EFD;&#xFF0C;&#x8FD9;&#x4E48;&#x5047;&#x8BBE;&#x6709;&#x4E00;&#x53F0;chukserver&#x574F;&#x6389;&#x540E;&#xFF0C;&#x6700;&#x5C11;&#x8FD8;&#x6709;&#x4E00;&#x4EFD;copy&#xFF0C;&#x5F53;&#x8FD9;&#x53F0;&#x53C8;&#x88AB;&#x52A0;&#x8FDB;&#x6765;&#x540E;&#xFF0C;&#x4F1A;&#x5C06;&#x5931;&#x6389;&#x7684;&#x90A3;&#x4EFD;copy&#x8865;&#x56DE;&#x6765;&#xFF0C;&#x59CB;&#x7EC8;&#x4FDD;&#x6301;&#x539F;&#x6709;&#x7684;copy&#x6570;&#xFF0C;&#x800C;&#x5047;&#x8BBE;goal&#x8BBE;&#x4E3A;1copy&#xFF0C;&#x90A3;&#x4E48;&#x5F53;&#x5B58;&#x50A8;&#x8BE5;copy&#x7684;chunkserver&#x574F;&#x6389;&#xFF0C;&#x4EE5;&#x540E;&#x53C8;&#x91CD;&#x65B0;&#x52A0;&#x5165;&#x56DE;&#x6765;&#xFF0C;copy&#x6570;&#x5C06;&#x59CB;&#x7EC8;&#x662F;0&#xFF0C;&#x4E0D;&#x4F1A;&#x5EB7;&#x590D;&#x5230;&#x4E4B;&#x524D;&#x7684;1&#x4E2A;copy&#x3002;</p><p><strong>Chunkserver</strong>&#x4E0A;&#x7684;&#x5269;&#x4F59;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#x8981;&#x5927;&#x4E8E;1GB&#xFF08;Reference Guide&#x6709;&#x8BF4;&#x5230;&#xFF09;&#xFF0C;&#x65B0;&#x7684;&#x6570;&#x636E;&#x624D;&#x4F1A;&#x88AB;&#x7B54;&#x5E94;&#x5199;&#x5165;&#xFF0C;&#x5426;&#x5219;&#xFF0C;&#x4F60;&#x4F1A;&#x770B;&#x5230;No space left on device&#x7684;&#x63D0;&#x793A;&#xFF0C;&#x5B9E;&#x4E60;&#x4E2D;&#xFF0C;&#x68C0;&#x9A8C;&#x53D1;&#x73B0;&#x5F53;&#x78C1;&#x76D8;&#x4F7F;&#x7528;&#x7387;&#x62B5;&#x8FBE;95%&#x652F;&#x914D;&#x7684;&#x65F6;&#x5206;&#xFF0C;&#x5C31;&#x73B0;&#x5DF2;&#x4E0D;&#x80FD;&#x5199;&#x5165;&#x4E86;&#xFF0C;&#x5F53;&#x65F6;&#x53EF;&#x7528;&#x7A7A;&#x95F4;&#x4E3A;1.9GB&#x3002;</p><p><strong>&#x786C;&#x4EF6;&#x63A8;&#x8350;</strong>&#xFF1A;&#x901A;&#x5E38;&#x7684;&#x673A;&#x5668;&#x5C31;&#x884C;&#xFF0C;&#x4FBF;&#x662F;&#x8981;&#x6765;&#x5B58;&#x51E0;&#x4EFD;&#x6570;&#x636E;&#xFF0C;&#x53EA;&#x9700;&#x78C1;&#x76D8;&#x591F;&#x5927;&#x5C31;&#x597D;&#x3002;</p><p><strong>Client</strong> &#x2014;&#x2014; &#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x8FC7;&#x5185;&#x6838;&#x52A0;&#x8F7D;&#x7684;FUSE&#x6A21;&#x5757;&#xFF0C;&#x518D;&#x901A;&#x8FC7;&#x548C;master&#x7684;&#x6C9F;&#x901A;&#xFF0C;&#x5C06;chunkserver&#x540C;&#x4EAB;&#x7684;&#x5206;&#x533A;&#x6302;&#x8F7D;&#x5230;&#x672C;&#x5730;&#xFF0C;&#x7136;&#x540E;&#x8FDB;&#x884C;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x3002;&#x7531;&#x4E8E;FUSE&#x6A21;&#x5757;&#x662F;&#x5916;&#x52A0;&#x7684;&#x6A21;&#x5757;&#xFF0C;&#x5F53;&#x7CFB;&#x7EDF;&#x91CD;&#x542F;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x5C65;&#x884C;modprobe fuse&#xFF0C;&#x5C06;&#x5176;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x6838;&#x4E2D;&#x3002;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;近来了解了一个分布式文件系统——MooseFS，之前对分布式的东西知道的很少，分布式文件系统、分布式数据库都是近而远之，觉得太杂乱了离我还很悠远。在各位教师的推动下我用6台机器实习了一下moosefs，moosefs的安置仍是很简略的，和装备NFS很像，便是多了两种人物的机器，恰是有了它们，才使得moosefs在可扩展性和稳定性上都要远好于NFS，在读写的功用方面，通过dd进行的简略检验来看，moosefs也便是写入的速度稍微好于NFS，读上没有不同。下面是关于MFS知识点的一些总结。&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>linux下编译安装Python环境与iPython</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/linux%E4%B8%8B%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85Python%E7%8E%AF%E5%A2%83%E4%B8%8EiPython.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/linux下编译安装Python环境与iPython.html</id>
    <published>2019-01-24T08:03:25.000Z</published>
    <updated>2019-01-24T08:25:18.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><figure class="highlight maxima"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x5B89;&#x88C5;<span class="built_in">readline</span>-devel,&#x89E3;&#x51B3;&#x4EA4;&#x4E92;&#x9000;&#x683C;&#x5220;&#x9664;&#x952E;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x95EE;&#x9898;</span><br><span class="line">yum insatll <span class="built_in">readline</span>-deve</span><br></pre></td></tr></tbody></table></figure><a id="more"></a><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">python.org&#x4E0B;&#x8F7D;Python2<span class="number">.7</span><span class="number">.7</span></span><br><span class="line">wget https://www.python.org/ftp/python/<span class="number">2.7</span><span class="number">.7</span>/Python<span class="number">-2.7</span><span class="number">.7</span>.tar.xz</span><br><span class="line">tar xf Python<span class="number">-2.7</span><span class="number">.7</span>.tar.xz</span><br><span class="line">cd Python<span class="number">-2.7</span><span class="number">.7</span></span><br><span class="line">./configure --prefix=/usr/local/python27</span><br><span class="line"><span class="comment">#&#x9A8C;&#x8BC1;&#xFF1A;</span></span><br><span class="line">[root@iZ28ixc7zmxZ Python<span class="number">-2.7</span><span class="number">.7</span>]<span class="comment"># /usr/local/python27/bin/python2.7</span></span><br><span class="line">Python <span class="number">2.7</span><span class="number">.7</span> (default, Feb <span class="number">28</span> <span class="number">2017</span>, <span class="number">23</span>:<span class="number">52</span>:<span class="number">42</span>)</span><br><span class="line">[GCC <span class="number">4.4</span><span class="number">.7</span> <span class="number">20120313</span> (Red Hat <span class="number">4.4</span><span class="number">.7</span><span class="number">-16</span>)] on linux2</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> <span class="string">&quot;python27&quot;</span></span><br><span class="line">python27</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="comment">#Python2.7 &#x5B89;&#x88C5;&#x6210;&#x529F;</span></span><br><span class="line"><span class="comment">#iPython&#x7A0B;&#x5E8F;&#x5305;&#x81EA;&#x884C;&#x767E;&#x5EA6;&#x4E0B;&#x8F7D;.&#xFF08;&#x589E;&#x52A0;tab&#x952E;&#x8865;&#x9F50;&#xFF09;</span></span><br><span class="line"><span class="comment">#ipython&#x662F;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x65B0;&#x5B89;&#x88C5;&#x7684;Python27&#x6765;&#x5B89;&#x88C5;</span></span><br><span class="line">tar xvf ipython<span class="number">-1.2</span><span class="number">.1</span>.tar.gz</span><br><span class="line">cd ipython<span class="number">-1.2</span><span class="number">.1</span></span><br><span class="line">/usr/local/python27/bin/python2<span class="number">.7</span> setup.py install</span><br><span class="line">ln -sv /usr/local/python27/bin/python2<span class="number">.7</span> /usr/bin/python27</span><br><span class="line">`/usr/bin/python27<span class="string">&apos; -&gt; `/usr/local/python27/bin/python2.7&apos;</span></span><br><span class="line">ln -sv /usr/local/python27/bin/ipython /usr/bin/ipython</span><br><span class="line">&#x5B89;&#x88C5;&#x5B8C;&#x6BD5;&#x3002;</span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight maxima&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;安装&lt;span class=&quot;built_in&quot;&gt;readline&lt;/span&gt;-devel,解决交互退格删除键无法使用问题&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum insatll &lt;span class=&quot;built_in&quot;&gt;readline&lt;/span&gt;-deve&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Linux下如何选择文件系统：EXT4、Btrfs 和 XFS</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/Linux%E4%B8%8B%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%9AEXT4%E3%80%81Btrfs-%E5%92%8C-XFS.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/Linux下如何选择文件系统：EXT4、Btrfs-和-XFS.html</id>
    <published>2019-01-24T08:02:53.000Z</published>
    <updated>2019-01-24T08:25:30.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&#x8001;&#x5B9E;&#x8BF4;&#xFF0C;&#x4EBA;&#x4EEC;&#x6700;&#x4E0D;&#x66FE;&#x601D;&#x8003;&#x7684;&#x95EE;&#x9898;&#x4E4B;&#x4E00;&#x662F;&#x4ED6;&#x4EEC;&#x7684;&#x4E2A;&#x4EBA;&#x7535;&#x8111;&#x4E2D;&#x4F7F;&#x7528;&#x4E86;&#x4EC0;&#x4E48;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;Windows &#x548C; Mac OS X &#x7528;&#x6237;&#x66F4;&#x6CA1;&#x6709;&#x7406;&#x7531;&#x53BB;&#x8003;&#x8651;&#xFF0C;&#x56E0;&#x4E3A;&#x5BF9;&#x4E8E;&#x4ED6;&#x4EEC;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x79CD;&#x9009;&#x62E9;&#xFF0C;&#x90A3;&#x5C31;&#x662F; NTFS &#x548C; HFS+&#x3002;&#x76F8;&#x53CD;&#xFF0C;&#x5BF9;&#x4E8E; Linux &#x7CFB;&#x7EDF;&#x800C;&#x8A00;&#xFF0C;&#x6709;&#x5F88;&#x591A;&#x79CD;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#xFF0C;&#x73B0;&#x5728;&#x9ED8;&#x8BA4;&#x7684;&#x662F;&#x5E7F;&#x6CDB;&#x91C7;&#x7528;&#x7684; ext4&#x3002;&#x7136;&#x800C;&#xFF0C;&#x73B0;&#x5728;&#x4E5F;&#x6709;&#x6539;&#x7528;&#x4E00;&#x79CD;&#x79F0;&#x4E3A; btrfs &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x8D8B;&#x52BF;&#x3002;&#x90A3;&#x662F;&#x4EC0;&#x4E48;&#x4F7F;&#x5F97; btrfs &#x66F4;&#x4F18;&#x79C0;&#xFF0C;&#x5176;&#x5B83;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x53C8;&#x80FD;&#x770B;&#x5230; Linux &#x53D1;&#x884C;&#x7248;&#x4F5C;&#x51FA;&#x6539;&#x53D8;&#x5462;&#xFF1F;</p><a id="more"></a><p>&#x9996;&#x5148;&#x8BA9;&#x6211;&#x4EEC;&#x5BF9;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4EE5;&#x53CA;&#x5B83;&#x4EEC;&#x771F;&#x6B63;&#x5E72;&#x4EC0;&#x4E48;&#x6709;&#x4E2A;&#x603B;&#x4F53;&#x7684;&#x8BA4;&#x8BC6;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x4EEC;&#x518D;&#x5BF9;&#x4E00;&#x4E9B;&#x6709;&#x540D;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x505A;&#x8BE6;&#x7EC6;&#x7684;&#x6BD4;&#x8F83;&#x3002;</p><h2 id="&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x5E72;&#x4EC0;&#x4E48;&#x7684;&#xFF1F;"><a href="#&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x5E72;&#x4EC0;&#x4E48;&#x7684;&#xFF1F;" class="headerlink" title="&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x5E72;&#x4EC0;&#x4E48;&#x7684;&#xFF1F;"></a>&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x5E72;&#x4EC0;&#x4E48;&#x7684;&#xFF1F;</h2><p>&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x6E05;&#x695A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x5E72;&#x4EC0;&#x4E48;&#x7684;&#xFF0C;&#x4E00;&#x53E5;&#x8BDD;&#x603B;&#x7ED3;&#x8D77;&#x6765;&#x4E5F;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x3002;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x63A7;&#x5236;&#x6240;&#x6709;&#x7A0B;&#x5E8F;&#x5728;&#x4E0D;&#x4F7F;&#x7528;&#x6570;&#x636E;&#x65F6;&#x5982;&#x4F55;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x3001;&#x5982;&#x4F55;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x4EE5;&#x53CA;&#x6709;&#x4EC0;&#x4E48;&#x5176;&#x5B83;&#x4FE1;&#x606F;&#xFF08;&#x5143;&#x6570;&#x636E;&#xFF09;&#x548C;&#x6570;&#x636E;&#x672C;&#x8EAB;&#x76F8;&#x5173;&#xFF0C;&#x7B49;&#x7B49;&#x3002;&#x542C;&#x8D77;&#x6765;&#x8981;&#x7F16;&#x7A0B;&#x5B9E;&#x73B0;&#x5E76;&#x4E0D;&#x662F;&#x8F7B;&#x800C;&#x6613;&#x4E3E;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x4E5F;&#x786E;&#x5B9E;&#x5982;&#x6B64;&#x3002;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E00;&#x76F4;&#x5728;&#x6539;&#x8FDB;&#xFF0C;&#x5305;&#x62EC;&#x4E86;&#x66F4;&#x591A;&#x7684;&#x529F;&#x80FD;&#x3001;&#x66F4;&#x9AD8;&#x6548;&#x5730;&#x5B8C;&#x6210;&#x5B83;&#x9700;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x603B;&#x800C;&#x8A00;&#x4E4B;&#xFF0C;&#x5B83;&#x662F;&#x6240;&#x6709;&#x8BA1;&#x7B97;&#x673A;&#x7684;&#x57FA;&#x672C;&#x9700;&#x6C42;&#x3001;&#x4F46;&#x5E76;&#x4E0D;&#x50CF;&#x542C;&#x8D77;&#x6765;&#x90A3;&#x4E48;&#x7B80;&#x5355;&#x3002;</p><h2 id="&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5206;&#x533A;&#xFF1F;"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5206;&#x533A;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5206;&#x533A;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5206;&#x533A;&#xFF1F;</h2><p>&#x7531;&#x4E8E;&#x6BCF;&#x4E2A;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x90FD;&#x80FD;&#x521B;&#x5EFA;&#x6216;&#x8005;&#x5220;&#x9664;&#x5206;&#x533A;&#xFF0C;&#x5F88;&#x591A;&#x4EBA;&#x5BF9;&#x5206;&#x533A;&#x90FD;&#x6709;&#x6A21;&#x7CCA;&#x7684;&#x8BA4;&#x8BC6;&#x3002;Linux &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5373;&#x4FBF;&#x4F7F;&#x7528;&#x6807;&#x51C6;&#x5B89;&#x88C5;&#x8FC7;&#x7A0B;&#xFF0C;&#x5728;&#x540C;&#x4E00;&#x5757;&#x78C1;&#x76D8;&#x4E0A;&#x4ECD;&#x4F7F;&#x7528;&#x591A;&#x4E2A;&#x5206;&#x533A;&#xFF0C;&#x8FD9;&#x770B;&#x8D77;&#x6765;&#x5F88;&#x5947;&#x602A;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x89E3;&#x91CA;&#x3002;&#x62E5;&#x6709;&#x4E0D;&#x540C;&#x5206;&#x533A;&#x7684;&#x4E00;&#x4E2A;&#x4E3B;&#x8981;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x5728;&#x707E;&#x96BE;&#x53D1;&#x751F;&#x65F6;&#x80FD;&#x83B7;&#x5F97;&#x66F4;&#x597D;&#x7684;&#x6570;&#x636E;&#x5B89;&#x5168;&#x6027;&#x3002;</p><p>&#x901A;&#x8FC7;&#x5C06;&#x786C;&#x76D8;&#x5212;&#x5206;&#x4E3A;&#x5206;&#x533A;&#xFF0C;&#x6570;&#x636E;&#x4F1A;&#x88AB;&#x5206;&#x9694;&#x4EE5;&#x53CA;&#x91CD;&#x7EC4;&#x3002;&#x5F53;&#x4E8B;&#x6545;&#x53D1;&#x751F;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x6709;&#x5B58;&#x50A8;&#x5728;&#x88AB;&#x635F;&#x574F;&#x5206;&#x533A;&#x4E0A;&#x7684;&#x6570;&#x636E;&#x4F1A;&#x88AB;&#x7834;&#x574F;&#xFF0C;&#x5F88;&#x5927;&#x53EF;&#x80FD;&#x4E0A;&#x5176;&#x5B83;&#x5206;&#x533A;&#x7684;&#x6570;&#x636E;&#x80FD;&#x5F97;&#x4EE5;&#x4FDD;&#x7559;&#x3002;&#x8FD9;&#x4E2A;&#x539F;&#x56E0;&#x53EF;&#x4EE5;&#x8FFD;&#x6EAF;&#x5230; Linux &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x8FD8;&#x6CA1;&#x6709;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3001;&#x4EFB;&#x4F55;&#x7535;&#x529B;&#x6545;&#x969C;&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x707E;&#x96BE;&#x53D1;&#x751F;&#x7684;&#x65F6;&#x5019;&#x3002;</p><p>&#x4F7F;&#x7528;&#x5206;&#x533A;&#x4E5F;&#x8003;&#x8651;&#x5230;&#x4E86;&#x5B89;&#x5168;&#x548C;&#x5065;&#x58EE;&#x6027;&#x539F;&#x56E0;&#xFF0C;&#x56E0;&#x6B64;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x90E8;&#x5206;&#x635F;&#x574F;&#x5E76;&#x4E0D;&#x610F;&#x5473;&#x7740;&#x6574;&#x4E2A;&#x8BA1;&#x7B97;&#x673A;&#x5C31;&#x6709;&#x98CE;&#x9669;&#x6216;&#x8005;&#x4F1A;&#x53D7;&#x5230;&#x7834;&#x574F;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x5F53;&#x524D;&#x91C7;&#x7528;&#x5206;&#x533A;&#x7684;&#x4E00;&#x4E2A;&#x6700;&#x91CD;&#x8981;&#x56E0;&#x7D20;&#x3002;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x7528;&#x6237;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E9B;&#x4F1A;&#x586B;&#x6EE1;&#x78C1;&#x76D8;&#x7684;&#x811A;&#x672C;&#x3001;&#x7A0B;&#x5E8F;&#x6216;&#x8005; web &#x5E94;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x78C1;&#x76D8;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x5927;&#x7684;&#x5206;&#x533A;&#xFF0C;&#x5982;&#x679C;&#x78C1;&#x76D8;&#x6EE1;&#x4E86;&#x90A3;&#x4E48;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x5C31;&#x4E0D;&#x80FD;&#x5DE5;&#x4F5C;&#x3002;&#x5982;&#x679C;&#x7528;&#x6237;&#x628A;&#x6570;&#x636E;&#x4FDD;&#x5B58;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x5206;&#x533A;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x53EA;&#x6709;&#x90A3;&#x4E2A;&#x5206;&#x533A;&#x4F1A;&#x53D7;&#x5230;&#x5F71;&#x54CD;&#xFF0C;&#x800C;&#x7CFB;&#x7EDF;&#x5206;&#x533A;&#x6216;&#x8005;&#x5176;&#x5B83;&#x6570;&#x636E;&#x5206;&#x533A;&#x4ECD;&#x80FD;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x3002;</p><p>&#x8BB0;&#x4F4F;&#xFF0C;&#x62E5;&#x6709;&#x4E00;&#x4E2A;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x53EA;&#x80FD;&#x5728;&#x6389;&#x7535;&#x6216;&#x8005;&#x548C;&#x5B58;&#x50A8;&#x8BBE;&#x5907;&#x610F;&#x5916;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x65F6;&#x63D0;&#x4F9B;&#x6570;&#x636E;&#x5B89;&#x5168;&#x6027;&#xFF0C;&#x5E76;&#x4E0D;&#x80FD;&#x5728;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x51FA;&#x73B0;&#x574F;&#x5757;&#x6216;&#x8005;&#x53D1;&#x751F;&#x903B;&#x8F91;&#x9519;&#x8BEF;&#x65F6;&#x4FDD;&#x62A4;&#x6570;&#x636E;&#x3002;&#x5BF9;&#x4E8E;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x5EC9;&#x4EF7;&#x78C1;&#x76D8;&#x5197;&#x4F59;&#x9635;&#x5217;&#xFF08;RAID&#xFF1A;Redundant Array of Inexpensive Disks&#xFF09;&#x7684;&#x65B9;&#x6848;&#x3002;</p><h2 id="&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5207;&#x6362;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF1F;"><a href="#&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5207;&#x6362;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF1F;" class="headerlink" title="&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5207;&#x6362;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF1F;"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5207;&#x6362;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF1F;</h2><p>ext4 &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7531; ext3 &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x6539;&#x8FDB;&#x800C;&#x6765;&#xFF0C;&#x800C;&#x540E;&#x8005;&#x53C8;&#x662F;&#x4ECE; ext2 &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x6539;&#x8FDB;&#x800C;&#x6765;&#x3002;&#x867D;&#x7136; ext4 &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5DF2;&#x7ECF;&#x975E;&#x5E38;&#x7A33;&#x5B9A;&#xFF0C;&#x662F;&#x8FC7;&#x53BB;&#x51E0;&#x5E74;&#x4E2D;&#x7EDD;&#x5927;&#x90E8;&#x5206;&#x53D1;&#x884C;&#x7248;&#x7684;&#x9ED8;&#x8BA4;&#x9009;&#x62E9;&#xFF0C;&#x4F46;&#x5B83;&#x662F;&#x57FA;&#x4E8E;&#x9648;&#x65E7;&#x7684;&#x4EE3;&#x7801;&#x5F00;&#x53D1;&#x800C;&#x6765;&#x3002;&#x53E6;&#x5916;&#xFF0C; Linux &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7528;&#x6237;&#x4E5F;&#x9700;&#x8981;&#x5F88;&#x591A; ext4 &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x672C;&#x8EAB;&#x4E0D;&#x63D0;&#x4F9B;&#x7684;&#x65B0;&#x529F;&#x80FD;&#x3002;&#x867D;&#x7136;&#x901A;&#x8FC7;&#x67D0;&#x4E9B;&#x8F6F;&#x4EF6;&#x80FD;&#x6EE1;&#x8DB3;&#x8FD9;&#x79CD;&#x9700;&#x6C42;&#xFF0C;&#x4F46;&#x6027;&#x80FD;&#x4F1A;&#x53D7;&#x5230;&#x5F71;&#x54CD;&#xFF0C;&#x5728;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5C42;&#x6B21;&#x505A;&#x5230;&#x8FD9;&#x4E9B;&#x80FD;&#x83B7;&#x5F97;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;&#x3002;</p><h2 id="Ext4-&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;"><a href="#Ext4-&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;" class="headerlink" title="Ext4 &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;"></a>Ext4 &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</h2><p>ext4 &#x8FD8;&#x6709;&#x4E00;&#x4E9B;&#x660E;&#x663E;&#x7684;&#x9650;&#x5236;&#x3002;&#x6700;&#x5927;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x662F; 16 tebibytes&#xFF08;&#x5927;&#x6982;&#x662F; 17.6 terabytes&#xFF09;&#xFF0C;&#x8FD9;&#x6BD4;&#x666E;&#x901A;&#x7528;&#x6237;&#x5F53;&#x524D;&#x80FD;&#x4E70;&#x5230;&#x7684;&#x786C;&#x76D8;&#x8FD8;&#x8981;&#x5927;&#x7684;&#x591A;&#x3002;&#x4F7F;&#x7528; ext4 &#x80FD;&#x521B;&#x5EFA;&#x7684;&#x6700;&#x5927;&#x5377;/&#x5206;&#x533A;&#x662F; 1 exbibyte&#xFF08;&#x5927;&#x6982;&#x662F; 1,152,921.5 terabytes&#xFF09;&#x3002;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x591A;&#x79CD;&#x6280;&#x5DE7;&#xFF0C; ext4 &#x6BD4; ext3 &#x6709;&#x5F88;&#x5927;&#x7684;&#x901F;&#x5EA6;&#x63D0;&#x5347;&#x3002;&#x7C7B;&#x4F3C;&#x4E00;&#x4E9B;&#x6700;&#x5148;&#x8FDB;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x610F;&#x5473;&#x7740;&#x5B83;&#x4F1A;&#x5BF9;&#x6587;&#x4EF6;&#x5728;&#x78C1;&#x76D8;&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#x4EE5;&#x53CA;&#x4EFB;&#x4F55;&#x5176;&#x5B83;&#x5BF9;&#x78C1;&#x76D8;&#x7684;&#x66F4;&#x6539;&#x505A;&#x8BB0;&#x5F55;&#x3002;&#x7EB5;&#x89C2;&#x5B83;&#x7684;&#x6240;&#x6709;&#x529F;&#x80FD;&#xFF0C;&#x5B83;&#x8FD8;&#x4E0D;&#x652F;&#x6301;&#x900F;&#x660E;&#x538B;&#x7F29;&#x3001;&#x91CD;&#x590D;&#x6570;&#x636E;&#x5220;&#x9664;&#x6216;&#x8005;&#x900F;&#x660E;&#x52A0;&#x5BC6;&#x3002;&#x6280;&#x672F;&#x4E0A;&#x652F;&#x6301;&#x4E86;&#x5FEB;&#x7167;&#xFF0C;&#x4F46;&#x8BE5;&#x529F;&#x80FD;&#x8FD8;&#x5904;&#x4E8E;&#x5B9E;&#x9A8C;&#x6027;&#x9636;&#x6BB5;&#x3002;</p><h2 id="Btrfs-&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;"><a href="#Btrfs-&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;" class="headerlink" title="Btrfs &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;"></a>Btrfs &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</h2><p>btrfs &#x6709;&#x5F88;&#x591A;&#x4E0D;&#x540C;&#x7684;&#x53EB;&#x6CD5;&#xFF0C;&#x4F8B;&#x5982; Better FS&#x3001;Butter FS &#x6216;&#x8005; B-Tree FS&#x3002;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x51E0;&#x4E4E;&#x5B8C;&#x5168;&#x4ECE;&#x5934;&#x5F00;&#x53D1;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;btrfs &#x51FA;&#x73B0;&#x7684;&#x539F;&#x56E0;&#x662F;&#x5B83;&#x7684;&#x5F00;&#x53D1;&#x8005;&#x8D77;&#x521D;&#x5E0C;&#x671B;&#x6269;&#x5C55;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x529F;&#x80FD;&#x4F7F;&#x5F97;&#x5B83;&#x5305;&#x62EC;&#x5FEB;&#x7167;&#x3001;&#x6C60;&#x5316;&#xFF08;pooling&#xFF09;&#x3001;&#x6821;&#x9A8C;&#x4EE5;&#x53CA;&#x5176;&#x5B83;&#x4E00;&#x4E9B;&#x529F;&#x80FD;&#x3002;&#x867D;&#x7136;&#x548C; ext4 &#x65E0;&#x5173;&#xFF0C;&#x5B83;&#x4E5F;&#x5E0C;&#x671B;&#x80FD;&#x4FDD;&#x7559; ext4 &#x4E2D;&#x80FD;&#x4F7F;&#x6D88;&#x8D39;&#x8005;&#x548C;&#x4F01;&#x4E1A;&#x53D7;&#x76CA;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x5E76;&#x6574;&#x5408;&#x989D;&#x5916;&#x7684;&#x80FD;&#x4F7F;&#x6BCF;&#x4E2A;&#x4EBA;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x4F01;&#x4E1A;&#x53D7;&#x76CA;&#x7684;&#x529F;&#x80FD;&#x3002;&#x5BF9;&#x4E8E;&#x4F7F;&#x7528;&#x5927;&#x578B;&#x8F6F;&#x4EF6;&#x4EE5;&#x53CA;&#x5927;&#x89C4;&#x6A21;&#x6570;&#x636E;&#x5E93;&#x7684;&#x4F01;&#x4E1A;&#xFF0C;&#x8BA9;&#x591A;&#x79CD;&#x4E0D;&#x540C;&#x7684;&#x786C;&#x76D8;&#x770B;&#x8D77;&#x6765;&#x4E00;&#x81F4;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x80FD;&#x4F7F;&#x4ED6;&#x4EEC;&#x53D7;&#x76CA;&#x5E76;&#x4E14;&#x4F7F;&#x6570;&#x636E;&#x6574;&#x5408;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x7B80;&#x5355;&#x3002;&#x5220;&#x9664;&#x91CD;&#x590D;&#x6570;&#x636E;&#x80FD;&#x964D;&#x4F4E;&#x6570;&#x636E;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x5F53;&#x9700;&#x8981;&#x955C;&#x50CF;&#x4E00;&#x4E2A;&#x5355;&#x4E00;&#x800C;&#x5DE8;&#x5927;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x65F6;&#x4F7F;&#x7528; btrfs &#x4E5F;&#x80FD;&#x4F7F;&#x6570;&#x636E;&#x955C;&#x50CF;&#x53D8;&#x5F97;&#x7B80;&#x5355;&#x3002;</p><p>&#x7528;&#x6237;&#x5F53;&#x7136;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x9009;&#x62E9;&#x521B;&#x5EFA;&#x591A;&#x4E2A;&#x5206;&#x533A;&#x4ECE;&#x800C;&#x65E0;&#x9700;&#x955C;&#x50CF;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#x3002;&#x8003;&#x8651;&#x5230;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;btrfs &#x80FD;&#x6A2A;&#x8DE8;&#x591A;&#x79CD;&#x786C;&#x76D8;&#xFF0C;&#x548C; ext4 &#x76F8;&#x6BD4;&#xFF0C;&#x5B83;&#x80FD;&#x652F;&#x6301; 16 &#x500D;&#x4EE5;&#x4E0A;&#x7684;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x3002;btrfs &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E00;&#x4E2A;&#x5206;&#x533A;&#x6700;&#x5927;&#x662F; 16 exbibytes&#xFF0C;&#x6700;&#x5927;&#x7684;&#x6587;&#x4EF6;&#x5927;&#x5C0F;&#x4E5F;&#x662F; 16 exbibytes&#x3002;</p><h2 id="XFS-&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;"><a href="#XFS-&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;" class="headerlink" title="XFS &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;"></a>XFS &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</h2><p>XFS &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x662F;&#x6269;&#x5C55;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF08;extent file system&#xFF09;&#x7684;&#x4E00;&#x4E2A;&#x6269;&#x5C55;&#x3002;XFS &#x662F; 64 &#x4F4D;&#x9AD8;&#x6027;&#x80FD;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;&#x5BF9; XFS &#x7684;&#x652F;&#x6301;&#x5927;&#x6982;&#x5728; 2002 &#x5E74;&#x5408;&#x5E76;&#x5230;&#x4E86; Linux &#x5185;&#x6838;&#xFF0C;&#x5230;&#x4E86; 2009 &#x5E74;&#xFF0C;&#x7EA2;&#x5E3D;&#x4F01;&#x4E1A;&#x7248; Linux 5.4 &#x4E5F;&#x652F;&#x6301;&#x4E86; XFS &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;&#x5BF9;&#x4E8E; 64 &#x4F4D;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;XFS &#x652F;&#x6301;&#x6700;&#x5927;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5927;&#x5C0F;&#x4E3A; 8 exbibytes&#x3002;XFS &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x6709;&#x4E00;&#x4E9B;&#x7F3A;&#x9677;&#xFF0C;&#x4F8B;&#x5982;&#x5B83;&#x4E0D;&#x80FD;&#x538B;&#x7F29;&#xFF0C;&#x5220;&#x9664;&#x5927;&#x91CF;&#x6587;&#x4EF6;&#x65F6;&#x6027;&#x80FD;&#x4F4E;&#x4E0B;&#x3002;&#x76EE;&#x524D;RHEL 7.0 &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528; XFS&#x3002;</p><h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>&#x4E0D;&#x5E78;&#x7684;&#x662F;&#xFF0C;&#x8FD8;&#x4E0D;&#x77E5;&#x9053; btrfs &#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x80FD;&#x5230;&#x6765;&#x3002;&#x5B98;&#x65B9;&#x8BF4;&#xFF0C;&#x5176;&#x4E0B;&#x4E00;&#x4EE3;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4ECD;&#x7136;&#x88AB;&#x5F52;&#x7C7B;&#x4E3A;&#x201C;&#x4E0D;&#x7A33;&#x5B9A;&#x201D;&#xFF0C;&#x4F46;&#x662F;&#x5982;&#x679C;&#x7528;&#x6237;&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7248;&#x672C;&#x7684; Ubuntu&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x5B89;&#x88C5;&#x5230; btrfs &#x5206;&#x533A;&#x4E0A;&#x3002;&#x4EC0;&#x4E48;&#x65F6;&#x5019; btrfs &#x4F1A;&#x88AB;&#x5F52;&#x7C7B;&#x5230; &#x201C;&#x7A33;&#x5B9A;&#x201D; &#x4ECD;&#x7136;&#x662F;&#x4E2A;&#x8C1C;&#xFF0C; &#x76F4;&#x5230;&#x771F;&#x7684;&#x8BA4;&#x4E3A;&#x5B83;&#x201C;&#x7A33;&#x5B9A;&#x201D;&#x4E4B;&#x524D;&#xFF0C;&#x7528;&#x6237;&#x4E5F;&#x4E0D;&#x5E94;&#x8BE5;&#x671F;&#x671B; Ubuntu &#x4F1A;&#x9ED8;&#x8BA4;&#x91C7;&#x7528; btrfs&#x3002;&#x6709;&#x62A5;&#x9053;&#x8BF4; Fedora 18 &#x4F1A;&#x7528; btrfs &#x4F5C;&#x4E3A;&#x5B83;&#x7684;&#x9ED8;&#x8BA4;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x56E0;&#x4E3A;&#x5230;&#x4E86;&#x53D1;&#x5E03;&#x5B83;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5E94;&#x8BE5;&#x6709;&#x4E86; btrfs &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x6821;&#x9A8C;&#x5668;&#x3002;&#x7531;&#x4E8E;&#x8FD8;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#x6240;&#x6709;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x53E6;&#x5916;&#x548C; ext4 &#x76F8;&#x6BD4;&#x6027;&#x80FD;&#x4E0A;&#x4E5F;&#x6BD4;&#x8F83;&#x7F13;&#x6162;&#xFF0C;btrfs &#x8FD8;&#x6709;&#x5F88;&#x591A;&#x7684;&#x5DE5;&#x4F5C;&#x8981;&#x505A;&#x3002;</p><p>&#x90A3;&#x4E48;&#xFF0C;&#x7A76;&#x7ADF;&#x4F7F;&#x7528;&#x54EA;&#x4E2A;&#x66F4;&#x597D;&#x5462;&#xFF1F;&#x5C3D;&#x7BA1;&#x6027;&#x80FD;&#x51E0;&#x4E4E;&#x76F8;&#x540C;&#xFF0C;&#x4F46; ext4 &#x8FD8;&#x662F;&#x8D62;&#x5BB6;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x7B54;&#x6848;&#x5728;&#x4E8E;&#x6613;&#x7528;&#x6027;&#x4EE5;&#x53CA;&#x5E7F;&#x6CDB;&#x6027;&#x3002;&#x5BF9;&#x4E8E;&#x684C;&#x9762;&#x6216;&#x8005;&#x5DE5;&#x4F5C;&#x7AD9;&#xFF0C; ext4 &#x4ECD;&#x7136;&#x662F;&#x4E00;&#x4E2A;&#x5F88;&#x597D;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;&#x7531;&#x4E8E;&#x5B83;&#x662F;&#x9ED8;&#x8BA4;&#x63D0;&#x4F9B;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x5728;&#x4E0A;&#x9762;&#x5B89;&#x88C5;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x3002;&#x540C;&#x65F6;&#xFF0C; ext4 &#x652F;&#x6301;&#x6700;&#x5927; 1 exabytes &#x7684;&#x5377;&#x548C; 16 terabytes &#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x8003;&#x8651;&#x5230;&#x5927;&#x5C0F;&#xFF0C;&#x5B83;&#x4E5F;&#x8FD8;&#x6709;&#x5F88;&#x5927;&#x7684;&#x8FDB;&#x6B65;&#x7A7A;&#x95F4;&#x3002;</p><p>btrfs &#x80FD;&#x63D0;&#x4F9B;&#x66F4;&#x5927;&#x7684;&#x9AD8;&#x8FBE; 16 exabytes &#x7684;&#x5377;&#x4EE5;&#x53CA;&#x66F4;&#x597D;&#x7684;&#x5BB9;&#x9519;&#xFF0C;&#x4F46;&#x662F;&#xFF0C;&#x5230;&#x73B0;&#x5728;&#x4E3A;&#x6B62;&#xFF0C;&#x5B83;&#x611F;&#x89C9;&#x66F4;&#x50CF;&#x662F;&#x4E00;&#x4E2A;&#x9644;&#x52A0;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x800C;&#x90E8;&#x7F72;&#x4E00;&#x4E2A;&#x96C6;&#x6210;&#x5230; Linux &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5C3D;&#x7BA1; btrfs &#x652F;&#x6301;&#x4E0D;&#x540C;&#x7684;&#x53D1;&#x884C;&#x7248;&#xFF0C;&#x4F7F;&#x7528; btrfs &#x683C;&#x5F0F;&#x5316;&#x786C;&#x76D8;&#x4E4B;&#x524D;&#x5148;&#x8981;&#x6709; btrfs-tools &#x5DE5;&#x5177;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5B89;&#x88C5; Linux &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x65F6;&#x5019;&#x5B83;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x9879;&#xFF0C;&#x5373;&#x4FBF;&#x4E0D;&#x540C;&#x53D1;&#x884C;&#x7248;&#x4E4B;&#x95F4;&#x4F1A;&#x6709;&#x6240;&#x4E0D;&#x540C;&#x3002;</p><p>&#x5C3D;&#x7BA1;&#x4F20;&#x8F93;&#x901F;&#x7387;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x8BC4;&#x4EF7;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x9664;&#x4E86;&#x6587;&#x4EF6;&#x4F20;&#x8F93;&#x901F;&#x5EA6;&#x4E4B;&#x5916;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x56E0;&#x7D20;&#x3002;btrfs &#x6709;&#x5F88;&#x591A;&#x597D;&#x7528;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4F8B;&#x5982;&#x5199;&#x590D;&#x5236;&#xFF08;Copy-on-Write&#xFF09;&#x3001;&#x6269;&#x5C55;&#x6821;&#x9A8C;&#x3001;&#x5FEB;&#x7167;&#x3001;&#x6E05;&#x6D17;&#x3001;&#x81EA;&#x4FEE;&#x590D;&#x6570;&#x636E;&#x3001;&#x5197;&#x4F59;&#x5220;&#x9664;&#x4EE5;&#x53CA;&#x5176;&#x5B83;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x5B8C;&#x6574;&#x6027;&#x7684;&#x529F;&#x80FD;&#x3002;&#x548C; ZFS &#x76F8;&#x6BD4; btrfs &#x7F3A;&#x5C11; RAID-Z &#x529F;&#x80FD;&#xFF0C;&#x56E0;&#x6B64;&#x5BF9;&#x4E8E; btrfs&#xFF0C; RAID &#x8FD8;&#x5904;&#x4E8E;&#x5B9E;&#x9A8C;&#x6027;&#x9636;&#x6BB5;&#x3002;&#x5BF9;&#x4E8E;&#x5355;&#x7EAF;&#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#xFF0C;&#x548C; ext4 &#x76F8;&#x6BD4; btrfs &#x4F3C;&#x4E4E;&#x66F4;&#x52A0;&#x4F18;&#x79C0;&#xFF0C;&#x4F46;&#x65F6;&#x95F4;&#x4F1A;&#x9A8C;&#x8BC1;&#x4E00;&#x5207;&#x3002;</p><p>&#x8FC4;&#x4ECA;&#x4E3A;&#x6B62;&#xFF0C;&#x5BF9;&#x4E8E;&#x684C;&#x9762;&#x7CFB;&#x7EDF;&#x800C;&#x8A00;&#xFF0C;ext4 &#x4F3C;&#x4E4E;&#x662F;&#x4E00;&#x4E2A;&#x66F4;&#x597D;&#x7684;&#x9009;&#x62E9;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x9ED8;&#x8BA4;&#x7684;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x4F20;&#x8F93;&#x6587;&#x4EF6;&#x65F6;&#x4E5F;&#x6BD4; btrfs &#x66F4;&#x5FEB;&#x3002;btrfs &#x5F53;&#x7136;&#x503C;&#x5F97;&#x5C1D;&#x8BD5;&#x3001;&#x4F46;&#x8981;&#x5728;&#x684C;&#x9762; Linux &#x4E0A;&#x5B8C;&#x5168;&#x53D6;&#x4EE3; ext4 &#x53EF;&#x80FD;&#x8FD8;&#x9700;&#x8981;&#x4E00;&#x4E9B;&#x65F6;&#x95F4;&#x3002;&#x6570;&#x636E;&#x573A;&#x548C;&#x5927;&#x5B58;&#x50A8;&#x6C60;&#x4F1A;&#x63ED;&#x793A;&#x5173;&#x4E8E; ext4&#x3001;XCF &#x4EE5;&#x53CA; btrfs &#x4E0D;&#x540C;&#x7684;&#x573A;&#x666F;&#x548C;&#x5DEE;&#x5F02;&#x3002;</p><p>&#x5982;&#x679C;&#x4F60;&#x6709;&#x4E0D;&#x540C;&#x6216;&#x8005;&#x5176;&#x5B83;&#x7684;&#x89C2;&#x70B9;&#xFF0C;&#x5728;&#x4E0B;&#x9762;&#x7684;&#x8BC4;&#x8BBA;&#x6846;&#x4E2D;&#x544A;&#x8BC9;&#x6211;&#x4EEC;&#x5427;&#x3002;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;老实说，人们最不曾思考的问题之一是他们的个人电脑中使用了什么文件系统。Windows 和 Mac OS X 用户更没有理由去考虑，因为对于他们的操作系统，只有一种选择，那就是 NTFS 和 HFS+。相反，对于 Linux 系统而言，有很多种文件系统可以选择，现在默认的是广泛采用的 ext4。然而，现在也有改用一种称为 btrfs 文件系统的趋势。那是什么使得 btrfs 更优秀，其它的文件系统又是什么，什么时候我们又能看到 Linux 发行版作出改变呢？&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Nginx+Tomcat+Redis实现负载均衡、资源分离、session共享</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/Nginx-Tomcat-Redis%E5%AE%9E%E7%8E%B0%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E3%80%81%E8%B5%84%E6%BA%90%E5%88%86%E7%A6%BB%E3%80%81session%E5%85%B1%E4%BA%AB.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/Nginx-Tomcat-Redis实现负载均衡、资源分离、session共享.html</id>
    <published>2019-01-24T08:02:15.000Z</published>
    <updated>2019-01-24T08:25:41.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><blockquote><p>Nginx+Tomcat+Redis&#x5B9E;&#x73B0;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3001;&#x8D44;&#x6E90;&#x5206;&#x79BB;&#x3001;session&#x5171;&#x4EAB;</p></blockquote></blockquote><a id="more"></a><p>1&#x3001;Nginx&#x5B9E;&#x73B0;&#x591A;Tomcat&#x8D1F;&#x8F7D;&#x5747;&#x8861;</p><p>Tomcat&#x670D;&#x52A1;<br></p><figure class="highlight tex"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.177:8001</span><br><span class="line"></span><br><span class="line">192.168.1.177:8002</span><br><span class="line"></span><br><span class="line">192.168.1.177:8003</span><br></pre></td></tr></tbody></table></figure><p></p><p>Nginx&#x914D;&#x7F6E;<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> mytomcats { </span><br><span class="line"> </span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.1.177:8001</span>; </span><br><span class="line"> </span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.1.177:8002</span>; </span><br><span class="line"> </span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.1.177:8003</span>; </span><br><span class="line"> </span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="section">server</span> { </span><br><span class="line"> </span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>; </span><br><span class="line"> </span><br><span class="line"><span class="attribute">server_name</span> www.xxx.com;</span><br><span class="line"> </span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~* \.(jpg|gif|png|swf|flv|wma|wmv|asf|mp3|mmf|zip|rar)$</span> { </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">root</span> /web/www/html/; </span><br><span class="line"> </span><br><span class="line">} </span><br><span class="line"> </span><br><span class="line"><span class="attribute">location</span> / { </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_pass</span> http://mytomcats; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_redirect</span> <span class="literal">off</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">client_max_body_size</span> <span class="number">10m</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">client_body_buffer_size</span> <span class="number">128k</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_connect_timeout</span> <span class="number">90</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_send_timeout</span> <span class="number">90</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_read_timeout</span> <span class="number">90</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_buffer_size</span> <span class="number">4k</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_buffers</span> <span class="number">4</span> <span class="number">32k</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_busy_buffers_size</span> <span class="number">64k</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_temp_file_write_size</span> <span class="number">64k</span>;</span><br><span class="line"> </span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><pre><code>upstream&#x6307;&#x5B9A;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7EC4;&#xFF0C;&#x6307;&#x5B9A;&#x5176;Tomcat&#x6210;&#x5458;location ~* \.(jpg|gif|&#x2026;&#x2026;&#x5B9E;&#x73B0;&#x4E86;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x5206;&#x79BB;&#x3002;ps&#xFF1A;&#x5728;location&#x6307;&#x4EE4;&#x4F7F;&#x7528;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x540E;&#x518D;&#x7528;alias&#x6307;&#x4EE4;&#xFF0C;Nginx&#x662F;&#x4E0D;&#x652F;&#x6301;&#x7684;&#x3002;</code></pre><p>2&#x3001;Nginx&#x5B9E;&#x73B0;&#x9759;&#x6001;&#x8D44;&#x6E90;&#x5206;&#x79BB;</p><p>Tomcat&#x670D;&#x52A1;<br></p><figure class="highlight tex"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.177:8000</span><br></pre></td></tr></tbody></table></figure><p></p><p>Nginx&#x914D;&#x7F6E;<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> { </span><br><span class="line"> </span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>; </span><br><span class="line"> </span><br><span class="line"><span class="attribute">server_name</span> www.xxx.com; </span><br><span class="line"> </span><br><span class="line"><span class="attribute">root</span> /web/www/html;</span><br><span class="line"> </span><br><span class="line"><span class="attribute">location</span> /img/ { </span><br><span class="line"> </span><br><span class="line"><span class="attribute">alias</span> /web/www/html/img/; </span><br><span class="line"> </span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ (\.jsp)|(\.do)$</span> { </span><br><span class="line"> </span><br><span class="line"><span class="attribute">proxy_pass</span> http://192.168.1.177:8000; </span><br><span class="line"> </span><br><span class="line"><span class="attribute">proxy_redirect</span> <span class="literal">off</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">client_max_body_size</span> <span class="number">10m</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">client_body_buffer_size</span> <span class="number">128k</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_connect_timeout</span> <span class="number">90</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_send_timeout</span> <span class="number">90</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_read_timeout</span> <span class="number">90</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_buffer_size</span> <span class="number">4k</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_buffers</span> <span class="number">4</span> <span class="number">32k</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_busy_buffers_size</span> <span class="number">64k</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_temp_file_write_size</span> <span class="number">64k</span>; </span><br><span class="line"> </span><br><span class="line">}  </span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><pre><code>&#x7B2C;&#x4E00;&#x4E2A;location&#x6307;&#x4EE4;&#x5C06;/web/www/html/img/&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x4EA4;&#x7ED9;Nginx&#x6765;&#x5B8C;&#x6210;&#x3002;&#x6700;&#x540E;&#x4E00;&#x4E2A;location&#x6307;&#x4EE4;&#x5C06;&#x6240;&#x6709;&#x4EE5;.jsp&#x3001;.do&#x7ED3;&#x5C3E;&#x7684;&#x6587;&#x4EF6;&#x90FD;&#x4EA4;&#x7ED9;Tomcat&#x670D;&#x52A1;&#x5668;&#x7684;8080&#x7AEF;&#x53E3;&#x6765;&#x5904;&#x7406;&#x3002;</code></pre><p>3&#x3001;Nginx+Tomcat+Redis&#x5B9E;&#x73B0;session&#x5171;&#x4EAB;<br></p><figure class="highlight tex"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Redis&#x670D;&#x52A1;</span><br><span class="line">192.168.1.178:6379</span><br><span class="line"></span><br><span class="line">Tomcat&#x670D;&#x52A1;</span><br><span class="line">192.168.1.177:8001</span><br><span class="line">192.168.1.177:8002</span><br><span class="line">192.168.1.177:8003</span><br><span class="line"></span><br><span class="line">Nginx&#x670D;&#x52A1;</span><br><span class="line">192.168.1.179</span><br></pre></td></tr></tbody></table></figure><p></p><pre><code>&#x914D;&#x7F6E;Tomcat&#x8BA9;&#x5176;session&#x4FDD;&#x5B58;&#x5230;redis&#x4E0A;&#xFF0C;&#x5728;context.xml&#x914D;&#x7F6E;(Value&#x6807;&#x7B7E;&#x4E00;&#x5B9A;&#x8981;&#x5728;Manager&#x6807;&#x7B7E;&#x524D;&#x9762;)&#xFF1A;</code></pre><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">&quot;&quot;</span> <span class="attr">docBase</span>=<span class="string">&quot;ajax&quot;</span> <span class="attr">debug</span>=<span class="string">&quot;0&quot;</span> <span class="attr">reloadable</span>=<span class="string">&quot;false&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;com.radiadesign.catalina.session.RedisSessionHandlerValve&quot;</span> /&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">&quot;com.radiadesign.catalina.session.RedisSessionManager&quot;</span>  </span></span><br><span class="line"><span class="tag">         <span class="attr">host</span>=<span class="string">&quot;192.168.1.178&quot;</span>  </span></span><br><span class="line"><span class="tag">         <span class="attr">port</span>=<span class="string">&quot;6379&quot;</span>  </span></span><br><span class="line"><span class="tag">         <span class="attr">database</span>=<span class="string">&quot;0&quot;</span>  </span></span><br><span class="line"><span class="tag">         <span class="attr">maxInactiveInterval</span>=<span class="string">&quot;60&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>&#x914D;&#x7F6E;Nginx<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> mytomcats { </span><br><span class="line"> </span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.1.177:8001</span>; </span><br><span class="line"> </span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.1.177:8002</span>; </span><br><span class="line"> </span><br><span class="line"><span class="attribute">server</span> <span class="number">192.168.1.177:8003</span>; </span><br><span class="line"> </span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="attribute">log_format</span> www_iu14_com <span class="string">&apos;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] <span class="variable">$request</span> &apos;</span> <span class="string">&apos;&quot;<span class="variable">$status</span>&quot; <span class="variable">$body_bytes_sent</span> &quot;<span class="variable">$http_referer</span>&quot;&apos;</span>  <span class="string">&apos;&quot;<span class="variable">$http_user_agent</span>&quot; &quot;<span class="variable">$http_x_forwarded_for</span>&quot;&apos;</span>; </span><br><span class="line"> </span><br><span class="line"><span class="section">server</span> {</span><br><span class="line"> </span><br><span class="line"><span class="attribute">listen</span>  <span class="number">80</span>; </span><br><span class="line"> </span><br><span class="line"><span class="attribute">server_name</span> www.iu14.com;  </span><br><span class="line"> </span><br><span class="line">    <span class="attribute">location</span> / { </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_pass</span> http:// mytomcats; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>; </span><br><span class="line"> </span><br><span class="line">} </span><br><span class="line"> </span><br><span class="line"><span class="attribute">access_log</span> /usr/tmp/logs/redis.iu14.log www_iu14_com;  </span><br><span class="line"> </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><pre><code>&#x4F9D;&#x6B21;&#x542F;&#x52A8;Redis&#x3001;Tomcat&#x3001;Nginx&#xFF0C;&#x8BBF;&#x95EE;Nginx.</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Nginx+Tomcat+Redis实现负载均衡、资源分离、session共享&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Nginx 配置选项整理</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/Nginx-%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9%E6%95%B4%E7%90%86.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/Nginx-配置选项整理.html</id>
    <published>2019-01-24T08:01:39.000Z</published>
    <updated>2019-01-24T08:25:54.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>Nginx &#x914D;&#x7F6E;&#x9009;&#x9879;&#x6574;&#x7406;</p></blockquote><a id="more"></a><p>Include &#x6587;&#x4EF6;<br>&#x4E0D;&#x8981;&#x5728;&#x60A8;&#x7684;&#x4E3B; nginx.conf &#x6587;&#x4EF6;&#x4E2D;&#x914D;&#x7F6E;&#x6240;&#x6709;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x5206;&#x6210;&#x51E0;&#x4E2A;&#x8F83;&#x5C0F;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x60A8;&#x7684;&#x540C;&#x4E8B;&#x4F1A;&#x5F88;&#x611F;&#x6FC0;&#x4F60;&#x7684;&#x3002;&#x6BD4;&#x5982;&#x6211;&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x6211;&#x5B9A;&#x4E49;&#x6211;&#x7684; upstream &#x7684; pool &#x7684;&#x4E3A;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x548C;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x5B9A;&#x4E49; location &#x5904;&#x7406;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x5176;&#x5B83;&#x7684;&#x5E94;&#x7528;&#x3002;</p><p>&#x4F8B;&#x5B50;&#xFF1A;</p><p>upstreams.conf<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&#x8D1F;&#x8F7D;1</span></span><br><span class="line"><span class="attribute">upstream</span> cluster1 {</span><br><span class="line">fair;</span><br><span class="line"><span class="attribute">server</span> app01:<span class="number">8080</span>;</span><br><span class="line"><span class="attribute">server</span> app01:<span class="number">8081</span>;</span><br><span class="line"><span class="attribute">server</span> app02:<span class="number">8082</span>;</span><br><span class="line"><span class="attribute">server</span> app02:<span class="number">8083</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">#&#x8D1F;&#x8F7D;2</span></span><br><span class="line"><span class="attribute">upstream</span> cluster2 {</span><br><span class="line">fair;</span><br><span class="line"><span class="attribute">server</span> app01:<span class="number">7071</span>;</span><br><span class="line"><span class="attribute">server</span> app01:<span class="number">7072</span>;</span><br><span class="line"><span class="attribute">server</span> app02:<span class="number">7071</span>;</span><br><span class="line"><span class="attribute">server</span> app02:<span class="number">7072</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>locations.conf<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / {</span><br><span class="line"><span class="attribute">root</span> /var/www;</span><br><span class="line"><span class="attribute">include</span> cache-control.conf;</span><br><span class="line"><span class="attribute">index</span> index.html index.htm;</span><br><span class="line">}</span><br><span class="line"><span class="attribute">location</span> /services/service1 {</span><br><span class="line"><span class="attribute">proxy_pass_header</span> Server;</span><br><span class="line"><span class="attribute">proxy_set_header</span> host <span class="variable">$http_host</span>;</span><br><span class="line"><span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Real-ip <span class="variable">$remote_addr</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Scheme <span class="variable">$scheme</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"><span class="attribute">add_header</span> Pragma <span class="string">&quot;no-cache&quot;</span>;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://cluster1/;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> /services/service2 {</span><br><span class="line"><span class="attribute">proxy_pass_header</span> Server;</span><br><span class="line"><span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line"><span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Scheme <span class="variable">$scheme</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"><span class="attribute">add_header</span> Pragma <span class="string">&quot;no-cache&quot;</span>;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://cluster2/service2;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>servers.conf<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> {</span><br><span class="line"><span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line"><span class="attribute">include</span> locations.conf;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x73B0;&#x5728;&#xFF0C;&#x4F60;&#x7684; nginx.conf &#x770B;&#x8D77;&#x6765;&#x975E;&#x5E38;&#x7684;&#x5E72;&#x51C0;&#x548C;&#x7B80;&#x5355;&#xFF08;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x5206;&#x5F00;&#x66F4;&#x591A;&#xFF0C;&#x6765;&#x66F4;&#x5305;&#x62EC;&#x6587;&#x4EF6;&#xFF0C;&#x6BD4;&#x5982;&#x5206;&#x79BB;gzip&#x7684;&#x914D;&#x7F6E;&#x9009;&#x9879;&#xFF09;</p><p>nginx.conf<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span> <span class="number">4</span>;</span><br><span class="line"><span class="attribute">worker_rlimit_nofile</span> <span class="number">20480</span>;</span><br><span class="line"><span class="section">events</span> {</span><br><span class="line"><span class="attribute">worker_connections</span> <span class="number">20480</span>;</span><br><span class="line"><span class="attribute">use</span> <span class="literal">epoll</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> {</span><br><span class="line"><span class="attribute">include</span> upstreams.conf;</span><br><span class="line"><span class="attribute">include</span> mime.types;</span><br><span class="line"><span class="attribute">default_type</span> application/octet-stream;</span><br><span class="line"></span><br><span class="line"><span class="attribute">log_format</span> custom <span class="string">&apos;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] &apos;</span></span><br><span class="line"><span class="string">&apos;&quot;<span class="variable">$request</span>&quot; <span class="variable">$status</span> <span class="variable">$bytes_sent</span> &apos;</span></span><br><span class="line"><span class="string">&apos;&quot;<span class="variable">$http_referer</span>&quot; &quot;<span class="variable">$http_user_agent</span>&quot; &quot;<span class="variable">$http_x_forwarded_for</span>&quot; <span class="variable">$request_time</span>&apos;</span>;</span><br><span class="line"><span class="attribute">access_log</span> /usr/local/app/nginx/logs/access.log custom;</span><br><span class="line"><span class="attribute">proxy_buffering</span> <span class="literal">off</span>;</span><br><span class="line"><span class="attribute">sendfile</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">tcp_nopush</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">tcp_nodelay</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">gzip_min_length</span> <span class="number">10240</span>;</span><br><span class="line"><span class="attribute">gzip_proxied</span> expired <span class="literal">no</span>-cache <span class="literal">no</span>-store private auth;</span><br><span class="line"><span class="attribute">gzip_types</span> text/plain text/css text/xml text/javascript application/x-javascript application/xml application/xml+rss image/svg+xml application/x-font-ttf application/vnd.ms-fontobject;</span><br><span class="line"><span class="attribute">gzip_disable</span> <span class="string">&quot;MSIE [1-6]\.&quot;</span>;</span><br><span class="line"><span class="comment"># proxy cache config</span></span><br><span class="line"><span class="attribute">proxy_cache_path</span> /mnt/nginx_cache levels=<span class="number">1</span>:<span class="number">2</span></span><br><span class="line">keys_zone=one:<span class="number">10m</span></span><br><span class="line">inactive=<span class="number">7d</span> max_size=<span class="number">10g</span>;</span><br><span class="line"><span class="attribute">proxy_temp_path</span> /var/tmp/nginx_temp;</span><br><span class="line"><span class="attribute">proxy_next_upstream</span> <span class="literal">error</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">include</span> servers.conf;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9; nginx.conf &#x6587;&#x4EF6;&#x662F;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E9B;&#x4E0D;&#x592A;&#x5E38;&#x89C1;&#x7684;&#x914D;&#x7F6E;&#x9009;&#x9879;&#xFF0C;&#x5B83;&#x503C;&#x5F97;&#x6307;&#x51FA;&#x5176;&#x4E2D;&#x4E00;&#x4E9B;&#x91CD;&#x8981;&#x7684;&#x3002;<br>&#x591A;&#x4E2A; worker  &#x7684;&#x914D;&#x7F6E;(&#x8FDB;&#x7A0B;)<br>&#x5982;&#x679C;&#x4F60;&#x7684; Nginx &#x662F;&#x591A;&#x4E2A; CPU &#x548C;&#x591A;&#x6838;&#xFF0C;&#x9700;&#x8981;&#x914D;&#x7F6E;&#x6210;&#x591A;&#x6838;&#x7684;&#x6570;&#x91CF;&#x6BD4;&#x8F83;&#x597D;&#x3002;<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span> <span class="number">4</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x589E;&#x52A0;&#x6253;&#x5F00;&#x7684;&#x6587;&#x4EF6;&#x53E5;&#x67C4;<br>&#x5982;&#x679C; Nginx &#x670D;&#x52A1;&#x5F88;&#x5927;&#x7684;&#x6D41;&#x91CF;&#xFF0C;&#x589E;&#x52A0;&#x6700;&#x5927;&#x53EF;&#x4EE5;&#x6253;&#x5F00;&#x7684;&#x6587;&#x4EF6;&#x53E5;&#x67C4;&#x8FD8;&#x662F;&#x5F88;&#x6709;&#x7528;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x9ED8;&#x8BA4;&#x53EA;&#x6709; 1024 &#x4E2A;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; &#x2018;ulimit -n&#x2019; &#x770B;&#x5230;&#x5F53;&#x524D;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x8BBE;&#x7F6E;&#x3002;<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_rlimit_nofile</span> <span class="number">10240</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5B9A;&#x5236;&#x7684;&#x65E5;&#x5FD7;<br></p><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x53EF;&#x4EE5;&#x770B;&#x770B; log_format &#x548C; access_log &#x4E8C;&#x4E2A;&#x9009;&#x9879;&#x7684;&#x8BBE;&#x7F6E;&#x3002;&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x6709;&#x51E0;&#x4E2A;&#x53C2;&#x6570;&#x6700;&#x5E38;&#x4F7F;&#x7528;&#xFF0C;&#x4F8B;&#x5982;&apos;$http_x_forwarded_for&apos;&#x53EF;&#x4EE5;&#x89C1;&#x5230; load balancer &#x7684;&#x8BBE;&#x5907;&#x4E4B;&#x524D;&#x7684; IP&#xFF0C;&#x8FD8;&#x6709;&apos;$request_time&apos;&#x53EF;&#x4EE5;&#x89C1;&#x5230; Nginx &#x6765;&#x5904;&#x7406;&#x8FD9;&#x4E2A;&#x4E3B;&#x52A8;&#x6240;&#x82B1;&#x7684;&#x65F6;&#x95F4;&#x3002;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x538B;&#x7F29;<br>&#x538B;&#x7F29;&#x5BF9;&#x4E8E;&#x6587;&#x672C;&#x975E;&#x5E38;&#x975E;&#x5E38;&#x7684;&#x6709;&#x7528;<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">gzip_min_length</span> <span class="number">10240</span>;</span><br><span class="line"><span class="attribute">gzip_proxied</span> expired <span class="literal">no</span>-cache <span class="literal">no</span>-store private auth;</span><br><span class="line"><span class="attribute">gzip_types</span> text/plain text/css text/xml text/javascript application/x-javascript application/xml application/xml+rss image/svg+xml application/x-font-ttf application/vnd.ms-fontobject;</span><br><span class="line"><span class="attribute">gzip_disable</span> <span class="string">&quot;MSIE [1-6]\.&quot;</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4EE3;&#x7406;&#x7684;&#x9009;&#x9879;<br>&#x8FD9;&#x4E9B;&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x5728;&#x6BCF;&#x4E2A; location &#x4E2D;&#x8BBE;&#x7F6E;<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_pass_header</span> Server;</span><br><span class="line"><span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line"><span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Scheme <span class="variable">$scheme</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"><span class="attribute">add_header</span> Pragma <span class="string">&quot;no-cache&quot;</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x4E2A;&#x4E2D;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x5B9A;&#x5236;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x5C31;&#x662F; &#x2018;no-cache&#x2019;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x4F1A;&#x4F7F;&#x7528; cache &#x7684;&#x5185;&#x5BB9;&#x4E86;&#x3002;<br>&#x4EE3;&#x7406;&#x7684; Cache<br>&#x4F7F;&#x7528; Nginx &#x53EF;&#x4EE5;&#x7ED9;&#x4E00;&#x4E9B;&#x6587;&#x4EF6;&#x6765; cache &#x5230;&#x672C;&#x5730;&#x6765;&#x5F53; Cache &#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x9700;&#x8981;&#x8BBE;&#x7F6E;  proxy_cache_path &#x548C;  proxy_temp_path  &#x5728;&#x4F60;&#x7684; HTTP &#x7684; directive &#x4E2D;&#x3002;&#x5728; location &#x4E2D;&#x914D;&#x7F6E;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x4F60;&#x60F3; cache &#x7684;&#x5185;&#x5BB9;&#x7684;&#x8BDD;&#x3002;<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_cache_path</span> /mnt/nginx_cache levels=<span class="number">1</span>:<span class="number">2</span></span><br><span class="line">keys_zone=one:<span class="number">10m</span></span><br><span class="line">inactive=<span class="number">7d</span> max_size=<span class="number">10g</span>;</span><br><span class="line"><span class="attribute">proxy_temp_path</span> /var/tmp/nginx_temp;</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x53EF;&#x80FD;&#x8FD8;&#x60F3;&#x589E;&#x52A0;&#x4E00;&#x4E9B;&#x5176;&#x5B83;&#x7684;&#x53C2;&#x6570;<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_cache</span> one;</span><br><span class="line"><span class="attribute">proxy_cache_key</span> mylocation.<span class="variable">$request_uri</span>;</span><br><span class="line"><span class="attribute">proxy_cache_valid</span> <span class="number">200</span> <span class="number">302</span> <span class="number">304</span> <span class="number">10m</span>;</span><br><span class="line"><span class="attribute">proxy_cache_valid</span> <span class="number">301</span> <span class="number">1h</span>;</span><br><span class="line"><span class="attribute">proxy_cache_valid</span> any <span class="number">1m</span>;</span><br><span class="line"><span class="attribute">proxy_cache_use_stale</span> <span class="literal">error</span> timeout invalid_header http_500 http_502 http_503 http_504 http_404;</span><br><span class="line"><span class="attribute">HTTP</span> caching options</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6709;&#x65F6;&#x4F60;&#x60F3;&#x4F7F;&#x7528;&#x5176;&#x5B83;&#x7684;&#x4E1C;&#x897F;&#x6765;&#x505A; Cache&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x600E;&#x4E48;&#x6837; cache&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x7ED9; cache &#x7684;&#x4FE1;&#x606F;&#x7684;&#x6587;&#x4EF6; include &#x5230;&#x4F60;&#x7684; root &#x7684; location &#x4E2D;<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / {</span><br><span class="line"><span class="attribute">root</span> /var/www;</span><br><span class="line"><span class="attribute">include</span> cache-control.conf;</span><br><span class="line"><span class="attribute">index</span> index.html index.htm;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4F60;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x4E0D;&#x540C;&#x7684;&#x5934;&#x5230;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x6587;&#x4EF6;<br>default cache 1 day<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">expires</span> +<span class="number">1d</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">if</span> (<span class="variable">$request_uri</span> <span class="regexp">~* &quot;^/services/.*$&quot;)</span> {</span><br><span class="line"><span class="attribute">expires</span> +<span class="number">0d</span>;</span><br><span class="line"><span class="attribute">add_header</span> Pragma <span class="string">&quot;no-cache&quot;</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="attribute">if</span> (<span class="variable">$request_uri</span> <span class="regexp">~* &quot;^/(index.html)?$&quot;)</span> {</span><br><span class="line"><span class="attribute">expires</span> +<span class="number">1h</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>SSL<br>&#x5982;&#x679C;&#x4F60;&#x8981;&#x914D;&#x7F6E; ssl &#x7684;&#x8FDE;&#x63A5;&#x7684;&#x8BDD;<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> {</span><br><span class="line"><span class="attribute">server_name</span> www.example.com;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">443</span>;</span><br><span class="line"><span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">ssl_certificate</span> /usr/local/nginx/ssl/cert.pem;</span><br><span class="line"><span class="attribute">ssl_certificate_key</span> /usr/local/nginx/ssl/cert.key;</span><br><span class="line"><span class="attribute">include</span> locations.conf;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>END&#xFF01;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Nginx 配置选项整理&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>手动本地添加static route</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/%E6%89%8B%E5%8A%A8%E6%9C%AC%E5%9C%B0%E6%B7%BB%E5%8A%A0static-route.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/手动本地添加static-route.html</id>
    <published>2019-01-24T08:01:02.000Z</published>
    <updated>2019-01-24T08:26:45.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="&#x624B;&#x52A8;&#x5728;linux-or-Mac&#x4E0A;add-static-route"><a href="#&#x624B;&#x52A8;&#x5728;linux-or-Mac&#x4E0A;add-static-route" class="headerlink" title="&#x624B;&#x52A8;&#x5728;linux or Mac&#x4E0A;add static route"></a>&#x624B;&#x52A8;&#x5728;linux or Mac&#x4E0A;add static route</h4><a id="more"></a><h3 id="mac-route&#x547D;&#x4EE4;&#x540C;&#x65F6;&#x8BBF;&#x95EE;&#x5185;&#x5916;&#x7F51;"><a href="#mac-route&#x547D;&#x4EE4;&#x540C;&#x65F6;&#x8BBF;&#x95EE;&#x5185;&#x5916;&#x7F51;" class="headerlink" title="mac route&#x547D;&#x4EE4;&#x540C;&#x65F6;&#x8BBF;&#x95EE;&#x5185;&#x5916;&#x7F51;"></a>mac route&#x547D;&#x4EE4;&#x540C;&#x65F6;&#x8BBF;&#x95EE;&#x5185;&#x5916;&#x7F51;</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo route -n add -net 192.168.0.0 -netmask 255.255.255.0 192.168.5.254 </span><br><span class="line">sudo route -n add -net 192.168.3.0 -netmask 255.255.255.0 192.168.5.254 </span><br><span class="line">sudo route -n add -net 192.168.2.0 -netmask 255.255.255.0 192.168.5.254</span><br></pre></td></tr></tbody></table></figure><h3 id="Windows-route&#x547D;&#x4EE4;&#x540C;&#x65F6;&#x8BBF;&#x95EE;&#x5185;&#x5916;&#x7F51;"><a href="#Windows-route&#x547D;&#x4EE4;&#x540C;&#x65F6;&#x8BBF;&#x95EE;&#x5185;&#x5916;&#x7F51;" class="headerlink" title="Windows route&#x547D;&#x4EE4;&#x540C;&#x65F6;&#x8BBF;&#x95EE;&#x5185;&#x5916;&#x7F51;"></a>Windows route&#x547D;&#x4EE4;&#x540C;&#x65F6;&#x8BBF;&#x95EE;&#x5185;&#x5916;&#x7F51;</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">route add -p 192.168.3.0 mask 255.255.255.0 192.168.5.254 </span><br><span class="line">route add -p 192.168.0.0 mask 255.255.255.0 192.168.5.254 </span><br><span class="line">route add -p 192.168.2.0 mask 255.255.255.0 192.168.5.254</span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;手动在linux-or-Mac上add-static-route&quot;&gt;&lt;a href=&quot;#手动在linux-or-Mac上add-static-route&quot; class=&quot;headerlink&quot; title=&quot;手动在linux or Mac上add static route&quot;&gt;&lt;/a&gt;手动在linux or Mac上add static route&lt;/h4&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>linux opepvpn客户端配置静态ip地址</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/linux-opepvpn%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81ip%E5%9C%B0%E5%9D%80.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/linux-opepvpn客户端配置静态ip地址.html</id>
    <published>2019-01-24T08:00:04.000Z</published>
    <updated>2019-01-24T08:27:28.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="openvpn&#x5BA2;&#x6237;&#x7AEF;&#x9759;&#x6001;ip&#x5730;&#x5740;&#x914D;&#x7F6E;"><a href="#openvpn&#x5BA2;&#x6237;&#x7AEF;&#x9759;&#x6001;ip&#x5730;&#x5740;&#x914D;&#x7F6E;" class="headerlink" title="openvpn&#x5BA2;&#x6237;&#x7AEF;&#x9759;&#x6001;ip&#x5730;&#x5740;&#x914D;&#x7F6E;"></a>openvpn&#x5BA2;&#x6237;&#x7AEF;&#x9759;&#x6001;ip&#x5730;&#x5740;&#x914D;&#x7F6E;</h4><a id="more"></a><h1 id="&#x5B89;&#x88C5;openvpn&#x5BA2;&#x6237;&#x7AEF;"><a href="#&#x5B89;&#x88C5;openvpn&#x5BA2;&#x6237;&#x7AEF;" class="headerlink" title="&#x5B89;&#x88C5;openvpn&#x5BA2;&#x6237;&#x7AEF;"></a>&#x5B89;&#x88C5;openvpn&#x5BA2;&#x6237;&#x7AEF;</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install or apt-get install openvpn</span></span><br></pre></td></tr></tbody></table></figure><h3 id="&#x670D;&#x52A1;&#x7AEF;&#x751F;&#x6210;key&#x5BC6;&#x94A5;zgc-ovpn&#x4E0A;&#x4F20;&#x5230;-etc-openvpn-etc"><a href="#&#x670D;&#x52A1;&#x7AEF;&#x751F;&#x6210;key&#x5BC6;&#x94A5;zgc-ovpn&#x4E0A;&#x4F20;&#x5230;-etc-openvpn-etc" class="headerlink" title="&#x670D;&#x52A1;&#x7AEF;&#x751F;&#x6210;key&#x5BC6;&#x94A5;zgc.ovpn&#x4E0A;&#x4F20;&#x5230;/etc/openvpn/etc"></a>&#x670D;&#x52A1;&#x7AEF;&#x751F;&#x6210;key&#x5BC6;&#x94A5;zgc.ovpn&#x4E0A;&#x4F20;&#x5230;/etc/openvpn/etc</h3><h3 id="&#x542F;&#x52A8;&#x547D;&#x4EE4;"><a href="#&#x542F;&#x52A8;&#x547D;&#x4EE4;" class="headerlink" title="&#x542F;&#x52A8;&#x547D;&#x4EE4;"></a>&#x542F;&#x52A8;&#x547D;&#x4EE4;</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># openvpn --daemon --cd /etc/openvpn/etc --config zgc.ovpn --log-append /var/log/openvpn.log</span></span><br></pre></td></tr></tbody></table></figure><h3 id="&#x670D;&#x52A1;&#x7AEF;&#x67E5;&#x770B;-var-log-openvpn-server-log"><a href="#&#x670D;&#x52A1;&#x7AEF;&#x67E5;&#x770B;-var-log-openvpn-server-log" class="headerlink" title="&#x670D;&#x52A1;&#x7AEF;&#x67E5;&#x770B;/var/log/openvpn/server.log"></a>&#x670D;&#x52A1;&#x7AEF;&#x67E5;&#x770B;/var/log/openvpn/server.log</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># taif -f /var/log/openvpn/server.log</span></span><br><span class="line"><span class="comment">### &#x6DFB;&#x52A0;&#x672C;&#x5730;&#x9759;&#x6001;&#x8DEF;&#x7531;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="&#x914D;&#x7F6E;&#x6587;&#x4EF6;-1"><a href="#&#x914D;&#x7F6E;&#x6587;&#x4EF6;-1" class="headerlink" title="&#x914D;&#x7F6E;&#x6587;&#x4EF6;-1"></a>&#x914D;&#x7F6E;&#x6587;&#x4EF6;-1</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">port 1194</span><br><span class="line">proto udp</span><br><span class="line">dev tun</span><br><span class="line"></span><br><span class="line">comp-lzo</span><br><span class="line">keepalive 10 120</span><br><span class="line"></span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line">user nobody</span><br><span class="line">group nogroup</span><br><span class="line"></span><br><span class="line">chroot /etc/openvpn/easy-rsa/keys/crl.jail</span><br><span class="line">crl-verify crl.pem</span><br><span class="line"></span><br><span class="line">ca /etc/openvpn/easy-rsa/keys/ca.crt</span><br><span class="line">dh /etc/openvpn/easy-rsa/keys/dh2048.pem</span><br><span class="line">tls-auth /etc/openvpn/easy-rsa/keys/ta.key 0</span><br><span class="line">key /etc/openvpn/easy-rsa/keys/server.key</span><br><span class="line">cert /etc/openvpn/easy-rsa/keys/server.crt</span><br><span class="line"></span><br><span class="line">server 10.10.10.0 255.255.255.0</span><br><span class="line">ifconfig-pool-persist ipp.txt</span><br><span class="line"></span><br><span class="line">push <span class="string">&quot;route 10.10.10.0 255.255.255.0&quot;</span>   //&#x58F0;&#x660E;192.168.10&#x6BB5;&#x7684;IP</span><br><span class="line">push <span class="string">&quot;route 10.0.0.0 255.255.255.0&quot;</span>     //&#x58F0;&#x660E;10.0.0.0&#x6BB5;&#x7684;ip</span><br><span class="line">client-config-dir ccd                         //&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x63A7;&#x5236;&#x6587;&#x4EF6;</span><br><span class="line">route 192.168.10.0 255.255.255.0            //&#x589E;&#x52A0;&#x7684;&#x8DEF;&#x7531;</span><br><span class="line">route 10.0.0.0 255.255.255.0            //&#x589E;&#x52A0;&#x7684;&#x8DEF;&#x7531;</span><br><span class="line">client-to-client</span><br><span class="line">keepalive 10 120</span><br><span class="line">comp-lzo</span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line">status /var/<span class="built_in">log</span>/openvpn/server.log</span><br><span class="line">verb 4                                   //&#x65E5;&#x5FD7;&#x7684;&#x8BB0;&#x5F55;&#x7B49;&#x7EA7;</span><br></pre></td></tr></tbody></table></figure><h3 id="&#x914D;&#x7F6E;&#x6587;&#x4EF6;-2"><a href="#&#x914D;&#x7F6E;&#x6587;&#x4EF6;-2" class="headerlink" title="&#x914D;&#x7F6E;&#x6587;&#x4EF6;-2"></a>&#x914D;&#x7F6E;&#x6587;&#x4EF6;-2</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">port 1194</span><br><span class="line">proto udp</span><br><span class="line">dev tun</span><br><span class="line"></span><br><span class="line">comp-lzo</span><br><span class="line">keepalive 10 120</span><br><span class="line"></span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line">user nobody</span><br><span class="line">group nogroup</span><br><span class="line"></span><br><span class="line">chroot /etc/openvpn/easy-rsa/keys/crl.jail</span><br><span class="line">crl-verify crl.pem</span><br><span class="line"></span><br><span class="line">ca /etc/openvpn/easy-rsa/keys/ca.crt</span><br><span class="line">dh /etc/openvpn/easy-rsa/keys/dh2048.pem</span><br><span class="line">tls-auth /etc/openvpn/easy-rsa/keys/ta.key 0</span><br><span class="line">key /etc/openvpn/easy-rsa/keys/server.key</span><br><span class="line">cert /etc/openvpn/easy-rsa/keys/server.crt</span><br><span class="line"></span><br><span class="line">ifconfig-pool-persist /var/lib/openvpn/server.ipp</span><br><span class="line">client-config-dir ccd</span><br><span class="line">status /var/<span class="built_in">log</span>/openvpn/server.log</span><br><span class="line">verb 4</span><br><span class="line"></span><br><span class="line">// virtual subnet unique <span class="keyword">for</span> openvpn to draw client addresses from</span><br><span class="line">// the server will be configured with x.x.x.1</span><br><span class="line">// important: must not be used on your network</span><br><span class="line">server 10.10.10.0 255.255.255.0</span><br><span class="line"></span><br><span class="line">// configure clients to route all their traffic through the vpn</span><br><span class="line">push <span class="string">&quot;redirect-gateway def1 bypass-dhcp&quot;</span></span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;openvpn客户端静态ip地址配置&quot;&gt;&lt;a href=&quot;#openvpn客户端静态ip地址配置&quot; class=&quot;headerlink&quot; title=&quot;openvpn客户端静态ip地址配置&quot;&gt;&lt;/a&gt;openvpn客户端静态ip地址配置&lt;/h4&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Centos7 内核参数优化</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/Centos7-%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/Centos7-内核参数优化.html</id>
    <published>2019-01-24T07:59:06.000Z</published>
    <updated>2019-01-24T08:21:25.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="CentOS7-&#x5185;&#x6838;&#x53C2;&#x6570;&#x4F18;&#x5316;"><a href="#CentOS7-&#x5185;&#x6838;&#x53C2;&#x6570;&#x4F18;&#x5316;" class="headerlink" title="CentOS7 &#x5185;&#x6838;&#x53C2;&#x6570;&#x4F18;&#x5316;"></a>CentOS7 &#x5185;&#x6838;&#x53C2;&#x6570;&#x4F18;&#x5316;</h2><a id="more"></a><h4 id="&#x67E5;&#x770B;sysctl-conf"><a href="#&#x67E5;&#x770B;sysctl-conf" class="headerlink" title="&#x67E5;&#x770B;sysctl.conf"></a>&#x67E5;&#x770B;sysctl.conf</h4><p><code>cat /etc/sysctl.conf</code></p><h4 id="&#x5173;&#x95ED;ipv6"><a href="#&#x5173;&#x95ED;ipv6" class="headerlink" title="&#x5173;&#x95ED;ipv6"></a>&#x5173;&#x95ED;ipv6</h4><p><code>net.ipv6.conf.all.disable_ipv6 = 1</code><br><code>net.ipv6.conf.default.disable_ipv6 = 1</code></p><h4 id="&#x907F;&#x514D;&#x653E;&#x5927;&#x653B;&#x51FB;"><a href="#&#x907F;&#x514D;&#x653E;&#x5927;&#x653B;&#x51FB;" class="headerlink" title="&#x907F;&#x514D;&#x653E;&#x5927;&#x653B;&#x51FB;"></a>&#x907F;&#x514D;&#x653E;&#x5927;&#x653B;&#x51FB;</h4><p><code>net.ipv4.icmp_echo_ignore_broadcasts = 1</code></p><h4 id="&#x5F00;&#x542F;&#x6076;&#x610F;icmp&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x4FDD;&#x62A4;"><a href="#&#x5F00;&#x542F;&#x6076;&#x610F;icmp&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x4FDD;&#x62A4;" class="headerlink" title="&#x5F00;&#x542F;&#x6076;&#x610F;icmp&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x4FDD;&#x62A4;"></a>&#x5F00;&#x542F;&#x6076;&#x610F;icmp&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x4FDD;&#x62A4;</h4><p><code>net.ipv4.icmp_ignore_bogus_error_responses = 1</code></p><h4 id="&#x5173;&#x95ED;&#x8DEF;&#x7531;&#x8F6C;&#x53D1;"><a href="#&#x5173;&#x95ED;&#x8DEF;&#x7531;&#x8F6C;&#x53D1;" class="headerlink" title="&#x5173;&#x95ED;&#x8DEF;&#x7531;&#x8F6C;&#x53D1;"></a>&#x5173;&#x95ED;&#x8DEF;&#x7531;&#x8F6C;&#x53D1;</h4><p><code>net.ipv4.ip_forward = 0</code><br><code>net.ipv4.conf.all.send_redirects = 0</code><br><code>net.ipv4.conf.default.send_redirects = 0</code></p><h4 id="&#x5F00;&#x542F;&#x53CD;&#x5411;&#x8DEF;&#x5F84;&#x8FC7;&#x6EE4;"><a href="#&#x5F00;&#x542F;&#x53CD;&#x5411;&#x8DEF;&#x5F84;&#x8FC7;&#x6EE4;" class="headerlink" title="&#x5F00;&#x542F;&#x53CD;&#x5411;&#x8DEF;&#x5F84;&#x8FC7;&#x6EE4;"></a>&#x5F00;&#x542F;&#x53CD;&#x5411;&#x8DEF;&#x5F84;&#x8FC7;&#x6EE4;</h4><p><code>net.ipv4.conf.all.rp_filter = 1</code><br><code>net.ipv4.conf.default.rp_filter = 1</code></p><h4 id="&#x5904;&#x7406;&#x65E0;&#x6E90;&#x8DEF;&#x7531;&#x7684;&#x5305;"><a href="#&#x5904;&#x7406;&#x65E0;&#x6E90;&#x8DEF;&#x7531;&#x7684;&#x5305;" class="headerlink" title="&#x5904;&#x7406;&#x65E0;&#x6E90;&#x8DEF;&#x7531;&#x7684;&#x5305;"></a>&#x5904;&#x7406;&#x65E0;&#x6E90;&#x8DEF;&#x7531;&#x7684;&#x5305;</h4><p><code>net.ipv4.conf.all.accept_source_route = 0</code><br><code>net.ipv4.conf.default.accept_source_route = 0</code></p><h4 id="&#x5173;&#x95ED;sysrq&#x529F;&#x80FD;"><a href="#&#x5173;&#x95ED;sysrq&#x529F;&#x80FD;" class="headerlink" title="&#x5173;&#x95ED;sysrq&#x529F;&#x80FD;"></a>&#x5173;&#x95ED;sysrq&#x529F;&#x80FD;</h4><p><code>kernel.sysrq = 0</code></p><h4 id="core&#x6587;&#x4EF6;&#x540D;&#x4E2D;&#x6DFB;&#x52A0;pid&#x4F5C;&#x4E3A;&#x6269;&#x5C55;&#x540D;"><a href="#core&#x6587;&#x4EF6;&#x540D;&#x4E2D;&#x6DFB;&#x52A0;pid&#x4F5C;&#x4E3A;&#x6269;&#x5C55;&#x540D;" class="headerlink" title="core&#x6587;&#x4EF6;&#x540D;&#x4E2D;&#x6DFB;&#x52A0;pid&#x4F5C;&#x4E3A;&#x6269;&#x5C55;&#x540D;"></a>core&#x6587;&#x4EF6;&#x540D;&#x4E2D;&#x6DFB;&#x52A0;pid&#x4F5C;&#x4E3A;&#x6269;&#x5C55;&#x540D;</h4><p><code>kernel.core_uses_pid = 1</code></p><h4 id="&#x5F00;&#x542F;SYN&#x6D2A;&#x6C34;&#x653B;&#x51FB;&#x4FDD;&#x62A4;"><a href="#&#x5F00;&#x542F;SYN&#x6D2A;&#x6C34;&#x653B;&#x51FB;&#x4FDD;&#x62A4;" class="headerlink" title="&#x5F00;&#x542F;SYN&#x6D2A;&#x6C34;&#x653B;&#x51FB;&#x4FDD;&#x62A4;"></a>&#x5F00;&#x542F;SYN&#x6D2A;&#x6C34;&#x653B;&#x51FB;&#x4FDD;&#x62A4;</h4><p><code>net.ipv4.tcp_syncookies = 1</code></p><h4 id="&#x4FEE;&#x6539;&#x6D88;&#x606F;&#x961F;&#x5217;&#x957F;&#x5EA6;"><a href="#&#x4FEE;&#x6539;&#x6D88;&#x606F;&#x961F;&#x5217;&#x957F;&#x5EA6;" class="headerlink" title="&#x4FEE;&#x6539;&#x6D88;&#x606F;&#x961F;&#x5217;&#x957F;&#x5EA6;"></a>&#x4FEE;&#x6539;&#x6D88;&#x606F;&#x961F;&#x5217;&#x957F;&#x5EA6;</h4><p><code>kernel.msgmnb = 65536</code><br><code>kernel.msgmax = 65536</code></p><h4 id="&#x8BBE;&#x7F6E;&#x6700;&#x5927;&#x5185;&#x5B58;&#x5171;&#x4EAB;&#x6BB5;&#x5927;&#x5C0F;bytes"><a href="#&#x8BBE;&#x7F6E;&#x6700;&#x5927;&#x5185;&#x5B58;&#x5171;&#x4EAB;&#x6BB5;&#x5927;&#x5C0F;bytes" class="headerlink" title="&#x8BBE;&#x7F6E;&#x6700;&#x5927;&#x5185;&#x5B58;&#x5171;&#x4EAB;&#x6BB5;&#x5927;&#x5C0F;bytes"></a>&#x8BBE;&#x7F6E;&#x6700;&#x5927;&#x5185;&#x5B58;&#x5171;&#x4EAB;&#x6BB5;&#x5927;&#x5C0F;bytes</h4><p><code>kernel.shmmax = 68719476736</code><br><code>kernel.shmall = 4294967296</code></p><h4 id="timewait&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x9ED8;&#x8BA4;180000"><a href="#timewait&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x9ED8;&#x8BA4;180000" class="headerlink" title="timewait&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x9ED8;&#x8BA4;180000"></a>timewait&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x9ED8;&#x8BA4;180000</h4><p><code>net.ipv4.tcp_max_tw_buckets = 6000</code><br><code>net.ipv4.tcp_sack = 1</code><br><code>net.ipv4.tcp_window_scaling = 1</code><br><code>net.ipv4.tcp_rmem = 4096        87380   4194304</code><br><code>net.ipv4.tcp_wmem = 4096        16384   4194304</code><br><code>net.core.wmem_default = 8388608</code><br><code>net.core.rmem_default = 8388608</code><br><code>net.core.rmem_max = 16777216</code><br><code>net.core.wmem_max = 16777216</code></p><h4 id="&#x6BCF;&#x4E2A;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x7684;&#x901F;&#x7387;&#x6BD4;&#x5185;&#x6838;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x5305;&#x7684;&#x901F;&#x7387;&#x5FEB;&#x65F6;&#xFF0C;&#x5141;&#x8BB8;&#x9001;&#x5230;&#x961F;&#x5217;&#x7684;&#x6570;&#x636E;&#x5305;&#x7684;&#x6700;&#x5927;&#x6570;&#x76EE;"><a href="#&#x6BCF;&#x4E2A;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x7684;&#x901F;&#x7387;&#x6BD4;&#x5185;&#x6838;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x5305;&#x7684;&#x901F;&#x7387;&#x5FEB;&#x65F6;&#xFF0C;&#x5141;&#x8BB8;&#x9001;&#x5230;&#x961F;&#x5217;&#x7684;&#x6570;&#x636E;&#x5305;&#x7684;&#x6700;&#x5927;&#x6570;&#x76EE;" class="headerlink" title="&#x6BCF;&#x4E2A;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x7684;&#x901F;&#x7387;&#x6BD4;&#x5185;&#x6838;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x5305;&#x7684;&#x901F;&#x7387;&#x5FEB;&#x65F6;&#xFF0C;&#x5141;&#x8BB8;&#x9001;&#x5230;&#x961F;&#x5217;&#x7684;&#x6570;&#x636E;&#x5305;&#x7684;&#x6700;&#x5927;&#x6570;&#x76EE;"></a>&#x6BCF;&#x4E2A;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x7684;&#x901F;&#x7387;&#x6BD4;&#x5185;&#x6838;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x5305;&#x7684;&#x901F;&#x7387;&#x5FEB;&#x65F6;&#xFF0C;&#x5141;&#x8BB8;&#x9001;&#x5230;&#x961F;&#x5217;&#x7684;&#x6570;&#x636E;&#x5305;&#x7684;&#x6700;&#x5927;&#x6570;&#x76EE;</h4><p><code>net.core.netdev_max_backlog = 262144</code></p><h4 id="&#x9650;&#x5236;&#x4EC5;&#x4EC5;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x7B80;&#x5355;&#x7684;DoS-&#x653B;&#x51FB;"><a href="#&#x9650;&#x5236;&#x4EC5;&#x4EC5;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x7B80;&#x5355;&#x7684;DoS-&#x653B;&#x51FB;" class="headerlink" title="&#x9650;&#x5236;&#x4EC5;&#x4EC5;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x7B80;&#x5355;&#x7684;DoS &#x653B;&#x51FB;"></a>&#x9650;&#x5236;&#x4EC5;&#x4EC5;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x7B80;&#x5355;&#x7684;DoS &#x653B;&#x51FB;</h4><p><code>net.ipv4.tcp_max_orphans = 3276800</code></p><h4 id="&#x672A;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x786E;&#x8BA4;&#x4FE1;&#x606F;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x7684;&#x6700;&#x5927;&#x503C;"><a href="#&#x672A;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x786E;&#x8BA4;&#x4FE1;&#x606F;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x7684;&#x6700;&#x5927;&#x503C;" class="headerlink" title="&#x672A;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x786E;&#x8BA4;&#x4FE1;&#x606F;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x7684;&#x6700;&#x5927;&#x503C;"></a>&#x672A;&#x6536;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x786E;&#x8BA4;&#x4FE1;&#x606F;&#x7684;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x7684;&#x6700;&#x5927;&#x503C;</h4><p><code>net.ipv4.tcp_max_syn_backlog = 262144</code><br><code>net.ipv4.tcp_timestamps = 0</code></p><h4 id="&#x5185;&#x6838;&#x653E;&#x5F03;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x4E4B;&#x524D;&#x53D1;&#x9001;SYNACK-&#x5305;&#x7684;&#x6570;&#x91CF;"><a href="#&#x5185;&#x6838;&#x653E;&#x5F03;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x4E4B;&#x524D;&#x53D1;&#x9001;SYNACK-&#x5305;&#x7684;&#x6570;&#x91CF;" class="headerlink" title="&#x5185;&#x6838;&#x653E;&#x5F03;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x4E4B;&#x524D;&#x53D1;&#x9001;SYNACK &#x5305;&#x7684;&#x6570;&#x91CF;"></a>&#x5185;&#x6838;&#x653E;&#x5F03;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x4E4B;&#x524D;&#x53D1;&#x9001;SYNACK &#x5305;&#x7684;&#x6570;&#x91CF;</h4><p><code>net.ipv4.tcp_synack_retries = 1</code></p><h4 id="&#x5185;&#x6838;&#x653E;&#x5F03;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x4E4B;&#x524D;&#x53D1;&#x9001;SYN-&#x5305;&#x7684;&#x6570;&#x91CF;"><a href="#&#x5185;&#x6838;&#x653E;&#x5F03;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x4E4B;&#x524D;&#x53D1;&#x9001;SYN-&#x5305;&#x7684;&#x6570;&#x91CF;" class="headerlink" title="&#x5185;&#x6838;&#x653E;&#x5F03;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x4E4B;&#x524D;&#x53D1;&#x9001;SYN &#x5305;&#x7684;&#x6570;&#x91CF;"></a>&#x5185;&#x6838;&#x653E;&#x5F03;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x4E4B;&#x524D;&#x53D1;&#x9001;SYN &#x5305;&#x7684;&#x6570;&#x91CF;</h4><p><code>net.ipv4.tcp_syn_retries = 1</code></p><h4 id="&#x542F;&#x7528;timewait-&#x5FEB;&#x901F;&#x56DE;&#x6536;"><a href="#&#x542F;&#x7528;timewait-&#x5FEB;&#x901F;&#x56DE;&#x6536;" class="headerlink" title="&#x542F;&#x7528;timewait &#x5FEB;&#x901F;&#x56DE;&#x6536;"></a>&#x542F;&#x7528;timewait &#x5FEB;&#x901F;&#x56DE;&#x6536;</h4><p><code>net.ipv4.tcp_tw_recycle = 1</code></p><h4 id="&#x5F00;&#x542F;&#x91CD;&#x7528;&#x3002;&#x5141;&#x8BB8;&#x5C06;TIME-WAIT-sockets-&#x91CD;&#x65B0;&#x7528;&#x4E8E;&#x65B0;&#x7684;TCP-&#x8FDE;&#x63A5;"><a href="#&#x5F00;&#x542F;&#x91CD;&#x7528;&#x3002;&#x5141;&#x8BB8;&#x5C06;TIME-WAIT-sockets-&#x91CD;&#x65B0;&#x7528;&#x4E8E;&#x65B0;&#x7684;TCP-&#x8FDE;&#x63A5;" class="headerlink" title="&#x5F00;&#x542F;&#x91CD;&#x7528;&#x3002;&#x5141;&#x8BB8;&#x5C06;TIME-WAIT sockets &#x91CD;&#x65B0;&#x7528;&#x4E8E;&#x65B0;&#x7684;TCP &#x8FDE;&#x63A5;"></a>&#x5F00;&#x542F;&#x91CD;&#x7528;&#x3002;&#x5141;&#x8BB8;&#x5C06;TIME-WAIT sockets &#x91CD;&#x65B0;&#x7528;&#x4E8E;&#x65B0;&#x7684;TCP &#x8FDE;&#x63A5;</h4><p><code>net.ipv4.tcp_tw_reuse = 1</code><br><code>net.ipv4.tcp_mem = 94500000 915000000 927000000</code><br><code>net.ipv4.tcp_fin_timeout = 1</code></p><h4 id="&#x5F53;keepalive-&#x8D77;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;TCP-&#x53D1;&#x9001;keepalive-&#x6D88;&#x606F;&#x7684;&#x9891;&#x5EA6;&#x3002;&#x7F3A;&#x7701;&#x662F;2-&#x5C0F;&#x65F6;"><a href="#&#x5F53;keepalive-&#x8D77;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;TCP-&#x53D1;&#x9001;keepalive-&#x6D88;&#x606F;&#x7684;&#x9891;&#x5EA6;&#x3002;&#x7F3A;&#x7701;&#x662F;2-&#x5C0F;&#x65F6;" class="headerlink" title="&#x5F53;keepalive &#x8D77;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;TCP &#x53D1;&#x9001;keepalive &#x6D88;&#x606F;&#x7684;&#x9891;&#x5EA6;&#x3002;&#x7F3A;&#x7701;&#x662F;2 &#x5C0F;&#x65F6;"></a>&#x5F53;keepalive &#x8D77;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;TCP &#x53D1;&#x9001;keepalive &#x6D88;&#x606F;&#x7684;&#x9891;&#x5EA6;&#x3002;&#x7F3A;&#x7701;&#x662F;2 &#x5C0F;&#x65F6;</h4><p><code>net.ipv4.tcp_keepalive_time = 30</code></p><h4 id="&#x5141;&#x8BB8;&#x7CFB;&#x7EDF;&#x6253;&#x5F00;&#x7684;&#x7AEF;&#x53E3;&#x8303;&#x56F4;"><a href="#&#x5141;&#x8BB8;&#x7CFB;&#x7EDF;&#x6253;&#x5F00;&#x7684;&#x7AEF;&#x53E3;&#x8303;&#x56F4;" class="headerlink" title="&#x5141;&#x8BB8;&#x7CFB;&#x7EDF;&#x6253;&#x5F00;&#x7684;&#x7AEF;&#x53E3;&#x8303;&#x56F4;"></a>&#x5141;&#x8BB8;&#x7CFB;&#x7EDF;&#x6253;&#x5F00;&#x7684;&#x7AEF;&#x53E3;&#x8303;&#x56F4;</h4><p><code>net.ipv4.ip_local_port_range = 1024    65000</code></p><h4 id="&#x4FEE;&#x6539;&#x9632;&#x706B;&#x5899;&#x8868;&#x5927;&#x5C0F;&#xFF0C;&#x9ED8;&#x8BA4;65536"><a href="#&#x4FEE;&#x6539;&#x9632;&#x706B;&#x5899;&#x8868;&#x5927;&#x5C0F;&#xFF0C;&#x9ED8;&#x8BA4;65536" class="headerlink" title="&#x4FEE;&#x6539;&#x9632;&#x706B;&#x5899;&#x8868;&#x5927;&#x5C0F;&#xFF0C;&#x9ED8;&#x8BA4;65536"></a>&#x4FEE;&#x6539;&#x9632;&#x706B;&#x5899;&#x8868;&#x5927;&#x5C0F;&#xFF0C;&#x9ED8;&#x8BA4;65536</h4><p><code>net.netfilter.nf_conntrack_max=655350</code><br><code>net.netfilter.nf_conntrack_tcp_timeout_established=1200</code></p><h4 id="&#x786E;&#x4FDD;&#x65E0;&#x4EBA;&#x80FD;&#x4FEE;&#x6539;&#x8DEF;&#x7531;&#x8868;"><a href="#&#x786E;&#x4FDD;&#x65E0;&#x4EBA;&#x80FD;&#x4FEE;&#x6539;&#x8DEF;&#x7531;&#x8868;" class="headerlink" title="&#x786E;&#x4FDD;&#x65E0;&#x4EBA;&#x80FD;&#x4FEE;&#x6539;&#x8DEF;&#x7531;&#x8868;"></a>&#x786E;&#x4FDD;&#x65E0;&#x4EBA;&#x80FD;&#x4FEE;&#x6539;&#x8DEF;&#x7531;&#x8868;</h4><p><code>net.ipv4.conf.all.accept_redirects = 0</code><br><code>net.ipv4.conf.default.accept_redirects = 0</code><br><code>net.ipv4.conf.all.secure_redirects = 0</code><br><code>net.ipv4.conf.default.secure_redirects = 0</code></p><h4 id="&#x628A;&#x53C2;&#x6570;&#x6DFB;&#x52A0;&#x5230;-etc-sysctl-conf&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;sysctl-p&#x4F7F;&#x53C2;&#x6570;&#x751F;&#x6548;&#xFF0C;&#x6C38;&#x4E45;&#x751F;&#x6548;"><a href="#&#x628A;&#x53C2;&#x6570;&#x6DFB;&#x52A0;&#x5230;-etc-sysctl-conf&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;sysctl-p&#x4F7F;&#x53C2;&#x6570;&#x751F;&#x6548;&#xFF0C;&#x6C38;&#x4E45;&#x751F;&#x6548;" class="headerlink" title="&#x628A;&#x53C2;&#x6570;&#x6DFB;&#x52A0;&#x5230;/etc/sysctl.conf&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;sysctl -p&#x4F7F;&#x53C2;&#x6570;&#x751F;&#x6548;&#xFF0C;&#x6C38;&#x4E45;&#x751F;&#x6548;"></a>&#x628A;&#x53C2;&#x6570;&#x6DFB;&#x52A0;&#x5230;/etc/sysctl.conf&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;sysctl -p&#x4F7F;&#x53C2;&#x6570;&#x751F;&#x6548;&#xFF0C;&#x6C38;&#x4E45;&#x751F;&#x6548;</h4><p><code>sysctl -p</code></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;CentOS7-内核参数优化&quot;&gt;&lt;a href=&quot;#CentOS7-内核参数优化&quot; class=&quot;headerlink&quot; title=&quot;CentOS7 内核参数优化&quot;&gt;&lt;/a&gt;CentOS7 内核参数优化&lt;/h2&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>常用的Linux运维小命令</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/%E5%B8%B8%E7%94%A8%E7%9A%84Linux%E8%BF%90%E7%BB%B4%E5%B0%8F%E5%91%BD%E4%BB%A4.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/常用的Linux运维小命令.html</id>
    <published>2019-01-24T07:57:49.000Z</published>
    <updated>2019-01-24T08:27:43.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&#x6574;&#x7406;&#x4E00;&#x4E9B;&#x670D;&#x52A1;&#x5668;&#x65E5;&#x5FD7;&#x5206;&#x6790;&#x547D;&#x4EE4;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x8BD5;&#x8BD5;&#xFF01;</p><a id="more"></a><p>1&#x3001;&#x67E5;&#x770B;&#x6709;&#x591A;&#x5C11;&#x4E2A;IP&#x8BBF;&#x95EE;&#xFF1A;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &apos;{print $<span class="number">1</span>}&apos; log_file|<span class="type">sort</span>|<span class="type">uniq</span>|<span class="type">wc</span> -l</span><br></pre></td></tr></tbody></table></figure><p>PS: wc -l &#x770B;&#x770B;&#x6709;&#x591A;&#x5C11;&#x884C;</p><p>2&#x3001;&#x67E5;&#x770B;&#x67D0;&#x4E00;&#x4E2A;&#x9875;&#x9762;&#x88AB;&#x8BBF;&#x95EE;&#x7684;&#x6B21;&#x6570;&#xFF1A;</p><figure class="highlight 1c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;/index.php&quot;</span> log_file <span class="string">| wc -l</span></span><br></pre></td></tr></tbody></table></figure><p>3&#x3001;&#x67E5;&#x770B;&#x6BCF;&#x4E00;&#x4E2A;IP&#x8BBF;&#x95EE;&#x4E86;&#x591A;&#x5C11;&#x4E2A;&#x9875;&#x9762;&#xFF1A;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk &apos;{++S[<span class="variable">$1</span>]} END {<span class="keyword">for</span> (a <span class="keyword">in</span> S) <span class="keyword">print</span> a,S[a]}&apos; log_file &gt; <span class="keyword">log</span>.txt</span><br><span class="line"><span class="keyword">sort</span> -<span class="keyword">n</span> -t &apos; &apos; -k 2 <span class="keyword">log</span>.txt # &#x914D;&#x5408;<span class="keyword">sort</span>&#x8FDB;&#x4E00;&#x6B65;&#x6392;&#x5E8F;</span><br></pre></td></tr></tbody></table></figure><p>4&#x3001;&#x5C06;&#x6BCF;&#x4E2A;IP&#x8BBF;&#x95EE;&#x7684;&#x9875;&#x9762;&#x6570;&#x8FDB;&#x884C;&#x4ECE;&#x5C0F;&#x5230;&#x5927;&#x6392;&#x5E8F;&#xFF1A;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &apos;{++S[<span class="variable">$1</span>]} END {<span class="keyword">for</span> (a <span class="keyword">in</span> S) <span class="keyword">print</span> S[a],a}&apos; log_file | <span class="keyword">sort</span> -<span class="keyword">n</span></span><br></pre></td></tr></tbody></table></figure><p>5&#x3001;&#x67E5;&#x770B;&#x67D0;&#x4E00;&#x4E2A;IP&#x8BBF;&#x95EE;&#x4E86;&#x54EA;&#x4E9B;&#x9875;&#x9762;&#xFF1A;</p><figure class="highlight lsl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep ^<span class="number">111.111</span><span class="number">.111</span><span class="number">.111</span> log_file| awk &apos;{print $<span class="number">1</span>,$<span class="number">7</span>}&apos;</span><br></pre></td></tr></tbody></table></figure><p>6&#x3001;&#x53BB;&#x6389;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x7EDF;&#x8BA1;&#x7684;&#x9875;&#x9762;&#xFF1A;</p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> <span class="string">&apos;{print <span class="variable">$12</span>,<span class="variable">$1</span>}&apos;</span> log_file | grep<span class="regexp"> ^\&quot;Mozilla</span> | awk <span class="string">&apos;{print <span class="variable">$2</span>}&apos;</span> |sort | uniq | wc -l</span><br></pre></td></tr></tbody></table></figure><p>7&#x3001;&#x67E5;&#x770B;2015&#x5E74;8&#x6708;16&#x65E5;14&#x65F6;&#x8FD9;&#x4E00;&#x4E2A;&#x5C0F;&#x65F6;&#x5185;&#x6709;&#x591A;&#x5C11;IP&#x8BBF;&#x95EE;:</p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> <span class="string">&apos;{print <span class="variable">$4</span>,<span class="variable">$1</span>}&apos;</span> log_file | grep <span class="number">16</span>/Aug/<span class="number">2015</span>:<span class="number">14</span> | awk <span class="string">&apos;{print <span class="variable">$2</span>}&apos;</span>| sort | uniq | wc -l</span><br></pre></td></tr></tbody></table></figure><p>8&#x3001;&#x67E5;&#x770B;&#x8BBF;&#x95EE;&#x524D;&#x5341;&#x4E2A;ip&#x5730;&#x5740;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">awk &apos;{<span class="keyword">print</span> <span class="variable">$1}</span>&apos; |<span class="keyword">sort</span>|uniq -c|<span class="keyword">sort</span> -nr |head -10 access_log</span><br><span class="line">uniq -c &#x76F8;&#x5F53;&#x4E8E;&#x5206;&#x7EC4;&#x7EDF;&#x8BA1;&#x5E76;&#x628A;&#x7EDF;&#x8BA1;&#x6570;&#x653E;&#x5728;&#x6700;&#x524D;&#x9762;</span><br><span class="line"></span><br><span class="line"><span class="keyword">cat</span> access.<span class="keyword">log</span>|awk &apos;{<span class="keyword">print</span> <span class="variable">$1}</span>&apos;|<span class="keyword">sort</span>|uniq -c|<span class="keyword">sort</span> -nr|head -10 </span><br><span class="line"></span><br><span class="line"><span class="keyword">cat</span> access.<span class="keyword">log</span>|awk &apos;{counts[$(11)]+=1}; END {<span class="keyword">for</span>(url <span class="keyword">in</span> counts) <span class="keyword">print</span> counts[url], url}</span><br></pre></td></tr></tbody></table></figure><p>9&#x3001;&#x8BBF;&#x95EE;&#x6B21;&#x6570;&#x6700;&#x591A;&#x7684;10&#x4E2A;&#x6587;&#x4EF6;&#x6216;&#x9875;&#x9762;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat log_file|<span class="type">awk</span> &apos;{print $<span class="number">11</span>}&apos;|<span class="type">sort</span>|<span class="type">uniq</span> -c|<span class="type">sort</span> -nr | <span class="type">head</span> <span class="number">-10</span></span><br><span class="line"></span><br><span class="line">cat log_file|<span class="type">awk</span> &apos;{print $<span class="number">11</span>}&apos;|<span class="type">sort</span>|<span class="type">uniq</span> -c|<span class="type">sort</span> -nr|<span class="type">head</span> <span class="number">-20</span></span><br><span class="line">awk &apos;{print $<span class="number">1</span>}&apos; log_file |<span class="type">sort</span> -n -r |<span class="type">uniq</span> -c | <span class="type">sort</span> -n -r | <span class="type">head</span> <span class="number">-20</span> # &#x8BBF;&#x95EE;&#x91CF;&#x6700;&#x5927;&#x7684;&#x524D;<span class="number">20</span>&#x4E2A;ip</span><br></pre></td></tr></tbody></table></figure><p>10&#x3001;&#x901A;&#x8FC7;&#x5B50;&#x57DF;&#x540D;&#x8BBF;&#x95EE;&#x6B21;&#x6570;&#xFF0C;&#x4F9D;&#x636E;referer&#x6765;&#x8BA1;&#x7B97;&#xFF0C;&#x7A0D;&#x6709;&#x4E0D;&#x51C6;</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> access.<span class="built_in">log</span> | awk <span class="string">&apos;{print $11}&apos;</span> | sed -<span class="keyword">e</span> <span class="string">&apos; s/http:\/\///&apos;</span> -<span class="keyword">e</span> <span class="string">&apos; s/\/.*//&apos;</span> | <span class="keyword">sort</span> | uniq -<span class="keyword">c</span> | <span class="keyword">sort</span> -rn | head -<span class="number">20</span></span><br></pre></td></tr></tbody></table></figure><p>11&#x3001;&#x5217;&#x51FA;&#x4F20;&#x8F93;&#x5927;&#x5C0F;&#x6700;&#x5927;&#x7684;&#x51E0;&#x4E2A;&#x6587;&#x4EF6;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> www.access.<span class="keyword">log</span> |awk &apos;(<span class="variable">$7</span>~/\.php/){<span class="keyword">print</span> <span class="variable">$10</span> <span class="string">&quot; &quot;</span> <span class="variable">$1</span> <span class="string">&quot; &quot;</span> <span class="variable">$4</span> <span class="string">&quot; &quot;</span> <span class="variable">$7}</span>&apos;|<span class="keyword">sort</span> -nr|head -100</span><br></pre></td></tr></tbody></table></figure><p>12&#x3001;&#x5217;&#x51FA;&#x8F93;&#x51FA;&#x5927;&#x4E8E;200000byte(&#x7EA6;200kb)&#x7684;&#x9875;&#x9762;&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x9875;&#x9762;&#x53D1;&#x751F;&#x6B21;&#x6570;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> www.access.<span class="keyword">log</span> |awk &apos;(<span class="variable">$10</span> &gt; 200000 &amp;&amp; <span class="variable">$7</span>~/\.php/){<span class="keyword">print</span> <span class="variable">$7}</span>&apos;|<span class="keyword">sort</span> -<span class="keyword">n</span>|uniq -c|<span class="keyword">sort</span> -nr|head -100</span><br></pre></td></tr></tbody></table></figure><p>13&#x3001;&#x5982;&#x679C;&#x65E5;&#x5FD7;&#x6700;&#x540E;&#x4E00;&#x5217;&#x8BB0;&#x5F55;&#x7684;&#x662F;&#x9875;&#x9762;&#x6587;&#x4EF6;&#x4F20;&#x8F93;&#x65F6;&#x95F4;&#xFF0C;&#x5219;&#x6709;&#x5217;&#x51FA;&#x5230;&#x5BA2;&#x6237;&#x7AEF;&#x6700;&#x8017;&#x65F6;&#x7684;&#x9875;&#x9762;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> www.access.<span class="keyword">log</span> |awk &apos;(<span class="variable">$7</span>~/\.php/){<span class="keyword">print</span> <span class="variable">$NF</span> <span class="string">&quot; &quot;</span> <span class="variable">$1</span> <span class="string">&quot; &quot;</span> <span class="variable">$4</span> <span class="string">&quot; &quot;</span> <span class="variable">$7}</span>&apos;|<span class="keyword">sort</span> -nr|head -100</span><br></pre></td></tr></tbody></table></figure><p>14&#x3001;&#x5217;&#x51FA;&#x6700;&#x6700;&#x8017;&#x65F6;&#x7684;&#x9875;&#x9762;(&#x8D85;&#x8FC7;60&#x79D2;&#x7684;)&#x7684;&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x9875;&#x9762;&#x53D1;&#x751F;&#x6B21;&#x6570;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> www.access.<span class="keyword">log</span> |awk &apos;(<span class="variable">$NF</span> &gt; 60 &amp;&amp; <span class="variable">$7</span>~/\.php/){<span class="keyword">print</span> <span class="variable">$7}</span>&apos;|<span class="keyword">sort</span> -<span class="keyword">n</span>|uniq -c|<span class="keyword">sort</span> -nr|head -100</span><br></pre></td></tr></tbody></table></figure><p>15&#x3001;&#x5217;&#x51FA;&#x4F20;&#x8F93;&#x65F6;&#x95F4;&#x8D85;&#x8FC7; 30 &#x79D2;&#x7684;&#x6587;&#x4EF6;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> www.access.<span class="keyword">log</span> |awk &apos;(<span class="variable">$NF</span> &gt; 30){<span class="keyword">print</span> <span class="variable">$7}</span>&apos;|<span class="keyword">sort</span> -<span class="keyword">n</span>|uniq -c|<span class="keyword">sort</span> -nr|head -20</span><br></pre></td></tr></tbody></table></figure><p>16&#x3001;&#x5217;&#x51FA;&#x5F53;&#x524D;&#x670D;&#x52A1;&#x5668;&#x6BCF;&#x4E00;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#x7684;&#x6570;&#x91CF;&#xFF0C;&#x5012;&#x5E8F;&#x6392;&#x5217;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | <span class="type">awk</span> -F &apos; &apos; &apos;{print $<span class="number">8</span> <span class="string">&quot; &quot;</span> $<span class="number">9</span>}&apos; |<span class="type">sort</span> | <span class="type">uniq</span> -c |<span class="type">sort</span> -nr |<span class="type">head</span> <span class="number">-20</span></span><br></pre></td></tr></tbody></table></figure><p>17&#x3001;&#x67E5;&#x770B;apache&#x5F53;&#x524D;&#x5E76;&#x53D1;&#x8BBF;&#x95EE;&#x6570;<br>&#x5BF9;&#x6BD4;httpd.conf&#x4E2D;MaxClients&#x7684;&#x6570;&#x5B57;&#x5DEE;&#x8DDD;&#x591A;&#x5C11;&#x3002;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -an | <span class="type">grep</span> ESTABLISHED | <span class="type">wc</span> -l</span><br></pre></td></tr></tbody></table></figure><p>18&#x3001;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#x53C2;&#x6570;&#x67E5;&#x770B;&#x6570;&#x636E;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|<span class="type">grep</span> httpd|<span class="type">wc</span> -l</span><br></pre></td></tr></tbody></table></figure><p>&#x7EDF;&#x8BA1;httpd&#x8FDB;&#x7A0B;&#x6570;&#xFF0C;&#x8FDE;&#x4E2A;&#x8BF7;&#x6C42;&#x4F1A;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#xFF0C;&#x4F7F;&#x7528;&#x4E8E;Apache&#x670D;&#x52A1;&#x5668;&#x3002;<br>&#x8868;&#x793A;Apache&#x80FD;&#x591F;&#x5904;&#x7406;1388&#x4E2A;&#x5E76;&#x53D1;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD9;&#x4E2A;&#x503C;Apache&#x53EF;&#x6839;&#x636E;&#x8D1F;&#x8F7D;&#x60C5;&#x51B5;&#x81EA;&#x52A8;&#x8C03;&#x6574;&#x3002;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nat|<span class="type">grep</span> -i <span class="string">&quot;80&quot;</span>|<span class="type">wc</span> -l</span><br></pre></td></tr></tbody></table></figure><p>netstat -an&#x4F1A;&#x6253;&#x5370;&#x7CFB;&#x7EDF;&#x5F53;&#x524D;&#x7F51;&#x7EDC;&#x94FE;&#x63A5;&#x72B6;&#x6001;&#xFF0C;&#x800C;grep -i &#x201C;80&#x201D;&#x662F;&#x7528;&#x6765;&#x63D0;&#x53D6;&#x4E0E;80&#x7AEF;&#x53E3;&#x6709;&#x5173;&#x7684;&#x8FDE;&#x63A5;&#x7684;&#xFF0C;wc -l&#x8FDB;&#x884C;&#x8FDE;&#x63A5;&#x6570;&#x7EDF;&#x8BA1;&#x3002;<br>&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x5B57;&#x5C31;&#x662F;&#x5F53;&#x524D;&#x6240;&#x6709;80&#x7AEF;&#x53E3;&#x7684;&#x8BF7;&#x6C42;&#x603B;&#x6570;&#x3002;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -na|<span class="type">grep</span> ESTABLISHED|<span class="type">wc</span> -l</span><br></pre></td></tr></tbody></table></figure><p>netstat -an&#x4F1A;&#x6253;&#x5370;&#x7CFB;&#x7EDF;&#x5F53;&#x524D;&#x7F51;&#x7EDC;&#x94FE;&#x63A5;&#x72B6;&#x6001;&#xFF0C;&#x800C;grep ESTABLISHED &#x63D0;&#x53D6;&#x51FA;&#x5DF2;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x7684;&#x4FE1;&#x606F;&#x3002; &#x7136;&#x540E;wc -l&#x7EDF;&#x8BA1;&#x3002;<br>&#x6700;&#x7EC8;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x5B57;&#x5C31;&#x662F;&#x5F53;&#x524D;&#x6240;&#x6709;80&#x7AEF;&#x53E3;&#x7684;&#x5DF2;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x7684;&#x603B;&#x6570;&#x3002;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nat|<span class="type">|grep</span> ESTABLISHED|<span class="type">wc</span></span><br></pre></td></tr></tbody></table></figure><p>&#x53EF;&#x67E5;&#x770B;&#x6240;&#x6709;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x7684;&#x8BE6;&#x7EC6;&#x8BB0;&#x5F55;</p><p>19&#x3001;&#x8F93;&#x51FA;&#x6BCF;&#x4E2A;ip&#x7684;&#x8FDE;&#x63A5;&#x6570;&#xFF0C;&#x4EE5;&#x53CA;&#x603B;&#x7684;&#x5404;&#x4E2A;&#x72B6;&#x6001;&#x7684;&#x8FDE;&#x63A5;&#x6570;</p><figure class="highlight maxima"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -n | awk &apos;/^tcp/ {n=<span class="built_in">split</span>($(NF-<span class="number">1</span>),<span class="built_in">array</span>,<span class="string">&quot;:&quot;</span>);<span class="keyword">if</span>(n&lt;=<span class="number">2</span>)++S[<span class="built_in">array</span>[(<span class="number">1</span>)]];<span class="keyword">else</span>++S[<span class="built_in">array</span>[(<span class="number">4</span>)]];++s[$NF];++N} END {<span class="keyword">for</span>(a <span class="keyword">in</span> S){<span class="built_in">printf</span>(<span class="string">&quot;%-20s %s\n&quot;</span>, a, S[a]);++I}<span class="built_in">printf</span>(<span class="string">&quot;%-20s %s\n&quot;</span>,<span class="string">&quot;TOTAL_IP&quot;</span>,I);<span class="keyword">for</span>(a <span class="keyword">in</span> s) <span class="built_in">printf</span>(<span class="string">&quot;%-20s %s\n&quot;</span>,a, s[a]);<span class="built_in">printf</span>(<span class="string">&quot;%-20s %s\n&quot;</span>,<span class="string">&quot;TOTAL_LINK&quot;</span>,N);}&apos;</span><br></pre></td></tr></tbody></table></figure><p>20&#x3001;&#x5176;&#x4ED6;&#x7684;&#x6536;&#x96C6;<br>&#x5206;&#x6790;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x4E0B;2012-05-04&#x8BBF;&#x95EE;&#x9875;&#x9762;&#x6700;&#x9AD8;&#x7684;&#x524D;20&#x4E2A;URL&#x5E76;&#x6392;&#x5E8F;</p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> access.<span class="built_in">log</span> |<span class="keyword">grep</span> <span class="string">&apos;04/May/2012&apos;</span>| awk <span class="string">&apos;{print $11}&apos;</span>|<span class="keyword">sort</span>|uniq -<span class="keyword">c</span>|<span class="keyword">sort</span> -nr|head -<span class="number">20</span></span><br></pre></td></tr></tbody></table></figure><p>&#x67E5;&#x8BE2;&#x53D7;&#x8BBF;&#x95EE;&#x9875;&#x9762;&#x7684;URL&#x5730;&#x5740;&#x4E2D; &#x542B;&#x6709; www.abc.com &#x7F51;&#x5740;&#x7684; IP &#x5730;&#x5740;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> access_log | awk &apos;(<span class="variable">$11</span>~/\www.abc.com/){<span class="keyword">print</span> <span class="variable">$1}</span>&apos;|<span class="keyword">sort</span>|uniq -c|<span class="keyword">sort</span> -nr</span><br></pre></td></tr></tbody></table></figure><p>&#x83B7;&#x53D6;&#x8BBF;&#x95EE;&#x6700;&#x9AD8;&#x7684;10&#x4E2A;IP&#x5730;&#x5740; &#x540C;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x6309;&#x65F6;&#x95F4;&#x6765;&#x67E5;&#x8BE2;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> linewow-access.<span class="keyword">log</span>|awk &apos;{<span class="keyword">print</span> <span class="variable">$1}</span>&apos;|<span class="keyword">sort</span>|uniq -c|<span class="keyword">sort</span> -nr|head -10</span><br></pre></td></tr></tbody></table></figure><p>&#x65F6;&#x95F4;&#x6BB5;&#x67E5;&#x8BE2;&#x65E5;&#x5FD7;&#x65F6;&#x95F4;&#x6BB5;&#x7684;&#x60C5;&#x51B5;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat log_file | <span class="type">egrep</span> &apos;<span class="number">15</span>/Aug/<span class="number">2015</span>|<span class="type">16</span>/Aug/<span class="number">2015</span>&apos; |<span class="type">awk</span> &apos;{print $<span class="number">1</span>}&apos;|<span class="type">sort</span>|<span class="type">uniq</span> -c|<span class="type">sort</span> -nr|<span class="type">head</span> <span class="number">-10</span></span><br></pre></td></tr></tbody></table></figure><p>&#x5206;&#x6790;2015/8/15&#x5230;2015/8/16&#x8BBF;&#x95EE;&#x201D;/index.php?g=Member&amp;m=Public&amp;a=sendValidCode&#x201D;&#x7684;IP&#x5012;&#x5E8F;&#x6392;&#x5217;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> log_file | egrep &apos;15/Aug/2015|16/Aug/2015&apos; | awk &apos;{<span class="keyword">if</span>(<span class="variable">$7</span> == <span class="string">&quot;/index.php?g=Member&amp;m=Public&amp;a=sendValidCode&quot;</span>) <span class="keyword">print</span> <span class="variable">$1</span>,<span class="variable">$7}</span>&apos;|<span class="keyword">sort</span>|uniq -c|<span class="keyword">sort</span> -nr</span><br></pre></td></tr></tbody></table></figure><p>($7~/.php/) $7&#x91CC;&#x9762;&#x5305;&#x542B;.php&#x7684;&#x5C31;&#x8F93;&#x51FA;,&#x672C;&#x53E5;&#x7684;&#x610F;&#x601D;&#x662F;&#x6700;&#x8017;&#x65F6;&#x7684;&#x4E00;&#x767E;&#x4E2A;PHP&#x9875;&#x9762;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> log_file |awk &apos;(<span class="variable">$7</span>~/\.php/){<span class="keyword">print</span> <span class="variable">$NF</span> <span class="string">&quot; &quot;</span> <span class="variable">$1</span> <span class="string">&quot; &quot;</span> <span class="variable">$4</span> <span class="string">&quot; &quot;</span> <span class="variable">$7}</span>&apos;|<span class="keyword">sort</span> -nr|head -100</span><br></pre></td></tr></tbody></table></figure><p>&#x5217;&#x51FA;&#x6700;&#x6700;&#x8017;&#x65F6;&#x7684;&#x9875;&#x9762;(&#x8D85;&#x8FC7;60&#x79D2;&#x7684;)&#x7684;&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x9875;&#x9762;&#x53D1;&#x751F;&#x6B21;&#x6570;*</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> access.<span class="keyword">log</span> |awk &apos;(<span class="variable">$NF</span> &gt; 60 &amp;&amp; <span class="variable">$7</span>~/.php/){<span class="keyword">print</span> <span class="variable">$7}</span>&apos;|<span class="keyword">sort</span> -<span class="keyword">n</span>|uniq -c|<span class="keyword">sort</span> -nr|head -100</span><br></pre></td></tr></tbody></table></figure><p>&#x7EDF;&#x8BA1;&#x7F51;&#x7AD9;&#x6D41;&#x91CF;&#xFF08;G)</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> access.<span class="keyword">log</span> |awk &apos;{<span class="keyword">sum</span>+=<span class="variable">$10}</span> END {<span class="keyword">print</span> <span class="keyword">sum</span>/1024/1024/1024}&apos;</span><br></pre></td></tr></tbody></table></figure><p>&#x7EDF;&#x8BA1;404&#x7684;&#x8FDE;&#x63A5;</p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">awk</span> <span class="string">&apos;(<span class="variable">$9</span> ~/404/)&apos;</span> access.log | awk <span class="string">&apos;{print <span class="variable">$9</span>,<span class="variable">$7</span>}&apos;</span> | sort</span><br></pre></td></tr></tbody></table></figure><p>&#x7EDF;&#x8BA1;http status.</p><figure class="highlight gauss"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat access.<span class="built_in">log</span> |awk &apos;{<span class="built_in">counts</span>[$(<span class="number">9</span>)]+=<span class="number">1</span>}; <span class="keyword">END</span> {<span class="keyword">for</span>(<span class="built_in">code</span> in <span class="built_in">counts</span>) <span class="keyword">print</span> <span class="built_in">code</span>, <span class="built_in">counts</span>[<span class="built_in">code</span>]}&apos; </span><br><span class="line">cat access.<span class="built_in">log</span> |awk &apos;{<span class="keyword">print</span> $<span class="number">9</span>}&apos;|sort|uniq -c|sort -rn</span><br></pre></td></tr></tbody></table></figure><p>&#x6BCF;&#x79D2;&#x5E76;&#x53D1;&#xFF1A;</p><figure class="highlight dos"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch &quot;awk &apos;{<span class="keyword">if</span>($<span class="number">9</span>~/<span class="number">200</span>|<span class="number">30</span>|<span class="number">404</span>/)COUNT[$<span class="number">4</span>]++}END{<span class="keyword">for</span>( a <span class="keyword">in</span> COUNT) <span class="built_in">print</span> a,COUNT[a]}&apos; log_file|sort -k <span class="number">2</span> -nr|head -n10&quot;</span><br></pre></td></tr></tbody></table></figure><p>&#x5E26;&#x5BBD;&#x7EDF;&#x8BA1;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> apache.<span class="keyword">log</span> |awk &apos;{<span class="keyword">if</span>(<span class="variable">$7</span>~/GET/) <span class="keyword">count</span>++}END{<span class="keyword">print</span> <span class="string">&quot;client_request=&quot;</span><span class="keyword">count</span>}&apos; </span><br><span class="line"><span class="keyword">cat</span> apache.<span class="keyword">log</span> |awk &apos;{BYTE+=<span class="variable">$11}</span>END{<span class="keyword">print</span> <span class="string">&quot;client_kbyte_out=&quot;</span>BYTE/1024<span class="string">&quot;KB&quot;</span>}&apos;</span><br></pre></td></tr></tbody></table></figure><p>&#x627E;&#x51FA;&#x67D0;&#x5929;&#x8BBF;&#x95EE;&#x6B21;&#x6570;&#x6700;&#x591A;&#x7684;10&#x4E2A;IP</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /tmp/access.log | <span class="type">grep</span> <span class="string">&quot;20/Mar/2011&quot;</span> |<span class="type">awk</span> &apos;{print $<span class="number">3</span>}&apos;|<span class="type">sort</span> |<span class="type">uniq</span> -c|<span class="type">sort</span> -nr|<span class="type">head</span></span><br></pre></td></tr></tbody></table></figure><p>&#x5F53;&#x5929;ip&#x8FDE;&#x63A5;&#x6570;&#x6700;&#x9AD8;&#x7684;ip&#x90FD;&#x5728;&#x5E72;&#x4E9B;&#x4EC0;&#x4E48;:</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat access.log | <span class="type">grep</span> <span class="string">&quot;10.0.21.17&quot;</span> | <span class="type">awk</span> &apos;{print $<span class="number">8</span>}&apos; | <span class="type">sort</span> | <span class="type">uniq</span> -c | <span class="type">sort</span> -nr | <span class="type">head</span> -n <span class="number">10</span></span><br></pre></td></tr></tbody></table></figure><p>&#x5C0F;&#x65F6;&#x5355;&#x4F4D;&#x91CC;ip&#x8FDE;&#x63A5;&#x6570;&#x6700;&#x591A;&#x7684;10&#x4E2A;&#x65F6;&#x6BB5;</p><figure class="highlight maxima"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -vFS=<span class="string">&quot;[:]&quot;</span> &apos;{gsub(<span class="string">&quot;-.*&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>);<span class="built_in">num</span>[$<span class="number">2</span><span class="string">&quot; &quot;</span>$<span class="number">1</span>]++}END{<span class="keyword">for</span>(i <span class="keyword">in</span> <span class="built_in">num</span>)<span class="built_in">print</span> i,<span class="built_in">num</span>[i]}&apos; log_file | <span class="built_in">sort</span> -n -k <span class="number">3</span> -r | head -<span class="number">10</span></span><br></pre></td></tr></tbody></table></figure><p>&#x627E;&#x51FA;&#x8BBF;&#x95EE;&#x6B21;&#x6570;&#x6700;&#x591A;&#x7684;&#x51E0;&#x4E2A;&#x5206;&#x949F;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &apos;{print $<span class="number">1</span>}&apos; access.log | <span class="type">grep</span> <span class="string">&quot;20/Mar/2011&quot;</span> |<span class="type">cut</span> -c <span class="number">14</span><span class="number">-18</span>|<span class="type">sort</span>|<span class="type">uniq</span> -c|<span class="type">sort</span> -nr|<span class="type">head</span></span><br></pre></td></tr></tbody></table></figure><p>&#x53D6;5&#x5206;&#x949F;&#x65E5;&#x5FD7;</p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="variable">$DATE_MINUTE</span> != <span class="variable">$DATE_END_MINUTE</span> ] ;then #&#x5219;&#x5224;&#x65AD;&#x5F00;&#x59CB;&#x65F6;&#x95F4;&#x6233;&#x4E0E;&#x7ED3;&#x675F;&#x65F6;&#x95F4;&#x6233;&#x662F;&#x5426;&#x76F8;&#x7B49;<span class="attribute">START_LINE</span>=sed -n <span class="string">&quot;/<span class="variable">$DATE_MINUTE</span>/=&quot;</span> <span class="variable">$APACHE_LOG</span>|head -n1#&#x5982;&#x679C;&#x4E0D;&#x76F8;&#x7B49;&#xFF0C;&#x5219;&#x53D6;&#x51FA;&#x5F00;&#x59CB;&#x65F6;&#x95F4;&#x6233;&#x7684;&#x884C;&#x53F7;&#xFF0C;&#x4E0E;&#x7ED3;&#x675F;&#x65F6;&#x95F4;&#x6233;&#x7684;&#x884C;&#x53F7;</span><br></pre></td></tr></tbody></table></figure><p>&#x67E5;&#x770B;tcp&#x7684;&#x94FE;&#x63A5;&#x72B6;&#x6001;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">netstat -nat |awk &apos;{<span class="keyword">print</span> <span class="variable">$6}</span>&apos;|<span class="keyword">sort</span>|uniq -c|<span class="keyword">sort</span> -rn </span><br><span class="line"></span><br><span class="line">netstat -<span class="keyword">n</span> | awk &apos;/^tcp/ {++S[<span class="variable">$NF</span>]};END {<span class="keyword">for</span>(a <span class="keyword">in</span> S) <span class="keyword">print</span> a, S[a]}&apos; </span><br><span class="line"></span><br><span class="line">netstat -<span class="keyword">n</span> | awk &apos;/^tcp/ {++state[<span class="variable">$NF</span>]}; END {<span class="keyword">for</span>(key <span class="keyword">in</span> state) <span class="keyword">print</span> key,<span class="string">&quot;\t&quot;</span>,state[key]}&apos; </span><br><span class="line"></span><br><span class="line">netstat -<span class="keyword">n</span> | awk &apos;/^tcp/ {++arr[<span class="variable">$NF</span>]};END {<span class="keyword">for</span>(k <span class="keyword">in</span> arr) <span class="keyword">print</span> k,<span class="string">&quot;\t&quot;</span>,arr[k]}&apos; </span><br><span class="line"></span><br><span class="line">netstat -<span class="keyword">n</span> |awk &apos;/^tcp/ {<span class="keyword">print</span> <span class="variable">$NF}</span>&apos;|<span class="keyword">sort</span>|uniq -c|<span class="keyword">sort</span> -rn </span><br><span class="line"></span><br><span class="line">netstat -ant | awk &apos;{<span class="keyword">print</span> <span class="variable">$NF}</span>&apos; | grep -v &apos;[a-z]&apos; | <span class="keyword">sort</span> | uniq -c</span><br><span class="line">netstat -ant|awk &apos;/ip:80/{<span class="keyword">split</span>(<span class="variable">$5</span>,ip,<span class="string">&quot;:&quot;</span>);++S[ip[1]]}END{<span class="keyword">for</span> (a <span class="keyword">in</span> S) <span class="keyword">print</span> S[a],a}&apos; |<span class="keyword">sort</span> -<span class="keyword">n</span> </span><br><span class="line"></span><br><span class="line">netstat -ant|awk &apos;/:80/{<span class="keyword">split</span>(<span class="variable">$5</span>,ip,<span class="string">&quot;:&quot;</span>);++S[ip[1]]}END{<span class="keyword">for</span> (a <span class="keyword">in</span> S) <span class="keyword">print</span> S[a],a}&apos; |<span class="keyword">sort</span> -rn|head -<span class="keyword">n</span> 10 </span><br><span class="line"></span><br><span class="line">awk &apos;BEGIN{printf (<span class="string">&quot;http_code\tcount_num\n&quot;</span>)}{<span class="keyword">COUNT</span>[<span class="variable">$10</span>]++}END{<span class="keyword">for</span> (a <span class="keyword">in</span> <span class="keyword">COUNT</span>) printf a<span class="string">&quot;\t\t&quot;</span><span class="keyword">COUNT</span>[a]<span class="string">&quot;\n&quot;</span>}&apos;</span><br></pre></td></tr></tbody></table></figure><p>&#x67E5;&#x627E;&#x8BF7;&#x6C42;&#x6570;&#x524D;20&#x4E2A;IP&#xFF08;&#x5E38;&#x7528;&#x4E8E;&#x67E5;&#x627E;&#x653B;&#x6765;&#x6E90;&#xFF09;&#xFF1A;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -anlp|<span class="type">grep</span> <span class="number">80</span>|<span class="type">grep</span> tcp|<span class="type">awk</span> &apos;{print $<span class="number">5</span>}&apos;|<span class="type">awk</span> -F: &apos;{print $<span class="number">1</span>}&apos;|<span class="type">sort</span>|<span class="type">uniq</span> -c|<span class="type">sort</span> -nr|<span class="type">head</span> -n20 </span><br><span class="line">netstat -ant |<span class="type">awk</span> &apos;/:<span class="number">80</span>/{<span class="built_in">split</span>($<span class="number">5</span>,ip,<span class="string">&quot;:&quot;</span>);++A[ip[<span class="number">1</span>]]}END{<span class="keyword">for</span>(i <span class="built_in">in</span> A) print A[i],i}&apos; |<span class="type">sort</span> -rn|<span class="type">head</span> -n20</span><br></pre></td></tr></tbody></table></figure><p>&#x7528;tcpdump&#x55C5;&#x63A2;80&#x7AEF;&#x53E3;&#x7684;&#x8BBF;&#x95EE;&#x770B;&#x770B;&#x8C01;&#x6700;&#x9AD8;</p><figure class="highlight lsl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 -tnn dst port <span class="number">80</span> -c <span class="number">1000</span> | awk -F<span class="string">&quot;.&quot;</span> &apos;{print $<span class="number">1</span><span class="string">&quot;.&quot;</span>$<span class="number">2</span><span class="string">&quot;.&quot;</span>$<span class="number">3</span><span class="string">&quot;.&quot;</span>$<span class="number">4</span>}&apos; | sort | uniq -c | sort -nr |head <span class="number">-20</span></span><br></pre></td></tr></tbody></table></figure><p>&#x67E5;&#x627E;&#x8F83;&#x591A;time_wait&#x8FDE;&#x63A5;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -n|<span class="type">grep</span> TIME_WAIT|<span class="type">awk</span> &apos;{print $<span class="number">5</span>}&apos;|<span class="type">sort</span>|<span class="type">uniq</span> -c|<span class="type">sort</span> -rn|<span class="type">head</span> -n20</span><br></pre></td></tr></tbody></table></figure><p>&#x627E;&#x67E5;&#x8F83;&#x591A;&#x7684;SYN&#x8FDE;&#x63A5;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -<span class="keyword">an</span> | grep SYN | awk &apos;{<span class="keyword">print</span> <span class="variable">$5}</span>&apos; | awk -F: &apos;{<span class="keyword">print</span> <span class="variable">$1}</span>&apos; | <span class="keyword">sort</span> | uniq -c | <span class="keyword">sort</span> -nr | <span class="keyword">more</span></span><br></pre></td></tr></tbody></table></figure><p>&#x6839;&#x636E;&#x7AEF;&#x53E3;&#x5217;&#x8FDB;&#x7A0B;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ntlp | <span class="type">grep</span> <span class="number">80</span> | <span class="type">awk</span> &apos;{print $<span class="number">7</span>}&apos; | <span class="type">cut</span> -d/ -f1</span><br></pre></td></tr></tbody></table></figure><p>&#x67E5;&#x770B;&#x4E86;&#x8FDE;&#x63A5;&#x6570;&#x548C;&#x5F53;&#x524D;&#x7684;&#x8FDE;&#x63A5;&#x6570;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -ant | <span class="type">grep</span> $ip:<span class="number">80</span> | <span class="type">wc</span> -l </span><br><span class="line">netstat -ant | <span class="type">grep</span> $ip:<span class="number">80</span> | <span class="type">grep</span> EST | <span class="type">wc</span> -l</span><br></pre></td></tr></tbody></table></figure><p>&#x67E5;&#x770B;IP&#x8BBF;&#x95EE;&#x6B21;&#x6570;</p><figure class="highlight coq"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nat|<span class="type">grep</span> <span class="string">&quot;:80&quot;</span>|<span class="type">awk</span> &apos;{print $<span class="number">5</span>}&apos; |<span class="type">awk</span> -F: &apos;{print $<span class="number">1</span>}&apos; | <span class="type">sort</span>| <span class="type">uniq</span> -c|<span class="type">sort</span> -n</span><br></pre></td></tr></tbody></table></figure><p>Linux&#x547D;&#x4EE4;&#x5206;&#x6790;&#x5F53;&#x524D;&#x7684;&#x94FE;&#x63A5;&#x72B6;&#x51B5;</p><figure class="highlight tap"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">netstat -n | awk &apos;/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}&apos;</span><br><span class="line">watch &quot;netstat -n | awk &apos;/^tcp/ {++S[\$NF]} END {for(a in S) print a, S[a]}&apos;&quot; <span class="comment"># &#x901A;&#x8FC7;watch&#x53EF;&#x4EE5;&#x4E00;&#x76F4;&#x76D1;&#x63A7;</span></span><br><span class="line"></span><br><span class="line">LAST_ACK<span class="number"> 5 </span>&#x5173;&#x95ED;&#x4E00;&#x4E2A;TCP&#x8FDE;&#x63A5;&#x9700;&#x8981;&#x4ECE;&#x4E24;&#x4E2A;&#x65B9;&#x5411;&#x4E0A;&#x5206;&#x522B;&#x8FDB;&#x884C;&#x5173;&#x95ED;&#xFF0C;&#x53CC;&#x65B9;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x53D1;&#x9001;FIN&#x6765;&#x8868;&#x793A;&#x5355;&#x65B9;&#x5411;&#x6570;&#x636E;&#x7684;&#x5173;&#x95ED;&#xFF0C;&#x5F53;&#x901A;&#x4FE1;&#x53CC;&#x65B9;&#x53D1;&#x9001;&#x4E86;&#x6700;&#x540E;&#x4E00;&#x4E2A;FIN&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53D1;&#x9001;&#x65B9;&#x6B64;&#x65F6;&#x5904;&#x4E8E;LAST_ACK&#x72B6;&#x6001;&#xFF0C;&#x5F53;&#x53D1;&#x9001;&#x65B9;&#x6536;&#x5230;&#x5BF9;&#x65B9;&#x7684;&#x786E;&#x8BA4;&#xFF08;Fin&#x7684;Ack&#x786E;&#x8BA4;&#xFF09;&#x540E;&#x624D;&#x771F;&#x6B63;&#x5173;&#x95ED;&#x6574;&#x4E2A;TCP&#x8FDE;&#x63A5;&#xFF1B;</span><br><span class="line"></span><br><span class="line">SYN_RECV<span class="number"> 30 </span><span class="comment"># &#x8868;&#x793A;&#x6B63;&#x5728;&#x7B49;&#x5F85;&#x5904;&#x7406;&#x7684;&#x8BF7;&#x6C42;&#x6570;&#xFF1B;</span></span><br><span class="line"></span><br><span class="line">ESTABLISHED<span class="number"> 1597 </span><span class="comment"># &#x8868;&#x793A;&#x6B63;&#x5E38;&#x6570;&#x636E;&#x4F20;&#x8F93;&#x72B6;&#x6001;&#xFF1B;</span></span><br><span class="line"></span><br><span class="line">FIN_WAIT1<span class="number"> 51 </span><span class="comment"># &#x8868;&#x793A;server&#x7AEF;&#x4E3B;&#x52A8;&#x8981;&#x6C42;&#x5173;&#x95ED;tcp&#x8FDE;&#x63A5;&#xFF1B;</span></span><br><span class="line"></span><br><span class="line">FIN_WAIT2<span class="number"> 504 </span><span class="comment"># &#x8868;&#x793A;&#x5BA2;&#x6237;&#x7AEF;&#x4E2D;&#x65AD;&#x8FDE;&#x63A5;&#xFF1B;</span></span><br><span class="line"></span><br><span class="line">TIME_WAIT<span class="number"> 1057 </span><span class="comment"># &#x8868;&#x793A;&#x5904;&#x7406;&#x5B8C;&#x6BD5;&#xFF0C;&#x7B49;&#x5F85;&#x8D85;&#x65F6;&#x7ED3;&#x675F;&#x7684;&#x8BF7;&#x6C42;&#x6570;&#xFF1B;</span></span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;整理一些服务器日志分析命令，大家可以试试！&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Centos7防火墙</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/Centos7%E9%98%B2%E7%81%AB%E5%A2%99.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/Centos7防火墙.html</id>
    <published>2019-01-24T07:57:12.000Z</published>
    <updated>2019-01-24T08:28:19.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="centos7-&#x9632;&#x706B;&#x5899;&#x7B80;&#x5355;&#x914D;&#x7F6E;"><a href="#centos7-&#x9632;&#x706B;&#x5899;&#x7B80;&#x5355;&#x914D;&#x7F6E;" class="headerlink" title="centos7 &#x9632;&#x706B;&#x5899;&#x7B80;&#x5355;&#x914D;&#x7F6E;"></a>centos7 &#x9632;&#x706B;&#x5899;&#x7B80;&#x5355;&#x914D;&#x7F6E;</h4><a id="more"></a><h2 id="&#x5F00;&#x542F;&#x9632;&#x706B;&#x5899;&#x5E76;&#x52A0;&#x5165;&#x5F00;&#x673A;&#x542F;&#x52A8;"><a href="#&#x5F00;&#x542F;&#x9632;&#x706B;&#x5899;&#x5E76;&#x52A0;&#x5165;&#x5F00;&#x673A;&#x542F;&#x52A8;" class="headerlink" title="&#x5F00;&#x542F;&#x9632;&#x706B;&#x5899;&#x5E76;&#x52A0;&#x5165;&#x5F00;&#x673A;&#x542F;&#x52A8;"></a>&#x5F00;&#x542F;&#x9632;&#x706B;&#x5899;&#x5E76;&#x52A0;&#x5165;&#x5F00;&#x673A;&#x542F;&#x52A8;</h2><p><code>systemctl start firewalld # &#x5F00;&#x542F;&#x9632;&#x706B;&#x5899;</code></p><p><code>systemctl enable firewalld # &#x5F00;&#x673A;&#x542F;&#x52A8;</code></p><h2 id="&#x63A7;&#x5236;&#x7AEF;&#x53E3;-&#x670D;&#x52A1;"><a href="#&#x63A7;&#x5236;&#x7AEF;&#x53E3;-&#x670D;&#x52A1;" class="headerlink" title="&#x63A7;&#x5236;&#x7AEF;&#x53E3;/&#x670D;&#x52A1;"></a>&#x63A7;&#x5236;&#x7AEF;&#x53E3;/&#x670D;&#x52A1;</h2><p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x63A7;&#x5236;&#x7AEF;&#x53E3;&#x7684;&#x5F00;&#x653E;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x6307;&#x5B9A;&#x7AEF;&#x53E3;&#x53F7;&#x53E6;&#x4E00;&#x79CD;&#x662F;&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x540D;&#x3002;&#x867D;&#x7136;&#x5F00;&#x653E;http&#x670D;&#x52A1;&#x5C31;&#x662F;&#x5F00;&#x653E;&#x4E86;80&#x7AEF;&#x53E3;&#xFF0C;&#x4F46;&#x662F;&#x8FD8;&#x662F;&#x4E0D;&#x80FD;&#x901A;&#x8FC7;&#x7AEF;&#x53E3;&#x53F7;&#x6765;&#x5173;&#x95ED;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x540D;&#x5F00;&#x653E;&#x7684;&#x5C31;&#x8981;&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x670D;&#x52A1;&#x540D;&#x5173;&#x95ED;&#xFF1B;&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x7AEF;&#x53E3;&#x53F7;&#x5F00;&#x653E;&#x7684;&#x5C31;&#x8981;&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x7AEF;&#x53E3;&#x53F7;&#x5173;&#x95ED;&#x3002;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x5C31;&#x662F;&#x6307;&#x5B9A;&#x7AEF;&#x53E3;&#x7684;&#x65F6;&#x5019;&#x4E00;&#x5B9A;&#x8981;&#x6307;&#x5B9A;&#x662F;&#x4EC0;&#x4E48;&#x534F;&#x8BAE;&#xFF0C;tcp&#x8FD8;&#x662F;udp&#x3002;&#x77E5;&#x9053;&#x8FD9;&#x4E2A;&#x4E4B;&#x540E;&#x4EE5;&#x540E;&#x5C31;&#x4E0D;&#x7528;&#x6BCF;&#x6B21;&#x5148;&#x5173;&#x9632;&#x706B;&#x5899;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x9632;&#x706B;&#x5899;&#x771F;&#x6B63;&#x7684;&#x751F;&#x6548;&#x3002;</p><p><code>firewall-cmd --add-service=mysql        # &#x5F00;&#x653E;mysql&#x7AEF;&#x53E3;</code></p><p><code>firewall-cmd --remove-service=http      # &#x963B;&#x6B62;http&#x7AEF;&#x53E3;</code></p><p><code>firewall-cmd --list-services            # &#x67E5;&#x770B;&#x5F00;&#x653E;&#x7684;&#x670D;&#x52A1;</code></p><p><code>firewall-cmd --add-port=``3306``/tcp        # &#x5F00;&#x653E;&#x901A;&#x8FC7;tcp&#x8BBF;&#x95EE;``3306</code></p><p><code>firewall-cmd --remove-port=80tcp        # &#x963B;&#x6B62;&#x901A;&#x8FC7;tcp&#x8BBF;&#x95EE;``3306</code></p><p><code>firewall-cmd --add-port=``233``/udp         # &#x5F00;&#x653E;&#x901A;&#x8FC7;udp&#x8BBF;&#x95EE;``233</code></p><p><code>firewall-cmd --list-ports               # &#x67E5;&#x770B;&#x5F00;&#x653E;&#x7684;&#x7AEF;&#x53E3;</code></p><p><code>firewall-cmd  --permanent --zone=public --add-port=443/tcp #&#x6C38;&#x4E45;&#x751F;&#x6548;</code></p><p><code>firewall-cmd  --permanent --zone=public --add-port=80/tcp #&#x6C38;&#x4E45;&#x751F;&#x6548;</code></p><p><code>firewall-cmd  --reload #&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x9632;&#x706B;&#x5899;</code></p><h2 id="&#x4F2A;&#x88C5;IP"><a href="#&#x4F2A;&#x88C5;IP" class="headerlink" title="&#x4F2A;&#x88C5;IP"></a>&#x4F2A;&#x88C5;IP</h2><p>&#x9632;&#x706B;&#x5899;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x4F2A;&#x88C5;IP&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4E0B;&#x9762;&#x7684;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x5C31;&#x4F1A;&#x7528;&#x5230;&#x8FD9;&#x4E2A;&#x529F;&#x80FD;&#x3002;<br><code>firewall-cmd --query-masquerade # &#x68C0;&#x67E5;&#x662F;&#x5426;&#x5141;&#x8BB8;&#x4F2A;&#x88C5;IP</code></p><p><code>firewall-cmd --add-masquerade   # &#x5141;&#x8BB8;&#x9632;&#x706B;&#x5899;&#x4F2A;&#x88C5;IP</code></p><p><code>firewall-cmd --remove-masquerade# &#x7981;&#x6B62;&#x9632;&#x706B;&#x5899;&#x4F2A;&#x88C5;IP</code></p><h2 id="&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;"><a href="#&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;" class="headerlink" title="&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;"></a>&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;</h2><p>&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x53EF;&#x4EE5;&#x5C06;&#x6307;&#x5B9A;&#x5730;&#x5740;&#x8BBF;&#x95EE;&#x6307;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;&#x65F6;&#xFF0C;&#x5C06;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x81F3;&#x6307;&#x5B9A;&#x5730;&#x5740;&#x7684;&#x6307;&#x5B9A;&#x7AEF;&#x53E3;&#x3002;&#x8F6C;&#x53D1;&#x7684;&#x76EE;&#x7684;&#x5982;&#x679C;&#x4E0D;&#x6307;&#x5B9A;ip&#x7684;&#x8BDD;&#x5C31;&#x9ED8;&#x8BA4;&#x4E3A;&#x672C;&#x673A;&#xFF0C;&#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E86;ip&#x5374;&#x6CA1;&#x6307;&#x5B9A;&#x7AEF;&#x53E3;&#xFF0C;&#x5219;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x6765;&#x6E90;&#x7AEF;&#x53E3;&#x3002;</p><p>&#x5982;&#x679C;&#x914D;&#x7F6E;&#x597D;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x4E4B;&#x540E;&#x4E0D;&#x80FD;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x68C0;&#x67E5;&#x4E0B;&#x9762;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;</p><ol><li>&#x6BD4;&#x5982;&#x6211;&#x5C06;80&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x81F3;8080&#x7AEF;&#x53E3;&#xFF0C;&#x9996;&#x5148;&#x68C0;&#x67E5;&#x672C;&#x5730;&#x7684;80&#x7AEF;&#x53E3;&#x548C;&#x76EE;&#x6807;&#x7684;8080&#x7AEF;&#x53E3;&#x662F;&#x5426;&#x5F00;&#x653E;&#x76D1;&#x542C;&#x4E86;</li><li>&#x5176;&#x6B21;&#x68C0;&#x67E5;&#x662F;&#x5426;&#x5141;&#x8BB8;&#x4F2A;&#x88C5;IP&#xFF0C;&#x6CA1;&#x5141;&#x8BB8;&#x7684;&#x8BDD;&#x8981;&#x5F00;&#x542F;&#x4F2A;&#x88C5;IP</li></ol><p><code>firewall-cmd --add-forward-port=port=``80``:proto=tcp:toport=``8080</code>   <code># &#x5C06;``80``&#x7AEF;&#x53E3;&#x7684;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x81F3;``8080</code></p><p><code>firewall-cmd --add-forward-port=port=``80``:proto=tcp:toaddr=``192.168``.``0.1</code> <code># &#x5C06;``80``&#x7AEF;&#x53E3;&#x7684;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x81F3;``192.168``.``0.1</code></p><p><code>firewall-cmd --add-forward-port=port=``80``:proto=tcp:toaddr=``192.168``.``0.1``:toport=``8080</code> <code># &#x5C06;``80``&#x7AEF;&#x53E3;&#x7684;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x81F3;``192.168``.``0.1``&#x7684;``8080``&#x7AEF;&#x53E3;</code></p><ol><li>&#x5F53;&#x6211;&#x4EEC;&#x60F3;&#x628A;&#x67D0;&#x4E2A;&#x7AEF;&#x53E3;&#x9690;&#x85CF;&#x8D77;&#x6765;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x9632;&#x706B;&#x5899;&#x4E0A;&#x963B;&#x6B62;&#x90A3;&#x4E2A;&#x7AEF;&#x53E3;&#x8BBF;&#x95EE;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5F00;&#x4E00;&#x4E2A;&#x4E0D;&#x89C4;&#x5219;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x4E4B;&#x540E;&#x914D;&#x7F6E;&#x9632;&#x706B;&#x5899;&#x7684;&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#xFF0C;&#x5C06;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x8FC7;&#x53BB;&#x3002;</li><li>&#x7AEF;&#x53E3;&#x8F6C;&#x53D1;&#x8FD8;&#x53EF;&#x4EE5;&#x505A;&#x6D41;&#x91CF;&#x5206;&#x53D1;&#xFF0C;&#x4E00;&#x4E2A;&#x9632;&#x706B;&#x5899;&#x62D6;&#x7740;&#x597D;&#x591A;&#x53F0;&#x8FD0;&#x884C;&#x7740;&#x4E0D;&#x540C;&#x670D;&#x52A1;&#x7684;&#x673A;&#x5668;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x9632;&#x706B;&#x5899;&#x5C06;&#x4E0D;&#x540C;&#x7AEF;&#x53E3;&#x7684;&#x6D41;&#x91CF;&#x8F6C;&#x53D1;&#x81F3;&#x4E0D;&#x540C;&#x673A;&#x5668;&#x3002;</li></ol><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;centos7-防火墙简单配置&quot;&gt;&lt;a href=&quot;#centos7-防火墙简单配置&quot; class=&quot;headerlink&quot; title=&quot;centos7 防火墙简单配置&quot;&gt;&lt;/a&gt;centos7 防火墙简单配置&lt;/h4&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>CentOS7利用systemctl添加自定义系统服务</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/CentOS7%E5%88%A9%E7%94%A8systemctl%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/CentOS7利用systemctl添加自定义系统服务.html</id>
    <published>2019-01-24T07:56:33.000Z</published>
    <updated>2019-01-24T08:28:34.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>CentOS 7&#x7684;&#x670D;&#x52A1;systemctl&#x811A;&#x672C;&#x5B58;&#x653E;&#x5728;&#xFF1A;/usr/lib/systemd/&#xFF0C;&#x6709;&#x7CFB;&#x7EDF;&#xFF08;system&#xFF09;&#x548C;&#x7528;&#x6237;&#xFF08;user&#xFF09;&#x4E4B;&#x5206;&#xFF0C;&#x9700;&#x8981;&#x5F00;&#x673A;&#x4E0D;&#x767B;&#x9646;&#x5C31;&#x80FD;&#x8FD0;&#x884C;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x5B58;&#x5728;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;&#x91CC;&#xFF0C;&#x5373;&#xFF1A;/usr/lib/systemd/system&#x76EE;&#x5F55;&#x4E0B;<br><a id="more"></a><br>&#x6BCF;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x4EE5;.service&#x7ED3;&#x5C3E;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x5206;&#x4E3A;3&#x90E8;&#x5206;&#xFF1A;[Unit]&#x3001;[Service]&#x548C;[Install]&#xFF0C;&#x6211;&#x5199;&#x7684;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x7528;&#x4E8E;&#x5F00;&#x673A;&#x8FD0;&#x884C;tomcat&#x9879;&#x76EE;:<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/tomcat.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=tomcatapi</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/usr/<span class="built_in">local</span>/tomcat/tomcat.pid</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/tomcat/bin/startup.sh</span><br><span class="line">ExecReload=</span><br><span class="line">ExecStop=/usr/<span class="built_in">local</span>/tomcat/bin/shutdown.sh</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure><p></p><p>[Unit]&#x90E8;&#x5206;&#x4E3B;&#x8981;&#x662F;&#x5BF9;&#x8FD9;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x8BF4;&#x660E;&#xFF0C;&#x5185;&#x5BB9;&#x5305;&#x62EC;Description&#x548C;After&#xFF0C;Description&#x7528;&#x4E8E;&#x63CF;&#x8FF0;&#x670D;&#x52A1;&#xFF0C;After&#x7528;&#x4E8E;&#x63CF;&#x8FF0;&#x670D;&#x52A1;&#x7C7B;&#x522B;;<br>[Service]&#x90E8;&#x5206;&#x662F;&#x670D;&#x52A1;&#x7684;&#x5173;&#x952E;&#xFF0C;&#x662F;&#x670D;&#x52A1;&#x7684;&#x4E00;&#x4E9B;&#x5177;&#x4F53;&#x8FD0;&#x884C;&#x53C2;&#x6570;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x8FD9;&#x91CC;Type=forking&#x662F;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x7684;&#x5F62;&#x5F0F;&#xFF0C;PIDFile&#x4E3A;&#x5B58;&#x653E;PID&#x7684;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF0C;ExecStart&#x4E3A;&#x670D;&#x52A1;&#x7684;&#x8FD0;&#x884C;&#x547D;&#x4EE4;&#xFF0C;ExecReload&#x4E3A;&#x91CD;&#x542F;&#x547D;&#x4EE4;&#xFF0C;ExecStop&#x4E3A;&#x505C;&#x6B62;&#x547D;&#x4EE4;&#xFF0C;PrivateTmp=True&#x8868;&#x793A;&#x7ED9;&#x670D;&#x52A1;&#x5206;&#x914D;&#x72EC;&#x7ACB;&#x7684;&#x4E34;&#x65F6;&#x7A7A;&#x95F4;&#xFF0C;&#x6CE8;&#x610F;&#xFF1A;[Service]&#x90E8;&#x5206;&#x7684;&#x542F;&#x52A8;&#x3001;&#x91CD;&#x542F;&#x3001;&#x505C;&#x6B62;&#x547D;&#x4EE4;&#x5168;&#x90E8;&#x8981;&#x6C42;&#x4F7F;&#x7528;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x4F7F;&#x7528;&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;&#x5219;&#x4F1A;&#x62A5;&#x9519;;<br>[Install]&#x90E8;&#x5206;&#x662F;&#x670D;&#x52A1;&#x5B89;&#x88C5;&#x7684;&#x76F8;&#x5173;&#x8BBE;&#x7F6E;&#xFF0C;&#x53EF;&#x8BBE;&#x7F6E;&#x4E3A;&#x591A;&#x7528;&#x6237;&#x7684;<br>&#x670D;&#x52A1;&#x811A;&#x672C;&#x6309;&#x7167;&#x4E0A;&#x9762;&#x7F16;&#x5199;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x4EE5;754&#x7684;&#x6743;&#x9650;&#x4FDD;&#x5B58;&#x5728;/usr/lib/systemd/system&#x76EE;&#x5F55;&#x4E0B;&#xFF0C;&#x8FD9;&#x65F6;&#x5C31;&#x53EF;&#x4EE5;&#x5229;&#x7528;systemctl&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#x4E86;</p><p>&#x6700;&#x540E;&#x7528;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x5C06;&#x670D;&#x52A1;&#x52A0;&#x5165;&#x5F00;&#x673A;&#x542F;&#x52A8;&#x5373;&#x53EF;&#xFF1A;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> tomcat</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5982;&#x679C;&#x4FEE;&#x6539;&#x8FC7;&#x8FC7;&#x811A;&#x672C;&#x6216;&#x8005;&#x914D;&#x7F6E;&#xFF0C;&#x9700;&#x8981;&#x91CD;&#x65B0;reload&#x4E0B;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></tbody></table></figure><p></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;CentOS 7的服务systemctl脚本存放在：/usr/lib/systemd/，有系统（system）和用户（user）之分，需要开机不登陆就能运行的程序，存在系统服务里，即：/usr/lib/systemd/system目录下&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>给OpenVPN添加用户访问日志</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/%E7%BB%99OpenVPN%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/给OpenVPN添加用户访问日志.html</id>
    <published>2019-01-24T07:55:28.000Z</published>
    <updated>2019-01-24T08:29:14.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="openVPN-&#x6DFB;&#x52A0;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x65E5;&#x5FD7;"><a href="#openVPN-&#x6DFB;&#x52A0;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x65E5;&#x5FD7;" class="headerlink" title="openVPN &#x6DFB;&#x52A0;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x65E5;&#x5FD7;"></a>openVPN &#x6DFB;&#x52A0;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x65E5;&#x5FD7;</h4><a id="more"></a><h2 id="1&#x3001;&#x5EFA;&#x7ACB;openvpn&#x7684;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x548C;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x811A;&#x672C;"><a href="#1&#x3001;&#x5EFA;&#x7ACB;openvpn&#x7684;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x548C;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x811A;&#x672C;" class="headerlink" title="1&#x3001;&#x5EFA;&#x7ACB;openvpn&#x7684;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x548C;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x811A;&#x672C;"></a>1&#x3001;&#x5EFA;&#x7ACB;openvpn&#x7684;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#x548C;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x811A;&#x672C;</h2><h3 id="&#x5EFA;&#x7ACB;-etc-openvpn-connect&#x6587;&#x4EF6;&#xFF0C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;"><a href="#&#x5EFA;&#x7ACB;-etc-openvpn-connect&#x6587;&#x4EF6;&#xFF0C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;" class="headerlink" title="&#x5EFA;&#x7ACB;/etc/openvpn/connect&#x6587;&#x4EF6;&#xFF0C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;"></a>&#x5EFA;&#x7ACB;/etc/openvpn/connect&#x6587;&#x4EF6;&#xFF0C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">day=`date +%F`</span><br><span class="line"><span class="keyword">if</span> [ -f /var/<span class="built_in">log</span>/openvpn/<span class="variable">$day</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;`date &apos;+%F %H:%M:%S&apos;` User <span class="variable">$common_name</span> is logged in&quot;</span> &gt;&gt;/var/<span class="built_in">log</span>/openvpn/<span class="variable">$day</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">touch /var/<span class="built_in">log</span>/openvpn/<span class="variable">$day</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;`date &apos;+%F %H:%M:%S&apos;` User <span class="variable">$common_name</span> is logged in&quot;</span> &gt;&gt;/var/<span class="built_in">log</span>/openvpn/<span class="variable">$day</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></tbody></table></figure><h3 id="&#x5EFA;&#x7ACB;-etc-openvpn-disconnect&#x6587;&#x4EF6;&#xFF0C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;"><a href="#&#x5EFA;&#x7ACB;-etc-openvpn-disconnect&#x6587;&#x4EF6;&#xFF0C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;" class="headerlink" title="&#x5EFA;&#x7ACB;/etc/openvpn/disconnect&#x6587;&#x4EF6;&#xFF0C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;"></a>&#x5EFA;&#x7ACB;/etc/openvpn/disconnect&#x6587;&#x4EF6;&#xFF0C;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#xFF1A;</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">day=`date +%F`</span><br><span class="line"><span class="keyword">if</span> [ -f /var/<span class="built_in">log</span>/openvpn/<span class="variable">$day</span> ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;`date &apos;+%F %H:%M:%S&apos;` User <span class="variable">$common_name</span> is logged off&quot;</span> &gt;&gt;/var/<span class="built_in">log</span>/openvpn/<span class="variable">$day</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">touch /var/<span class="built_in">log</span>/openvpn/<span class="variable">$day</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;`date &apos;+%F %H:%M:%S&apos;` User <span class="variable">$common_name</span> is logged off&quot;</span> &gt;&gt;/var/<span class="built_in">log</span>/openvpn/<span class="variable">$day</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></tbody></table></figure><h3 id="&#x8981;&#x5C06;&#x8FD9;&#x4E24;&#x4E2A;&#x811A;&#x672C;&#x8D4B;&#x4E88;&#x6267;&#x884C;&#x6743;&#x9650;"><a href="#&#x8981;&#x5C06;&#x8FD9;&#x4E24;&#x4E2A;&#x811A;&#x672C;&#x8D4B;&#x4E88;&#x6267;&#x884C;&#x6743;&#x9650;" class="headerlink" title="&#x8981;&#x5C06;&#x8FD9;&#x4E24;&#x4E2A;&#x811A;&#x672C;&#x8D4B;&#x4E88;&#x6267;&#x884C;&#x6743;&#x9650;"></a>&#x8981;&#x5C06;&#x8FD9;&#x4E24;&#x4E2A;&#x811A;&#x672C;&#x8D4B;&#x4E88;&#x6267;&#x884C;&#x6743;&#x9650;</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /etc/openvpn/connect</span><br><span class="line">chmod +x /etc/openvpn/disconnect</span><br></pre></td></tr></tbody></table></figure><h3 id="&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#x56E0;&#x4E3A;openvpn&#x662F;&#x4EE5;nodody&#x5E10;&#x53F7;&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x8D4B;&#x4E88;nodody&#x5E10;&#x53F7;&#x5BF9;-var-log-openvpn&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#x7684;&#x5199;&#x6743;&#x9650;&#xFF0C;&#x5426;&#x5219;openvpn&#x7684;&#x8FD0;&#x884C;&#x5C06;&#x53D7;&#x5230;&#x5F71;&#x54CD;&#xFF0C;&#x7528;&#x6237;&#x767B;&#x5F55;&#x8FC7;&#x7A0B;&#x4E0D;&#x80FD;&#x5B8C;&#x6210;&#x3002;"><a href="#&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#x56E0;&#x4E3A;openvpn&#x662F;&#x4EE5;nodody&#x5E10;&#x53F7;&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x8D4B;&#x4E88;nodody&#x5E10;&#x53F7;&#x5BF9;-var-log-openvpn&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#x7684;&#x5199;&#x6743;&#x9650;&#xFF0C;&#x5426;&#x5219;openvpn&#x7684;&#x8FD0;&#x884C;&#x5C06;&#x53D7;&#x5230;&#x5F71;&#x54CD;&#xFF0C;&#x7528;&#x6237;&#x767B;&#x5F55;&#x8FC7;&#x7A0B;&#x4E0D;&#x80FD;&#x5B8C;&#x6210;&#x3002;" class="headerlink" title="&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#x56E0;&#x4E3A;openvpn&#x662F;&#x4EE5;nodody&#x5E10;&#x53F7;&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x8D4B;&#x4E88;nodody&#x5E10;&#x53F7;&#x5BF9;/var/log/openvpn&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#x7684;&#x5199;&#x6743;&#x9650;&#xFF0C;&#x5426;&#x5219;openvpn&#x7684;&#x8FD0;&#x884C;&#x5C06;&#x53D7;&#x5230;&#x5F71;&#x54CD;&#xFF0C;&#x7528;&#x6237;&#x767B;&#x5F55;&#x8FC7;&#x7A0B;&#x4E0D;&#x80FD;&#x5B8C;&#x6210;&#x3002;**"></a>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#x56E0;&#x4E3A;openvpn&#x662F;&#x4EE5;nodody&#x5E10;&#x53F7;&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x8D4B;&#x4E88;nodody&#x5E10;&#x53F7;&#x5BF9;/var/log/openvpn&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#x7684;&#x5199;&#x6743;&#x9650;&#xFF0C;&#x5426;&#x5219;openvpn&#x7684;&#x8FD0;&#x884C;&#x5C06;&#x53D7;&#x5230;&#x5F71;&#x54CD;&#xFF0C;&#x7528;&#x6237;&#x767B;&#x5F55;&#x8FC7;&#x7A0B;&#x4E0D;&#x80FD;&#x5B8C;&#x6210;&#x3002;**</h3><h2 id="2&#x3001;&#x4FEE;&#x6539;openvpn&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x542F;&#x7528;&#x811A;&#x672C;"><a href="#2&#x3001;&#x4FEE;&#x6539;openvpn&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x542F;&#x7528;&#x811A;&#x672C;" class="headerlink" title="2&#x3001;&#x4FEE;&#x6539;openvpn&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x542F;&#x7528;&#x811A;&#x672C;"></a>2&#x3001;&#x4FEE;&#x6539;openvpn&#x670D;&#x52A1;&#x5668;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x542F;&#x7528;&#x811A;&#x672C;</h2><p>&#x4FEE;&#x6539;/etc/openvpn/server.conf&#xFF0C;&#x6DFB;&#x52A0;&#x5982;&#x4E0B;&#x4E24;&#x884C;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">client-connect /etc/openvpn/connect</span><br><span class="line">client-disconnect /etc/openvpn/disconnect</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x8FD9;&#x6837;&#x6BCF;&#x5929;&#x5C31;&#x4F1A;&#x5728;/var/log/openvpn&#x4E0B;&#x9762;&#x5EFA;&#x7ACB;&#x6587;&#x4EF6;&#x540D;&#x4E3A;2007-06-04&#x8FD9;&#x6837;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x8BE5;&#x6587;&#x4EF6;&#x8BB0;&#x5F55;&#x4E86;&#x5F53;&#x5929;&#x767B;&#x9646;openvpn&#x7684;&#x7528;&#x6237;&#x540D;&#x548C;&#x65F6;&#x95F4;&#xFF0C;&#x8F93;&#x51FA;&#x4F8B;&#x5982;&#xFF1A;<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2007-06-04 11:51:53 User rwen is logged in</span><br><span class="line">2007-06-04 11:55:54 User rwen is logged off &#xFF08;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x56E0;&#x4E3A;openvpn&#x672C;&#x8EAB;&#x5224;&#x65AD;&#x673A;&#x5236;&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x767B;&#x51FA;&#x65F6;&#x95F4;&#x6BD4;&#x5B9E;&#x9645;&#x767B;&#x51FA;&#x65F6;&#x95F4;&#x6162;3&#x5206;&#x949F;&#xFF09;</span><br></pre></td></tr></tbody></table></figure><p></p><h2 id="3&#x3001;&#x542F;&#x52A8;&#x672C;&#x673A;&#x7684;sendmail"><a href="#3&#x3001;&#x542F;&#x52A8;&#x672C;&#x673A;&#x7684;sendmail" class="headerlink" title="3&#x3001;&#x542F;&#x52A8;&#x672C;&#x673A;&#x7684;sendmail"></a>3&#x3001;&#x542F;&#x52A8;&#x672C;&#x673A;&#x7684;sendmail</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --level 3 sendmail on</span><br><span class="line">service sendmail start</span><br></pre></td></tr></tbody></table></figure><h2 id="4&#x3001;&#x5EFA;&#x7ACB;-etc-openvpn-mail2admin-&#x5E76;&#x8D4B;&#x4E88;&#x6267;&#x884C;&#x6743;&#x9650;-chmod-x-mail2admin"><a href="#4&#x3001;&#x5EFA;&#x7ACB;-etc-openvpn-mail2admin-&#x5E76;&#x8D4B;&#x4E88;&#x6267;&#x884C;&#x6743;&#x9650;-chmod-x-mail2admin" class="headerlink" title="4&#x3001;&#x5EFA;&#x7ACB;/etc/openvpn/mail2admin,&#x5E76;&#x8D4B;&#x4E88;&#x6267;&#x884C;&#x6743;&#x9650; chmod +x mail2admin"></a>4&#x3001;&#x5EFA;&#x7ACB;/etc/openvpn/mail2admin,&#x5E76;&#x8D4B;&#x4E88;&#x6267;&#x884C;&#x6743;&#x9650; chmod +x mail2admin</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">today=`date +%F`</span><br><span class="line"><span class="keyword">if</span> [ -f /var/<span class="built_in">log</span>/openvpn/<span class="variable">$today</span> ];<span class="keyword">then</span></span><br><span class="line">mail -s <span class="string">&quot;<span class="variable">$today</span> openvpn user access log&quot;</span> [username@yourcompany.com](http://www.360doc.com/mailto:rwen@corp.netease.com)&lt; /var/<span class="built_in">log</span>/openvpn/<span class="variable">$today</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></tbody></table></figure><h2 id="5&#x3001;&#x5EFA;&#x7ACB;cron&#x5DE5;&#x4F5C;&#x8868;&#xFF0C;&#x6BCF;&#x5929;&#x5B9A;&#x65F6;23&#xFF1A;55&#x5206;&#x53D1;&#x9001;&#x5F53;&#x5929;&#x7684;&#x65E5;&#x5FD7;&#x7ED9;&#x7BA1;&#x7406;&#x5458;"><a href="#5&#x3001;&#x5EFA;&#x7ACB;cron&#x5DE5;&#x4F5C;&#x8868;&#xFF0C;&#x6BCF;&#x5929;&#x5B9A;&#x65F6;23&#xFF1A;55&#x5206;&#x53D1;&#x9001;&#x5F53;&#x5929;&#x7684;&#x65E5;&#x5FD7;&#x7ED9;&#x7BA1;&#x7406;&#x5458;" class="headerlink" title="5&#x3001;&#x5EFA;&#x7ACB;cron&#x5DE5;&#x4F5C;&#x8868;&#xFF0C;&#x6BCF;&#x5929;&#x5B9A;&#x65F6;23&#xFF1A;55&#x5206;&#x53D1;&#x9001;&#x5F53;&#x5929;&#x7684;&#x65E5;&#x5FD7;&#x7ED9;&#x7BA1;&#x7406;&#x5458;"></a>5&#x3001;&#x5EFA;&#x7ACB;cron&#x5DE5;&#x4F5C;&#x8868;&#xFF0C;&#x6BCF;&#x5929;&#x5B9A;&#x65F6;23&#xFF1A;55&#x5206;&#x53D1;&#x9001;&#x5F53;&#x5929;&#x7684;&#x65E5;&#x5FD7;&#x7ED9;&#x7BA1;&#x7406;&#x5458;</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#crontab -e</span></span><br><span class="line">55 23 * * * /etc/openvpn/mail2admin</span><br></pre></td></tr></tbody></table></figure><h3 id="&#x641E;&#x5B9A;&#xFF01;"><a href="#&#x641E;&#x5B9A;&#xFF01;" class="headerlink" title="&#x641E;&#x5B9A;&#xFF01;"></a>&#x641E;&#x5B9A;&#xFF01;</h3><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;openVPN-添加用户访问日志&quot;&gt;&lt;a href=&quot;#openVPN-添加用户访问日志&quot; class=&quot;headerlink&quot; title=&quot;openVPN 添加用户访问日志&quot;&gt;&lt;/a&gt;openVPN 添加用户访问日志&lt;/h4&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Docker私有仓库Harbor部署https</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/Docker%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93Harbor%E9%83%A8%E7%BD%B2https.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/Docker私有仓库Harbor部署https.html</id>
    <published>2019-01-24T07:47:39.000Z</published>
    <updated>2019-01-24T08:30:33.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="&#x79C1;&#x6709;&#x4ED3;&#x5E93;harbor&#x914D;&#x7F6E;HTTPS&#x90E8;&#x7F72;"><a href="#&#x79C1;&#x6709;&#x4ED3;&#x5E93;harbor&#x914D;&#x7F6E;HTTPS&#x90E8;&#x7F72;" class="headerlink" title="&#x79C1;&#x6709;&#x4ED3;&#x5E93;harbor&#x914D;&#x7F6E;HTTPS&#x90E8;&#x7F72;"></a>&#x79C1;&#x6709;&#x4ED3;&#x5E93;harbor&#x914D;&#x7F6E;HTTPS&#x90E8;&#x7F72;</h4><a id="more"></a><h3 id="1-&#x73AF;&#x5883;&#x88C5;&#x5907;&#xFF1A;"><a href="#1-&#x73AF;&#x5883;&#x88C5;&#x5907;&#xFF1A;" class="headerlink" title="1.&#x73AF;&#x5883;&#x88C5;&#x5907;&#xFF1A;"></a>1.&#x73AF;&#x5883;&#x88C5;&#x5907;&#xFF1A;</h3><p>Portus,Portus&#x548C;harbor&#x90FD;&#x662F;&#x5F00;&#x6E90;&#x7684;Registry&#x670D;&#x52A1;&#x5668; ,Portusv&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#xFF1A;docker-Portusv2.1&#x955C;&#x50CF;&#x4ED3;&#x5E93;&#x5FEB;&#x901F;&#x90E8;&#x7F72;&#x4F7F;&#x7528;<a href="http://www.linuxea.com/1547.html" target="_blank" rel="noopener">http://www.linuxea.com/1547.html</a><br>&#x5F53;&#x7136;&#xFF0C;&#x8FD8;&#x6709;gitlab8.8.0&#x63D0;&#x4F9B;&#x7684;docker Registry&#xFF0C;&#x4E5F;&#x662F;&#x975E;&#x5E38;&#x597D;&#x7528;&#x7684;,&#x53EF;&#x53C2;&#x8003;<a href="https://about.gitlab.com/2016/05/23/gitlab-container-registry/" target="_blank" rel="noopener">https://about.gitlab.com/2016/05/23/gitlab-container-registry/</a><br>centos7.2.1511,python2.7&#x4EE5;&#x4E0A;&#x7248;&#x672C;&#xFF0C;docker&#x5F15;&#x64CE;1.10&#x6216;&#x8005;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#xFF0C;docker compose&#x9700;&#x8981;1.6.0&#x6216;&#x8005;&#x66F4;&#x9AD8;&#x7248;&#x672C;<br>harbor&#x5B89;&#x88C5;&#x53C2;&#x8003;&#xFF1A;<a href="https://github.com/vmware/harbor/blob/master/docs/installation_guide.md" target="_blank" rel="noopener">https://github.com/vmware/harbor/blob/master/docs/installation_guide.md</a><br>harbor&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;<a href="https://github.com/vmware/harbor/releases" target="_blank" rel="noopener">https://github.com/vmware/harbor/releases</a><br>vmware&#x5B89;&#x88C5;&#x53C2;&#x8003;&#xFF1A;<a href="https://github.com/vmware/harbor/blob/master/docs/installation_guide_ova.md" target="_blank" rel="noopener">https://github.com/vmware/harbor/blob/master/docs/installation_guide_ova.md</a><br>&#x5B89;&#x88C5;&#x5305;&#x5206;&#x4E3A;&#x79BB;&#x7EBF;&#xFF0C;&#x7F51;&#x7EDC;&#xFF0C;&#x6E90;&#x7801;&#x5B89;&#x88C5;<br>&#x7F51;&#x7EDC;&#x5B89;&#x88C5;&#x5305;&#xFF1A;<a href="https://github.com/vmware/harbor/releases/download/1.1.2/harbor-online-installer-1.1.2.tgz" target="_blank" rel="noopener">https://github.com/vmware/harbor/releases/download/1.1.2/harbor-online-installer-1.1.2.tgz</a><br>&#x79BB;&#x7EBF;&#x5B89;&#x88C5;&#x5305;&#xFF1A;<a href="https://github.com/vmware/harbor/releases/download/1.1.2/harbor-offline-installer-1.1.2.tgz" target="_blank" rel="noopener">https://github.com/vmware/harbor/releases/download/1.1.2/harbor-offline-installer-1.1.2.tgz</a><br>&#x6E90;&#x4EE3;&#x7801;&#xFF1B;<a href="https://github.com/vmware/harbor/archive/1.1.2.tar.gz" target="_blank" rel="noopener">https://github.com/vmware/harbor/archive/1.1.2.tar.gz</a><br>&#x4EC0;&#x4E48;&#x662F;harbor<br>&#x7B80;&#x5355;&#x7684;&#x8BF4;&#xFF0C;Harbor &#x662F;&#x4E00;&#x4E2A;&#x4F01;&#x4E1A;&#x7EA7;&#x7684; Docker Registry&#xFF0C;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0; images &#x7684;&#x79C1;&#x6709;&#x5B58;&#x50A8;&#x548C;&#x65E5;&#x5FD7;&#x7EDF;&#x8BA1;&#x6743;&#x9650;&#x63A7;&#x5236;&#x7B49;&#x529F;&#x80FD;&#xFF0C;&#x5E76;&#x652F;&#x6301;&#x521B;&#x5EFA;&#x591A;&#x9879;&#x76EE;(Harbor &#x63D0;&#x51FA;&#x7684;&#x6982;&#x5FF5;)&#xFF0C;&#x57FA;&#x4E8E;&#x5B98;&#x65B9; Registry V2 &#x5B9E;&#x73B0;&#x3002;</p><h3 id="2-&#x914D;&#x7F6E;&#x53C2;&#x6570;&#xFF1A;"><a href="#2-&#x914D;&#x7F6E;&#x53C2;&#x6570;&#xFF1A;" class="headerlink" title="2.&#x914D;&#x7F6E;&#x53C2;&#x6570;&#xFF1A;"></a>2.&#x914D;&#x7F6E;&#x53C2;&#x6570;&#xFF1A;</h3><figure class="highlight makefile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x5728;harbor.cfg&#x4E2D;</span><br><span class="line">&#x4FEE;&#x6539;hostname = &#x57DF;&#x540D;</span><br><span class="line">&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x4F4D;&#x4E8E;&#x6587;&#x4EF6;harbor.cfg&#x3002;&#x53C2;&#x6570;&#x8BF4;&#x660E;&#x5982;&#x4E0B;-&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x6700;&#x8D77;&#x7801;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x6539;&#x53D8;&#x4E3B;&#x673A;&#x5C5E;&#x6027;&#x3002;</span><br><span class="line">&#x4E3B;&#x673A;&#xFF1A;&#x76EE;&#x6807;&#x4E3B;&#x673A;&#x7684;&#x4E3B;&#x673A;&#x540D;&#xFF0C;&#x8FD9;&#x662F;&#x7528;&#x4E8E;&#x8BBF;&#x95EE;&#x7528;&#x6237;&#x754C;&#x9762;&#x548C;&#x6CE8;&#x518C;&#x8868;&#x670D;&#x52A1;&#x3002;&#x5B83;&#x5E94;&#x8BE5;&#x662F;IP&#x5730;&#x5740;&#x6216;&#x76EE;&#x6807;&#x8BA1;&#x7B97;&#x673A;&#x7684;&#x5B8C;&#x5168;&#x9650;&#x5B9A;&#x57DF;&#x540D;&#xFF08;FQDN&#xFF09;&#xFF0C;&#x4F8B;&#x5982;&#xFF0C;192.168.1.10&#x6216;reg.yourdomain.com&#x3002;&#x4E0D;&#x8981;&#x4F7F;&#x7528;localhost&#x6216;127.0.0.1&#x4F5C;&#x4E3A;&#x4E3B;&#x673A;&#x540D;-&#x6CE8;&#x518C;&#x8868;&#x670D;&#x52A1;&#x9700;&#x8981;&#x7531;&#x5916;&#x90E8;&#x5BA2;&#x6237;&#x7AEF;&#x8BBF;&#x95EE;&#xFF01;</span><br><span class="line">ui_url_protocol&#xFF1A;&#xFF08;HTTP&#x6216;HTTPS&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;HTTP&#xFF09;&#x7528;&#x4E8E;&#x8BBF;&#x95EE;&#x7528;&#x6237;&#x754C;&#x9762;&#x548C;&#x4EE4;&#x724C;/&#x901A;&#x77E5;&#x670D;&#x52A1;&#x7684;&#x534F;&#x8BAE;&#x3002;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x662F;HTTP&#x3002;&#x8981;&#x5EFA;&#x7ACB;HTTPS&#x534F;&#x8BAE;&#xFF0C;&#x8BF7;&#x53C2;&#x9605;&#x914D;&#x7F6E;&#x4E0E;&#x6E2F;HTTPS&#x8BBF;&#x95EE;&#x3002;</span><br><span class="line">&#x7535;&#x5B50;&#x90AE;&#x4EF6;&#x8BBE;&#x7F6E;&#xFF1A;&#x9700;&#x8981;&#x5BF9;&#x6E2F;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#xFF0C;&#x4EE5;&#x4FBF;&#x80FD;&#x591F;&#x5411;&#x7528;&#x6237;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x201C;&#x5BC6;&#x7801;&#x91CD;&#x8BBE;&#x201D;&#x7535;&#x5B50;&#x90AE;&#x4EF6;&#xFF0C;&#x4EE5;&#x53CA;&#x662F;&#x5426;&#x9700;&#x8981;&#x8BE5;&#x529F;&#x80FD;&#x53EA;&#x662F;&#x5FC5;&#x8981;&#x7684;&#x3002;&#x8FD8;&#x6709;&#xFF0C;&#x5343;&#x4E07;&#x6CE8;&#x610F;&#xFF0C;&#x5728;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;SSL&#x8FDE;&#x63A5;&#x662F;&#x6CA1;&#x6709;&#x542F;&#x7528;-&#x5982;&#x679C;&#x4F60;&#x7684;SMTP&#x670D;&#x52A1;&#x5668;&#x9700;&#x8981;SSL&#xFF0C;&#x4F46;&#x4E0D;&#x652F;&#x6301;STARTTLS&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x5E94;&#x8BE5;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;&#x542F;&#x7528;SSL email_ssl = TRUE&#x3002;</span><br><span class="line">email_server = smtp.mydomain.com</span><br><span class="line">email_server_port = 25</span><br><span class="line">email_username = sample_admin@mydomain.com</span><br><span class="line">email_password = abc</span><br><span class="line">EMAIL_FROM =&#x7BA1;&#x7406;&#x5458;sample_admin@mydomain.com</span><br><span class="line">email_ssl = false</span><br><span class="line">harbor_admin_password&#xFF1A;&#x7BA1;&#x7406;&#x5458;&#x7684;&#x521D;&#x59CB;&#x5BC6;&#x7801;&#x3002;&#x6B64;&#x5BC6;&#x7801;&#x4EC5;&#x5728;&#x6E2F;&#x53E3;&#x9996;&#x6B21;&#x53D1;&#x5E03;&#x65F6;&#x751F;&#x6548;&#x3002;&#x4E4B;&#x540E;&#xFF0C;&#x5C06;&#x5FFD;&#x7565;&#x6B64;&#x8BBE;&#x7F6E;&#xFF0C;&#x5E76;&#x4E14;&#x5E94;&#x5728;UI&#x4E2D;&#x8BBE;&#x7F6E;&#x7BA1;&#x7406;&#x5458;&#x7684;&#x5BC6;&#x7801;&#x3002;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#x9ED8;&#x8BA4;&#x7684;&#x7528;&#x6237;&#x540D;/&#x5BC6;&#x7801;&#x7BA1;&#x7406;/ Harbor12345&#x3002;</span><br><span class="line">auth_mode&#xFF1A;&#x7528;&#x4E8E;&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x7F3A;&#x7701;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B83;&#x662F;db_auth&#xFF0C;&#x5373;&#x51ED;&#x8BC1;&#x5B58;&#x50A8;&#x5728;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x3002;&#x5BF9;&#x4E8E;LDAP&#x8EAB;&#x4EFD;&#x9A8C;&#x8BC1;&#xFF0C;&#x6B64;&#x8BBE;&#x7F6E;&#x4E86;ldap_auth&#x3002;</span><br><span class="line"><span class="section">ldap_url&#xFF1A;&#x672C;LDAP&#x7AEF;&#x70B9;URL&#xFF08;&#x4F8B;&#x5982;ldaps://ldap.mydomain.com&#xFF09;&#x3002; &#x4EC5;&#x5F53;&#x4F7F;&#x7528;auth_mode&#x8BBE;&#x4E3A;&#x4E86;ldap_auth&#x3002;</span></span><br><span class="line">ldap_searchdn&#xFF1A;&#x8C01;&#x6709;&#x6743;&#x641C;&#x7D22;LDAP / AD&#x670D;&#x52A1;&#x5668;&#xFF08;&#x4F8B;&#x5982;&#x6743;&#x9650;&#x7684;&#x7528;&#x6237;&#x7684;DN uid=admin,ou=people,dc=mydomain,dc=com&#xFF09;&#x3002;</span><br><span class="line">ldap_search_pwd&#xFF1A;&#x7531;&#x6307;&#x5B9A;&#x7684;&#x7528;&#x6237;&#x7684;&#x5BC6;&#x7801;ldap_searchdn&#x3002;</span><br><span class="line">LDAP_BASEDN&#xFF1A;&#x57FA;&#x672C;DN&#x6765;&#x67E5;&#x627E;&#x7528;&#x6237;&#xFF0C;&#x4F8B;&#x5982;ou=people,dc=mydomain,dc=com&#x3002; &#x4EC5;&#x5F53;&#x4F7F;&#x7528;auth_mode&#x8BBE;&#x4E3A;&#x4E86;ldap_auth&#x3002;</span><br><span class="line">ldap_filter&#xFF1A;&#x7528;&#x4E8E;&#x67E5;&#x627E;&#x7528;&#x6237;&#xFF0C;&#x4F8B;&#x5982;&#x641C;&#x7D22;&#x7B5B;&#x9009;&#x5668;(objectClass=person)&#x3002;</span><br><span class="line">LDAP_UID&#xFF1A;&#x7528;&#x4E8E;&#x4E00;&#x4E2A;LDAP&#x641C;&#x7D22;&#x671F;&#x95F4;&#x7528;&#x6237;&#x5339;&#x914D;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x6D41;&#x4F53;&#xFF0C;CN&#xFF0C;&#x7535;&#x5B50;&#x90AE;&#x4EF6;&#x6216;&#x5176;&#x4ED6;&#x5C5E;&#x6027;&#x3002;</span><br><span class="line">ldap_scope&#xFF1A;&#x8303;&#x56F4;&#x4EE5;&#x641C;&#x7D22;&#x7528;&#x6237;&#xFF0C;1- LDAP_SCOPE_BASE&#xFF0C;2- LDAP_SCOPE_ONELEVEL&#xFF0C;3- LDAP_SCOPE_SUBTREE&#x3002;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;3&#x3002;</span><br><span class="line">DB_PASSWORD&#xFF1A;&#x5BF9;&#x4E8E;&#x7528;&#x4E8E;MySQL&#x6570;&#x636E;&#x5E93;&#x7684;root&#x5BC6;&#x7801;db_auth&#x3002;&#x66F4;&#x6539;&#x6B64;&#x5BC6;&#x7801;&#x4EE5;&#x7528;&#x4E8E;&#x4EFB;&#x4F55;&#x751F;&#x4EA7;&#x4F7F;&#x7528;&#xFF01;</span><br><span class="line">self_registration&#xFF1A;&#xFF08;&#x4E0A;&#x6216;&#x5173;&#x95ED;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;&#x4E0A;&#xFF09;&#x542F;&#x7528;/&#x7981;&#x7528;&#x7528;&#x6237;&#x6CE8;&#x518C;&#x81EA;&#x5DF1;&#x7684;&#x80FD;&#x529B;&#x3002;&#x7981;&#x7528;&#x65F6;&#xFF0C;&#x65B0;&#x7528;&#x6237;&#x53EA;&#x80FD;&#x7531;&#x7BA1;&#x7406;&#x5458;&#x7528;&#x6237;&#x521B;&#x5EFA;&#xFF0C;&#x53EA;&#x6709;&#x7BA1;&#x7406;&#x5458;&#x7528;&#x6237;&#x624D;&#x80FD;&#x5728;Harbor&#x4E2D;&#x521B;&#x5EFA;&#x65B0;&#x7528;&#x6237;&#x3002; &#x6CE8;&#xFF1A;&#x5F53;auth_mode&#x8BBE;&#x4E3A;&#x4E86;ldap_auth&#xFF0C;&#x81EA;&#x6CE8;&#x518C;&#x529F;&#x80FD;&#x603B;&#x662F;&#x7981;&#x7528;&#xFF0C;&#x8FD9;&#x4E2A;&#x6807;&#x5FD7;&#x5C06;&#x88AB;&#x5FFD;&#x7565;&#x3002;</span><br><span class="line">use_compressed_js&#xFF1A;&#xFF08;&#x4E0A;&#x6216;&#x5173;&#x95ED;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;&#x4E0A;&#xFF09;&#xFF0C;&#x4F9B;&#x751F;&#x4EA7;&#x4F7F;&#x7528;&#xFF0C;&#x628A;&#x8FD9;&#x4E2A;&#x6807;&#x5FD7;&#x4E0A;&#x3002;&#x5728;&#x5F00;&#x53D1;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x5C06;&#x5176;&#x8BBE;&#x7F6E;&#x4E3A;&#x5173;&#x95ED;&#xFF0C;&#x8FD9;&#x6837;&#x7684;JS&#x6587;&#x4EF6;&#x53EF;&#x4EE5;&#x5355;&#x72EC;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#x3002;</span><br><span class="line">max_job_workers&#xFF1A;&#xFF08;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;3&#xFF09;&#x590D;&#x5236;&#x5DE5;&#x4EBA;&#x5C31;&#x4E1A;&#x670D;&#x52A1;&#x7684;&#x6700;&#x5927;&#x6570;&#x91CF;&#x3002;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E2A;&#x56FE;&#x50CF;&#x590D;&#x5236;&#x4F5C;&#x4E1A;&#xFF0C;&#x5DE5;&#x4F5C;&#x7A0B;&#x5E8F;&#x5C06;&#x5B58;&#x50A8;&#x5E93;&#x7684;&#x6240;&#x6709;&#x6807;&#x8BB0;&#x540C;&#x6B65;&#x5230;&#x8FDC;&#x7A0B;&#x76EE;&#x6807;&#x3002;&#x589E;&#x52A0;&#x6B64;&#x6570;&#x76EE;&#x5141;&#x8BB8;&#x7CFB;&#x7EDF;&#x4E2D;&#x66F4;&#x591A;&#x7684;&#x5E76;&#x53D1;&#x590D;&#x5236;&#x4F5C;&#x4E1A;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x7531;&#x4E8E;&#x6BCF;&#x4E2A;&#x5DE5;&#x4EBA;&#x6D88;&#x8017;&#x4E00;&#x5B9A;&#x91CF;&#x7684;&#x7F51;&#x7EDC;/ CPU / IO&#x8D44;&#x6E90;&#xFF0C;&#x8BF7;&#x6839;&#x636E;&#x4E3B;&#x673A;&#x7684;&#x786C;&#x4EF6;&#x8D44;&#x6E90;&#x4ED4;&#x7EC6;&#x9009;&#x62E9;&#x6B64;&#x5C5E;&#x6027;&#x7684;&#x503C;&#x3002;</span><br><span class="line">token_expiration&#xFF1A;&#x5230;&#x671F;&#x65F6;&#x95F4;&#xFF08;&#x5206;&#x949F;&#xFF09;&#x901A;&#x8FC7;&#x4EE4;&#x724C;&#x670D;&#x52A1;&#x521B;&#x5EFA;&#x7684;&#x4EE4;&#x724C;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;30&#x5206;&#x949F;&#x3002;</span><br><span class="line">verify_remote_cert&#xFF1A;&#xFF08;&#x4E0A;&#x6216;&#x5173;&#x95ED;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;&#x4E0A;&#xFF09;&#x8BE5;&#x6807;&#x5FD7;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x9A8C;&#x8BC1;SSL / TLS&#x8BC1;&#x4E66;&#x65F6;&#xFF0C;&#x6E2F;&#x53E3;&#xFF0C;&#x8FDC;&#x7A0B;&#x6CE8;&#x518C;&#x8868;&#x5B9E;&#x4F8B;&#x901A;&#x4FE1;&#x3002;&#x8BBE;&#x7F6E;&#x8FD9;&#x4E2A;&#x5C5E;&#x6027;&#x5173;&#x7ED5;&#x8FC7;SSL / TLS&#x9A8C;&#x8BC1;&#xFF0C;&#x8FD9;&#x662F;&#x901A;&#x5E38;&#x7528;&#x5728;&#x8FDC;&#x7A0B;&#x5B9E;&#x4F8B;&#x6709;&#x81EA;&#x7B7E;&#x540D;&#x6216;&#x4E0D;&#x53D7;&#x4FE1;&#x4EFB;&#x7684;&#x8BC1;&#x4E66;&#x3002;</span><br><span class="line">customize_crt&#xFF1A;&#xFF08;&#x4E0A;&#x6216;&#x5173;&#x95ED;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;&#x4E0A;&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x6B64;&#x5C5E;&#x6027;&#x4E0A;&#xFF0C;&#x5728;&#x51C6;&#x5907;&#x811A;&#x672C;&#x521B;&#x5EFA;&#x6CE8;&#x518C;&#x8868;&#x7684;&#x4EE4;&#x724C;&#x751F;&#x6210;/&#x9A8C;&#x8BC1;&#x79C1;&#x94A5;&#x548C;&#x6839;&#x8BC1;&#x4E66;&#x3002;&#x4EE5;&#x4E0B;&#x5C5E;&#x6027;&#xFF1A;crt_country&#xFF0C;crt_state&#xFF0C;crt_location&#xFF0C;crt_organization&#xFF0C;crt_organizationalunit&#xFF0C;crt_commonname&#xFF0C;crt_email&#x88AB;&#x7528;&#x4F5C;&#x7528;&#x4E8E;&#x4EA7;&#x751F;&#x5BC6;&#x94A5;&#x7684;&#x53C2;&#x6570;&#x3002;&#x8BE5;&#x5C5E;&#x6027;&#x8BBE;&#x7F6E;&#x4E3A;&#x5173;&#x95ED;&#x65F6;&#xFF0C;&#x5BC6;&#x94A5;&#x548C;&#x6839;&#x8BC1;&#x4E66;&#x662F;&#x7531;&#x5916;&#x90E8;&#x6765;&#x6E90;&#x63D0;&#x4F9B;&#x3002;&#x8BF7;&#x53C2;&#x9605;&#x81EA;&#x5B9A;&#x4E49;&#x952E;&#x548C;&#x6E2F;&#x4EE4;&#x724C;&#x670D;&#x52A1;&#x8BC1;&#x4E66;&#x83B7;&#x53D6;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x3002;</span><br></pre></td></tr></tbody></table></figure><h3 id="3-&#x5F00;&#x59CB;&#x5B89;&#x88C5;"><a href="#3-&#x5F00;&#x59CB;&#x5B89;&#x88C5;" class="headerlink" title="3.&#x5F00;&#x59CB;&#x5B89;&#x88C5;"></a>3.&#x5F00;&#x59CB;&#x5B89;&#x88C5;</h3><figure class="highlight autoit"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@harbor</span> ~]<span class="meta"># yum install epel-release<span class="comment">;</span></span></span><br><span class="line">[root<span class="symbol">@harbor</span> ~]<span class="meta"># yum install openssl openssl-devel docker-io</span></span><br><span class="line">[root<span class="symbol">@harbor</span> ~]<span class="meta"># mkdir -p /data/cert &amp;&amp; cd /data/cert/</span></span><br><span class="line">[root<span class="symbol">@harbor</span> ~]<span class="meta"># openssl req  -newkey rsa:4096 -nodes -sha256 -keyout ca.key -x509 -days 365 -out ca.crt -subj <span class="string">&quot;/C=CN/L=London/O=Company Ltd/CN=nginx-docker&quot;</span></span></span><br><span class="line">[root<span class="symbol">@harbor</span> ~]<span class="meta"># openssl req -newkey rsa:4096 -nodes -sha256 -keyout harbor.wolf7.org.key -out server.csr -subj <span class="string">&quot;/C=CN/L=London/O=Company Ltd/CN=harbor.wolf7.org&quot;</span></span></span><br><span class="line">[root<span class="symbol">@harbor</span> ~]<span class="meta"># openssl x509 -req -days 365 -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out harbor.wolf7.org.crt</span></span><br><span class="line">[root<span class="symbol">@harbor</span> ~]<span class="meta"># cd ..</span></span><br></pre></td></tr></tbody></table></figure><p>&#x5B89;&#x88C5;docker-compose<br></p><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -L https:<span class="regexp">//gi</span>thub.com<span class="regexp">/docker/</span>compose<span class="regexp">/releases/</span>download<span class="regexp">/1.6.2/</span>docker-compose-`uname -s`-`uname -m` &gt; <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>docker-compose;</span><br><span class="line">chmod +x <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>docker-compose;</span><br></pre></td></tr></tbody></table></figure><p></p><p>Download Harbor 1.1.2<br>Harbor git&#x5730;&#x5740;&#xFF1A;<a href="https://github.com/vmware/harbor/releases" target="_blank" rel="noopener">https://github.com/vmware/harbor/releases</a><br>&#x4E0B;&#x8F7D; Harbor &#x79BB;&#x7EBF;&#x5B89;&#x88C5;&#x5305;<br></p><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/src;wget https:/</span><span class="regexp">/github.com/</span>vmware<span class="regexp">/harbor/</span>releases<span class="regexp">/download/</span>v1<span class="number">.1</span><span class="number">.2</span>/harbor-offline-installer-v1<span class="number">.1</span><span class="number">.2</span>.tgz`</span><br><span class="line">tar xvf  harbor-offline-installer-v1<span class="number">.1</span><span class="number">.2</span>.tgz</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x6587;&#x4EF6;<br></p><figure class="highlight vhdl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor ~]# cd harbor </span><br><span class="line">[root@harbor ~]# sed -i <span class="symbol">&apos;s</span>/ui_url_protocol = http/ui_url_protocol = https/&apos; harbor.cfg</span><br><span class="line">[root@harbor ~]# sed -i <span class="symbol">&apos;s</span>/hostname = reg.mydomain.com/hostname = harbor.wolf7.org/&apos; harbor.cfg</span><br><span class="line">[root@harbor ~]# sed -i <span class="symbol">&apos;s</span>@ssl_cert = /data/cert/server.crt@ssl_cert = /data/cert/harbor.wolf7.org.crt@g&apos; harbor.cfg</span><br><span class="line">[root@harbor ~]# sed -i <span class="symbol">&apos;s</span>@ssl_cert_key = /data/cert/server.key@ssl_cert_key = /data/cert/harbor.wolf7.org.key@g&apos; harbor.cfg</span><br><span class="line">[root@harbor ~]# ./prepare </span><br><span class="line">loaded secret key</span><br><span class="line">Generated <span class="keyword">configuration</span> <span class="keyword">file</span>: ./common/config/nginx/nginx.conf</span><br><span class="line">Generated <span class="keyword">configuration</span> <span class="keyword">file</span>: ./common/config/ui/env</span><br><span class="line">Generated <span class="keyword">configuration</span> <span class="keyword">file</span>: ./common/config/ui/app.conf</span><br><span class="line">Generated <span class="keyword">configuration</span> <span class="keyword">file</span>: ./common/config/registry/config.yml</span><br><span class="line">Generated <span class="keyword">configuration</span> <span class="keyword">file</span>: ./common/config/db/env</span><br><span class="line">Generated <span class="keyword">configuration</span> <span class="keyword">file</span>: ./common/config/jobservice/env</span><br><span class="line">Generated <span class="keyword">configuration</span> <span class="keyword">file</span>: ./common/config/jobservice/app.conf</span><br><span class="line">Generated <span class="keyword">configuration</span> <span class="keyword">file</span>: ./common/config/ui/private_key.pem</span><br><span class="line">Generated <span class="keyword">configuration</span> <span class="keyword">file</span>: ./common/config/registry/root.crt</span><br><span class="line">The <span class="keyword">configuration</span> files are ready, please <span class="keyword">use</span> docker-compose <span class="keyword">to</span> start the service.</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6267;&#x884C;.install &#x4F1A;&#x8FD0;&#x884C;docker-compose&#xFF0C;&#x5176;&#x4E2D;&#x4F1A;&#x53BB;dockerhub&#x62C9;&#x53D6;&#x955C;&#x50CF;&#xFF0C;&#x5982;&#x679C;&#x94FE;&#x63A5;dockerhub&#x8F83;&#x5361;&#xFF0C;&#x53EF;&#x4F7F;&#x7528;&#x79BB;&#x7EBF;&#x5B89;&#x88C5;&#x5305;<br></p><figure class="highlight jboss-cli"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor ~]<span class="comment">#  ./install.sh </span></span><br><span class="line"></span><br><span class="line">[Step 0]: checking installation environment <span class="string">...</span></span><br><span class="line"></span><br><span class="line">Note: docker <span class="keyword">version</span>: 1.12.3</span><br><span class="line"></span><br><span class="line">Note: docker-compose <span class="keyword">version</span>: 1.8.0.<span class="string">....</span></span><br><span class="line">&#x7565;&#x8FC7;</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="3-1-web&#x767B;&#x9646;&#x548C;&#x521B;&#x5EFA;&#x9879;&#x76EE;"><a href="#3-1-web&#x767B;&#x9646;&#x548C;&#x521B;&#x5EFA;&#x9879;&#x76EE;" class="headerlink" title="3.1 web&#x767B;&#x9646;&#x548C;&#x521B;&#x5EFA;&#x9879;&#x76EE;"></a>3.1 web&#x767B;&#x9646;&#x548C;&#x521B;&#x5EFA;&#x9879;&#x76EE;</h3><p>url:&#x57DF;&#x540D;<br>admin / Harbor12345</p><h3 id="4-push"><a href="#4-push" class="headerlink" title="4.push"></a>4.push</h3><figure class="highlight subunit"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor ~]# docker login -u admin -p Harbor12345 harbor.wolf7.org</span><br><span class="line"><span class="keyword">Error </span>response from daemon: Get https://harbor.wolf7.org/v1/users/: x509: certificate signed by unknown authority</span><br></pre></td></tr></tbody></table></figure><p>509: certificate signed by unknown authority&#x89E3;&#x51B3;&#x5982;&#x4E0B;:<br></p><figure class="highlight autoit"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@harbor</span> ~]<span class="meta"># mkdir -p /etc/docker/certs.d/harbor.wolf7.org</span></span><br><span class="line">[root<span class="symbol">@harbor</span> ~]<span class="meta"># cp /data/cert/ca.crt /etc/docker/certs.d/harbor.wolf7.org</span></span><br><span class="line">[root<span class="symbol">@harbor</span> ~]<span class="meta"># docker login -u admin -p Harbor12345 harbor.wolf7.org</span></span><br><span class="line">Login Succeeded</span><br><span class="line">[root<span class="symbol">@harbor</span> ~]<span class="meta">#</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6253;&#x5305;&#x4E0A;&#x4F20;<br></p><figure class="highlight llvm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.&#x4F7F;&#x7528;docker images &#x83B7;&#x53D6;image id</span><br><span class="line">[root<span class="title">@harbor</span> ~]# docker tag <span class="number">05</span>a<span class="number">60462</span>f<span class="number">8</span>ba harbor.wolf<span class="number">7</span>.org/test/nginx:<span class="number">1.11</span>.<span class="number">5</span></span><br><span class="line">[root<span class="title">@harbor</span> ~]# docker push harbor.wolf<span class="number">7</span>.org/test/nginx:<span class="number">1.11</span>.<span class="number">5</span></span><br><span class="line">The push refers <span class="keyword">to</span> a repository [harbor.wolf<span class="number">7</span>.org/test/nginx]</span><br><span class="line"><span class="number">3</span>f<span class="number">117</span><span class="keyword">c</span><span class="number">44</span>afbb: Pushed </span><br><span class="line"><span class="keyword">c</span><span class="number">4</span>a<span class="number">8</span>b<span class="number">7411</span>af<span class="number">4</span>: Pushed </span><br><span class="line">fe<span class="number">4</span><span class="keyword">c</span><span class="number">16</span>cbf<span class="number">7</span>a<span class="number">4</span>: Pushed </span><br><span class="line"><span class="number">1.11</span>.<span class="number">5</span>: digest: sha<span class="number">256</span>:e<span class="number">5</span><span class="keyword">c</span><span class="number">82328</span>a<span class="number">509</span>aeb<span class="number">7</span><span class="keyword">c</span><span class="number">18</span><span class="keyword">c</span><span class="number">1</span>d<span class="number">7</span>fb<span class="number">36633</span>dc<span class="number">638</span>fcf<span class="number">433</span>f<span class="number">651</span>bdcda<span class="number">59</span><span class="keyword">c</span><span class="number">1</span><span class="keyword">cc</span><span class="number">04</span>d<span class="number">3</span>ee<span class="number">55</span> size: <span class="number">948</span></span><br><span class="line"><span class="number">2</span>.&#x4E5F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5B8C;&#x6574;&#x4ED3;&#x5E93;&#x8DEF;&#x5F84; tag images:tag images:tag</span><br><span class="line">[root<span class="title">@harbor</span> ~]# docker tag  vmware/harbor-notary-db:mariadb<span class="number">-10.1</span>.<span class="number">10</span> harbor.wolf<span class="number">7</span>.org/test/mariadb:<span class="number">10.1</span>.<span class="number">10</span></span><br><span class="line">[root<span class="title">@harbor</span> ~]# docker  push harbor.wolf<span class="number">7</span>.org/test/mariadb:<span class="number">10.1</span>.<span class="number">10</span></span><br><span class="line">The push refers <span class="keyword">to</span> a repository [harbor.wolf<span class="number">7</span>.org/test/mariadb]</span><br><span class="line"><span class="keyword">c</span><span class="number">2385</span>ae<span class="number">7</span>d<span class="number">6e5</span>: Pushed </span><br><span class="line"><span class="number">5</span>f<span class="number">70</span>bf<span class="number">18</span>a<span class="number">086</span>: Pushed </span><br><span class="line"><span class="number">978</span>a<span class="number">35</span>efaa<span class="number">8</span><span class="keyword">c</span>: Pushed </span><br><span class="line"><span class="keyword">c</span><span class="number">3014</span>bbccb<span class="number">0</span>b: Pushed </span><br><span class="line"><span class="number">8</span>aa<span class="number">2</span><span class="keyword">c</span><span class="number">772121</span><span class="keyword">c</span>: Pushed </span><br><span class="line">eaa<span class="number">3924</span>b<span class="number">054</span>e: Pushed </span><br><span class="line">d<span class="number">8</span>f<span class="number">2</span>cde<span class="number">2</span>eef<span class="number">8</span>: Pushed </span><br><span class="line"><span class="number">574</span>ab<span class="number">36807</span>f<span class="number">2</span>: Pushed </span><br><span class="line"><span class="number">8</span>deec<span class="number">01122</span>be: Pushed </span><br><span class="line"><span class="number">78</span>dbfa<span class="number">5</span>b<span class="number">7</span>cbc: Pushed </span><br><span class="line"><span class="number">10.1</span>.<span class="number">10</span>: digest: sha<span class="number">256</span>:<span class="number">0</span>f<span class="number">561</span>ad<span class="number">96</span>b<span class="number">9</span>d<span class="number">86</span>edca<span class="number">4010569</span>ce<span class="number">3</span>eb<span class="number">501</span><span class="keyword">c</span><span class="number">2</span>aa<span class="number">8</span>bf<span class="number">1596</span>af<span class="number">88</span>b<span class="number">2</span>ca<span class="number">82</span>d<span class="number">05</span>d<span class="number">57e974</span> size: <span class="number">3642</span></span><br><span class="line">[root<span class="title">@harbor</span> ~]#</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x67E5;&#x770B;&#xFF1A;</p><h3 id="5-pull"><a href="#5-pull" class="headerlink" title="5.pull"></a>5.pull</h3><p>&#x6362;&#x4E00;&#x53F0;&#x673A;&#x5668;pull<br>1&#xFF0C;&#x9996;&#x5148;&#x9700;&#x8981;harbor&#x7684;ca&#x4FE1;&#x4EFB;&#xFF0C;&#x521B;&#x5EFA;&#x8DEF;&#x5F84;&#x540E;&#xFF0C;&#x5728;harbor&#x5C06;ca&#x4F20;&#x9012;&#x8FC7;&#x6765;<br></p><figure class="highlight autoit"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@test01</span> ~]<span class="meta"># mkdir -p /etc/docker/certs.d/harbor.wolf7.org</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>2&#xFF0C;&#x5728;harbor&#x4E0A;&#x628A;ca&#x590D;&#x5236;&#x5230;pull&#x7684;&#x673A;&#x5668;&#x4E0A;<br></p><figure class="highlight vbnet"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor cert]<span class="meta"># scp -r /data/cert/ca.crt  root@test01.wolf7.org:/etc/docker/certs.d/harbor.wolf7.org</span></span><br><span class="line">The authenticity <span class="keyword">of</span> host <span class="comment">&apos;test01.wolf7.org (192.168.77.201)&apos; can&apos;t be established.</span></span><br><span class="line">ECDSA <span class="keyword">key</span> fingerprint <span class="keyword">is</span> <span class="number">1</span>f:b8:e0:<span class="number">19</span>:ac:<span class="number">78</span>:<span class="number">87</span>:a7:<span class="number">79</span>:<span class="number">50</span>:ba:<span class="number">89</span>:<span class="number">12</span>:<span class="number">8</span>f:<span class="number">20</span>:d5.</span><br><span class="line">Are you sure you want <span class="keyword">to</span> <span class="keyword">continue</span> connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added <span class="comment">&apos;test01.wolf7.org,192.168.77.201&apos; (ECDSA) to the list of known hosts.</span></span><br><span class="line">root@test01.wolf7.org<span class="comment">&apos;s password:</span></span><br><span class="line">ca.crt                                                                                               <span class="number">100</span>% <span class="number">1935</span>     <span class="number">1.9</span>KB/s   <span class="number">00</span>:<span class="number">00</span></span><br><span class="line">[root@harbor cert]<span class="meta">#</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>3&#xFF0C;&#x975E;&#x516C;&#x5F00;&#x9879;&#x76EE;&#x9700;&#x8981;&#x767B;&#x9646;&#xFF0C;&#x516C;&#x5F00;&#x9879;&#x76EE;&#x4E0D;&#x9700;&#x8981;&#x767B;&#x9646;<br></p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@LinuxEA-COM /data/harbor/cert]# docker login -u admin -p Harbor12345 harbor.wolf7.org</span><br><span class="line">WARNING: <span class="builtin-name">Error</span> loading<span class="built_in"> config </span>file:/root/.docker/config.json - EOF</span><br><span class="line">Login Succeeded</span><br></pre></td></tr></tbody></table></figure><p></p><p>4&#xFF0C;&#x5F00;&#x59CB;pull<br></p><figure class="highlight llvm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="title">@test01</span> harbor.wolf<span class="number">7</span>.org]# mkdir /data</span><br><span class="line">[root<span class="title">@test01</span> harbor.wolf<span class="number">7</span>.org]# cd /data/</span><br><span class="line">[root<span class="title">@test01</span> data]# docker pull harbor.wolf<span class="number">7</span>.org/test/nginx:<span class="number">1.11</span>.<span class="number">5</span></span><br><span class="line">Trying <span class="keyword">to</span> pull repository harbor.wolf<span class="number">7</span>.org/test/nginx ...</span><br><span class="line"><span class="number">1.11</span>.<span class="number">5</span>: Pulling from harbor.wolf<span class="number">7</span>.org/test/nginx</span><br><span class="line"><span class="number">1</span>fad<span class="number">42e8</span>a<span class="number">0</span>d<span class="number">9</span>: Pull complete</span><br><span class="line"><span class="keyword">c</span><span class="number">600959992</span>d<span class="number">4</span>: Pull complete</span><br><span class="line"><span class="number">52894</span>f<span class="number">103317</span>: Pull complete</span><br><span class="line">Digest: sha<span class="number">256</span>:e<span class="number">5</span><span class="keyword">c</span><span class="number">82328</span>a<span class="number">509</span>aeb<span class="number">7</span><span class="keyword">c</span><span class="number">18</span><span class="keyword">c</span><span class="number">1</span>d<span class="number">7</span>fb<span class="number">36633</span>dc<span class="number">638</span>fcf<span class="number">433</span>f<span class="number">651</span>bdcda<span class="number">59</span><span class="keyword">c</span><span class="number">1</span><span class="keyword">cc</span><span class="number">04</span>d<span class="number">3</span>ee<span class="number">55</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>5&#xFF0C;&#x67E5;&#x770B;<br></p><figure class="highlight crmsh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@test01 data]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY                    <span class="keyword">TAG</span>                 <span class="title">IMAGE</span> ID            CREATED             SIZE</span><br><span class="line">harbor.wolf7.org/test/nginx   <span class="number">1.11</span>.<span class="number">5</span>              <span class="number">05</span>a60462f8ba        <span class="number">7</span> months ago        <span class="number">181.4</span> MB</span><br><span class="line">[root@test01 data]<span class="comment">#</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x51FA;&#x73B0;unauthorized: authentication required&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x4E00;&#x822C;&#x5728;web&#x4E2D;&#x521B;&#x5EFA;&#x4E86;&#x9879;&#x76EE;&#x662F;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x7684;<br>&#x5219;&#x53EF;&#x4EE5;&#x5728;/data/harborcommon/config/nginx/nginx.conf&#x4E2D;&#x6DFB;&#x52A0;proxy_set_header X-Forwarded-Proto https;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;私有仓库harbor配置HTTPS部署&quot;&gt;&lt;a href=&quot;#私有仓库harbor配置HTTPS部署&quot; class=&quot;headerlink&quot; title=&quot;私有仓库harbor配置HTTPS部署&quot;&gt;&lt;/a&gt;私有仓库harbor配置HTTPS部署&lt;/h4&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Docker1.7脚本安装</title>
    <link href="https://wolf-7.github.io/uncategorized/2019/01/24/Docker1-7%E8%84%9A%E6%9C%AC%E5%AE%89%E8%A3%85.html"/>
    <id>https://wolf-7.github.io/uncategorized/2019/01/24/Docker1-7脚本安装.html</id>
    <published>2019-01-24T07:46:05.000Z</published>
    <updated>2019-01-24T08:31:06.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="docker1-7&#x811A;&#x672C;&#x5B89;&#x88C5;"><a href="#docker1-7&#x811A;&#x672C;&#x5B89;&#x88C5;" class="headerlink" title="docker1.7&#x811A;&#x672C;&#x5B89;&#x88C5;"></a>docker1.7&#x811A;&#x672C;&#x5B89;&#x88C5;</h4><a id="more"></a><h1 id="1-Easypack-docker-sh"><a href="#1-Easypack-docker-sh" class="headerlink" title="1-Easypack_docker.sh"></a>1-Easypack_docker.sh</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#VARS INIT</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#Confirm Env</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line">date</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Install Preconfirm&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Uname&quot;</span></span><br><span class="line">uname -r</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## OS bit&quot;</span></span><br><span class="line">getconf LONG_BIT</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#INSTALL yum-utils</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line">date</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Install begins : yum-utils&quot;</span></span><br><span class="line">yum install -y yum-utils &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Install failed...&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Install ends   : yum-utils&quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#Setting yum-config-manager</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Setting begins : yum-config-manager&quot;</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">   --add-repo \</span><br><span class="line">   https://download.docker.com/linux/centos/docker-ce.repo &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Install failed...&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Setting ends   : yum-config-manager&quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#Update Package Cache</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Setting begins : Update package cache&quot;</span></span><br><span class="line">yum makecache fast &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Install failed...&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Setting ends   : Update package cache&quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#INSTALL Docker-engine</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line">date</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Install begins : docker-ce&quot;</span></span><br><span class="line">yum install -y docker-ce</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Install failed...&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Install ends   : docker-ce&quot;</span></span><br><span class="line">date</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#Stop Firewalld</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Setting begins : stop firewall&quot;</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Install failed...&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Install failed...&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Setting ends   : stop firewall&quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#Clear Iptable rules</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Setting begins : clear iptable rules&quot;</span></span><br><span class="line">iptables -F</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Install failed...&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Setting ends   : clear iptable rules&quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#Enable docker</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Setting begins : systemctl enable docker&quot;</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Install failed...&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Setting ends   : systemctl enable docker&quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#start docker</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Setting begins : systemctl restart docker&quot;</span></span><br><span class="line">systemctl restart docker</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Install failed...&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## Setting ends   : systemctl restart docker&quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#confirm docker version</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## docker info&quot;</span></span><br><span class="line">docker info</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;## docker version&quot;</span></span><br><span class="line">docker version</span><br></pre></td></tr></tbody></table></figure><h1 id="2-install-docker-sh"><a href="#2-install-docker-sh" class="headerlink" title="2-install-docker.sh"></a>2-install-docker.sh</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">SYSTEMDDIR=/usr/lib/systemd/system</span><br><span class="line">SERVICEFILE=docker.service</span><br><span class="line">DOCKERDIR=/usr/bin</span><br><span class="line">DOCKERBIN=docker</span><br><span class="line">SERVICENAME=docker</span><br><span class="line">FILETARGZ=docker-1.13.1.tgz</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="variable">${FILETARGZ}</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Docker binary tgz files does not exist, please check it&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;##unzip : tar xvpf <span class="variable">${FILETARGZ}</span>&quot;</span></span><br><span class="line">tar xvpf <span class="variable">${FILETARGZ}</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;##binary : <span class="variable">${DOCKERBIN}</span> copy to <span class="variable">${DOCKERDIR}</span>&quot;</span></span><br><span class="line">cp -p <span class="variable">${DOCKERBIN}</span>/* <span class="variable">${DOCKERDIR}</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="built_in">which</span> <span class="variable">${DOCKERBIN}</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;##systemd service: <span class="variable">${SERVICEFILE}</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;##docker.service: create docker systemd file&quot;</span></span><br><span class="line">cat &gt;<span class="variable">${SYSTEMDDIR}</span>/<span class="variable">${SERVICEFILE}</span> &lt;&lt;EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=http://docs.docker.com</span><br><span class="line">After=network.target docker.socket</span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">EnvironmentFile=-/run/flannel/docker</span><br><span class="line">WorkingDirectory=/usr/<span class="built_in">local</span>/bin</span><br><span class="line">ExecStart=/usr/bin/dockerd \</span><br><span class="line">                -H tcp://0.0.0.0:4243 \</span><br><span class="line">                -H unix:///var/run/docker.sock \</span><br><span class="line">                --selinux-enabled=<span class="literal">false</span> \</span><br><span class="line">                --<span class="built_in">log</span>-opt max-size=1g</span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> -s HUP <span class="variable">$MAINPID</span></span><br><span class="line"><span class="comment"># Having non-zero Limit*s causes performance problems due to accounting overhead</span></span><br><span class="line"><span class="comment"># in the kernel. We recommend using cgroups to do container-local accounting.</span></span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line"><span class="comment"># Uncomment TasksMax if your systemd version supports it.</span></span><br><span class="line"><span class="comment"># Only systemd 226 and above support this version.</span></span><br><span class="line"><span class="comment">#TasksMax=infinity</span></span><br><span class="line">TimeoutStartSec=0</span><br><span class="line"><span class="comment"># set delegate yes so that systemd does not reset the cgroups of docker containers</span></span><br><span class="line">Delegate=yes</span><br><span class="line"><span class="comment"># kill only the docker process, not all processes in the cgroup</span></span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;##Service status: <span class="variable">${SERVICENAME}</span>&quot;</span></span><br><span class="line">systemctl status <span class="variable">${SERVICENAME}</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;##Service restart: <span class="variable">${SERVICENAME}</span>&quot;</span></span><br><span class="line">systemctl restart <span class="variable">${SERVICENAME}</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;##Service status: <span class="variable">${SERVICENAME}</span>&quot;</span></span><br><span class="line">systemctl status <span class="variable">${SERVICENAME}</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;##Service enabled: <span class="variable">${SERVICENAME}</span>&quot;</span></span><br><span class="line">systemctl <span class="built_in">enable</span> <span class="variable">${SERVICENAME}</span></span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;docker1-7脚本安装&quot;&gt;&lt;a href=&quot;#docker1-7脚本安装&quot; class=&quot;headerlink&quot; title=&quot;docker1.7脚本安装&quot;&gt;&lt;/a&gt;docker1.7脚本安装&lt;/h4&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Install And Configure Grafana/influxdb ON AWS EC2 Instance(Ubuntu)</title>
    <link href="https://wolf-7.github.io/AWS/2018/05/29/%E6%90%AD%E5%BB%BAgrafana-on-AWS-Ubuntu-Instance.html"/>
    <id>https://wolf-7.github.io/AWS/2018/05/29/搭建grafana-on-AWS-Ubuntu-Instance.html</id>
    <published>2018-05-29T06:58:09.000Z</published>
    <updated>2019-01-16T05:58:11.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><p><font color="" size="3"> <em>&#x9700;&#x6C42;&#xFF1A;&#x56E0;AWS&#x81EA;&#x5E26;&#x7684;CloudWatch&#x76D1;&#x63A7;&#x4E0D;&#x80FD;&#x6EE1;&#x8DB3;&#x5F53;&#x4E0B;&#x9700;&#x6C42;&#xFF0C;&#x6240;&#x4EE5;&#x4F7F;&#x7528;&#x9002;&#x7528;&#x4E8E;AWS CloudWatch&#x7684;Grafana&#x4EEA;&#x8868;&#x677F;.</em> </font>&#x2003;</p><p><font color="red" size="4"> <strong> &#x4E00;&#x4E9B;&#x6709;&#x7528;&#x7684;&#x8D44;&#x6599; </strong> </font><br><a href="http://docs.grafana.org/installation/debian/" target="_blank" rel="noopener">Grafana&#x5B98;&#x65B9;&#x5B89;&#x88C5;&#x6587;&#x6863;</a><br><a href="https://hostpresto.com/community/tutorials/how-to-install-influxdb-on-ubuntu-14-04/" target="_blank" rel="noopener">InfluxDB&#x5B89;&#x88C5;&#x6587;&#x6863;</a><br><a href="https://github.com/monitoringartist/grafana-aws-cloudwatch-dashboards" target="_blank" rel="noopener">GitHub&#x63D0;&#x4F9B;&#x7684;&#x76D1;&#x63A7;AWS&#x7684;&#x4E00;&#x4E9B;&#x57FA;&#x7840;&#x670D;&#x52A1;&#x6A21;&#x677F;</a></p><hr><a id="more"></a><p><font color="DarkCyan" size="4"> <strong> &#x6DFB;&#x52A0;AWS Redshift dashboard </strong> </font><br>1.&#x56E0;&#x4E3A;Grafana&#x5B98;&#x65B9;&#x7F51;&#x7AD9;&#x63D0;&#x4F9B;&#x7684;&#x6A21;&#x677F;&#x4E2D;&#x6CA1;&#x6709;&#x9488;&#x5BF9;Redshift&#x76D1;&#x63A7;&#x7684;&#x6A21;&#x677F;&#xFF0C;&#x53EA;&#x80FD;&#x81EA;&#x5DF1;&#x52A8;&#x624B;&#x4E30;&#x8863;&#x8DB3;&#x98DF;&#x4E86;&#xFF1B;<br>2.&#x5728;variable&#x6DFB;&#x52A0;Region&#x3001;ClusterIdentifier&#x4EE5;&#x4FBF;&#x4E8E;&#x53EF;&#x4EE5;&#x5728;dashboard&#x4E2D;&#x81EA;&#x5B9A;&#x4E49;&#x9009;&#x62E9;&#x533A;&#x57DF;&#x4E0E;&#x96C6;&#x7FA4;&#x540D;&#x79F0;&#xFF1B;<br>3.&#x914D;&#x7F6E;dashboard&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5728;metrics&#x4E2D;&#x5F15;&#x7528;&#x5B9A;&#x4E49;&#x7684;variable&#xFF1B;<br>4.&#x5728;&#x914D;&#x7F6E;dashboard&#x5C55;&#x793A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5728;&#x6DFB;&#x52A0;Axes&#x3001;Legend&#x3001;Display&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x4E00;&#x4E9B;&#x7EC6;&#x8282;&#xFF0C;&#x5982;&#x679C;&#x914D;&#x7F6E;&#x9519;&#x8BEF;&#xFF0C;&#x5C55;&#x793A;&#x4F1A;&#x6DF7;&#x4E71;&#xFF0C;&#x6BD4;&#x5982;&#x5728;Axes&#x914D;&#x7F6E;network&#x5C55;&#x793A;&#x5355;&#x4F4D;&#x9700;&#x8981;&#x4F7F;&#x7528;data rate&#x4E2D;&#x7684;bytes/sec&#xFF0C;CPU or disk &#x5C55;&#x793A;&#x9700;&#x8981;&#x4F7F;&#x7528;none&#x4E2D;&#x7684;percent&#x3002;<br>&#x5982;&#x679C;&#x60F3;&#x5728;dashboard&#x53F3;&#x4E0B;&#x89D2;&#x663E;&#x793A;&#x6700;&#x5927;&#x3001;&#x6700;&#x5927;&#x3001;&#x5F53;&#x524D;&#x7B49;&#x6570;&#x636E;&#xFF0C;&#x9700;&#x8981;&#x5728;Legend&#x5F00;&#x542F;Show/Max/Min/As Table/Avg/Current&#x3002;<br>Display&#x662F;&#x63A7;&#x5236;&#x4EE5;line&#x6216;&#x8005;&#x5176;&#x4ED6;&#x65B9;&#x5F0F;&#x663E;&#x793A;&#xFF0C;Fill&#x662F;&#x989C;&#x8272;&#x7684;&#x6DF1;&#x6D45;&#xFF0C;line Width&#x662F;line&#x7684;&#x52A0;&#x7C97;&#x3002;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;&lt;font color=&quot;&quot; size=&quot;3&quot;&gt; &lt;em&gt;需求：因AWS自带的CloudWatch监控不能满足当下需求，所以使用适用于AWS CloudWatch的Grafana仪表板.&lt;/em&gt; &lt;/font&gt;&amp;emsp;&lt;/p&gt;
&lt;p&gt;&lt;font color=&quot;red&quot; size=&quot;4&quot;&gt; &lt;strong&gt; 一些有用的资料 &lt;/strong&gt; &lt;/font&gt;&lt;br&gt;&lt;a href=&quot;http://docs.grafana.org/installation/debian/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Grafana官方安装文档&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://hostpresto.com/community/tutorials/how-to-install-influxdb-on-ubuntu-14-04/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;InfluxDB安装文档&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/monitoringartist/grafana-aws-cloudwatch-dashboards&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub提供的监控AWS的一些基础服务模板&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="AWS" scheme="https://wolf-7.github.io/categories/AWS/"/>
    
    
      <category term="AWS" scheme="https://wolf-7.github.io/tags/AWS/"/>
    
  </entry>
  
  <entry>
    <title>配置适用于Lambda函数的AWS环境NAT网关-从VPC访问Intelnet公共网络</title>
    <link href="https://wolf-7.github.io/AWS/2018/02/06/%E9%85%8D%E7%BD%AE%E9%80%82%E7%94%A8%E4%BA%8ELambda%E5%87%BD%E6%95%B0%E7%9A%84AWS%E7%8E%AF%E5%A2%83NAT%E7%BD%91%E5%85%B3-%E4%BB%8EVPC%E8%AE%BF%E9%97%AEIntelnet%E5%85%AC%E5%85%B1%E7%BD%91%E7%BB%9C.html"/>
    <id>https://wolf-7.github.io/AWS/2018/02/06/配置适用于Lambda函数的AWS环境NAT网关-从VPC访问Intelnet公共网络.html</id>
    <published>2018-02-06T03:37:30.000Z</published>
    <updated>2019-01-16T03:11:08.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><p><font color="" size="3"> <em>&#x9700;&#x6C42;&#xFF1A;&#x56E0;&#x4E3A;lambda&#x672C;&#x8EAB;&#x5728;&#x5EFA;&#x7ACB;&#x4E4B;&#x521D;&#x662F;&#x5177;&#x5907;&#x516C;&#x5171;&#x7684;Intelnet&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x56E0;&#x4E3A;&#x67B6;&#x6784;&#x9700;&#x8981;VPC&#xFF0C;&#x914D;&#x7F6E;VPC&#x4EE5;&#x540E;Lambda&#x51FD;&#x6570;&#x5C06;&#x5931;&#x53BB;&#x516C;&#x5171;&#x7684;Intelnet&#x8BBF;&#x95EE;&#x6743;&#x9650;&#xFF0C;&#x6B64;&#x65F6;&#x9700;&#x8981;&#x7ED9;VPC&#x914D;&#x7F6E;NAT&#x7F51;&#x5173;&#xFF0C;&#x540C;&#x65F6;&#x9700;&#x8981;&#x5728;&#x5B89;&#x5168;&#x7EC4;&#x4E2D;&#x6DFB;&#x52A0;&#x9700;&#x8981;&#x51FA;&#x7AD9;&#x7684;&#x8FDE;&#x63A5;&#xFF08;&#x9ED8;&#x8BA4;&#x662F;&#x5168;&#x90E8;&#x5141;&#x8BB8;&#x51FA;&#x7AD9;&#xFF09;</em> </font>&#x2003;</p><hr><a id="more"></a><p><font color="red" size="4"> <strong> AWS&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;NAT&#x7F51;&#x5173;&#x67B6;&#x6784;&#x56FE; </strong> </font><br><a href="https://docs.aws.amazon.com/zh_cn/AmazonVPC/latest/UserGuide/vpc-nat-gateway.html#nat-gateway-working-with" target="_blank" rel="noopener">AWS&#x5B98;&#x65B9;&#x6280;&#x672F;&#x6587;&#x6863;</a><br><img src="https://docs.aws.amazon.com/zh_cn/AmazonVPC/latest/UserGuide/images/nat-gateway-diagram.png" width="100%" height="70%"></p><p><font color="DarkCyan" size="4"> <strong> &#x76F8;&#x5173;AWS&#x6280;&#x672F;&#x77E5;&#x8BC6;&#x70B9; </strong> </font><br>    1.&#x8FD9;&#x91CC;&#x6D89;&#x53CA;&#x5230;AWS&#x4E91;&#x7684;&#x51E0;&#x4E2A;&#x77E5;&#x8BC6;&#x70B9;&#xFF1A;VPC&#x3001;&#x5B50;&#x7F51;&#x3001;Intelnet&#x7F51;&#x5173;&#x3001;NAT&#x7F51;&#x5173;&#x3002;<br>    2.&#x9ED8;&#x8BA4;&#x5B98;&#x65B9;&#x6587;&#x6863;&#x67B6;&#x6784;&#x4E2D;&#x662F;&#x5206;&#x4E3A;Public&#x4E0E;Private&#x4FE9;&#x4E2A;&#x5B50;&#x7F51;&#x6BB5;&#xFF0C;&#x6211;&#x7684;&#x73AF;&#x5883;&#x662F;&#x5DF2;&#x7ECF;<br>    &#x5B58;&#x5728;VPC&#x4E0E;Public&#x5B50;&#x7F51;&#x6BB5;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x91CC;&#x53EA;&#x6D89;&#x53CA;&#x5230;&#x4E86;Private&#x7F51;&#x6BB5;&#x3002;</p><p><font color="DarkCyan" size="4"> <strong> &#x914D;&#x7F6E;VPC </strong> </font><br>    1.VPC&#x9ED8;&#x8BA4;&#x662F;&#x4F1A;&#x5B58;&#x5728;&#xFF0C;&#x8FD9;&#x91CC;&#x4F1A;&#x6D89;&#x53CA;&#x5230;&#x5404;&#x4E2A;AWS&#x670D;&#x52A1;&#x7684;VPC&#x5173;&#x8054;&#x95EE;&#x9898;&#xFF0C;&#x5982;&#x679C;&#x65B0;&#x5EFA;VPC&#xFF0C;<br>    &#x4F1A;&#x5BFC;&#x81F4;&#x5176;&#x4ED6;VPC&#x4E0E;Lambda&#x6216;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE;&#x7B49;&#x672A;&#x77E5;&#x95EE;&#x9898;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x4E0D;&#x5EFA;&#x8BAE;&#x5728;&#x521B;&#x5EFA;<br>    &#x65B0;&#x7684;VPC&#xFF0C;&#x800C;&#x662F;&#x5728;&#x539F;&#x6709;&#x7684;VPC&#x4E2D;&#x521B;&#x5EFA;&#x5B50;&#x7F51;&#xFF0C;&#x7136;&#x540E;&#x914D;&#x7F6E;NAT&#x7F51;&#x5173;&#x3002;<br>    2.&#x9ED8;&#x8BA4;VPC&#x4E2D;&#x5B58;&#x5728;&#x4E86;Subnet&#x5B50;&#x7F51;&#x6BB5;:<br></p><figure class="highlight lsl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.31</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">16</span></span><br></pre></td></tr></tbody></table></figure><p></p><pre><code>&#x4EE5;&#x4E0B;&#x6211;&#x4EEC;&#x5C06;&#x5728;&#x8FD9;&#x4E2A;VPC&#x4E2D;&#x521B;&#x5EFA;Subnet&#x5B50;&#x7F51;&#x3002;</code></pre><p><img src="/images/lambda-images/1517885033617.png" width="100%" height="70%"></p><p><font color="DarkCyan" size="4"> <strong> &#x521B;&#x5EFA;VPC&#x4E2D;&#x7684;Subnet&#x5B50;&#x7F51; </strong> </font><br>    1.&#x65B0;&#x5EFA;NAT&#x7F51;&#x5173;&#x7684;&#x5B50;&#x7F51;&#xFF0C;&#x8FD9;&#x91CC;&#x9762;&#x6D89;&#x53CA;&#x5230;&#x7F51;&#x7EDC;&#x7684;&#x4E00;&#x4E9B;&#x57FA;&#x7840;&#x6982;&#x5FF5;&#xFF0C;&#x5B50;&#x7F51;&#x5212;&#x5206;&#xFF0C;&#x9700;&#x8981;&#x4E86;&#x89E3;&#x3002;<br>    &#x9ED8;&#x8BA4;VPC&#x5B58;&#x5728;&#x4E86;&#x4E09;&#x4E2A;&#x5B50;&#x7F51;&#x4E3A;:<br></p><figure class="highlight lsl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.31</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">20</span>(<span class="number">0</span><span class="number">-15</span>)</span><br><span class="line"><span class="number">172.31</span><span class="number">.16</span><span class="number">.0</span>/<span class="number">20</span>(<span class="number">16</span><span class="number">-31</span>)</span><br><span class="line"><span class="number">172.31</span><span class="number">.32</span><span class="number">.0</span>/<span class="number">20</span>(<span class="number">32</span><span class="number">-47</span>)</span><br></pre></td></tr></tbody></table></figure><p></p><p>2.&#x6240;&#x4EE5;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x533A;&#x5206;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x547D;&#x540D;subnet-lambda&#x7684;&#x5B50;&#x7F51;:</p><figure class="highlight lsl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.31</span><span class="number">.48</span><span class="number">.0</span>/<span class="number">20</span>(<span class="number">48</span><span class="number">-63</span>)</span><br></pre></td></tr></tbody></table></figure><p>&#x4F5C;&#x4E3A;NAT&#x7F51;&#x5173;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x7684;&#x5B50;&#x7F51;&#x6BB5;&#x3002;<br><img src="/images/lambda-images/1517885255818.png" width="100%" height="70%"></p><p><font color="DarkCyan" size="4"> <strong> &#x914D;&#x7F6E;Intelnet&#x7F51;&#x5173; </strong> </font><br>    1.&#x521B;&#x5EFA;VPC&#x65F6;&#x4F1A;&#x81EA;&#x52A8;&#x521B;&#x5EFA;Intelnet&#x7F51;&#x5173;&#x5E76;&#x4E14;&#x81EA;&#x52A8;attached&#xFF0C;&#x4E3A;AWS&#x63D0;&#x4F9B;&#x7684;&#x516C;&#x5171;Intelnet&#x8BBF;&#x95EE;&#x3002;<br>    2.&#x5982;&#x679C;&#x662F;&#x65B0;&#x5EFA;&#x7684;VPC&#xFF0C;&#x5C31;&#x9700;&#x5728;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;Intelnet&#x7F51;&#x5173;&#xFF0C;&#x5E76;&#x4E14;attached&#x5230;&#x521B;&#x5EFA;&#x7684;VPC&#x4E0A;&#x3002;<br><img src="/images/lambda-images/1517887619633.png" width="100%" height="70%"></p><p><font color="DarkCyan" size="4"> <strong> &#x914D;&#x7F6E;NAT&#x7F51;&#x5173; </strong> </font><br>    1.&#x65B0;&#x5EFA;NAT&#x7F51;&#x5173;&#xFF0C;&#x5C06;&#x5176;&#x5173;&#x8054;&#x5230;&#x4E00;&#x4E2A;&#x53EF;&#x5DF2;&#x7ECF;&#x914D;&#x7F6E;Intelnet&#x7F51;&#x5173;&#x7684;&#x5B50;&#x7F51;&#x3002;<br>    2.&#x521B;&#x5EFA;&#x4E00;&#x4E2A;ElasticIP&#xFF0C;attached&#x5230;NAT&#x7F51;&#x5173;&#x3002;<br><img src="/images/lambda-images/1517886163129.png" width="100%" height="70%"></p><p><font color="DarkCyan" size="4"> <strong> &#x914D;&#x7F6E;Route&#x8868; </strong> </font><br>    1.&#x5728;&#x8DEF;&#x7531;&#x8868;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Route&#x8868;&#xFF08;rtb-default&#xFF09;&#xFF0C;&#x4E00;&#x822C;&#x4F1A;&#x521B;&#x5EFA;&#x9ED8;&#x8BA4;Route&#x8868;&#xFF0C;&#x81EA;&#x52A8;&#x5173;&#x8054;&#xFF0C;<br>    &#x8FD9;&#x65F6;&#x5C06;&#x4E0A;&#x9762;&#x65B0;&#x5EFA;&#x7684;Intelnet&#x7F51;&#x5173;&#x6807;&#x8BB0;&#x5230;&#x9ED8;&#x8BA4;Route&#x8868;&#xFF0C;&#x5E76;&#x5173;&#x8054;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x7684;VPC&#x4E2D;&#x7684;&#x4E09;&#x4E2A;&#x5B50;&#x7F51;&#x3002;<br>    2.&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;Route&#x8868;&#xFF08;rtb-lambda&#xFF09;&#xFF0C;&#x5173;&#x8054;172.31.48.0/20&#x5B50;&#x7F51;&#x6BB5;&#x3002;<br>    &#x5C06;&#x8DEF;&#x7531;&#x6807;&#x8BB0;&#x4E3A;0.0.0.0/0 &#x2013;&gt;&gt; nat-gateway-id&#xFF08;&#x65B0;&#x5EFA;&#x7684;NAT&#x7F51;&#x5173;&#xFF09;&#x3002;<br><img src="/images/lambda-images/1517885960712.png" width="100%" height="70%"><br><img src="/images/lambda-images/1517887872674.png" width="100%" height="70%"><br><img src="/images/lambda-images/1517887081653.png" width="100%" height="70%"></p><p><font color="DarkCyan" size="4"> <strong> &#x914D;&#x7F6E;Lambda&#x51FD;&#x6570; </strong> </font><br>    1.Lambda&#x51FD;&#x6570;&#x9700;&#x8981;&#x5177;&#x6709;&#x5BF9;VPC&#x7684;&#x6267;&#x884C;Read&#x6743;&#x9650;&#xFF0C;&#x9700;&#x8981;&#x5728;IAM&#x4E2D;&#x6DFB;&#x52A0;&#x8D4B;&#x4E88;&#x3002;<br>    2.&#x914D;&#x7F6E;&#x7F51;&#x7EDC;&#x4E3A;&#x65B0;&#x5EFA;VPC&#x4E2D;&#x7684;&#x5B50;&#x7F51;&#xFF08;172.31.48.0/20&#xFF09;&#x3002;<br>    3.&#x5F00;&#x542F;&#x9700;&#x8981;&#x5165;&#x7AD9;&#x3001;&#x51FA;&#x7AD9;&#x7684;&#x5B89;&#x5168;&#x7EC4;&#x3002;<br><img src="/images/lambda-images/1517887288826.png" width="100%" height="70%"><br><img src="/images/lambda-images/1517887298487.png" width="100%" height="70%"><br><img src="/images/lambda-images/1517887323032.png" width="100%" height="70%"></p><pre><code>&#x6B64;&#x65F6;&#xFF0C;Lambda&#x51FD;&#x6570;&#x5C31;&#x5177;&#x5907;&#x4E86;Intelnet&#x516C;&#x5171;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x4E86;&#x3002;</code></pre><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;&lt;font color=&quot;&quot; size=&quot;3&quot;&gt; &lt;em&gt;需求：因为lambda本身在建立之初是具备公共的Intelnet访问权限的，但是因为架构需要VPC，配置VPC以后Lambda函数将失去公共的Intelnet访问权限，此时需要给VPC配置NAT网关，同时需要在安全组中添加需要出站的连接（默认是全部允许出站）&lt;/em&gt; &lt;/font&gt;&amp;emsp;&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="AWS" scheme="https://wolf-7.github.io/categories/AWS/"/>
    
    
      <category term="AWS" scheme="https://wolf-7.github.io/tags/AWS/"/>
    
  </entry>
  
  <entry>
    <title>CentOS7一键安装ipsec-vpn</title>
    <link href="https://wolf-7.github.io/uncategorized/2018/01/24/CentOS7%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85ipsec-vpn.html"/>
    <id>https://wolf-7.github.io/uncategorized/2018/01/24/CentOS7一键安装ipsec-vpn.html</id>
    <published>2018-01-24T07:41:58.000Z</published>
    <updated>2019-01-24T08:24:01.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>&#x4E0B;&#x8F7D;&#x5B89;&#x88C5;&#x811A;&#x672C;<br><code>wget https://git.io/vpnsetup-centos</code></p><a id="more"></a><p>&#x6267;&#x884C;&#xFF0C;&#x6DFB;&#x52A0;PSK&#xFF0C;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x5BC6;&#x7801;<br>&#x6700;&#x9EBB;&#x70E6;&#x7684;&#x914D;&#x7F6E;&#x5C31;&#x662F;ipsec.conf<br>ipsec.conf<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">version 2.0</span><br><span class="line"></span><br><span class="line">config setup</span><br><span class="line">  virtual_private=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%v4:172.16.0.0/12,%v4:!192.168.42.0/24,%v4:!192.168.43.0/24</span><br><span class="line">  protostack=netkey</span><br><span class="line">  nhelpers=0</span><br><span class="line">  interfaces=%defaultroute</span><br><span class="line">  uniqueids=no</span><br><span class="line"></span><br><span class="line">conn shared</span><br><span class="line">  left=%defaultroute</span><br><span class="line">  leftid=54.x.x.221</span><br><span class="line">  right=%any</span><br><span class="line">  encapsulation=yes</span><br><span class="line">  authby=secret</span><br><span class="line">  pfs=no</span><br><span class="line">  rekey=no</span><br><span class="line">  keyingtries=5</span><br><span class="line">  dpddelay=30</span><br><span class="line">  dpdtimeout=120</span><br><span class="line">  dpdaction=clear</span><br><span class="line">  ike=3des-sha1,3des-sha2,aes-sha1,aes-sha1;modp1024,aes-sha2,aes-sha2;modp1024,aes256-sha2_512</span><br><span class="line">  phase2alg=3des-sha1,3des-sha2,aes-sha1,aes-sha2,aes256-sha2_512</span><br><span class="line">  sha2-truncbug=yes</span><br><span class="line"></span><br><span class="line">conn l2tp-psk</span><br><span class="line">  auto=add</span><br><span class="line">  leftprotoport=17/1701</span><br><span class="line">  rightprotoport=17/%any</span><br><span class="line">  type=transport</span><br><span class="line">  phase2=esp</span><br><span class="line">  also=shared</span><br><span class="line"></span><br><span class="line">conn xauth-psk</span><br><span class="line">  auto=add</span><br><span class="line">  leftsubnet=0.0.0.0/0</span><br><span class="line">  rightaddresspool=192.168.43.10-192.168.43.250</span><br><span class="line">  modecfgdns1=8.8.8.8</span><br><span class="line">  modecfgdns2=8.8.4.4</span><br><span class="line">  leftxauthserver=yes</span><br><span class="line">  rightxauthclient=yes</span><br><span class="line">  leftmodecfgserver=yes</span><br><span class="line">  rightmodecfgclient=yes</span><br><span class="line">  modecfgpull=yes</span><br><span class="line">  xauthby=file</span><br><span class="line">  ike-frag=yes</span><br><span class="line">  ikev2=never</span><br><span class="line">  cisco-unity=yes</span><br><span class="line">  also=shared</span><br><span class="line"></span><br><span class="line">conn ikev2-cp</span><br><span class="line">  left=%defaultroute</span><br><span class="line">  leftid=54.x.x.221</span><br><span class="line">  leftsendcert=always</span><br><span class="line">  leftsubnet=0.0.0.0/0</span><br><span class="line">  leftrsasigkey=%cert</span><br><span class="line">  right=%any</span><br><span class="line">  rightaddresspool=192.168.45.10-192.168.45.250</span><br><span class="line">  rightca=%same</span><br><span class="line">  rightrsasigkey=%cert</span><br><span class="line">  modecfgdns1=8.8.8.8</span><br><span class="line">  modecfgdns2=8.8.4.4</span><br><span class="line">  narrowing=yes</span><br><span class="line">  dpddelay=30</span><br><span class="line">  dpdtimeout=120</span><br><span class="line">  dpdaction=clear</span><br><span class="line">  auto=add</span><br><span class="line">  ikev2=insist</span><br><span class="line">  rekey=no</span><br><span class="line">  fragmentation=yes</span><br><span class="line">  ike=3des-sha1,3des-sha2,aes-sha1,aes-sha1;modp1024,aes-sha2,aes-sha2;modp1024,aes256-sha2_512</span><br><span class="line">  phase2alg=3des-sha1,3des-sha2,aes-sha1,aes-sha2,aes256-sha2_512</span><br></pre></td></tr></tbody></table></figure><p></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;下载安装脚本&lt;br&gt;&lt;code&gt;wget https://git.io/vpnsetup-centos&lt;/code&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>做一个职业运维人</title>
    <link href="https://wolf-7.github.io/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/2018/01/01/%E5%81%9A%E4%B8%80%E4%B8%AA%E8%81%8C%E4%B8%9A%E8%BF%90%E7%BB%B4%E4%BA%BA.html"/>
    <id>https://wolf-7.github.io/职业规划/2018/01/01/做一个职业运维人.html</id>
    <published>2018-01-01T13:09:25.000Z</published>
    <updated>2019-01-16T03:11:49.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><font color="" size="3"> &#x5F88;&#x591A;&#x4E09;&#x56DB;&#x5E74;&#x5DE5;&#x4F5C;&#x7ECF;&#x9A8C;&#x7684;&#x540C;&#x5B66;&#xFF0C;&#x56E0;&#x4E3A;&#x7F3A;&#x5C11;&#x5FC5;&#x8981;&#x7684;&#x804C;&#x4E1A;&#x7D20;&#x517B;&#x7684;&#x57F9;&#x8BAD;&#xFF0C;&#x5DE5;&#x4F5C;&#x7684;&#x65B9;&#x5F0F;&#x65B9;&#x6CD5;&#x6216;&#x591A;&#x6216;&#x5C11;&#x5B58;&#x5728;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x5F71;&#x54CD;&#x4E86;&#x81EA;&#x8EAB;&#x7684;&#x804C;&#x4E1A;&#x53D1;&#x5C55;&#x3002;&#x600E;&#x4E48;&#x505A;&#x624D;&#x7B97;&#x662F;&#x4F1A;&#x5DE5;&#x4F5C;&#xFF0C;&#x8FD9;&#x91CC;&#x6709;&#x51E0;&#x70B9;&#x4E0D;&#x6210;&#x719F;&#x7684;&#x5EFA;&#x8BAE;&#xFF0C;&#x4F9B;&#x8BF8;&#x541B;&#x53C2;&#x8003;&#x3002; </font><hr><a id="more"></a><h4 id="&#x641E;&#x6E05;&#x695A;&#x516C;&#x53F8;&#x4E3A;&#x4EC0;&#x4E48;&#x8058;&#x8BF7;&#x4F60;"><a href="#&#x641E;&#x6E05;&#x695A;&#x516C;&#x53F8;&#x4E3A;&#x4EC0;&#x4E48;&#x8058;&#x8BF7;&#x4F60;" class="headerlink" title="&#x641E;&#x6E05;&#x695A;&#x516C;&#x53F8;&#x4E3A;&#x4EC0;&#x4E48;&#x8058;&#x8BF7;&#x4F60;"></a>&#x641E;&#x6E05;&#x695A;&#x516C;&#x53F8;&#x4E3A;&#x4EC0;&#x4E48;&#x8058;&#x8BF7;&#x4F60;</h4><p>&#x516C;&#x53F8;&#x4E0D;&#x662F;&#x6148;&#x5584;&#x673A;&#x6784;&#xFF0C;&#x800C;&#x662F;&#x4EE5;&#x8425;&#x5229;&#x4E3A;&#x76EE;&#x7684;&#xFF0C;&#x516C;&#x53F8;&#x8058;&#x8BF7;&#x4F60;&#xFF0C;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x8BA9;&#x4F60;&#x5E2E;&#x52A9;&#x516C;&#x53F8;&#x53BB;&#x8425;&#x5229;&#xFF0C;&#x5E2E;&#x52A9;&#x516C;&#x53F8;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x5982;&#x679C;&#x89C9;&#x5F97;&#x81EA;&#x5DF1;&#x5728;&#x516C;&#x53F8;&#x6CA1;&#x5565;&#x7528;&#x5904;&#xFF0C;&#x6709;&#x4F60;&#x6CA1;&#x4F60;&#x6CA1;&#x533A;&#x522B;&#xFF0C;&#x90A3;&#x5C31;&#x79BB;&#x89E3;&#x8058;&#x4E0D;&#x8FDC;&#x4E86;&#x3002;</p><h4 id="&#x4E0D;&#x65AD;&#x5347;&#x804C;&#x52A0;&#x85AA;&#x7684;&#x79D8;&#x8BC0;"><a href="#&#x4E0D;&#x65AD;&#x5347;&#x804C;&#x52A0;&#x85AA;&#x7684;&#x79D8;&#x8BC0;" class="headerlink" title="&#x4E0D;&#x65AD;&#x5347;&#x804C;&#x52A0;&#x85AA;&#x7684;&#x79D8;&#x8BC0;"></a>&#x4E0D;&#x65AD;&#x5347;&#x804C;&#x52A0;&#x85AA;&#x7684;&#x79D8;&#x8BC0;</h4><p>&#x8981;&#x4E0D;&#x65AD;&#x6709;&#x4EA7;&#x51FA;&#xFF0C;&#x53D8;&#x6210;&#x7A00;&#x7F3A;&#x4EBA;&#x624D;&#x3002;&#x8981;&#x60F3;&#x660E;&#x767D;&#x81EA;&#x5DF1;&#x53EF;&#x4EE5;&#x5E2E;&#x516C;&#x53F8;&#x89E3;&#x51B3;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF0C;&#x5E2E;&#x9886;&#x5BFC;&#x89E3;&#x51B3;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x3002;&#x5E76;&#x4E0D;&#x9057;&#x4F59;&#x529B;&#x7684;&#x53BB;&#x62FC;&#x640F;&#xFF0C;&#x76F8;&#x4FE1;&#x6211;&#xFF0C;&#x9886;&#x5BFC;&#x770B;&#x5F97;&#x89C1;&#x4F60;&#x7684;&#x4ED8;&#x51FA;&#x3002;&#x67D0;&#x4E9B;&#x4E8B;&#x60C5;&#x4F60;&#x53EF;&#x4EE5;&#x505A;&#xFF0C;&#x522B;&#x4EBA;&#x505A;&#x4E0D;&#x4E86;&#xFF0C;&#x9886;&#x5BFC;&#x628A;&#x4E8B;&#x60C5;&#x4EA4;&#x5230;&#x4F60;&#x8FD9;&#x4ED6;&#x653E;&#x5FC3;&#xFF0C;&#x4F60;&#x5C31;&#x79BB;&#x52A0;&#x85AA;&#x4E0D;&#x8FDC;&#x4E86;&#xFF0C;&#x591A;&#x6B21;&#x5982;&#x6B64;&#xFF0C;&#x5C31;&#x79BB;&#x5347;&#x804C;&#x4E0D;&#x8FDC;&#x4E86;&#x3002;</p><h4 id="&#x628A;&#x63E1;&#x597D;&#x8DDF;&#x9886;&#x5BFC;&#x7684;&#x5173;&#x7CFB;"><a href="#&#x628A;&#x63E1;&#x597D;&#x8DDF;&#x9886;&#x5BFC;&#x7684;&#x5173;&#x7CFB;" class="headerlink" title="&#x628A;&#x63E1;&#x597D;&#x8DDF;&#x9886;&#x5BFC;&#x7684;&#x5173;&#x7CFB;"></a>&#x628A;&#x63E1;&#x597D;&#x8DDF;&#x9886;&#x5BFC;&#x7684;&#x5173;&#x7CFB;</h4><p>&#x4ECE;&#x67D0;&#x79CD;&#x7A0B;&#x5EA6;&#x4E0A;&#x8BB2;&#xFF0C;&#x4F60;&#x5176;&#x5B9E;&#x4E0D;&#x662F;&#x5728;&#x4E3A;&#x516C;&#x53F8;&#x6253;&#x5DE5;&#xFF0C;&#x800C;&#x662F;&#x5728;&#x4E3A;&#x4F60;&#x7684;&#x76F4;&#x5C5E;&#x4E0A;&#x53F8;&#x6253;&#x5DE5;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x8DDF;&#x9886;&#x5BFC;&#x7684;&#x5173;&#x7CFB;&#x5C3D;&#x91CF;&#x4E0D;&#x8981;&#x641E;&#x7838;&#x4E86;&#xFF0C;&#x9886;&#x5BFC;&#x8BF4;&#x7684;&#x5BF9;&#x7684;&#xFF0C;&#x8981;&#x5168;&#x529B;&#x652F;&#x6301;&#xFF1B;&#x505A;&#x7684;&#x4E0D;&#x5408;&#x7406;&#x7684;&#xFF0C;&#x8981;#### &#x79C1;&#x4E0B;#### &#x8DDF;&#x9886;&#x5BFC;&#x6C9F;&#x901A;&#xFF0C;&#x7528;&#x59D4;&#x5A49;&#x7684;&#x65B9;&#x5F0F;&#x5E2E;&#x4ED6;&#x6307;&#x51FA;&#x95EE;&#x9898;&#x6240;&#x5728;&#x3002;&#x5982;&#x679C;&#x5F88;&#x4E0D;&#x5E78;&#xFF0C;&#x4F60;&#x7684;&#x9886;&#x5BFC;&#x521A;&#x610E;&#x81EA;&#x7528;&#xFF0C;&#x542C;&#x4E0D;&#x8FDB;&#x8C0F;&#x8A00;&#xFF0C;&#x90A3;&#x6211;&#x53EA;&#x80FD;&#x8BF4;&#xFF0C;&#x826F;&#x79BD;&#x62E9;&#x6728;&#x800C;&#x6816;&#x3002;</p><h4 id="&#x628A;&#x63E1;&#x597D;&#x8DDF;&#x540C;&#x4E8B;&#x7684;&#x5173;&#x7CFB;"><a href="#&#x628A;&#x63E1;&#x597D;&#x8DDF;&#x540C;&#x4E8B;&#x7684;&#x5173;&#x7CFB;" class="headerlink" title="&#x628A;&#x63E1;&#x597D;&#x8DDF;&#x540C;&#x4E8B;&#x7684;&#x5173;&#x7CFB;"></a>&#x628A;&#x63E1;&#x597D;&#x8DDF;&#x540C;&#x4E8B;&#x7684;&#x5173;&#x7CFB;</h4><p>&#x7531;&#x4E8E;&#x6BCF;&#x4E2A;&#x4EBA;&#x7684;&#x8BA4;&#x77E5;&#x4E0D;&#x540C;&#xFF0C;&#x80CC;&#x666F;&#x77E5;&#x8BC6;&#x4E0D;&#x540C;&#xFF0C;&#x7ECF;&#x9A8C;&#x4E0D;&#x540C;&#xFF0C;&#x5728;&#x540C;&#x4E00;&#x4EF6;&#x4E8B;&#x60C5;&#x4E0A;&#x9762;&#x7684;&#x770B;&#x6CD5;&#x4F1A;&#x4E0D;&#x540C;&#xFF0C;&#x8FD9;&#x5C06;&#x662F;&#x5E38;&#x6001;&#x3002;&#x672C;&#x7740;&#x7406;&#x4E0D;&#x8FA8;&#x4E0D;&#x660E;&#x7684;&#x539F;&#x5219;&#xFF0C;&#x51E1;&#x4E8B;&#x6C9F;&#x901A;&#x89E3;&#x51B3;&#xFF0C;&#x5BF9;&#x4E8B;&#x4E0D;&#x5BF9;&#x4EBA;&#xFF0C;&#x6CE8;&#x610F;&#x8868;&#x8FBE;&#x8BED;&#x6C14;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x56E2;&#x4F53;&#x4F5C;&#x6218;&#x7684;&#x5E74;&#x4EE3;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x5408;&#x7FA4;&#xFF0C;&#x4E5F;&#x4F1A;&#x8BA9;&#x4F60;&#x7684;&#x9886;&#x5BFC;&#x96BE;&#x529E;&#x3002;&#x53EA;&#x8981;&#x7ED3;&#x679C;&#x662F;&#x597D;&#x7684;&#xFF0C;&#x5FCD;&#x8BA9;&#x4E00;&#x4E0B;&#x53C8;&#x4F55;&#x59A8;&#x3002;</p><h4 id="&#x4E0D;&#x65AD;&#x63D0;&#x5347;&#x81EA;&#x8EAB;&#x7684;&#x8F6F;&#x7D20;&#x8D28;"><a href="#&#x4E0D;&#x65AD;&#x63D0;&#x5347;&#x81EA;&#x8EAB;&#x7684;&#x8F6F;&#x7D20;&#x8D28;" class="headerlink" title="&#x4E0D;&#x65AD;&#x63D0;&#x5347;&#x81EA;&#x8EAB;&#x7684;&#x8F6F;&#x7D20;&#x8D28;"></a>&#x4E0D;&#x65AD;&#x63D0;&#x5347;&#x81EA;&#x8EAB;&#x7684;&#x8F6F;&#x7D20;&#x8D28;</h4><p>&#x5728;&#x804C;&#x4E1A;&#x751F;&#x6DAF;&#x524D;&#x671F;&#xFF0C;&#x4E13;&#x4E1A;&#x6280;&#x672F;&#x80FD;&#x529B;&#x662F;&#x63A8;&#x5347;&#x4F60;&#x5F80;&#x4E0A;&#x8D70;&#x7684;&#x4E3B;&#x8981;&#x52A8;&#x529B;&#xFF0C;&#x804C;&#x4E1A;&#x751F;&#x6DAF;&#x4E2D;&#x671F;&#xFF0C;&#x8F6F;&#x7D20;&#x8D28;&#x5C31;&#x4F1A;&#x663E;&#x5F97;&#x5C24;&#x4E3A;&#x91CD;&#x8981;&#xFF0C;&#x804C;&#x4E1A;&#x751F;&#x6DAF;&#x540E;&#x671F;&#xFF0C;&#x4EBA;&#x683C;&#x9B45;&#x529B;&#x548C;&#x5F71;&#x54CD;&#x529B;&#x662F;&#x4E0D;&#x53EF;&#x6216;&#x7F3A;&#x7684;&#x3002;</p><h4 id="&#x84DD;&#x56FE;&#x89C4;&#x5212;&#x3001;&#x76EE;&#x6807;&#x62C6;&#x89E3;&#x3001;&#x5173;&#x952E;&#x8DEF;&#x5F84;&#x3001;&#x8FC7;&#x7A0B;&#x7BA1;&#x7406;"><a href="#&#x84DD;&#x56FE;&#x89C4;&#x5212;&#x3001;&#x76EE;&#x6807;&#x62C6;&#x89E3;&#x3001;&#x5173;&#x952E;&#x8DEF;&#x5F84;&#x3001;&#x8FC7;&#x7A0B;&#x7BA1;&#x7406;" class="headerlink" title="&#x84DD;&#x56FE;&#x89C4;&#x5212;&#x3001;&#x76EE;&#x6807;&#x62C6;&#x89E3;&#x3001;&#x5173;&#x952E;&#x8DEF;&#x5F84;&#x3001;&#x8FC7;&#x7A0B;&#x7BA1;&#x7406;"></a>&#x84DD;&#x56FE;&#x89C4;&#x5212;&#x3001;&#x76EE;&#x6807;&#x62C6;&#x89E3;&#x3001;&#x5173;&#x952E;&#x8DEF;&#x5F84;&#x3001;&#x8FC7;&#x7A0B;&#x7BA1;&#x7406;</h4><p>&#x5982;&#x679C;&#x53EA;&#x662F;&#x4F4E;&#x5934;&#x8D70;&#x8DEF;&#xFF0C;&#x4E0D;&#x62AC;&#x5934;&#x770B;&#x65B9;&#x5411;&#xFF0C;&#x5BB9;&#x6613;&#x8FF7;&#x5931;&#x3002;&#x5DE5;&#x4F5C;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#xFF0C;&#x4F5C;&#x4E3A;&#x5458;&#x5DE5;&#xFF0C;&#x8981;&#x53BB;&#x4E86;&#x89E3;&#x516C;&#x53F8;&#x6218;&#x7565;&#xFF0C;&#x90E8;&#x95E8;&#x84DD;&#x56FE;&#xFF0C;&#x505A;&#x4E3A;&#x9886;&#x5BFC;&#xFF0C;&#x8981;&#x53BB;&#x4F20;&#x8FBE;&#x516C;&#x53F8;&#x6218;&#x7565;&#xFF0C;&#x90E8;&#x95E8;&#x84DD;&#x56FE;&#xFF0C;&#x8FD9;&#x6837;&#xFF0C;&#x6574;&#x4E2A;&#x56E2;&#x961F;&#x624D;&#x77E5;&#x9053;&#x5F80;&#x54EA;&#x4F7F;&#x52B2;&#x3002;&#x628A;&#x516C;&#x53F8;&#x76EE;&#x6807;&#x62C6;&#x6210;&#x90E8;&#x95E8;&#x76EE;&#x6807;&#xFF0C;&#x628A;&#x90E8;&#x95E8;&#x76EE;&#x6807;&#x62C6;&#x6210;&#x56E2;&#x961F;&#x76EE;&#x6807;&#xFF0C;&#x6700;&#x540E;&#x62C6;&#x6210;&#x4E2A;&#x4EBA;&#x76EE;&#x6807;&#xFF0C;&#x4E86;&#x89E3;&#x8FD9;&#x4E9B;&#xFF0C;&#x5DE5;&#x4F5C;&#x65B9;&#x5411;&#x624D;&#x80FD;&#x6BD4;&#x8F83;&#x6E05;&#x6670;&#x3002;&#x4E3A;&#x4E86;&#x8FBE;&#x6210;&#x76EE;&#x6807;&#xFF0C;&#x6211;&#x4EEC;&#x5236;&#x5B9A;&#x4E86;&#x5173;&#x952E;&#x8DEF;&#x5F84;&#xFF0C;&#x9879;&#x76EE;&#x3001;&#x4EFB;&#x52A1;&#x90FD;&#x662F;&#x4E3A;&#x76EE;&#x6807;&#x670D;&#x52A1;&#x7684;&#x3002;&#x8001;&#x677F;&#x8981;&#x4F60;&#x5199;&#x5468;&#x62A5;&#xFF0C;&#x8981;&#x4F60;&#x7ECF;&#x5E38;&#x6C47;&#x62A5;&#xFF0C;&#x5B9E;&#x9645;&#x5C31;&#x662F;&#x5728;&#x505A;&#x8FC7;&#x7A0B;&#x7BA1;&#x7406;&#xFF0C;&#x6015;&#x51FA;&#x610F;&#x5916;~</p><h4 id="&#x77E5;&#x9053;&#x65B9;&#x5411;&#x4E86;&#x8981;&#x4F4E;&#x5934;&#x770B;&#x8DEF;"><a href="#&#x77E5;&#x9053;&#x65B9;&#x5411;&#x4E86;&#x8981;&#x4F4E;&#x5934;&#x770B;&#x8DEF;" class="headerlink" title="&#x77E5;&#x9053;&#x65B9;&#x5411;&#x4E86;&#x8981;&#x4F4E;&#x5934;&#x770B;&#x8DEF;"></a>&#x77E5;&#x9053;&#x65B9;&#x5411;&#x4E86;&#x8981;&#x4F4E;&#x5934;&#x770B;&#x8DEF;</h4><p>&#x6211;&#x4EEC;&#x6709;&#x7406;&#x60F3;&#xFF0C;&#x77E5;&#x9053;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#xFF0C;&#x4F46;&#x8981;&#x60F3;&#x771F;&#x6B63;&#x843D;&#x5730;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x77E5;&#x9053;&#x73B0;&#x72B6;&#xFF0C;&#x77E5;&#x9053;&#x4ECE;&#x73B0;&#x5B9E;&#x8D70;&#x5411;&#x7406;&#x60F3;&#x7684;&#x8DEF;&#x3002;&#x8131;&#x79BB;&#x4E00;&#x7EBF;&#x7684;&#x9AD8;&#x5C42;&#x5BB9;&#x6613;&#x6D3B;&#x5728;&#x7406;&#x60F3;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x4F5C;&#x4E3A;&#x5E72;&#x6D3B;&#x7684;&#x4EBA;&#xFF0C;&#x5374;&#x4E0D;&#x80FD;&#x9760;&#x7406;&#x60F3;&#xFF0C;&#x9760;&#x65B9;&#x6CD5;&#x8BBA;&#x6D3B;&#x7740;&#xFF0C;&#x5236;&#x5B9A;&#x51FA;&#x8FD9;&#x6761;&#x8DEF;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x8DEF;&#x7684;&#x8D70;&#x6CD5;&#x540C;&#x6B65;&#x7ED9;&#x4F60;&#x7684;&#x8001;&#x677F;&#xFF0C;&#x5F97;&#x5230;&#x8001;&#x677F;&#x7684;&#x8BA4;&#x53EF;&#xFF0C;&#x575A;&#x5B9A;&#x7684;&#x6CBF;&#x7740;&#x8FD9;&#x6761;&#x8DEF;&#x8D70;&#x4E0B;&#x53BB;&#xFF0C;&#x624D;&#x80FD;&#x6700;&#x7EC8;&#x8FBE;&#x6210;&#x76EE;&#x6807;&#x3002;</p><h4 id="&#x5FF5;&#x5FF5;&#x4E0D;&#x5FD8;&#x5FC5;&#x6709;&#x56DE;&#x54CD;"><a href="#&#x5FF5;&#x5FF5;&#x4E0D;&#x5FD8;&#x5FC5;&#x6709;&#x56DE;&#x54CD;" class="headerlink" title="&#x5FF5;&#x5FF5;&#x4E0D;&#x5FD8;&#x5FC5;&#x6709;&#x56DE;&#x54CD;"></a>&#x5FF5;&#x5FF5;&#x4E0D;&#x5FD8;&#x5FC5;&#x6709;&#x56DE;&#x54CD;</h4><p>&#x5168;&#x8EAB;&#x5FC3;&#x7684;&#x6295;&#x5165;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x80FD;&#x91CF;&#x8D85;&#x4E4E;&#x60F3;&#x8C61;&#x3002;&#x4E0D;&#x77E5;&#x9053;&#x5927;&#x5BB6;&#x6709;&#x6CA1;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x7ECF;&#x5386;&#xFF0C;&#x5DE5;&#x4F5C;&#x4E2D;&#x9047;&#x5230;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x767E;&#x601D;&#x4E0D;&#x5F97;&#x5176;&#x89E3;&#xFF0C;&#x7136;&#x540E;&#x4F60;&#x8D70;&#x7740;&#x60F3;&#xFF0C;&#x505A;&#x7740;&#x60F3;&#xFF0C;&#x5403;&#x996D;&#x60F3;&#xFF0C;&#x7761;&#x524D;&#x60F3;&#xFF0C;&#x7136;&#x540E;&#x67D0;&#x5929;&#x65E9;&#x4E0A;&#x9192;&#x6765;&#xFF0C;&#x7075;&#x5149;&#x4E4D;&#x73B0;&#xFF0C;&#x5F97;&#x51FA;&#x4E00;&#x5B8C;&#x7F8E;&#x65B9;&#x6848;&#x3002;&#x5FCD;&#x4E0D;&#x4F4F;&#x90FD;&#x8981;&#x4E3A;&#x81EA;&#x5DF1;&#x7684;&#x806A;&#x660E;&#x624D;&#x667A;&#x9F13;&#x9F13;&#x638C;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x5FF5;&#x5FF5;&#x4E0D;&#x5FD8;&#x5FC5;&#x6709;&#x56DE;&#x54CD;&#x3002;&#x8001;&#x5929;&#x7737;&#x987E;&#x52AA;&#x529B;&#x7684;&#x4EBA;&#x3002;</p><h4 id="&#x8FC7;&#x7A0B;&#x4E2D;&#x8981;&#x53CA;&#x65F6;&#x53CD;&#x9988;&#xFF0C;&#x7ECF;&#x5E38;&#x6C47;&#x62A5;"><a href="#&#x8FC7;&#x7A0B;&#x4E2D;&#x8981;&#x53CA;&#x65F6;&#x53CD;&#x9988;&#xFF0C;&#x7ECF;&#x5E38;&#x6C47;&#x62A5;" class="headerlink" title="&#x8FC7;&#x7A0B;&#x4E2D;&#x8981;&#x53CA;&#x65F6;&#x53CD;&#x9988;&#xFF0C;&#x7ECF;&#x5E38;&#x6C47;&#x62A5;"></a>&#x8FC7;&#x7A0B;&#x4E2D;&#x8981;&#x53CA;&#x65F6;&#x53CD;&#x9988;&#xFF0C;&#x7ECF;&#x5E38;&#x6C47;&#x62A5;</h4><p>&#x5DE5;&#x4F5C;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x60F3;&#x9886;&#x5BFC;&#x4E4B;&#x6240;&#x60F3;&#xFF0C;&#x8001;&#x677F;&#x628A;&#x4EFB;&#x52A1;&#x62C6;&#x89E3;&#x597D;&#x4E86;&#xFF0C;&#x8DDF;&#x5927;&#x4F19;&#x5236;&#x5B9A;&#x4E86;&#x8FBE;&#x6210;&#x76EE;&#x6807;&#x7684;&#x5173;&#x952E;&#x8DEF;&#x5F84;&#xFF0C;&#x624B;&#x4E0B;&#x4EBA;&#x53BB;&#x5E72;&#x6D3B;&#x4E86;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x8001;&#x677F;&#x4F1A;&#x5173;&#x6CE8;&#x4EC0;&#x4E48;&#xFF1F;&#x663E;&#x7136;&#xFF0C;&#x8001;&#x677F;&#x60F3;&#x77E5;&#x9053;&#x5404;&#x4F4D;&#x5E72;&#x5F97;&#x5982;&#x4F55;&#x4E86;&#xFF0C;&#x662F;&#x5426;&#x9047;&#x5230;&#x96BE;&#x70B9;&#xFF0C;&#x51FA;&#x73B0;&#x610F;&#x5916;&#xFF0C;&#x5F71;&#x54CD;&#x9879;&#x76EE;&#x8FDB;&#x5C55;&#xFF0C;&#x5DF2;&#x7ECF;&#x505A;&#x4E86;&#x54EA;&#x4E9B;&#xFF0C;&#x8FD8;&#x5DEE;&#x54EA;&#x4E9B;&#x2026;&#x2026;&#x6240;&#x4EE5;&#xFF0C;&#x53CA;&#x65F6;&#x53CD;&#x9988;&#xFF0C;&#x7ECF;&#x5E38;&#x6C47;&#x62A5;&#x662F;&#x5F88;&#x6709;&#x5FC5;&#x8981;&#x6EF4;&#xFF0C;&#x8001;&#x677F;&#x4F1A;&#x89C9;&#x5F97;&#x4F60;&#x5F88;&#x4E0A;&#x8FDB;&#xFF0C;&#x5F88;&#x79EF;&#x6781;&#x3002;&#x4F46;&#x8001;&#x662F;&#x62FF;&#x4E2A;PPT&#x53BB;&#x7ED9;&#x8001;&#x677F;&#x8BB2;&#xFF0C;&#x5F88;&#x4E0D;&#x7CFB;&#x7EDF;&#x5316;&#xFF0C;&#x4E5F;&#x4E0D;&#x4FBF;&#x4E8E;&#x8001;&#x677F;&#x8DDF;&#x8E2A;&#xFF0C;&#x4E00;&#x4E2A;&#x826F;&#x597D;&#x7684;&#x9879;&#x76EE;&#x7BA1;&#x7406;&#x5DE5;&#x5177;&#x662F;&#x5F88;&#x6709;&#x5FC5;&#x8981;&#x7684;&#x3002;</p><p><img src="/images/sh.jpg" width="100%" height="70%"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;font color=&quot;&quot; size=&quot;3&quot;&gt; 很多三四年工作经验的同学，因为缺少必要的职业素养的培训，工作的方式方法或多或少存在一些问题，这影响了自身的职业发展。怎么做才算是会工作，这里有几点不成熟的建议，供诸君参考。 &lt;/font&gt;

&lt;hr&gt;
    
    </summary>
    
      <category term="职业规划" scheme="https://wolf-7.github.io/categories/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/"/>
    
    
      <category term="职业规划" scheme="https://wolf-7.github.io/tags/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/"/>
    
  </entry>
  
  <entry>
    <title>运维的价值与目标拆解</title>
    <link href="https://wolf-7.github.io/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/2017/07/17/%E8%BF%90%E7%BB%B4%E7%9A%84%E4%BB%B7%E5%80%BC%E4%B8%8E%E7%9B%AE%E6%A0%87%E6%8B%86%E8%A7%A3.html"/>
    <id>https://wolf-7.github.io/职业规划/2017/07/17/运维的价值与目标拆解.html</id>
    <published>2017-07-17T13:41:56.000Z</published>
    <updated>2019-01-14T11:59:08.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><p>&#x8FD9;&#x91CC;&#x8BF4;&#x7684;&#x8FD0;&#x7EF4;&#x4E3B;&#x8981;&#x662F;&#x6307;&#x5E94;&#x7528;&#x8FD0;&#x7EF4;&#xFF0C;&#x975E;&#x7CFB;&#x7EDF;&#x90E8;&#x7684;&#x504F;&#x786C;&#x4EF6;&#x548C;&#x7F51;&#x7EDC;&#x7684;&#x8FD0;&#x7EF4;</p><hr><a id="more"></a><h3 id="&#x6211;&#x4E0D;&#x5E78;&#x798F;"><a href="#&#x6211;&#x4E0D;&#x5E78;&#x798F;" class="headerlink" title="&#x6211;&#x4E0D;&#x5E78;&#x798F;"></a>&#x6211;&#x4E0D;&#x5E78;&#x798F;</h3><p>&#x5F88;&#x591A;&#x8FD0;&#x7EF4;&#x540C;&#x5B66;&#x611F;&#x89C9;&#x81EA;&#x5DF1;&#x5F88;&#x82E6;&#x903C;&#xFF0C;&#x611F;&#x89C9;&#x6BCF;&#x5929;&#x90FD;&#x5728;&#x6551;&#x706B;&#xFF0C;&#x7ED9;&#x7814;&#x53D1;&#x64E6;&#x5C41;&#x80A1;&#xFF0C;&#x505A;&#x4E00;&#x4E9B;&#x91CD;&#x590D;&#x5DE5;&#x4F5C;&#xFF0C;&#x505A;&#x4E00;&#x4E9B;&#x5BF9;&#x81EA;&#x5DF1;&#x63D0;&#x5347;&#x8F83;&#x5C0F;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x603B;&#x7ED3;&#x4E00;&#x53E5;&#x8BDD;&#xFF0C;&#x5C31;&#x662F;&#x4E0D;&#x5E78;&#x798F;&#x3002;</p><h3 id="&#x600E;&#x4E48;&#x5E78;&#x798F;"><a href="#&#x600E;&#x4E48;&#x5E78;&#x798F;" class="headerlink" title="&#x600E;&#x4E48;&#x5E78;&#x798F;"></a>&#x600E;&#x4E48;&#x5E78;&#x798F;</h3><p>&#x5DE5;&#x4F5C;&#x4E2D;&#x7684;&#x5E78;&#x798F;&#x4E3B;&#x8981;&#x6765;&#x81EA;&#x4E24;&#x70B9;&#xFF1A;</p><p>1&#x3001;&#x6709;&#x6210;&#x5C31;&#x611F;&#xFF1B;<br>2&#x3001;&#x85AA;&#x6C34;&#x5230;&#x4F4D;&#xFF1B;</p><p>&#x800C;&#x85AA;&#x6C34;&#x5230;&#x4F4D;&#x4E0E;&#x5426;&#x5F88;&#x5927;&#x7A0B;&#x5EA6;&#x51B3;&#x5B9A;&#x4E8E;&#x4F60;&#x7684;&#x4EA7;&#x51FA;&#xFF08;&#x5982;&#x679C;&#x4F60;&#x7684;&#x8001;&#x677F;&#x4E0D;&#x61C2;&#x4F60;&#x4EEC;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x770B;&#x4E0D;&#x5230;&#x672C;&#x8BE5;&#x770B;&#x5230;&#x7684;&#x4EF7;&#x503C;&#xFF0C;&#x90A3;&#x53E6;&#x5F53;&#x522B;&#x8BBA;&#xFF09;&#xFF0C;&#x800C;&#x4EA7;&#x51FA;&#x591A;&#x5C11;&#x5F88;&#x5927;&#x7A0B;&#x5EA6;&#x4E0A;&#x548C;&#x4F60;&#x7684;&#x6210;&#x5C31;&#x611F;&#x662F;&#x6B63;&#x76F8;&#x5173;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x5E78;&#x798F;&#xFF0C;&#x5C31;&#x8981;&#x505A;&#x6709;&#x6210;&#x5C31;&#x611F;&#x7684;&#x4E8B;&#x60C5;&#x3002;</p><h3 id="&#x8C08;&#x6210;&#x5C31;&#x611F;"><a href="#&#x8C08;&#x6210;&#x5C31;&#x611F;" class="headerlink" title="&#x8C08;&#x6210;&#x5C31;&#x611F;"></a>&#x8C08;&#x6210;&#x5C31;&#x611F;</h3><p>&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x6280;&#x672F;&#x4EBA;&#x5458;&#xFF0C;&#x6210;&#x5C31;&#x611F;&#x4E3B;&#x8981;&#x6765;&#x81EA;&#x4E24;&#x70B9;&#xFF1A;</p><p>1&#x3001;&#x505A;&#x7684;&#x6709;&#x4EF7;&#x503C;<br>2&#x3001;&#x88AB;&#x522B;&#x4EBA;&#x8BA4;&#x540C;</p><p>&#x5BF9;&#x4E8E;&#x7814;&#x53D1;&#x540C;&#x5B66;&#xFF0C;&#x6BD4;&#x5982;&#x5199;&#x4E86;&#x4E00;&#x4E2A;framework&#xFF0C;&#x6216;&#x8005;lib&#xFF0C;&#x540C;&#x4E8B;&#x90FD;&#x8BF4;&#x597D;&#xFF0C;&#x5E76;&#x62FF;&#x53BB;&#x7528;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x662F;&#x8D85;&#x7EA7;&#x6709;&#x6210;&#x5C31;&#x611F;&#x7684;&#xFF1B;&#x6216;&#x8005;&#x505A;&#x7684;&#x4EA7;&#x54C1;&#x88AB;&#x5E02;&#x573A;&#x8BA4;&#x53EF;&#xFF0C;&#x88AB;&#x540C;&#x884C;&#x8BA4;&#x53EF;&#xFF0C;&#x4E5F;&#x662F;&#x5F88;&#x6709;&#x6210;&#x5C31;&#x611F;&#x7684;&#x3002;</p><p>&#x90A3;&#x8FD0;&#x7EF4;&#x540C;&#x5B66;&#x5462;&#xFF1F;&#x4EF7;&#x503C;&#x4F53;&#x73B0;&#x5728;&#x54EA;&#x91CC;&#xFF1F;</p><p>&#x8FD0;&#x7EF4;&#x7684;&#x4EF7;&#x503C;<br>&#x53EF;&#x4EE5;&#x5206;&#x5BF9;&#x5185;&#x7684;&#xFF0C;&#x548C;&#x5BF9;&#x5916;&#x7684;&#x3002;&#x6BD4;&#x5982;&#x8FD0;&#x7EF4;&#x540C;&#x5B66;&#x5199;&#x4E86;&#x4E00;&#x4E9B;&#x8FD0;&#x7EF4;&#x5DE5;&#x5177;&#xFF0C;&#x5927;&#x5927;&#x63D0;&#x5347;&#x4E86;&#x505A;&#x67D0;&#x4E9B;&#x4E8B;&#x60C5;&#x7684;&#x6548;&#x7387;&#xFF0C;&#x5F97;&#x5230;&#x5468;&#x8FB9;&#x540C;&#x5B66;&#x7684;&#x8BA4;&#x53EF;&#xFF0C;&#x8FD9;&#x662F;&#x5BF9;&#x5185;&#x7684;&#x4EF7;&#x503C;&#x3002;&#x8FD9;&#x91CC;&#xFF0C;&#x7B14;&#x8005;&#x66F4;&#x5E0C;&#x671B;&#x597D;&#x597D;&#x63A2;&#x8BA8;&#x4E00;&#x4E0B;&#x5BF9;&#x5916;&#x7684;&#x4EF7;&#x503C;&#xFF0C;&#x8FD0;&#x7EF4;&#x8FD9;&#x4E2A;&#x89D2;&#x8272;&#xFF0C;&#x5728;&#x516C;&#x53F8;&#x7684;&#x5B9A;&#x4F4D;&#xFF0C;&#x5BF9;&#x516C;&#x53F8;&#x7684;&#x4EF7;&#x503C;&#x3002;</p><p>&#x591A;&#x6570;&#x516C;&#x53F8;&#x5728;&#x521B;&#x4E1A;&#x4E4B;&#x521D;&#xFF0C;&#x662F;&#x6CA1;&#x6709;&#x8FD0;&#x7EF4;&#x8FD9;&#x4E2A;&#x89D2;&#x8272;&#x7684;&#xFF0C;&#x76F8;&#x5173;&#x5DE5;&#x4F5C;&#x5185;&#x5BB9;&#x7531;&#x6240;&#x8C13;&#x7684;&#x5168;&#x6808;&#x5DE5;&#x7A0B;&#x5E08;&#x3001;&#x6808;&#x6EA2;&#x51FA;&#x5DE5;&#x7A0B;&#x5E08;&#x4EE3;&#x52B3;&#x3002;&#x968F;&#x7740;&#x516C;&#x53F8;&#x89C4;&#x6A21;&#x6269;&#x5927;&#xFF0C;&#x673A;&#x5668;&#x5230;&#x51E0;&#x767E;&#x53F0;&#xFF0C;&#x4F1A;&#x66B4;&#x9732;&#x51FA;N&#x591A;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x8F83;&#x76F4;&#x89C2;&#x7684;&#x6BD4;&#x5982;&#xFF1A;</p><ul><li>&#x7EBF;&#x4E0A;&#x73AF;&#x5883;&#x6DF7;&#x4E71;&#x4E0D;&#x582A;&#xFF0C;OS&#x53D1;&#x884C;&#x7248;&#x3001;&#x7CFB;&#x7EDF;&#x53C2;&#x6570;&#x914D;&#x7F6E;&#x3001;WEB&#x670D;&#x52A1;&#x5668;&#x3001;&#x542F;&#x505C;&#x65B9;&#x5F0F;&#x3001;&#x90E8;&#x7F72;&#x8DEF;&#x5F84;&#x5168;&#x51ED;&#x5404;&#x670D;&#x52A1;&#x7684;&#x7814;&#x53D1;&#x4EBA;&#x5458;&#x7684;&#x559C;&#x597D;&#x548C;&#x719F;&#x6089;&#x7A0B;&#x5EA6;</li><li>&#x76D1;&#x63A7;&#x5404;&#x79CD;&#x4E0D;&#x5B8C;&#x5907;&#xFF0C;&#x5F88;&#x591A;&#x6545;&#x969C;&#x90FD;&#x662F;&#x540E;&#x4E8E;&#x7528;&#x6237;&#x53D1;&#x73B0;&#xFF0C;&#x6709;&#x4E9B;&#x8FDB;&#x7A0B;&#x6302;&#x4E86;&#x597D;&#x4E45;&#x624D;&#x5076;&#x7136;&#x53D1;&#x73B0;&#x6216;&#x7528;&#x6237;&#x62A5;&#x969C;&#x4E86;&#x624D;&#x53D1;&#x73B0;</li><li>&#x51FA;&#x4E86;&#x6545;&#x969C;&#x6392;&#x67E5;&#x8D39;&#x52B2;&#xFF0C;&#x751A;&#x81F3;&#x5728;&#x7EBF;&#x4E0A;&#x8C03;&#x8BD5;</li><li>&#x5F88;&#x591A;&#x6545;&#x969C;&#x90FD;&#x662F;&#x7531;&#x4E00;&#x4E9B;&#x4F4E;&#x7EA7;&#x95EE;&#x9898;&#x5BFC;&#x81F4;&#xFF0C;&#x6BD4;&#x5982;ulimit&#x914D;&#x7F6E;&#x4E0D;&#x5408;&#x7406;&#xFF0C;&#x6BD4;&#x5982;&#x60F3;&#x56DE;&#x6EDA;&#x5374;&#x53D1;&#x73B0;&#x5FD8;&#x8BB0;&#x5907;&#x4EFD;</li><li>&#x670D;&#x52A1;&#x5668;&#x8D44;&#x6E90;&#x5229;&#x7528;&#x7387;&#x4F4E;&#xFF0C;&#x5F88;&#x591A;&#x673A;&#x5668;&#x6839;&#x672C;&#x6CA1;&#x5728;&#x7528;&#xFF0C;&#x751A;&#x81F3;&#x90FD;&#x627E;&#x4E0D;&#x5230;&#x4E86;&#xFF0C;&#x6D6A;&#x8D39;&#x4E86;&#x5927;&#x91CF;&#x786C;&#x4EF6;&#x6210;&#x672C;</li><li>&#x540C;&#x65F6;&#x64CD;&#x4F5C;&#x5927;&#x91CF;&#x673A;&#x5668;&#x7F3A;&#x4E4F;&#x6709;&#x529B;&#x5DE5;&#x5177;&#xFF0C;&#x7EBF;&#x4E0A;&#x6743;&#x9650;&#x8981;&#x4E48;&#x6DF7;&#x4E71;&#x4E0D;&#x582A;&#xFF0C;&#x8981;&#x4E48;&#x6240;&#x6709;&#x4EBA;&#x6709;&#x6240;&#x6709;&#x673A;&#x5668;&#x7684;&#x6743;&#x9650;</li></ul><p>&#x6280;&#x672F;&#x5408;&#x4F19;&#x4EBA;&#x610F;&#x8BC6;&#x5230;&#xFF1A;&#x9760;&#x4E13;&#x6CE8;&#x5199;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x7684;&#x7814;&#x53D1;&#x4EBA;&#x5458;&#x6765;&#x89E3;&#x51B3;&#x8FD9;&#x4E9B;&#x95EE;&#x9898;&#x662F;&#x4E0D;&#x9760;&#x8C31;&#x7684;&#xFF0C;&#x9700;&#x8981;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x804C;&#x80FD;&#x56E2;&#x961F;&#x6765;&#x6536;&#x62FE;&#x8FD9;&#x4E2A;&#x70C2;&#x644A;&#x5B50;&#x3002;</p><p>&#x4E8E;&#x662F;&#xFF0C;&#x8FD0;&#x7EF4;&#x56E2;&#x961F;&#x5E94;&#x8FD0;&#x800C;&#x751F;&#xFF0C;&#x5B9A;&#x4F4D;&#x5C31;&#x662F;&#xFF1A;&#x89E3;&#x51B3;&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684;&#x95EE;&#x9898;&#x3002;&#x6362;&#x4E2A;&#x8BF4;&#x6CD5;&#xFF1A;&#x8BA9;&#x7814;&#x53D1;&#x53EA;&#x4E13;&#x6CE8;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x548C;&#x67B6;&#x6784;&#x8BBE;&#x8BA1;&#xFF0C;&#x8FD0;&#x7EF4;&#x641E;&#x5B9A;&#x5269;&#x4E0B;&#x7684;&#x3002;&#x8FD9;&#x6837;&#x4F1A;&#x5E26;&#x6765;&#x4EE5;&#x4E0B;&#x597D;&#x5904;&#xFF1A;</p><ul><li>&#x4EA7;&#x54C1;&#x66F4;&#x5FEB;&#x5F97;&#x5230;&#x9A8C;&#x8BC1;&#xFF1A;&#x89E3;&#x653E;&#x4E86;&#x7814;&#x53D1;&#x4EBA;&#x529B;&#xFF0C;&#x7814;&#x53D1;&#x540C;&#x5B66;&#x5C31;&#x53EF;&#x4EE5;&#x5168;&#x8EAB;&#x5FC3;&#x6251;&#x5728;&#x4EA7;&#x54C1;&#x5F00;&#x53D1;&#x4E0A;&#xFF0C;&#x8FED;&#x4EE3;&#x901F;&#x5EA6;&#x4F1A;&#x53D8;&#x5FEB;</li><li>&#x5927;&#x5E45;&#x63D0;&#x5347;&#x670D;&#x52A1;&#x7A33;&#x5B9A;&#x6027;&#xFF1A;&#x4E13;&#x4E1A;&#x7684;&#x4EBA;&#x5E72;&#x4E13;&#x4E1A;&#x7684;&#x4E8B;&#xFF0C;&#x7EBF;&#x4E0A;&#x73AF;&#x5883;&#x89C4;&#x8303;&#x5E72;&#x51C0;&#x4E86;&#xFF0C;&#x76D1;&#x63A7;&#x5B8C;&#x5907;&#x4E86;&#xFF0C;&#x6CA1;&#x6709;&#x4F4E;&#x7EA7;&#x9519;&#x8BEF;&#x4E86;&#xFF0C;&#x7CFB;&#x7EDF;&#x53C2;&#x6570;&#x914D;&#x7F6E;&#x5408;&#x7406;&#x4E86;</li><li>&#x8D44;&#x4EA7;&#x5F97;&#x5230;&#x6709;&#x6548;&#x5229;&#x7528;&#xFF1A;&#x8D44;&#x4EA7;&#x4E13;&#x95E8;&#x6709;&#x4EBA;&#x5728;&#x68B3;&#x7406;&#xFF0C;&#x901A;&#x8FC7;&#x670D;&#x52A1;&#x6DF7;&#x90E8;&#x7B49;&#x624B;&#x6BB5;&#x63D0;&#x9AD8;&#x5229;&#x7528;&#x7387;&#xFF0C;&#x518D;&#x4E5F;&#x6CA1;&#x6709;&#x673A;&#x5668;&#x5728;&#x7A7A;&#x8F6C;</li></ul><blockquote><font color="wihte" size="4"> &#x7528;&#x4E00;&#x53E5;&#x8BDD;&#x6765;&#x6982;&#x51B5;&#x8FD0;&#x7EF4;&#x7684;&#x4EF7;&#x503C;: </font><br><font color="red" size="4"> &#x82B1;&#x66F4;&#x5C11;&#x7684;&#x94B1;&#xFF0C;&#x8BA9;&#x4EA7;&#x54C1;&#x66F4;&#x5FEB;&#x8FED;&#x4EE3;&#xFF0C;&#x66F4;&#x7A33;&#x5B9A;&#x8FD0;&#x884C; </font></blockquote><p>&#x2003;<br>&#x6709;&#x4E9B;&#x8FD0;&#x7EF4;&#x540C;&#x4EC1;&#x6982;&#x51B5;&#x4E86;&#x8FD0;&#x7EF4;&#x4E5D;&#x5B57;&#x771F;&#x8A00;&#x201C;&#x5B89;&#x5168;&#x7A33;&#x5B9A;&#x9AD8;&#x6548;&#x4F4E;&#x6210;&#x672C;&#x201D;&#xFF0C;&#x8BF4;&#x7684;&#x975E;&#x5E38;&#x5230;&#x4F4D;&#x3002;&#x5176;&#x4E2D;&#x7684;&#x5B89;&#x5168;&#xFF0C;&#x884C;&#x6587;&#x5230;&#x6B64;&#x5C1A;&#x672A;&#x4ECB;&#x7ECD;&#x5230;&#xFF0C;&#x6709;&#x4E9B;&#x516C;&#x53F8;&#x4F1A;&#x628A;&#x5B89;&#x5168;&#x5355;&#x62CE;&#x51FA;&#x6765;&#x6210;&#x7ACB;&#x5B89;&#x5168;&#x90E8;&#xFF0C;&#x6709;&#x4E9B;&#x5C31;&#x76F4;&#x63A5;&#x653E;&#x5728;&#x8FD0;&#x7EF4;&#x56E2;&#x961F;&#xFF0C;&#x8FD9;&#x4E2A;&#x770B;&#x516C;&#x53F8;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x679C;&#x516C;&#x53F8;&#x4F53;&#x91CF;&#x5927;&#xFF0C;&#x4E2A;&#x4EBA;&#x8BA4;&#x4E3A;&#xFF0C;&#x8FD8;&#x662F;&#x5355;&#x62CE;&#x51FA;&#x6765;&#x4F1A;&#x597D;&#x4E00;&#x4E9B;&#x3002;</p><h3 id="&#x76EE;&#x6807;&#x62C6;&#x89E3;"><a href="#&#x76EE;&#x6807;&#x62C6;&#x89E3;" class="headerlink" title="&#x76EE;&#x6807;&#x62C6;&#x89E3;"></a>&#x76EE;&#x6807;&#x62C6;&#x89E3;</h3><p>&#x5B89;&#x5168;&#x3001;&#x7A33;&#x5B9A;&#x3001;&#x9AD8;&#x6548;&#x3001;&#x4F4E;&#x6210;&#x672C;&#xFF0C;&#x600E;&#x4E48;&#x624D;&#x80FD;&#x628A;&#x8FD9;&#x56DB;&#x5927;&#x76EE;&#x6807;&#x505A;&#x597D;&#xFF1F;&#x5E94;&#x8BE5;&#x505A;&#x54EA;&#x4E9B;&#x4E8B;&#x60C5;&#x6765;&#x8FBE;&#x6210;&#x76EE;&#x6807;&#xFF1F;&#x7B14;&#x8005;&#x7528;&#x4E00;&#x5F20;&#x8111;&#x56FE;&#x6765;&#x68B3;&#x7406;&#x4E00;&#x4E0B;&#xFF1A;</p><h3 id="&#x8FD0;&#x7EF4;&#x76EE;&#x6807;&#x62C6;&#x89E3;"><a href="#&#x8FD0;&#x7EF4;&#x76EE;&#x6807;&#x62C6;&#x89E3;" class="headerlink" title="&#x8FD0;&#x7EF4;&#x76EE;&#x6807;&#x62C6;&#x89E3;"></a>&#x8FD0;&#x7EF4;&#x76EE;&#x6807;&#x62C6;&#x89E3;</h3><p><img src="/images/operation-2.jpg" width="100%" height="80%"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;这里说的运维主要是指应用运维，非系统部的偏硬件和网络的运维&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="职业规划" scheme="https://wolf-7.github.io/categories/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/"/>
    
    
      <category term="职业规划" scheme="https://wolf-7.github.io/tags/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/"/>
    
  </entry>
  
  <entry>
    <title>Red Hat Certified Engineer (RHCE) EX300 Study Guide</title>
    <link href="https://wolf-7.github.io/RHCE/2017/03/02/Red-Hat-Certified-Engineer-RHCE-EX300-Study-Guide.html"/>
    <id>https://wolf-7.github.io/RHCE/2017/03/02/Red-Hat-Certified-Engineer-RHCE-EX300-Study-Guide.html</id>
    <published>2017-03-02T11:21:54.000Z</published>
    <updated>2019-01-16T03:12:17.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><font color="" size="3"> Red Hat Certified Engineer (RHCE) EX300 Study Guide. </font><hr><a id="more"></a><p><img src="http://www.yoinsights.com/wp-content/uploads/2016/07/RHCE-in-surat.png" width="100%" height="80%"></p><p>If you&#x2019;re studying towards RHCE, then you may find this page useful.</p><p>Our configuration was tested on <code>RHEL 7.0</code> and <code>RHEL 7.1</code>, some notes for the newest at the time of writing <code>RHEL 7.2</code>, have also been added, were available. There is a link to a sample exam available at the bottom of the page.</p><p>I also recommend you checking out the following blogs: CertDepot and RootUsers. They contain a great deal of information that can be helpful preparing for the RHCE exam.</p><p>RHCE exam candidates should be able to accomplish the following without assistance.</p><h3 id="System-Configuration-and-Management"><a href="#System-Configuration-and-Management" class="headerlink" title="System Configuration and Management"></a>System Configuration and Management</h3><ul><li><a href="http://blog.wolf7.org/2016/02/06/Configure-Aggregated-Network-Links-on-RHEL-7-Bonding-and-Teaming/" target="_blank" rel="noopener">Use network teaming or bonding to configure aggregated network links between two Red Hat Enterprise Linux systems</a></li><li>Configure IPv6 addresses and perform basic IPv6 troubleshooting</li><li>Route IP traffic and create static routes</li><li>Use firewalld and associated mechanisms such as rich rules, zones and custom rules, to implement packet filtering and configure network address translation (NAT)</li><li>Use /proc/sys and sysctl to modify and set kernel runtime parameters</li><li>Configure a system to authenticate using Kerberos (sssd, nslcd)</li><li>Configure a system as either an iSCSI target or initiator that persistently mounts an iSCSI target</li><li>Produce and deliver reports on system utilisation (processor, memory, disk, and network)</li><li>Use shell scripting to automate system maintenance tasks</li></ul><h3 id="Network-Services"><a href="#Network-Services" class="headerlink" title="Network Services"></a>Network Services</h3><p>Network services are an important subset of the exam objectives. RHCE candidates should be capable of meeting the following objectives for each of the network services listed below:</p><ul><li>Install the packages needed to provide the service</li><li>Configure SELinux to support the service</li><li>Use SELinux port labeling to allow services to use non-standard ports</li><li>Configure the service to start when the system is booted</li><li>Configure the service for basic operation</li><li>Configure host-based and user-based security for the service</li></ul><h3 id="HTTP-HTTPS"><a href="#HTTP-HTTPS" class="headerlink" title="HTTP/HTTPS"></a>HTTP/HTTPS</h3><ul><li>Configure a virtual host</li><li>Configure access restrictions on directories</li><li>Deploy a basic CGI application</li><li>Configure group-managed content</li><li>Configure TLS security</li></ul><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><ul><li>Configure a caching-only name server</li><li>Troubleshoot DNS client issues<h3 id="NFS"><a href="#NFS" class="headerlink" title="NFS"></a>NFS</h3></li><li>Provide network shares to specific clients</li><li>Provide network shares suitable for group collaboration</li><li>Use Kerberos to control access to NFS network shares<h3 id="SMB"><a href="#SMB" class="headerlink" title="SMB"></a>SMB</h3></li><li>Provide network shares to specific clients</li><li>Provide network shares suitable for group collaboration<h3 id="SMTP"><a href="#SMTP" class="headerlink" title="SMTP"></a>SMTP</h3></li><li>Configure a system to forward all email to a central mail server<h3 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h3></li><li>Configure key-based authentication</li><li>Configure additional options described in documentation<h3 id="NTP"><a href="#NTP" class="headerlink" title="NTP"></a>NTP</h3></li><li>Synchronise time using other NTP peers<h3 id="Database-services"><a href="#Database-services" class="headerlink" title="Database services"></a>Database services</h3></li><li>Install and configure MariaDB</li><li>Backup and restore a database</li><li>Create a simple database schema</li><li>Perform simple SQL queries against a database</li></ul><h3 id="Other-RHCE-Related-Topics"><a href="#Other-RHCE-Related-Topics" class="headerlink" title="Other RHCE Related Topics"></a>Other RHCE Related Topics</h3><p>FreeIPA Server on RHEL 7<br>Configure Remote Logging on RHEL 7<br>Software Bridge on Top of a Teamed Device on RHEL 7</p><h3 id="RHCE-Sample-Exam-for-RHEL-7"><a href="#RHCE-Sample-Exam-for-RHEL-7" class="headerlink" title="RHCE Sample Exam for RHEL 7"></a>RHCE Sample Exam for RHEL 7</h3><p>I&#x2019;ve created a sample exam, it&#x2019;s available here.</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;font color=&quot;&quot; size=&quot;3&quot;&gt; Red Hat Certified Engineer (RHCE) EX300 Study Guide. &lt;/font&gt;

&lt;hr&gt;
    
    </summary>
    
      <category term="RHCE" scheme="https://wolf-7.github.io/categories/RHCE/"/>
    
    
  </entry>
  
  <entry>
    <title>Docker基本操作命令</title>
    <link href="https://wolf-7.github.io/uncategorized/2017/02/24/Docker%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4.html"/>
    <id>https://wolf-7.github.io/uncategorized/2017/02/24/Docker基本操作命令.html</id>
    <published>2017-02-24T07:48:33.000Z</published>
    <updated>2019-01-24T08:20:49.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="docker&#x7B80;&#x660E;&#x64CD;&#x4ECB;&#x7ECD;"><a href="#docker&#x7B80;&#x660E;&#x64CD;&#x4ECB;&#x7ECD;" class="headerlink" title="docker&#x7B80;&#x660E;&#x64CD;&#x4ECB;&#x7ECD;"></a>docker&#x7B80;&#x660E;&#x64CD;&#x4ECB;&#x7ECD;</h4><p>&#x534F;&#x8BAE; Apache2.0<br>&#x5F00;&#x53D1;&#x8BED;&#x8A00; Go<br>&#x4E00;&#x6B21;build&#x5230;&#x5904;Run<br>docker&#x4F9D;&#x8D56;&#x4E8E;Linux&#x5185;&#x6838;/kernel<br>docker client server&#xFF08;&#x540E;&#x53F0;process&#xFF09;</p><a id="more"></a><p>&#x7EC4;&#x4EF6;&#xFF1A;Image&#x955C;&#x50CF; Container&#x5BB9;&#x5668;&#xFF08;&#x9694;&#x79BB;&#xFF09; Repository&#x4ED3;&#x5E93;&#xFF08;&#x5B58;&#x653E;&#x955C;&#x50CF;&#xFF09;</p><h4 id="Docker&#x4E0E;openstack&#x5E94;&#x7528;&#x573A;&#x666F;&#x7684;&#x5BF9;&#x6BD4;"><a href="#Docker&#x4E0E;openstack&#x5E94;&#x7528;&#x573A;&#x666F;&#x7684;&#x5BF9;&#x6BD4;" class="headerlink" title="Docker&#x4E0E;openstack&#x5E94;&#x7528;&#x573A;&#x666F;&#x7684;&#x5BF9;&#x6BD4;"></a>Docker&#x4E0E;openstack&#x5E94;&#x7528;&#x573A;&#x666F;&#x7684;&#x5BF9;&#x6BD4;</h4><p>&#x7C7B;   &#x522B;&#xFF1A;  Docker   openstack<br>&#x90E8;&#x7F72;&#x96BE;&#x5EA6;&#xFF1A;  &#x975E;&#x5E38;&#x7B80;&#x5355;  &#x7EC4;&#x4EF6;&#x591A;&#xFF0C;&#x90E8;&#x7F72;&#x590D;&#x6742;<br>&#x542F;&#x52A8;&#x901F;&#x5EA6;&#xFF1A;  &#x79D2;&#x7EA7;        &#x5206;&#x949F;&#x7EA7;<br>&#x6267;&#x884C;&#x6027;&#x80FD;&#xFF1A;  &#x548C;&#x7269;&#x7406;&#x673A;&#x51E0;&#x4E4E;&#x4E00;&#x81F4;  VM&#x4F1A;&#x5360;&#x7528;&#x76F8;&#x5BF9;&#x591A;&#x4E00;&#x4E9B;&#x8D44;&#x6E90;<br>&#x955C;&#x50CF;&#x4F53;&#x79EF;&#xFF1A;  &#x955C;&#x50CF;MB&#x7EA7;&#x522B;    &#x865A;&#x62DF;&#x673A;&#x955C;&#x50CF;GB&#x7EA7;<br>&#x7BA1;&#x7406;&#x6548;&#x7387;&#xFF1A;  &#x7BA1;&#x7406;&#x7B80;&#x5355;    &#x7EC4;&#x4EF6;&#x76F8;&#x4E92;&#x4F9D;&#x8D56;&#xFF0C;&#x7BA1;&#x7406;&#x590D;&#x6742;<br>&#x9694;&#x79BB;&#x6027;&#xFF1A;       &#x9694;&#x79BB;&#x9AD8;    &#x5F7B;&#x5E95;&#x9694;&#x79BB;<br>&#x53EF;&#x7BA1;&#x7406;&#x6027;&#xFF1A;  &#x5355;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E0D;&#x5EFA;&#x8BAE;&#x542F;&#x52A8;SSH    &#x5B8C;&#x6574;&#x7684;&#x7CFB;&#x7EDF;&#x7BA1;&#x7406;<br>&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#xFF1A;    &#x6BD4;&#x8F83;&#x5F31;&#xFF0C;&#x505A;&#x96C6;&#x7FA4;&#x80FD;&#x529B;&#x6BD4;&#x8F83;&#x5F31;    &#x501F;&#x52A9;neutron&#x53EF;&#x4EE5;&#x7075;&#x6D3B;&#x7EC4;&#x4EF6;&#x5404;&#x7C7B;&#x7F51;&#x7EDC;&#x67B6;&#x6784;<br>&#x9762;&#x5411;&#x4EA7;&#x54C1;&#xFF0C; &#x5F00;&#x53D1;&#xFF0C; &#x6D4B;&#x8BD5;&#xFF0C; &#x8FD0;&#x7EF4; &#xFF0C; &#x81EA;&#x52A8;&#x5316;{&#x8F7B;&#x91CF;&#x7EA7;&#x7684;&#x6269;&#x5BB9;} &#x5FAE;&#x670D;&#x52A1; &#x9762;&#x5411;&#x5927;&#x89C4;&#x6A21;&#x7684;&#x5206;&#x5E03;&#x5F0F;&#x67B6;&#x6784;{&#x5FAE;&#x4FE1;&#x7EA2;&#x5305;}</p><h4 id="centos-7-&#x914D;&#x7F6E;epel-yum&#x6E90;"><a href="#centos-7-&#x914D;&#x7F6E;epel-yum&#x6E90;" class="headerlink" title="centos 7 &#x914D;&#x7F6E;epel yum&#x6E90;"></a>centos 7 &#x914D;&#x7F6E;epel yum&#x6E90;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span><br><span class="line">yum install docker-io</span><br><span class="line">docker serch centos <span class="comment">#&#x641C;&#x7D22;&#x955C;&#x50CF;</span></span><br><span class="line">docker pull centos <span class="comment">#&#x83B7;&#x53D6;centos&#x955C;&#x50CF;</span></span><br><span class="line">docker rmi images id <span class="comment">#&#x5220;&#x9664;&#x955C;&#x50CF;&#xFF08;&#x6839;&#x636E;image id&#x5220;&#x9664;&#xFF09;</span></span><br><span class="line">docker rm container id <span class="comment">#&#x5220;&#x9664;&#x5BB9;&#x5668;&#xFF08;&#x6839;&#x636E;container id&#xFF09;</span></span><br></pre></td></tr></tbody></table></figure><h4 id="&#x8BE6;&#x7EC6;&#x63CF;&#x8FF0;&#x955C;&#x50CF;"><a href="#&#x8BE6;&#x7EC6;&#x63CF;&#x8FF0;&#x955C;&#x50CF;" class="headerlink" title="&#x8BE6;&#x7EC6;&#x63CF;&#x8FF0;&#x955C;&#x50CF;"></a>&#x8BE6;&#x7EC6;&#x63CF;&#x8FF0;&#x955C;&#x50CF;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">docker.io/centos    latest              3bee3060bfc8        3 weeks ago         192.5 MB</span><br></pre></td></tr></tbody></table></figure><h4 id="docker&#x6BCF;&#x6B21;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x811A;&#x672C;&#x542F;&#x52A8;&#x591A;&#x4E2A;&#x5E94;&#x7528;"><a href="#docker&#x6BCF;&#x6B21;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x811A;&#x672C;&#x542F;&#x52A8;&#x591A;&#x4E2A;&#x5E94;&#x7528;" class="headerlink" title="docker&#x6BCF;&#x6B21;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x811A;&#x672C;&#x542F;&#x52A8;&#x591A;&#x4E2A;&#x5E94;&#x7528;"></a>docker&#x6BCF;&#x6B21;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x811A;&#x672C;&#x542F;&#x52A8;&#x591A;&#x4E2A;&#x5E94;&#x7528;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># docker run centos /bin/echo &apos;hello, world!&apos;</span></span><br><span class="line">hello, world!</span><br></pre></td></tr></tbody></table></figure><h4 id="&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x72B6;&#x6001;"><a href="#&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x72B6;&#x6001;" class="headerlink" title="&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x72B6;&#x6001;"></a>&#x67E5;&#x770B;&#x5BB9;&#x5668;&#x8FD0;&#x884C;&#x72B6;&#x6001;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES</span><br><span class="line">22143f214366        centos              <span class="string">&quot;/bin/echo &apos;hello, wo&quot;</span>   26 seconds ago      Exited (0) 25 seconds ago                       loving_ptolemy</span><br></pre></td></tr></tbody></table></figure><h4 id="&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#xFF0C;&#x5E76;&#x4E14;&#x8FDB;&#x5165;bash&#x6A21;&#x5F0F;"><a href="#&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#xFF0C;&#x5E76;&#x4E14;&#x8FDB;&#x5165;bash&#x6A21;&#x5F0F;" class="headerlink" title="&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#xFF0C;&#x5E76;&#x4E14;&#x8FDB;&#x5165;bash&#x6A21;&#x5F0F;"></a>&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x540D;&#x5B57;&#xFF0C;&#x5E76;&#x4E14;&#x8FDB;&#x5165;bash&#x6A21;&#x5F0F;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># docker run --name DenissDocker -it centos /bin/bash</span></span><br><span class="line">[root@32bbfc535f14 /]<span class="comment">#</span></span><br></pre></td></tr></tbody></table></figure><p>####&#x9000;&#x51FA;&#x5BB9;&#x5668;exit<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">32bbfc535f14        centos              <span class="string">&quot;/bin/bash&quot;</span>              2 minutes ago       Exited (0) 3 seconds ago                       DenissDocker</span><br><span class="line">22143f214366        centos              <span class="string">&quot;/bin/echo &apos;hello, wo&quot;</span>   4 minutes ago       Exited (0) 4 minutes ago                       loving_ptolemy</span><br></pre></td></tr></tbody></table></figure><p></p><p>####&#x542F;&#x52A8;&#x5BB9;&#x5668;&#x540E;&#x53F0;&#x8FD0;&#x884C;&#x53C2;&#x6570;-d(&#x5982;&#x679C;&#x6CA1;&#x6709;nginx&#x955C;&#x50CF;&#x4F1A;&#x4ECE;repository&#x4ED3;&#x5E93;pull&#x4E00;&#x4E2A;&#x4E0B;&#x6765;)<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># docker run -d -h nginx --name Deniss.nginx nginx</span></span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="&#x8FDB;&#x5165;&#x5BB9;&#x5668;&#x4E0E;&#x7F51;&#x7EDC;&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;"><a href="#&#x8FDB;&#x5165;&#x5BB9;&#x5668;&#x4E0E;&#x7F51;&#x7EDC;&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;" class="headerlink" title="&#x8FDB;&#x5165;&#x5BB9;&#x5668;&#x4E0E;&#x7F51;&#x7EDC;&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;"></a>&#x8FDB;&#x5165;&#x5BB9;&#x5668;&#x4E0E;&#x7F51;&#x7EDC;&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;</h4><p>&#x83B7;&#x53D6;&#x5BB9;&#x5668;PID&#xFF0C;&#x53EF;&#x4EE5;&#x662F;&#x540D;&#x5B57;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;CONTAINER ID<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># docker inspect --format &quot;{{.State.Pid}}&quot; Deniss.nginx</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x811A;&#x672C;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">CNAME=<span class="variable">$1</span></span><br><span class="line">CPID=$(docker inspect --format <span class="string">&quot;{{.State.Pid}}&quot;</span> <span class="variable">$CNAME</span>)</span><br><span class="line">nsenter --target <span class="string">&quot;<span class="variable">$CPID</span>&quot;</span> --mount --uts --ipc --net --pid</span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="&#x7F51;&#x7EDC;&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;"><a href="#&#x7F51;&#x7EDC;&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;" class="headerlink" title="&#x7F51;&#x7EDC;&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;"></a>&#x7F51;&#x7EDC;&#x8BBF;&#x95EE;&#x6A21;&#x5F0F;</h4><p>&#x968F;&#x673A;&#x6620;&#x5C04;<br>docker run -P{&#x65E0;&#x9700;&#x5236;&#x5B9A;&#x7AEF;&#x53E3;&#xFF0C;&#x7AEF;&#x53E3;&#x968F;&#x673A;} &#x4F18;&#x70B9;&#xFF1A;&#x7AEF;&#x53E3;&#x4E0D;&#x4F1A;&#x51B2;&#x7A81;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># docker run -d -P --name mysqlnginx1 nginx</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>docker run -p {&#x5236;&#x5B9A;&#x7AEF;&#x53E3;}<br>&#x5236;&#x5B9A;&#x6620;&#x5C04;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># dockersqlnginx2 nginx run -d -p  91:80 --name mynginx2 nginx</span></span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="&#x67E5;&#x770B;&#x7F51;&#x7EDC;"><a href="#&#x67E5;&#x770B;&#x7F51;&#x7EDC;" class="headerlink" title="&#x67E5;&#x770B;&#x7F51;&#x7EDC;"></a>&#x67E5;&#x770B;&#x7F51;&#x7EDC;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># brctl show</span></span><br><span class="line">bridge namebridge idSTP enabledinterfaces</span><br><span class="line">docker08000.0242ba293708noveth21d6f36</span><br><span class="line">virbr08000.5254005d7096yesvirbr0-nic</span><br></pre></td></tr></tbody></table></figure><p>####&#x67E5;&#x770B;docker&#x5BB9;&#x5668;ip<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># ip ad li</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>####&#x67E5;&#x770B;&#x8DEF;&#x7531;&#x7F51;&#x5173;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># ip ro li</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6570;&#x636E;&#x7BA1;&#x7406;<br>&#x6570;&#x636E;&#x5377;    &#x6570;&#x636E;&#x5377;&#x5BB9;&#x5668;<br>-v /data &#x2013;volumes-<br>-v src:dst from</p><p>&#x6570;&#x636E;&#x5377;&#x4E2D;&#x7684;&#x64CD;&#x4F5C;&#x4F1A;&#x7ACB;&#x9A6C;&#x751F;&#x6548;&#xFF0C;&#x540C;&#x65F6;&#x8FD8;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x91CD;&#x7528;<br>&#x6620;&#x5C04;&#x6570;&#x636E;&#x5377;&#x7684;&#x521B;&#x5EFA;&#x65B9;&#x5F0F;{&#x76EE;&#x5F55;&#x4F1A;&#x7ED5;&#x8FC7;UFS /var/lib/docker/vfs/dir}<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># docker run -it --name volume-test1 -h nginx -v /data cetnos</span></span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="&#x67E5;&#x770B;docker&#x6570;&#x636E;&#x5377;&#x5B58;&#x653E;&#x7684;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;"><a href="#&#x67E5;&#x770B;docker&#x6570;&#x636E;&#x5377;&#x5B58;&#x653E;&#x7684;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;" class="headerlink" title="&#x67E5;&#x770B;docker&#x6570;&#x636E;&#x5377;&#x5B58;&#x653E;&#x7684;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;"></a>&#x67E5;&#x770B;docker&#x6570;&#x636E;&#x5377;&#x5B58;&#x653E;&#x7684;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;</h4><p>&#x5236;&#x5B9A;&#x76EE;&#x5F55;&#x6302;&#x8F7D;&#x81F3;&#x5BB9;&#x5668;&#xFF08;&#x4E0D;&#x53EF;&#x4EE5;&#x6709;&#x7279;&#x6B8A;&#x5B57;&#x7B26;/&#xFF09;&#x53EF;&#x4EE5;&#x5236;&#x5B9A;&#x6743;&#x9650;&#x8BBF;&#x95EE;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># docker run -it --name volume-test2 -h nginx -v /otp:/opt:ro centos</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>####&#x6570;&#x636E;&#x5377;&#x5BB9;&#x5668;<br>&#x7528;&#x4E4B;&#x524D;&#x542F;&#x52A8;&#x7684;&#x5BB9;&#x5668;&#x7528;&#x6765;&#x505A;&#x6570;&#x636E;&#x5377;&#x5B58;&#x50A8;&#x8BBF;&#x95EE;&#xFF0C;&#x53EF;&#x4EE5;&#x662F;&#x505C;&#x6B62;&#x72B6;&#x6001;&#xFF0C;&#x5BB9;&#x5668;&#x4E0E;&#x65B0;&#x5EFA;&#x5BB9;&#x5668;&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># docker run -it --name volume-test4 --volumes-from volume-test1 centos</span></span><br></pre></td></tr></tbody></table></figure><p></p><h4 id="&#x811A;&#x672C;&#x5FAA;&#x73AF;&#x6253;&#x5370;-image-id-&#x5E76;&#x5220;&#x9664;"><a href="#&#x811A;&#x672C;&#x5FAA;&#x73AF;&#x6253;&#x5370;-image-id-&#x5E76;&#x5220;&#x9664;" class="headerlink" title="&#x811A;&#x672C;&#x5FAA;&#x73AF;&#x6253;&#x5370; image id &#x5E76;&#x5220;&#x9664;"></a>&#x811A;&#x672C;&#x5FAA;&#x73AF;&#x6253;&#x5370; image id &#x5E76;&#x5220;&#x9664;</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon ~]<span class="comment"># for name in `docker images |awk &apos;{print $3}&apos;|grep -v IMAGE`;do docker rmi $name;done</span></span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;docker简明操介绍&quot;&gt;&lt;a href=&quot;#docker简明操介绍&quot; class=&quot;headerlink&quot; title=&quot;docker简明操介绍&quot;&gt;&lt;/a&gt;docker简明操介绍&lt;/h4&gt;&lt;p&gt;协议 Apache2.0&lt;br&gt;开发语言 Go&lt;br&gt;一次build到处Run&lt;br&gt;docker依赖于Linux内核/kernel&lt;br&gt;docker client server（后台process）&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>MySQL备份工具Mysqldump以及Xtrabackup详解</title>
    <link href="https://wolf-7.github.io/MySQL/2017/02/07/MySQL%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7mysqldump%E4%BB%A5%E5%8F%8AXtrabackup%E8%AF%A6%E8%A7%A3.html"/>
    <id>https://wolf-7.github.io/MySQL/2017/02/07/MySQL备份工具mysqldump以及Xtrabackup详解.html</id>
    <published>2017-02-07T09:48:05.000Z</published>
    <updated>2019-01-16T03:15:10.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><h1 id="&#x5F00;&#x5934;&#x8BED;"><a href="#&#x5F00;&#x5934;&#x8BED;" class="headerlink" title=" &#x5F00;&#x5934;&#x8BED;: "></a><font color="Orchid" size="3"> &#x5F00;&#x5934;&#x8BED;: </font></h1><h2 id="&#x5728;&#x5F00;&#x59CB;&#x5BF9;Mysqldump&#x8DDF;Xtrabakcup&#x7684;&#x4ECB;&#x7ECD;&#x4E0E;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5230;&#x4E4B;&#x524D;&#xFF0C;&#x8BF4;&#x4E0B;&#x6570;&#x636E;&#x5BF9;&#x516C;&#x53F8;&#x7684;&#x91CD;&#x8981;&#x6027;&#xFF1A;"><a href="#&#x5728;&#x5F00;&#x59CB;&#x5BF9;Mysqldump&#x8DDF;Xtrabakcup&#x7684;&#x4ECB;&#x7ECD;&#x4E0E;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5230;&#x4E4B;&#x524D;&#xFF0C;&#x8BF4;&#x4E0B;&#x6570;&#x636E;&#x5BF9;&#x516C;&#x53F8;&#x7684;&#x91CD;&#x8981;&#x6027;&#xFF1A;" class="headerlink" title=" &#x5728;&#x5F00;&#x59CB;&#x5BF9;Mysqldump&#x8DDF;Xtrabakcup&#x7684;&#x4ECB;&#x7ECD;&#x4E0E;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5230;&#x4E4B;&#x524D;&#xFF0C;&#x8BF4;&#x4E0B;&#x6570;&#x636E;&#x5BF9;&#x516C;&#x53F8;&#x7684;&#x91CD;&#x8981;&#x6027;&#xFF1A;"></a><font color="Orchid" size="3"> &#x5728;&#x5F00;&#x59CB;&#x5BF9;Mysqldump&#x8DDF;Xtrabakcup&#x7684;&#x4ECB;&#x7ECD;&#x4E0E;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5230;&#x4E4B;&#x524D;&#xFF0C;&#x8BF4;&#x4E0B;&#x6570;&#x636E;&#x5BF9;&#x516C;&#x53F8;&#x7684;&#x91CD;&#x8981;&#x6027;&#xFF1A;</font></h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x5BF9;&#x4E8E;&#x516C;&#x53F8;&#x6765;&#x8BB2;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x672C;&#x8EAB;&#x53EF;&#x80FD;&#x5E76;&#x4E0D;&#x91CD;&#x8981;&#xFF0C;&#x91CD;&#x8981;&#x7684;&#x662F;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x3002;</span><br><span class="line">&#x5BF9;&#x4E8E;&#x5907;&#x4EFD;&#x6765;&#x8BB2;&#xFF0C;&#x6700;&#x7EC8;&#x7684;&#x76EE;&#x7684;&#x662F;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5907;&#x4EFD;&#x80FD;&#x591F;&#x5B9E;&#x73B0;&#x8FD8;&#x539F;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x3002;</span><br><span class="line">&#x56E0;&#x6B64;&#xFF0C;&#x4E00;&#x4E2A;&#x53EF;&#x6062;&#x590D;&#x7684;&#x6570;&#x636E;&#x5E93;&#x5907;&#x4EFD;&#x662F;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x751A;&#x81F3;&#x5173;&#x4E4E;&#x516C;&#x53F8;&#x7684;&#x547D;&#x8109;&#x3002;</span><br></pre></td></tr></tbody></table></figure><hr><a id="more"></a><p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1fhgv8l75tkj308204u745.jpg" width="100%" height="70%"></p><font color="Orchid" size="3"> &#x4E3A;&#x4EC0;&#x4E48;&#x5907;&#x4EFD;? </font><figure class="highlight gcode"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x5B9E;&#x73B0;&#x707E;&#x96BE;&#x6062;&#x590D;&#xFF1A;&#x786C;&#x4EF6;&#x6545;&#x969C;<span class="comment">(&#x5197;&#x4F59;)</span>&#x3001;&#x8F6F;&#x4EF6;&#x6545;&#x969C;<span class="comment">(BUG)</span>&#x3001;&#x81EA;&#x7136;&#x707E;&#x5BB3;&#x3001;&#x9ED1;&#x5BA2;&#x653B;&#x51FB;&#x3001;&#x8BEF;&#x64CD;&#x4F5C;&#x3001;...</span><br><span class="line">&#x6D4B;&#x8BD5;&#x6062;&#x590D;&#x5907;&#x4EFD;&#x65F6;&#xFF0C;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x5C06;&#x6570;&#x636E;&#x5E93;&#x6D4B;&#x8BD5;&#x5D29;&#x6E83;&#x6389;&#x7684;&#x60C5;&#x51B5;</span><br><span class="line"></span><br><span class="line">&#x8FD9;&#x91CC;&#x6700;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x7684;&#x60C5;&#x51B5;&#x662F;&#xFF1A;&#x8BEF;&#x64CD;&#x4F5C;</span><br><span class="line">&#x6240;&#x4EE5;&#x8BF4;&#xFF0C;&#x5728;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x5E93;&#x65F6;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x614E;&#x4E4B;&#x53C8;&#x614E;</span><br></pre></td></tr></tbody></table></figure><h1 id="&#x5907;&#x4EFD;&#x65F6;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E8B;&#x9879;"><a href="#&#x5907;&#x4EFD;&#x65F6;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E8B;&#x9879;" class="headerlink" title=" &#x5907;&#x4EFD;&#x65F6;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E8B;&#x9879;"></a><font szie="4" color="#32CD99"> &#x5907;&#x4EFD;&#x65F6;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x4E8B;&#x9879;</font></h1><ul><li>&#x6CE8;&#x610F;&#x4E8B;&#x9879;</li></ul><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x80FD;&#x5BB9;&#x5FCD;&#x6700;&#x591A;&#x4E22;&#x5931;&#x591A;&#x5C11;&#x6570;&#x636E;&#xFF1B;</span><br><span class="line">&#x6062;&#x590D;&#x6570;&#x636E;&#x9700;&#x8981;&#x5728;&#x591A;&#x957F;&#x65F6;&#x95F4;&#x5185;&#x5B8C;&#x6210;&#xFF1B;</span><br><span class="line">&#x9700;&#x8981;&#x6062;&#x590D;&#x54EA;&#x4E9B;&#x6570;&#x636E;&#xFF1B;</span><br><span class="line"></span><br><span class="line">&#x505A;&#x6062;&#x590D;&#x6F14;&#x7EC3;&#xFF1A;</span><br><span class="line">    &#x6D4B;&#x8BD5;&#x5907;&#x4EFD;&#x7684;&#x53EF;&#x7528;&#x6027;&#xFF1B;</span><br><span class="line">    &#x589E;&#x5F3A;&#x6062;&#x590D;&#x64CD;&#x4F5C;&#x6548;&#x7387;&#xFF1B;</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x5907;&#x4EFD;&#x9700;&#x8981;&#x8003;&#x8651;&#x7684;&#x56E0;&#x7D20;</li></ul><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x9501;&#x5B9A;&#x8D44;&#x6E90;&#x591A;&#x957F;&#x65F6;&#x95F4;&#xFF1F;</span><br><span class="line">&#x5907;&#x4EFD;&#x8FC7;&#x7A0B;&#x7684;&#x65F6;&#x957F;&#xFF1F;</span><br><span class="line">&#x5907;&#x4EFD;&#x65F6;&#x7684;&#x670D;&#x52A1;&#x5668;&#x8D1F;&#x8F7D;&#xFF1F;</span><br><span class="line">&#x6062;&#x590D;&#x8FC7;&#x7A0B;&#x7684;&#x65F6;&#x957F;&#xFF1F;</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x5907;&#x4EFD;&#x4EC0;&#x4E48;?</li></ul><figure class="highlight brainfuck"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#x6570;&#x636E;</span></span><br><span class="line"><span class="comment">&#x4E8C;&#x8FDB;&#x5236;&#x65E5;&#x5FD7;&#x3001;InnoDB&#x7684;&#x4E8B;&#x52A1;&#x65E5;&#x5FD7;&#xFF1B;</span></span><br><span class="line"><span class="comment">&#x4EE3;&#x7801;&#xFF08;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x3001;&#x5B58;&#x50A8;&#x51FD;&#x6570;&#x3001;&#x89E6;&#x53D1;&#x5668;&#x3001;&#x4E8B;&#x4EF6;&#x8C03;&#x5EA6;&#x5668;&#xFF09;</span></span><br><span class="line"><span class="comment">&#x670D;&#x52A1;&#x5668;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</span> <span class="literal">-</span><span class="literal">-</span>&gt; <span class="comment">&#x914D;&#x7F6E;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</span> <span class="literal">-</span><span class="literal">-</span>&gt; <span class="comment">&#x5B58;&#x653E;&#x5728;</span> <span class="comment">Git</span> <span class="comment">&#x3001;svn</span> <span class="comment">&#x4E0A;</span></span><br></pre></td></tr></tbody></table></figure><p><em>&#x6CE8;&#x610F;&#xFF1A;&#x4E8C;&#x8FDB;&#x5236;&#x65E5;&#x5FD7;&#x3001;InnoDB&#x4E8B;&#x52A1;&#x65E5;&#x5FD7; &#x4E0E;&#x6570;&#x636E;&#x8981;&#x5206;&#x522B;&#x5B58;&#x653E;&#x5728;&#x4E0D;&#x540C;&#x7684;&#x786C;&#x76D8;&#x4E2D;</em></p><ul><li>&#x5907;&#x4EFD;&#x7B56;&#x7565;</li></ul><figure class="highlight armasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x5168;&#x91CF;+&#x5DEE;&#x5F02; + <span class="keyword">binlogs</span></span><br><span class="line"><span class="keyword">&#x5168;&#x91CF;+&#x589E;&#x91CF; </span>+ <span class="keyword">binlogs </span></span><br><span class="line"></span><br><span class="line">&#x5907;&#x4EFD;&#x624B;&#x6BB5;&#xFF1A;&#x7269;&#x7406;&#x3001;&#x903B;&#x8F91;</span><br></pre></td></tr></tbody></table></figure><hr><!-- more --><h1 id="&#x5907;&#x4EFD;&#x7C7B;&#x578B;"><a href="#&#x5907;&#x4EFD;&#x7C7B;&#x578B;" class="headerlink" title=" &#x5907;&#x4EFD;&#x7C7B;&#x578B; "></a><font szie="4" color="#32CD99"> &#x5907;&#x4EFD;&#x7C7B;&#x578B; </font></h1><h2 id="&#x5907;&#x4EFD;&#x7684;&#x6570;&#x636E;&#x7684;&#x8303;&#x56F4;"><a href="#&#x5907;&#x4EFD;&#x7684;&#x6570;&#x636E;&#x7684;&#x8303;&#x56F4;" class="headerlink" title=" &#x5907;&#x4EFD;&#x7684;&#x6570;&#x636E;&#x7684;&#x8303;&#x56F4;"></a><font szie="4" color="#007FFF"> &#x5907;&#x4EFD;&#x7684;&#x6570;&#x636E;&#x7684;&#x8303;&#x56F4;</font></h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x5B8C;&#x5168;&#x5907;&#x4EFD;&#x548C;&#x90E8;&#x5206;&#x5907;&#x4EFD;</span><br><span class="line">&#x5B8C;&#x5168;&#x5907;&#x4EFD;&#xFF1A;&#x6574;&#x4E2A;&#x6570;&#x636E;&#x96C6;&#xFF1B;</span><br><span class="line">&#x90E8;&#x5206;&#x5907;&#x4EFD;&#xFF1A;&#x6570;&#x636E;&#x96C6;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x6BD4;&#x5982;&#x90E8;&#x5206;&#x8868;&#xFF1B;</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x5168;&#x91CF;&#x5907;&#x4EFD;&#x3001;&#x589E;&#x91CF;&#x5907;&#x4EFD;&#x3001;&#x5DEE;&#x5F02;&#x5907;&#x4EFD;"><a href="#&#x5168;&#x91CF;&#x5907;&#x4EFD;&#x3001;&#x589E;&#x91CF;&#x5907;&#x4EFD;&#x3001;&#x5DEE;&#x5F02;&#x5907;&#x4EFD;" class="headerlink" title=" &#x5168;&#x91CF;&#x5907;&#x4EFD;&#x3001;&#x589E;&#x91CF;&#x5907;&#x4EFD;&#x3001;&#x5DEE;&#x5F02;&#x5907;&#x4EFD;"></a><font szie="4" color="#007FFF"> &#x5168;&#x91CF;&#x5907;&#x4EFD;&#x3001;&#x589E;&#x91CF;&#x5907;&#x4EFD;&#x3001;&#x5DEE;&#x5F02;&#x5907;&#x4EFD;</font></h2><ul><li>&#x5168;&#x91CF;&#x5907;&#x4EFD;</li></ul><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x5907;&#x4EFD;&#x6574;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x7684;&#x6240;&#x6709;&#x6570;&#x636E;</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x589E;&#x91CF;&#x5907;&#x4EFD;</li></ul><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x4EC5;&#x5907;&#x4EFD;&#x81EA;&#x4E0A;&#x4E00;&#x6B21;&#x5B8C;&#x5168;&#x5907;&#x4EFD;&#x6216; &#x589E;&#x91CF;&#x5907;&#x4EFD;&#x4EE5;&#x6765;&#x53D8;&#x91CF;&#x7684;&#x90A3;&#x90E8;&#x6570;&#x636E;</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x5DEE;&#x5F02;&#x5907;&#x4EFD;</li></ul><figure class="highlight gcode"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x4EC5;&#x5907;&#x4EFD;&#x81EA;&#x4E0A;&#x4E00;&#x6B21;&#x5B8C;&#x5168;&#x5907;&#x4EFD;&#x4EE5;&#x6765;&#x53D8;&#x91CF;&#x7684;&#x90A3;&#x90E8;&#x6570;&#x636E;&#xFF1B;<span class="comment">(&#x6D6A;&#x8D39;&#x7A7A;&#x95F4;&#xFF0C;&#x8FD8;&#x539F;&#x6548;&#x679C;&#x6BD4;&#x589E;&#x91CF;&#x5FEB;)</span></span><br></pre></td></tr></tbody></table></figure><ul><li>&#x901A;&#x8FC7;&#x5907;&#x4EFD;&#x6062;&#x590D;&#x6570;&#x636E;&#x5E93;</li></ul><figure class="highlight gcode"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x5B8C;&#x5168;+&#x589E;&#x91CF;&#xFF1A; &#x5B8C;&#x5168;+&#x6BCF;&#x4E00;&#x6B21;&#x589E;&#x91CF; + &#x4E8C;&#x8FDB;&#x5236;&#x65E5;&#x5FD7;<span class="comment">(&#x6839;&#x636E;&#x65F6;&#x95F4;&#x70B9;&#x6062;&#x590D;)</span></span><br><span class="line">&#x5B8C;&#x5168;+&#x5DEE;&#x5F02;&#xFF1A; &#x5B8C;&#x5168;+&#x6700;&#x540E;&#x4E00;&#x6B21;&#x5DEE;&#x5F02;&#x5907;&#x4EFD; + &#x4E8C;&#x8FDB;&#x5236;&#x65E5;&#x5FD7;<span class="comment">(&#x6839;&#x636E;&#x65F6;&#x95F4;&#x70B9;&#x6062;&#x590D;)</span></span><br></pre></td></tr></tbody></table></figure><h2 id="&#x7269;&#x7406;&#x5907;&#x4EFD;&#x3001;&#x903B;&#x8F91;&#x5907;&#x4EFD;"><a href="#&#x7269;&#x7406;&#x5907;&#x4EFD;&#x3001;&#x903B;&#x8F91;&#x5907;&#x4EFD;" class="headerlink" title=" &#x7269;&#x7406;&#x5907;&#x4EFD;&#x3001;&#x903B;&#x8F91;&#x5907;&#x4EFD;"></a><font szie="4" color="#007FFF"> &#x7269;&#x7406;&#x5907;&#x4EFD;&#x3001;&#x903B;&#x8F91;&#x5907;&#x4EFD;</font></h2><ul><li>&#x7269;&#x7406;&#x5907;&#x4EFD;</li></ul><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x76F4;&#x63A5;&#x590D;&#x5236;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x7684;&#x5907;&#x4EFD;</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x903B;&#x8F91;&#x5907;&#x4EFD;(mysqldump)</li></ul><figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x901A;&#x8FC7;mysql&#xFF0C;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x5BFC;&#x51FA;&#x6570;&#x636E;&#x53E6;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;</span><br><span class="line">&#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x5927;&#x7684;<span class="keyword">SELECT</span> &#x8BED;&#x53E5;&#xFF0C;&#x8F6C;&#x6210;&#x4E00;&#x4E2A; <span class="keyword">INSERT</span> &#x8BED;&#x53E5; &#x8FDB;&#x884C;&#x5907;&#x4EFD;</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x70ED;&#x5907;&#x3001;&#x6E29;&#x5907;&#x3001;&#x51B7;&#x5907;"><a href="#&#x70ED;&#x5907;&#x3001;&#x6E29;&#x5907;&#x3001;&#x51B7;&#x5907;" class="headerlink" title=" &#x70ED;&#x5907;&#x3001;&#x6E29;&#x5907;&#x3001;&#x51B7;&#x5907;"></a><font szie="4" color="#007FFF"> &#x70ED;&#x5907;&#x3001;&#x6E29;&#x5907;&#x3001;&#x51B7;&#x5907;</font></h2><ul><li>&#x70ED;&#x5907;</li></ul><figure class="highlight brainfuck"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x5747;&#x53EF;&#x8FDB;&#x884C;&#x7684;&#x72B6;&#x6001;&#x4E0B;&#x6240;&#x505A;&#x7684;&#x5907;&#x4EFD;</span> <span class="literal">-</span><span class="literal">-</span>&gt; <span class="comment">&#x5BFC;&#x81F4;&#x5907;&#x4EFD;&#x7684;&#x6570;&#x636E;&#x65F6;&#x95F4;&#x70B9;&#x53EF;&#x80FD;&#x4E0D;&#x4E00;&#x81F4;&#xFF0C;&#x6062;&#x590D;&#x540E;&#x7684;&#x6570;&#x636E;&#x65F6;&#x95F4;&#x70B9;&#x4E0D;&#x4E00;&#x81F4;</span> <span class="literal">-</span><span class="literal">-</span>&gt;  <span class="comment">&#x5BFC;&#x81F4;MySQL&#x62D2;&#x7EDD;&#x6062;&#x590D;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>&#x6E29;&#x5907;</li></ul><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x53EF;&#x8BFB;&#x4F46;&#x4E0D;&#x53EF;&#x5199;&#x72B6;&#x6001;&#x4E0B;&#x8FDB;&#x884C;&#x7684;&#x5907;&#x4EFD;</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x51B7;&#x5907;</li></ul><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x5747;&#x4E0D;&#x53EF;&#x8FDB;&#x884C;&#x7684;&#x72B6;&#x6001;&#x4E0B;&#x6240;&#x505A;&#x7684;&#x5907;&#x4EFD;</span><br></pre></td></tr></tbody></table></figure><hr><h1 id="mysqldump&#x5907;&#x4EFD;&#x5DE5;&#x5177;&#x4F7F;&#x7528;&#x8BE6;&#x89E3;"><a href="#mysqldump&#x5907;&#x4EFD;&#x5DE5;&#x5177;&#x4F7F;&#x7528;&#x8BE6;&#x89E3;" class="headerlink" title=" mysqldump&#x5907;&#x4EFD;&#x5DE5;&#x5177;&#x4F7F;&#x7528;&#x8BE6;&#x89E3; "></a><font szie="4" color="#32CD99"> mysqldump&#x5907;&#x4EFD;&#x5DE5;&#x5177;&#x4F7F;&#x7528;&#x8BE6;&#x89E3; </font></h1><p><code>&#x5907;&#x4EFD;&#x7B56;&#x7565;</code>&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x5168;&#x91CF;&#x5907;&#x4EFD; + binlogs</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x547D;&#x4EE4;&#x8BE6;&#x89E3;"><a href="#&#x547D;&#x4EE4;&#x8BE6;&#x89E3;" class="headerlink" title="&#x547D;&#x4EE4;&#x8BE6;&#x89E3;"></a><font size="4" color="#32CD99">&#x547D;&#x4EE4;&#x8BE6;&#x89E3;</font></h2><ul><li>&#x8BED;&#x6CD5;&#x683C;&#x5F0F;&#xFF1A;</li></ul><figure class="highlight gams"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqldump [<span class="keyword">OPTIONS</span>] database [tables]</span><br><span class="line"><span class="keyword">OR</span>     mysqldump [<span class="keyword">OPTIONS</span>] --databases [<span class="keyword">OPTIONS</span>] DB1 [DB2 DB3...]</span><br><span class="line"><span class="keyword">OR</span>     mysqldump [<span class="keyword">OPTIONS</span>] --<span class="keyword">all</span>-databases [<span class="keyword">OPTIONS</span>]</span><br></pre></td></tr></tbody></table></figure><p>&#x5B9E;&#x4F8B;&#x8BE6;&#x89E3;&#xFF1A;</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x8868;&#x7EA7;&#x522B;&#x5907;&#x4EFD;&#xFF1B;&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93;</span></span><br><span class="line">$ mysqldump mydb</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x5E93;&#x7EA7;&#x522B;&#x5907;&#x4EFD;&#xFF0C;&#x81EA;&#x52A8;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E93; </span></span><br><span class="line">$ mysqldump --databases mydb</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x9009;&#x9879;&#x8BE6;&#x89E3;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-x, --lock-all-tables       &#x9501;&#x5B9A;<span class="string">&apos;&#x6240;&#x6709;&#x5E93;&#x7684;&#x6240;&#x6709;&#x8868;&apos;</span>&#xFF0C;&#x8BFB;&#x9501;&#xFF1B;</span><br><span class="line">-l, --lock-tables           &#x9501;&#x5B9A;<span class="string">&apos;&#x6307;&#x5B9A;&#x5E93;&#x6240;&#x6709;&#x8868;&apos;</span>&#xFF1B;</span><br><span class="line">-R, --routines              &#x5907;&#x4EFD;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x548C;&#x5B58;&#x50A8;&#x51FD;&#x6570;&#xFF1B;</span><br><span class="line">-E, --events                &#x5907;&#x4EFD;&#x4E8B;&#x4EF6;&#x8C03;&#x5EA6;&#x5668;</span><br><span class="line">-F&#xFF0C;--flush-logs             &#x9501;&#x5B9A;&#x8868;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x5373;&#x8FDB;&#x884C;&#x65E5;&#x5FD7;&#x5237;&#x65B0;&#x64CD;&#x4F5C;&#xFF0C;&#x8BA9;&#x65E5;&#x5FD7;&#x6EDA;&#x52A8;&#xFF1B;</span><br><span class="line">--triggers                  &#x5907;&#x4EFD;&#x89E6;&#x53D1;&#x5668;</span><br><span class="line"></span><br><span class="line">--master-data[=<span class="comment">#] &#xFF1A;&#x8BB0;&#x5F55;&#x5907;&#x4EFD;&#x5F00;&#x59CB;&#x65F6; binlog&#x4E2D;</span></span><br><span class="line"> 1&#xFF1A;&#x8BB0;&#x5F55;&#x4E3A;CHANGE MASTER TO&#x8BED;&#x53E5;&#xFF0C;&#x6B64;&#x8BED;&#x53E5;&#x4E0D;&#x88AB;&#x6CE8;&#x91CA;&#xFF1B;</span><br><span class="line"> 2&#xFF1A;&#x8BB0;&#x5F55;&#x4E3A;CHANGE MASTER TO&#x8BED;&#x53E5;&#xFF0C;&#x6B64;&#x8BED;&#x53E5;&#x88AB;&#x6CE8;&#x91CA;&#xFF1B;</span><br><span class="line"> </span><br><span class="line"><span class="string">&apos;InnoDB&#x5B58;&#x50A8;&#x5F15;&#x64CE;&#xFF1A;&#x652F;&#x6301;&#x6E29;&#x5907;&#x548C;&#x70ED;&#x5907;&#xFF1B;&apos;</span></span><br><span class="line">--single-transaction&#xFF1A;<span class="string">&apos;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#xFF0C;&#x57FA;&#x4E8E;&#x6B64;&#x5FEB;&#x7167;&#x6267;&#x884C;&#x5907;&#x4EFD;&apos;</span>&#xFF1B;</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x5168;&#x91CF;&#x5907;&#x4EFD;&#x4E00;&#x6B21;&#x6574;&#x4E2A;&#x6570;&#x636E;&#x5E93;"><a href="#&#x5168;&#x91CF;&#x5907;&#x4EFD;&#x4E00;&#x6B21;&#x6574;&#x4E2A;&#x6570;&#x636E;&#x5E93;" class="headerlink" title="&#x5168;&#x91CF;&#x5907;&#x4EFD;&#x4E00;&#x6B21;&#x6574;&#x4E2A;&#x6570;&#x636E;&#x5E93;"></a><font size="4" color="#32CD99">&#x5168;&#x91CF;&#x5907;&#x4EFD;&#x4E00;&#x6B21;&#x6574;&#x4E2A;&#x6570;&#x636E;&#x5E93;</font></h2><ul><li>&#x5F00;&#x542F;&#x4E8C;&#x8FDB;&#x5236;&#x65E5;&#x5FD7;</li></ul><figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/my<span class="selector-class">.cnf</span><span class="selector-class">.d</span>/server.conf</span><br><span class="line">[server]</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">$ systemctl restart mariadb.service</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x5F00;&#x59CB;&#x5907;&#x4EFD;&#x6570;&#x636E;&#x5E93;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x4F7F;&#x7528;mysqldump&#x5907;&#x4EFD;&#x6574;&#x4E2A;mysql&#x6570;&#x636E;&#x5E93;</span></span><br><span class="line">$ mysqldump -E -R --triggers --master-data=2 -F -l --single-transaction --all-databases &gt; /tmp/all-fullback-$(date +%F).sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x767B;&#x9646;&#x81F3;MySQL&#x4FEE;&#x6539;&#x4E00;&#x4E9B;&#x6570;&#x636E;</span></span><br><span class="line">$ mysql </span><br><span class="line">&gt; SHOW MASTER LOGS;</span><br><span class="line">+------------------+-----------+</span><br><span class="line">| Log_name         | File_size |</span><br><span class="line">+------------------+-----------+</span><br><span class="line">| mysql-bin.000001 |     30352 |</span><br><span class="line">| mysql-bin.000002 |   1038814 |</span><br><span class="line">| mysql-bin.000003 |      9235 |</span><br><span class="line">| mysql-bin.000004 |       696 |</span><br><span class="line">| mysql-bin.000005 |       245 |</span><br><span class="line">+------------------+-----------+</span><br><span class="line">&gt; use hellodb;</span><br><span class="line">&gt; DELETE FROM students WHERE StuID=1;</span><br><span class="line">&gt; DELETE FROM students WHERE StuID=5;</span><br><span class="line">&gt; DELETE FROM students WHERE StuID=10;</span><br><span class="line">&gt; DELETE FROM students WHERE StuID=15;</span><br><span class="line">&gt; DELETE FROM students WHERE StuID=20;</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x62F7;&#x8D1D;&#x5168;&#x91CF;&#x5907;&#x4EFD;&#x540E;&#xFF0C;&#x672A;&#x5907;&#x4EFD;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x65E5;&#x5FD7;&#x81F3;/tmp&#x76EE;&#x5F55;&#x4E2D;</span></span><br><span class="line">$ cp /var/lib/mysql/mysql-bin.000005 /tmp/</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x6A21;&#x62DF;&#x6570;&#x636E;&#x5E93;&#x5D29;&#x6E83;&#x60C5;&#x51B5;&#xFF0C;&#x5220;&#x9664;&#x6570;&#x636E;&#x5E93;&#x6570;&#x636E;&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x6240;&#x6709;&#x6587;&#x4EF6;</span></span><br><span class="line">$ rm -rf /var/lib/mysql/*</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x4F7F;&#x7528;&#x5907;&#x4EFD;&#x6062;&#x590D;&#x6570;&#x636E;&#x5E93;"><a href="#&#x4F7F;&#x7528;&#x5907;&#x4EFD;&#x6062;&#x590D;&#x6570;&#x636E;&#x5E93;" class="headerlink" title="&#x4F7F;&#x7528;&#x5907;&#x4EFD;&#x6062;&#x590D;&#x6570;&#x636E;&#x5E93;"></a><font size="4" color="#32CD99">&#x4F7F;&#x7528;&#x5907;&#x4EFD;&#x6062;&#x590D;&#x6570;&#x636E;&#x5E93;</font></h2><ul><li>&#x91CD;&#x542F;&#x6570;&#x636E;&#x5E93;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl stop mariadb.service</span><br><span class="line">$ systemctl start mariadb.service</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x767B;&#x9646;&#x6570;&#x636E;&#x5E93;&#x8FDB;&#x884C;&#x6062;&#x590D;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mysql</span><br><span class="line"><span class="comment"># &#x5173;&#x95ED;&#x4F1A;&#x8BDD;&#x7EA7;&#x522B;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x65E5;&#x5FD7;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6267;&#x884C;&#x6062;&#x590D;sql&#x811A;&#x672C;&#xFF0C;&#x4E0D;&#x5E0C;&#x671B;&#x4E8C;&#x8FDB;&#x5236;&#x8BB0;&#x5F55;&#x6B64;&#x4FE1;&#x606F;</span></span><br><span class="line">&gt; SET @@session.sql_log_bin=OFF;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># &#x5728;MySQL&#x4E2D;&#x6267;&#x884C;SQL&#x811A;&#x672C;</span></span><br><span class="line">&gt; \. /tmp/alldb_fullbackup-2017-06-20.sql</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x4F7F;&#x7528;&#x4E8C;&#x8FDB;&#x5236;&#x65E5;&#x5FD7;&#x6062;&#x590D;&#x672A;&#x5907;&#x4EFD;&#x7684;&#x4FE1;&#x606F;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /tmp</span><br><span class="line">$ mysqlbinlog mysql-bin.000005 | mysql</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x5F00;&#x542F;&#x4E8C;&#x8FDB;&#x5236;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; SET @@session.sql_log_bin=ON;</span><br></pre></td></tr></tbody></table></figure><p><strong>&#x81F3;&#x6B64;&#xFF0C;&#x4E00;&#x6B21;&#x5220;&#x5E93;&#x5230;&#x6062;&#x590D;&#x5C31;&#x5B8C;&#x6210;&#x4E86;</strong>&#xFF0C;&#x4E0D;&#x8FC7;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5728;&#x6062;&#x590D;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x4E1A;&#x52A1;&#x4E0D;&#x662F;&#x5F88;&#x7740;&#x6025;&#x9700;&#x8981;&#x4E0A;&#x7EBF;&#xFF0C;&#x8FD9;&#x65F6;&#x8FD8;&#x8981;&#x505A;&#x4E00;&#x6B21;&#x5168;&#x91CF;&#x5907;&#x4EFD;&#x3002;&#x5982;&#x679C;&#x4E1A;&#x52A1;&#x5FC5;&#x987B;&#x7ACB;&#x5373;&#x4E0A;&#x7EBF;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x5F53;&#x5929;&#x665A;&#x4E0A;&#x8FDB;&#x884C;&#x5907;&#x4EFD;&#x6570;&#x636E;&#x5E93;&#x3002;</p><h2 id="&#x4F7F;&#x7528;&#x5907;&#x4EFD;&#x811A;&#x672C;&#x5907;&#x4EFD;&#x6570;&#x636E;&#x5E93;"><a href="#&#x4F7F;&#x7528;&#x5907;&#x4EFD;&#x811A;&#x672C;&#x5907;&#x4EFD;&#x6570;&#x636E;&#x5E93;" class="headerlink" title="&#x4F7F;&#x7528;&#x5907;&#x4EFD;&#x811A;&#x672C;&#x5907;&#x4EFD;&#x6570;&#x636E;&#x5E93;"></a><font size="4" color="#32CD99">&#x4F7F;&#x7528;&#x5907;&#x4EFD;&#x811A;&#x672C;&#x5907;&#x4EFD;&#x6570;&#x636E;&#x5E93;</font></h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">$ vim mysql-backup.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># MYSQLDBUSERNAME&#x662F;MySQL&#x6570;&#x636E;&#x5E93;&#x7684;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x53EF;&#x81EA;&#x5B9A;&#x4E49;</span></span><br><span class="line">MYSQLDBUSERNAME=root</span><br><span class="line"></span><br><span class="line"><span class="comment"># MYSQLDBPASSWORD&#x662F;MySQL&#x6570;&#x636E;&#x5E93;&#x7684;&#x5BC6;&#x7801;&#xFF0C;&#x53EF;&#x81EA;&#x5B9A;&#x4E49;</span></span><br><span class="line">MYSQLDBPASSWORD=<span class="string">&quot;root@123&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MYSQBASEDIR&#x662F;MySQL&#x6570;&#x636E;&#x5E93;&#x7684;&#x5B89;&#x88C5;&#x76EE;&#x5F55;&#xFF0C;--prefix=$MYSQBASEDIR&#xFF0C;&#x53EF;&#x81EA;&#x5B9A;&#x4E49;</span></span><br><span class="line">MYSQBASEDIR=/usr</span><br><span class="line"></span><br><span class="line"><span class="comment"># MYSQL&#x662F;mysql&#x547D;&#x4EE4;&#x7684;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x53EF;&#x81EA;&#x5B9A;&#x4E49;</span></span><br><span class="line">MYSQL=<span class="variable">$MYSQBASEDIR</span>/bin/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># MYSQLDUMP&#x662F;mysqldump&#x547D;&#x4EE4;&#x7684;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF0C;&#x53EF;&#x81EA;&#x5B9A;&#x4E49;</span></span><br><span class="line">MYSQLDUMP=<span class="variable">$MYSQBASEDIR</span>/bin/mysqldump</span><br><span class="line"></span><br><span class="line"><span class="comment"># BACKDIR&#x662F;&#x6570;&#x636E;&#x5E93;&#x5907;&#x4EFD;&#x7684;&#x5B58;&#x653E;&#x5730;&#x5740;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x4FEE;&#x6539;&#x6210;&#x8FDC;&#x7A0B;&#x5730;&#x5740;</span></span><br><span class="line">BACKDIR=/var/backup/mysqldb</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#xFF0C;&#x683C;&#x5F0F;&#x4E3A;&#xFF1A;&#x5E74;-&#x6708;-&#x65E5;&#xFF0C;&#x7528;&#x4E8E;&#x751F;&#x6210;&#x4EE5;&#x8FD9;&#x79CD;&#x65F6;&#x95F4;&#x683C;&#x5F0F;&#x7684;&#x76EE;&#x5F55;&#x540D;&#x79F0;</span></span><br><span class="line">DATEFORMATTYPE1=$(date +%Y-%m-%d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x83B7;&#x53D6;&#x5F53;&#x524D;&#x65F6;&#x95F4;&#xFF0C;&#x683C;&#x5F0F;&#x4E3A;&#xFF1A;&#x5E74;&#x6708;&#x65E5;&#x65F6;&#x5206;&#x79D2;&#xFF0C;&#x7528;&#x4E8E;&#x751F;&#x6210;&#x4EE5;&#x8FD9;&#x79CD;&#x65F6;&#x95F4;&#x683C;&#x5F0F;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x79F0;</span></span><br><span class="line">DATEFORMATTYPE2=$(date +%Y%m%d%H%M%S)</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x6570;&#x636E;&#x5E93;&#x6570;&#x636E;&#x76EE;&#x5F55;</span></span><br><span class="line">MYSQDATADIR=/var/lib/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x5982;&#x679C;mysql&#x547D;&#x4EE4;&#x5B58;&#x5728;&#x5E76;&#x53EF;&#x6267;&#x884C;&#xFF0C;&#x5219;&#x7EE7;&#x7EED;&#xFF0C;&#x5426;&#x5219;&#x5C06;MYSQL&#x8BBE;&#x5B9A;&#x4E3A;mysql&#xFF0C;&#x9ED8;&#x8BA4;&#x8DEF;&#x5F84;&#x4E0B;&#x7684;mysql</span></span><br><span class="line">[ -x <span class="variable">$MYSQL</span> ] || MYSQL=mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x5982;&#x679C;mysqldump&#x547D;&#x4EE4;&#x5B58;&#x5728;&#x5E76;&#x53EF;&#x6267;&#x884C;&#xFF0C;&#x5219;&#x7EE7;&#x7EED;&#xFF0C;&#x5426;&#x5219;&#x5C06;MYSQLDUMP&#x8BBE;&#x5B9A;&#x4E3A;mysqldump&#xFF0C;&#x9ED8;&#x8BA4;&#x8DEF;&#x5F84;&#x4E0B;&#x7684;mysqldump</span></span><br><span class="line">[ -x <span class="variable">$MYSQLDUMP</span> ] || MYSQLDUMP=mysqldump</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;&#x5907;&#x4EFD;&#x76EE;&#x5F55;&#x5219;&#x521B;&#x5EFA;&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;</span></span><br><span class="line">[ -d <span class="variable">${BACKDIR}</span> ] || mkdir -p <span class="variable">${BACKDIR}</span></span><br><span class="line">[ -d <span class="variable">${BACKDIR}</span>/<span class="variable">${DATEFORMATTYPE1}</span> ] || mkdir <span class="variable">${BACKDIR}</span>/<span class="variable">${DATEFORMATTYPE1}</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x83B7;&#x53D6;MySQL&#x4E2D;&#x6709;&#x54EA;&#x4E9B;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x6839;&#x636E;mysqldatadir&#x4E0B;&#x7684;&#x76EE;&#x5F55;&#x540D;&#x5B57;&#x6765;&#x786E;&#x8BA4;&#xFF0C;&#x6B64;&#x5904;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#xFF0C;TODO</span></span><br><span class="line">DBLIST=`ls -p <span class="variable">$MYSQDATADIR</span> | grep / |tr -d /`</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x4ECE;&#x6570;&#x636E;&#x5E93;&#x5217;&#x8868;&#x4E2D;&#x5FAA;&#x73AF;&#x53D6;&#x51FA;&#x6570;&#x636E;&#x5E93;&#x540D;&#x79F0;&#xFF0C;&#x6267;&#x884C;&#x5907;&#x4EFD;&#x64CD;&#x4F5C;</span></span><br><span class="line"><span class="keyword">for</span> DBNAME <span class="keyword">in</span> <span class="variable">$DBLIST</span></span><br><span class="line">    <span class="comment"># mysqldump skip one table</span></span><br><span class="line">    <span class="comment"># -- Warning: Skipping the data of table mysql.event. Specify the --events option explicitly.</span></span><br><span class="line">    <span class="comment"># mysqldump --ignore-table=mysql.event</span></span><br><span class="line">    <span class="comment"># http://serverfault.com/questions/376904/mysqldump-skip-one-table</span></span><br><span class="line">    <span class="comment"># --routines&#xFF0C;&#x5907;&#x4EFD;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x548C;&#x51FD;&#x6570;</span></span><br><span class="line">    <span class="comment"># --events&#xFF0C;&#x8DF3;&#x8FC7;mysql.event&#x8868;</span></span><br><span class="line">    <span class="comment"># --triggers&#xFF0C;&#x5907;&#x4EFD;&#x89E6;&#x53D1;&#x5668;</span></span><br><span class="line">    <span class="comment"># --single-transaction&#xFF0C;&#x9488;&#x5BF9;InnoDB&#xFF0C;&#x5728;&#x5355;&#x6B21;&#x4E8B;&#x52A1;&#x4E2D;&#x901A;&#x8FC7;&#x8F6C;&#x50A8;&#x6240;&#x6709;&#x6570;&#x636E;&#x5E93;&#x8868;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E00;&#x81F4;&#x6027;&#x7684;&#x5FEB;&#x7167;&#xFF0C;&#x6B64;&#x9009;&#x9879;&#x4F1A;&#x5BFC;&#x81F4;&#x81EA;&#x52A8;&#x9501;&#x8868;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x9700;&#x8981;--lock-all-tables</span></span><br><span class="line">    <span class="comment"># --flush-logs&#xFF0C;&#x5728;dump&#x8F6C;&#x50A8;&#x524D;&#x5237;&#x65B0;&#x65E5;&#x5FD7;</span></span><br><span class="line">    <span class="comment"># --ignore-table&#xFF0C;&#x5FFD;&#x7565;&#x67D0;&#x4E2A;&#x8868;&#xFF0C;--ignore-table=database.table</span></span><br><span class="line">    <span class="comment"># --master-data=2 &#xFF0C;&#x5982;&#x679C;&#x542F;&#x7528;MySQL&#x590D;&#x5236;&#x529F;&#x80FD;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x8FD9;&#x4E2A;&#x9009;&#x9879;</span></span><br><span class="line">    <span class="comment"># &#x5C06;dump&#x51FA;&#x7684;sql&#x8BED;&#x53E5;&#x7528;gzip&#x538B;&#x7F29;&#x5230;&#x4E00;&#x4E2A;&#x4EE5;&#x65F6;&#x95F4;&#x547D;&#x540D;&#x7684;&#x6587;&#x4EF6;</span></span><br><span class="line">    <span class="keyword">do</span> <span class="variable">${MYSQLDUMP}</span> --user=<span class="variable">${MYSQLDBUSERNAME}</span> --password=<span class="variable">${MYSQLDBPASSWORD}</span> --routines --events --triggers --single-transaction --flush-logs --ignore-table=mysql.event --databases <span class="variable">${DBNAME}</span> | gzip &gt; <span class="variable">${BACKDIR}</span>/<span class="variable">${DATEFORMATTYPE1}</span>/<span class="variable">${DBNAME}</span>-backup-<span class="variable">${DATEFORMATTYPE2}</span>.sql.gz</span><br><span class="line"></span><br><span class="line">    <span class="comment"># &#x68C0;&#x67E5;&#x6267;&#x884C;&#x7ED3;&#x679C;&#xFF0C;&#x5982;&#x679C;&#x9519;&#x8BEF;&#x4EE3;&#x7801;&#x4E3A;0&#x5219;&#x8F93;&#x51FA;&#x6210;&#x529F;&#xFF0C;&#x5426;&#x5219;&#x8F93;&#x51FA;&#x5931;&#x8D25;</span></span><br><span class="line">    [ $? -eq 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">${DBNAME}</span> has been backuped successful&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">${DBNAME}</span> has been backuped failed&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># &#x7B49;&#x5F85;5s&#xFF0C;&#x53EF;&#x81EA;&#x5B9A;&#x4E49;</span></span><br><span class="line">    /bin/sleep 5</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></tbody></table></figure><hr><h1 id="xtrabackupex&#x5907;&#x4EFD;&#x5DE5;&#x5177;&#x4F7F;&#x7528;&#x8BE6;&#x89E3;"><a href="#xtrabackupex&#x5907;&#x4EFD;&#x5DE5;&#x5177;&#x4F7F;&#x7528;&#x8BE6;&#x89E3;" class="headerlink" title="xtrabackupex&#x5907;&#x4EFD;&#x5DE5;&#x5177;&#x4F7F;&#x7528;&#x8BE6;&#x89E3;"></a><font size="4" color="#32CD99">xtrabackupex&#x5907;&#x4EFD;&#x5DE5;&#x5177;&#x4F7F;&#x7528;&#x8BE6;&#x89E3;</font></h1><h2 id="&#x5B89;&#x88C5;xtrabackupex"><a href="#&#x5B89;&#x88C5;xtrabackupex" class="headerlink" title="&#x5B89;&#x88C5;xtrabackupex"></a><font size="4" color="#007FFF">&#x5B89;&#x88C5;xtrabackupex</font></h2><p>&#x5B98;&#x65B9;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF1A;<a href="https://www.percona.com/downloads/XtraBackup/LATEST/" target="_blank" rel="noopener">XtraBackup</a></p><p>&#x5B89;&#x88C5;<code>XtraBackup</code></p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ntpdate 172.16.0.1</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> wget ftp://172.16.0.1/pub/Sources/7.x86_64/percona/percona-xtrabackup-24-2.4.7-2.el7.x86_64.rpm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install -y ./percona-xtrabackup-24-2.4.7-2.el7.x86_64.rpm</span></span><br></pre></td></tr></tbody></table></figure><h2 id="&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x5168;&#x5E93;&#x5907;&#x4EFD;"><a href="#&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x5168;&#x5E93;&#x5907;&#x4EFD;" class="headerlink" title="&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x5168;&#x5E93;&#x5907;&#x4EFD;"></a><font size="4" color="#007FFF">&#x8FDB;&#x884C;&#x4E00;&#x6B21;&#x5168;&#x5E93;&#x5907;&#x4EFD;</font></h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/my.cnf.d/server.conf</span><br><span class="line">[server]</span><br><span class="line">skip_name_resolve=ON</span><br><span class="line">innodb_file_per_table=ON</span><br><span class="line"><span class="built_in">log</span>-bin=mysql_bin</span><br><span class="line"></span><br><span class="line">$ systemctl start mariadb.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x5168;&#x5E93;&#x5907;&#x4EFD;&#x65F6;&#xFF0C;&#x65E0;&#x9700;&#x6307;&#x5B9A;&#x6570;&#x636E;&#x5E93;&#x5373;&#x53EF;&#x5907;&#x4EFD;&#x3002;&#x6307;&#x5B9A;&#x5E93;&#x5907;&#x4EFD;&#x4F7F;&#x7528; --databases DATABASE_NAME</span></span><br><span class="line">$ innobackupex --user root /data/backup/</span><br><span class="line">$ ll /data/backup/2017-07-13_20-05-42/</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x901A;&#x8FC7;&#x5907;&#x4EFD;&#x6062;&#x590D;&#x6570;&#x636E;&#x5E93;"><a href="#&#x901A;&#x8FC7;&#x5907;&#x4EFD;&#x6062;&#x590D;&#x6570;&#x636E;&#x5E93;" class="headerlink" title="&#x901A;&#x8FC7;&#x5907;&#x4EFD;&#x6062;&#x590D;&#x6570;&#x636E;&#x5E93;"></a><font size="4" color="#007FFF">&#x901A;&#x8FC7;&#x5907;&#x4EFD;&#x6062;&#x590D;&#x6570;&#x636E;&#x5E93;</font></h2><ul><li>&#x6062;&#x590D;&#x4E4B;&#x524D;&#x7684;&#x51C6;&#x5907;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x9ED8;&#x8BA4;&#x6570;&#x636E;&#x5E93;&#x635F;&#x574F;&#xFF0C;&#x88AB;&#x5220;&#x5E93;</span></span><br><span class="line">$ cp /var/lib/mysql/mysql_bin.00000* /data/backup</span><br><span class="line">$ rm -rf /var/lib/mysql/*</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x6267;&#x884C;Preparing&#x64CD;&#x4F5C;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ innobackupex --apply-log /data/backup/2017-07-13_20-05-42/</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x6062;&#x590D;&#x6570;&#x636E;&#x5E93;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ innobackupex --copy-back 2017-07-13_20-05-42/</span><br><span class="line">$ <span class="built_in">cd</span> /var/lib/mysql</span><br><span class="line">$ chown -R mysql.mysql ./*</span><br></pre></td></tr></tbody></table></figure><p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fhje4qhtw8j31kw0u4kjn.jpg" alt=""></p><ul><li>&#x542F;&#x52A8;&#x6570;&#x636E;&#x5E93;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl start mariadb.service</span><br><span class="line">$ mysql</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x5907;&#x4EFD;&#x540E;&#x751F;&#x6210;&#x7684;&#x4E00;&#x4E9B;&#x6587;&#x4EF6;</li></ul><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fhje6hs102j31kw0f64nv.jpg" alt=""></p><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fhje6h4a43j31kw0f6kdx.jpg" alt=""></p><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fhje5oqw16j31dk08sdpy.jpg" alt=""></p><p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fhje5ohh5ij31kw0f64ou.jpg" alt=""></p><h2 id="&#x589E;&#x91CF;&#x5907;&#x4EFD;-&#x6570;&#x636E;&#x5E93;-&#x5168;&#x5E93;"><a href="#&#x589E;&#x91CF;&#x5907;&#x4EFD;-&#x6570;&#x636E;&#x5E93;-&#x5168;&#x5E93;" class="headerlink" title="&#x589E;&#x91CF;&#x5907;&#x4EFD; &#x6570;&#x636E;&#x5E93;(&#x5168;&#x5E93;)"></a><font size="4" color="#007FFF">&#x589E;&#x91CF;&#x5907;&#x4EFD; &#x6570;&#x636E;&#x5E93;(&#x5168;&#x5E93;)</font></h2><p>&#x589E;&#x91CF;&#x5907;&#x4EFD;&#xFF1A;&#x4EC5;&#x5907;&#x4EFD;&#x81EA;&#x4E0A;&#x4E00;&#x6B21;<code>&#x5B8C;&#x5168;&#x5907;&#x4EFD;</code>&#x6216;<code>&#x589E;&#x91CF;&#x5907;&#x4EFD;</code>&#x4EE5;&#x6765;&#x53D8;&#x91CF;&#x7684;&#x90A3;&#x4E9B;&#x6570;&#x636E;</p><ul><li>&#x5148;&#x505A;&#x4E00;&#x6B21;&#x5168;&#x91CF;&#x5907;&#x4EFD;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ innobackupex --user root /data/backup</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x8FDE;&#x63A5;&#x5230;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#xFF0C;&#x5220;&#x9664;/&#x589E;&#x52A0;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x4E3A;&#x4E00;&#x4F1A;&#x505A;&#x589E;&#x91CF;&#x5907;&#x4EFD;&#x6253;&#x4E0B;&#x57FA;&#x7840;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ mysql</span><br><span class="line">&gt; use hellodb;</span><br><span class="line">&gt; DELETE FROM students WHERE StuID=21;</span><br><span class="line">&gt; INSERT INTO students (Name,Age,Gender,ClassID,TeacherID) VALUES(<span class="string">&apos;Zhu Ba Jie&apos;</span>,120,<span class="string">&apos;M&apos;</span>,2,3);</span><br><span class="line">&gt; <span class="built_in">exit</span>;</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x7B2C;&#x4E00;&#x6B21;&#x589E;&#x91CF;&#x5907;&#x4EFD;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ innobackupex --incremental -u root /data/backup --incremental-basedir=/data/backup/2017-07-13_20-38-20/</span><br></pre></td></tr></tbody></table></figure><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fhje42cakwj31kw0u84qr.jpg" alt=""></p><p><img src="https://ws3.sinaimg.cn/large/006tNc79ly1fhje7gtxwpj31kw0f6b29.jpg" alt=""></p><ul><li>&#x518D;&#x6B21;&#x8FDE;&#x63A5;&#x5230;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5220;&#x9664;&#x4FEE;&#x6539;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#xFF0C;&#x518D;&#x505A;<code>&#x7B2C;&#x4E8C;&#x6B21;&#x589E;&#x91CF;&#x5907;&#x4EFD;</code></li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mysql </span><br><span class="line">&gt; use hellodb;</span><br><span class="line">&gt; DELETE FROM students WHERE StuID=1;</span><br><span class="line">&gt; EXIT;</span><br></pre></td></tr></tbody></table></figure><ul><li><code>&#x7B2C;&#x4E8C;&#x6B21;</code>&#x589E;&#x91CF;&#x5907;&#x4EFD;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x8FD9;&#x91CC;--incremental-basedir &#x4E3A;&#x4E0A;&#x4E00;&#x6B21;&#x589E;&#x91CF;&#x5907;&#x4EFD;&#x7684;&#x76EE;&#x5F55;&#xFF0C;&#x800C;&#x975E;&#x5168;&#x91CF;&#x5907;&#x4EFD;&#x7684;&#x76EE;&#x5F55;</span></span><br><span class="line">$ innobackupex -u root --incremental /data/backup --incremental-basedir=/data/backup/2017-07-13_20-47-49</span><br><span class="line"><span class="comment"># &#x7B2C;&#x4E8C;&#x6B21;&#x589E;&#x91CF;&#x7684;checkpoints</span></span><br><span class="line">$ cat 2017-07-13_20-56-20/xtrabackup_checkpoints</span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 1638999</span><br><span class="line">to_lsn = 1640148</span><br><span class="line">last_lsn = 1640148</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x7B2C;&#x4E00;&#x6B21;&#x589E;&#x91CF;&#x7684;checkpoints</span></span><br><span class="line">$ cat 2017-07-13_20-47-49/xtrabackup_checkpoints</span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 1636913</span><br><span class="line">to_lsn = 1638999</span><br><span class="line">last_lsn = 1638999</span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x901A;&#x8FC7;&#x4E24;&#x6B21;&#x589E;&#x91CF;&#x5907;&#x4EFD; + &#x5168;&#x91CF;&#x5907;&#x4EFD; &#x8FDB;&#x884C;&#x6062;&#x590D;&#x6570;&#x636E;&#x5E93;&#x7684;&#x64CD;&#x4F5C;</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x5220;&#x5E93;</span></span><br><span class="line">$ cp /var/lib/mysql/mysql_bin.* /data/backup/binlogs</span><br><span class="line">$ rm -rf /var/lib/mysql/*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.&#x5408;&#x5E76;&#x589E;&#x91CF;&#x5907;&#x4EFD;(&#x53EA;&#x63D0;&#x4EA4;&#x4E0D;&#x56DE;&#x6EDA;)</span><br><span class="line"><span class="comment"># &#x53EA;&#x63D0;&#x4EA4;&#x4E0D;&#x56DE;&#x6EDA; &#x5168;&#x91CF;&#x5907;&#x4EFD;</span></span><br><span class="line">$ innobackupex --apply-log --redo-only 2017-07-13_20-38-20/</span><br><span class="line"><span class="comment"># &#x53EA;&#x63D0;&#x4EA4;&#x4E0D;&#x56DE;&#x6EDA; &#x7B2C;&#x4E00;&#x6B21;&#x589E;&#x91CF;+&#x5168;&#x91CF;</span></span><br><span class="line">$ innobackupex --apply-log --redo-only 2017-07-13_20-38-20 --incremental-dir=2017-07-13_20-47-49</span><br><span class="line"><span class="comment"># &#x53EA;&#x63D0;&#x4EA4;&#x4E0D;&#x56DE;&#x6EDA; &#x7B2C;&#x4E8C;&#x589E;&#x91CF;+&#x5168;&#x91CF;(&#x7B2C;&#x4E00;&#x6B21;&#x589E;&#x91CF;+&#x5168;&#x91CF;)</span></span><br><span class="line">$ innobackupex --apply-log --redo-only 2017-07-13_20-38-20 --incremental-dir=2017-07-13_20-56-20</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.&#x5F00;&#x59CB;&#x63D0;&#x4EA4;&#x5E76;&#x56DE;&#x6EDA;</span><br><span class="line">$ innobackupex --apply-log 2017-07-13_20-38-20/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.&#x62FF;&#x7740;&#x63D0;&#x4EA4;&#x5E76;&#x56DE;&#x6EDA;&#x540E;&#x7684;&#x5168;&#x91CF;&#xFF0C;&#x8FDB;&#x884C;&#x6062;&#x590D;</span><br><span class="line">$ innobackupex --copy-back 2017-07-13_20-38-20/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4.&#x67E5;&#x770B;&#x6062;&#x590D;&#x540E;&#x7684;&#x6570;&#x636E;&#x76EE;&#x5F55;</span><br><span class="line">$ ll /var/lib/mysql </span><br><span class="line">total 40988</span><br><span class="line">drwxr-x--- 2 root root     4096 Jul 13 21:17 2017-07-13_20-27-08</span><br><span class="line">drwxr-x--- 2 root root     4096 Jul 13 21:17 hellodb</span><br><span class="line">-rw-r----- 1 root root 18874368 Jul 13 21:17 ibdata1</span><br><span class="line">-rw-r----- 1 root root  5242880 Jul 13 21:17 ib_logfile0</span><br><span class="line">-rw-r----- 1 root root  5242880 Jul 13 21:17 ib_logfile1</span><br><span class="line">-rw-r----- 1 root root 12582912 Jul 13 21:17 ibtmp1</span><br><span class="line">drwxr-x--- 2 root root     4096 Jul 13 21:17 mysql</span><br><span class="line">drwxr-x--- 2 root root     4096 Jul 13 21:17 performance_schema</span><br><span class="line">drwxr-x--- 2 root root     4096 Jul 13 21:17 <span class="built_in">test</span></span><br><span class="line">-rw-r----- 1 root root       23 Jul 13 21:17 xtrabackup_binlog_pos_innodb</span><br><span class="line">-rw-r----- 1 root root      532 Jul 13 21:17 xtrabackup_info</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5.&#x4FEE;&#x6539;&#x76EE;&#x5F55;&#x6743;&#x9650;</span><br><span class="line">$ chown -R mysql.mysql /var/lib/mysql/*</span><br></pre></td></tr></tbody></table></figure><h1 id="&#x7ED3;&#x675F;&#x8BED;"><a href="#&#x7ED3;&#x675F;&#x8BED;" class="headerlink" title=" &#x7ED3;&#x675F;&#x8BED;: "></a><font color="Orchid" size="5"> &#x7ED3;&#x675F;&#x8BED;: </font></h1><h2 id="&#x5BF9;&#x4E8E;Mysqldump&#x8DDF;Xtrabakcup&#x7684;&#x4ECB;&#x7ECD;&#x4E0E;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5230;&#x6B64;&#x5B8C;&#x6210;&#x3002;"><a href="#&#x5BF9;&#x4E8E;Mysqldump&#x8DDF;Xtrabakcup&#x7684;&#x4ECB;&#x7ECD;&#x4E0E;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5230;&#x6B64;&#x5B8C;&#x6210;&#x3002;" class="headerlink" title=" &#x5BF9;&#x4E8E;Mysqldump&#x8DDF;Xtrabakcup&#x7684;&#x4ECB;&#x7ECD;&#x4E0E;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5230;&#x6B64;&#x5B8C;&#x6210;&#x3002;"></a><font color="Orchid" size="4"> &#x5BF9;&#x4E8E;Mysqldump&#x8DDF;Xtrabakcup&#x7684;&#x4ECB;&#x7ECD;&#x4E0E;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x5230;&#x6B64;&#x5B8C;&#x6210;&#x3002;</font></h2><hr><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;h1 id=&quot;开头语&quot;&gt;&lt;a href=&quot;#开头语&quot; class=&quot;headerlink&quot; title=&quot; 开头语: &quot;&gt;&lt;/a&gt;&lt;font color=&quot;Orchid&quot; size=&quot;3&quot;&gt; 开头语: &lt;/font&gt;&lt;/h1&gt;&lt;h2 id=&quot;在开始对Mysqldump跟Xtrabakcup的介绍与使用方法到之前，说下数据对公司的重要性：&quot;&gt;&lt;a href=&quot;#在开始对Mysqldump跟Xtrabakcup的介绍与使用方法到之前，说下数据对公司的重要性：&quot; class=&quot;headerlink&quot; title=&quot; 在开始对Mysqldump跟Xtrabakcup的介绍与使用方法到之前，说下数据对公司的重要性：&quot;&gt;&lt;/a&gt;&lt;font color=&quot;Orchid&quot; size=&quot;3&quot;&gt; 在开始对Mysqldump跟Xtrabakcup的介绍与使用方法到之前，说下数据对公司的重要性：&lt;/font&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;对于公司来讲，数据库本身可能并不重要，重要的是数据库中存储的数据。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;对于备份来讲，最终的目的是可以使用备份能够实现还原数据库中的数据。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;因此，一个可恢复的数据库备份是非常重要的，甚至关乎公司的命脉。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="MySQL" scheme="https://wolf-7.github.io/categories/MySQL/"/>
    
    
      <category term="MySQL" scheme="https://wolf-7.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Optimise MySQL Configuration for WordPress</title>
    <link href="https://wolf-7.github.io/MySQL/2017/02/07/Optimise-MySQL-Configuration-for-WordPress.html"/>
    <id>https://wolf-7.github.io/MySQL/2017/02/07/Optimise-MySQL-Configuration-for-WordPress.html</id>
    <published>2017-02-07T09:48:05.000Z</published>
    <updated>2019-01-14T11:59:08.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><p><a href="https://www.lisenet.com/2015/optimise-mysql-configuration-for-wordpress/" target="_blank" rel="noopener">Document links</a></p><hr><a id="more"></a><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;&lt;a href=&quot;https://www.lisenet.com/2015/optimise-mysql-configuration-for-wordpress/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Document links&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="MySQL" scheme="https://wolf-7.github.io/categories/MySQL/"/>
    
    
      <category term="MySQL" scheme="https://wolf-7.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>部署 kubernetes 集群 （三）</title>
    <link href="https://wolf-7.github.io/uncategorized/2017/01/24/%E9%83%A8%E7%BD%B2-kubernetes-%E9%9B%86%E7%BE%A4-%EF%BC%88%E4%B8%89%EF%BC%89.html"/>
    <id>https://wolf-7.github.io/uncategorized/2017/01/24/部署-kubernetes-集群-（三）.html</id>
    <published>2017-01-24T07:50:49.000Z</published>
    <updated>2019-01-24T08:29:47.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>kubernetes &#x96C6;&#x7FA4;&#xFF08;&#x4E09;&#xFF09;</p><a id="more"></a><h1 id="7-&#x90E8;&#x7F72;-Node-&#x8282;&#x70B9;"><a href="#7-&#x90E8;&#x7F72;-Node-&#x8282;&#x70B9;" class="headerlink" title="7.&#x90E8;&#x7F72; Node &#x8282;&#x70B9;"></a>7.&#x90E8;&#x7F72; Node &#x8282;&#x70B9;</h1><p>kubernetes Node &#x8282;&#x70B9;&#x5305;&#x542B;&#x5982;&#x4E0B;&#x7EC4;&#x4EF6;&#xFF1A;</p><ul><li>flanneld</li><li>docker</li><li>kubelet</li><li>kube-proxy</li></ul><h2 id="&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;"><a href="#&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;" class="headerlink" title="&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;"></a>&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;</h2><p>&#x672C;&#x6587;&#x6863;&#x7528;&#x5230;&#x7684;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># &#x66FF;&#x6362;&#x4E3A; kubernetes master &#x96C6;&#x7FA4;&#x4EFB;&#x4E00;&#x673A;&#x5668; IP</span><br><span class="line">export MASTER_IP=192.168.77.201</span><br><span class="line">export KUBE_APISERVER=&quot;https://${MASTER_IP}:6443&quot;</span><br><span class="line"># &#x5F53;&#x524D;&#x90E8;&#x7F72;&#x7684;&#x8282;&#x70B9; IP</span><br><span class="line">export NODE_IP=192.168.77.202</span><br><span class="line"># &#x5BFC;&#x5165;&#x7528;&#x5230;&#x7684;&#x5176;&#x5B83;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF1A;ETCD_ENDPOINTS&#x3001;FLANNEL_ETCD_PREFIX&#x3001;CLUSTER_CIDR&#x3001;CLUSTER_DNS_SVC_IP&#x3001;CLUSTER_DNS_DOMAIN&#x3001;SERVICE_CIDR</span><br><span class="line">source /root/local/bin/environment.sh</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;-flanneld"><a href="#&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;-flanneld" class="headerlink" title="&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E; flanneld"></a>&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E; flanneld</h2><p>&#x53C2;&#x8003; <a href="https://github.com/opsnull/follow-me-install-kubernetes-cluster/blob/master/05-%E9%83%A8%E7%BD%B2Flannel%E7%BD%91%E7%BB%9C.md" target="_blank" rel="noopener">05-&#x90E8;&#x7F72;Flannel&#x7F51;&#x7EDC;.md</a></p><h2 id="&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;-docker"><a href="#&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;-docker" class="headerlink" title="&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E; docker"></a>&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E; docker</h2><h3 id="&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7684;-docker-&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;"><a href="#&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7684;-docker-&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;" class="headerlink" title="&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7684; docker &#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;"></a>&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7684; docker &#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;</h3><p>&#x53C2;&#x8003; <a href="https://www.wolf7.org/articles/2017/07/07/1499419787623.html" target="_blank" rel="noopener">Docker1.7&#x811A;&#x672C;&#x5B89;&#x88C5;</a></p><h3 id="&#x4FEE;&#x6539;-docker-&#x7684;-systemd-unit-&#x6587;&#x4EF6;"><a href="#&#x4FEE;&#x6539;-docker-&#x7684;-systemd-unit-&#x6587;&#x4EF6;" class="headerlink" title="&#x4FEE;&#x6539; docker &#x7684; systemd unit &#x6587;&#x4EF6;"></a>&#x4FEE;&#x6539; docker &#x7684; systemd unit &#x6587;&#x4EF6;</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">vim /lib/systemd/system/docker.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.docker.com</span><br><span class="line">After=network-online.target firewalld.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">EnvironmentFile=-/run/flannel/docker</span><br><span class="line">ExecStart=/usr/bin/dockerd $DOCKER_NETWORK_OPTIONS --log-level=error</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">TimeoutStartSec=0</span><br><span class="line">Delegate=yes</span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">StartLimitBurst=3</span><br><span class="line">StartLimitInterval=60s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.targe</span><br></pre></td></tr></tbody></table></figure><ul><li><p>dockerd &#x8FD0;&#x884C;&#x65F6;&#x4F1A;&#x8C03;&#x7528;&#x5176;&#x5B83; docker &#x547D;&#x4EE4;&#xFF0C;&#x5982; docker-proxy&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5C06; docker &#x547D;&#x4EE4;&#x6240;&#x5728;&#x7684;&#x76EE;&#x5F55;&#x52A0;&#x5230; PATH &#x73AF;&#x5883;&#x53D8;&#x91CF;&#x4E2D;&#xFF1B;</p></li><li><p>flanneld &#x542F;&#x52A8;&#x65F6;&#x5C06;&#x7F51;&#x7EDC;&#x914D;&#x7F6E;&#x5199;&#x5165;&#x5230; <code>/run/flannel/docker</code> &#x6587;&#x4EF6;&#x4E2D;&#x7684;&#x53D8;&#x91CF; <code>DOCKER_NETWORK_OPTIONS</code>&#xFF0C;dockerd &#x547D;&#x4EE4;&#x884C;&#x4E0A;&#x6307;&#x5B9A;&#x8BE5;&#x53D8;&#x91CF;&#x503C;&#x6765;&#x8BBE;&#x7F6E; docker0 &#x7F51;&#x6865;&#x53C2;&#x6570;&#xFF1B;</p></li><li><p>&#x5982;&#x679C;&#x6307;&#x5B9A;&#x4E86;&#x591A;&#x4E2A; <code>EnvironmentFile</code> &#x9009;&#x9879;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x5C06; <code>/run/flannel/docker</code> &#x653E;&#x5728;&#x6700;&#x540E;(&#x786E;&#x4FDD; docker0 &#x4F7F;&#x7528; flanneld &#x751F;&#x6210;&#x7684; bip &#x53C2;&#x6570;)&#xFF1B;</p></li><li><p>&#x4E0D;&#x80FD;&#x5173;&#x95ED;&#x9ED8;&#x8BA4;&#x5F00;&#x542F;&#x7684; <code>--iptables</code> &#x548C; <code>--ip-masq</code> &#x9009;&#x9879;&#xFF1B;</p></li><li><p>&#x5982;&#x679C;&#x5185;&#x6838;&#x7248;&#x672C;&#x6BD4;&#x8F83;&#x65B0;&#xFF0C;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528; <code>overlay</code> &#x5B58;&#x50A8;&#x9A71;&#x52A8;&#xFF1B;</p></li><li><p>docker &#x4ECE; 1.13 &#x7248;&#x672C;&#x5F00;&#x59CB;&#xFF0C;&#x53EF;&#x80FD;&#x5C06; <strong>iptables FORWARD chain&#x7684;&#x9ED8;&#x8BA4;&#x7B56;&#x7565;&#x8BBE;&#x7F6E;&#x4E3A;DROP</strong>&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4; ping &#x5176;&#x5B83; Node &#x4E0A;&#x7684; Pod IP &#x5931;&#x8D25;&#xFF0C;&#x9047;&#x5230;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x624B;&#x52A8;&#x8BBE;&#x7F6E;&#x7B56;&#x7565;&#x4E3A; <code>ACCEPT</code>&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo iptables -P FORWARD ACCEPT</span><br><span class="line">$</span><br></pre></td></tr></tbody></table></figure></li><li><p>&#x4E3A;&#x4E86;&#x52A0;&#x5FEB; pull image &#x7684;&#x901F;&#x5EA6;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x56FD;&#x5185;&#x7684;&#x4ED3;&#x5E93;&#x955C;&#x50CF;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x540C;&#x65F6;&#x589E;&#x52A0;&#x4E0B;&#x8F7D;&#x7684;&#x5E76;&#x53D1;&#x6570;&#x3002;(&#x5982;&#x679C; dockerd &#x5DF2;&#x7ECF;&#x8FD0;&#x884C;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x91CD;&#x542F; dockerd &#x751F;&#x6548;&#x3002;)</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat /etc/docker/daemon.json</span><br><span class="line">{</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn&quot;, &quot;hub-mirror.c.163.com&quot;],</span><br><span class="line">  &quot;max-concurrent-downloads&quot;: 10</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ul><p>&#x5B8C;&#x6574; unit &#x89C1; <a href="https://github.com/opsnull/follow-me-install-kubernetes-cluster/blob/master/systemd/docker.service" target="_blank" rel="noopener">docker.service</a></p><h2 id="&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;-kubelet"><a href="#&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;-kubelet" class="headerlink" title="&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E; kubelet"></a>&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E; kubelet</h2><p>kubelet &#x542F;&#x52A8;&#x65F6;&#x5411; kube-apiserver &#x53D1;&#x9001; TLS bootstrapping &#x8BF7;&#x6C42;&#xFF0C;&#x9700;&#x8981;&#x5148;&#x5C06; bootstrap token &#x6587;&#x4EF6;&#x4E2D;&#x7684; kubelet-bootstrap &#x7528;&#x6237;&#x8D4B;&#x4E88; system:node-bootstrapper &#x89D2;&#x8272;&#xFF0C;&#x7136;&#x540E; kubelet &#x624D;&#x6709;&#x6743;&#x9650;&#x521B;&#x5EFA;&#x8BA4;&#x8BC1;&#x8BF7;&#x6C42;(certificatesigningrequests)&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create clusterrolebinding kubelet-bootstrap --clusterrole=system:node-bootstrapper --user=kubelet-bootstrap</span><br><span class="line">$</span><br></pre></td></tr></tbody></table></figure><ul><li><code>--user=kubelet-bootstrap</code> &#x662F;&#x6587;&#x4EF6; <code>/etc/kubernetes/token.csv</code> &#x4E2D;&#x6307;&#x5B9A;&#x7684;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x5199;&#x5165;&#x4E86;&#x6587;&#x4EF6; <code>/etc/kubernetes/bootstrap.kubeconfig</code>&#xFF1B;</li></ul><h3 id="&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7684;-kubelet-&#x548C;-kube-proxy-&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;"><a href="#&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7684;-kubelet-&#x548C;-kube-proxy-&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;" class="headerlink" title="&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7684; kubelet &#x548C; kube-proxy &#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;"></a>&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7684; kubelet &#x548C; kube-proxy &#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://dl.k8s.io/v1.6.2/kubernetes-server-linux-amd64.tar.gz</span><br><span class="line">$ tar -xzvf kubernetes-server-linux-amd64.tar.gz</span><br><span class="line">$ cd kubernetes</span><br><span class="line">$ tar -xzvf  kubernetes-src.tar.gz</span><br><span class="line">$ sudo cp -r ./server/bin/{kube-proxy,kubelet} /root/local/bin/</span><br><span class="line">$</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x521B;&#x5EFA;-kubelet-bootstrapping-kubeconfig-&#x6587;&#x4EF6;"><a href="#&#x521B;&#x5EFA;-kubelet-bootstrapping-kubeconfig-&#x6587;&#x4EF6;" class="headerlink" title="&#x521B;&#x5EFA; kubelet bootstrapping kubeconfig &#x6587;&#x4EF6;"></a>&#x521B;&#x5EFA; kubelet bootstrapping kubeconfig &#x6587;&#x4EF6;</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># &#x8BBE;&#x7F6E;&#x96C6;&#x7FA4;&#x53C2;&#x6570;</span><br><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --server=${KUBE_APISERVER} \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"># &#x8BBE;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x8BA4;&#x8BC1;&#x53C2;&#x6570;</span><br><span class="line">kubectl config set-credentials kubelet-bootstrap \</span><br><span class="line">  --token=${BOOTSTRAP_TOKEN} \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"># &#x8BBE;&#x7F6E;&#x4E0A;&#x4E0B;&#x6587;&#x53C2;&#x6570;</span><br><span class="line">kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=kubelet-bootstrap \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"># &#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x4E0A;&#x4E0B;&#x6587;</span><br><span class="line">kubectl config use-context default --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">cp bootstrap.kubeconfig /etc/kubernetes/</span><br><span class="line">scp bootstrap.kubeconfig root@node2:/etc/kubernetes/</span><br><span class="line">scp bootstrap.kubeconfig root@node3:/etc/kubernetes/</span><br></pre></td></tr></tbody></table></figure><ul><li><code>--embed-certs</code> &#x4E3A; <code>true</code> &#x65F6;&#x8868;&#x793A;&#x5C06; <code>certificate-authority</code> &#x8BC1;&#x4E66;&#x5199;&#x5165;&#x5230;&#x751F;&#x6210;&#x7684; <code>bootstrap.kubeconfig</code> &#x6587;&#x4EF6;&#x4E2D;&#xFF1B;</li><li>&#x8BBE;&#x7F6E; kubelet &#x5BA2;&#x6237;&#x7AEF;&#x8BA4;&#x8BC1;&#x53C2;&#x6570;&#x65F6;<strong>&#x6CA1;&#x6709;</strong>&#x6307;&#x5B9A;&#x79D8;&#x94A5;&#x548C;&#x8BC1;&#x4E66;&#xFF0C;&#x540E;&#x7EED;&#x7531; <code>kube-apiserver</code> &#x81EA;&#x52A8;&#x751F;&#x6210;&#xFF1B;</li><li>&#x751F;&#x6210;&#x7684;bootstrap.kubeconfig&#x6587;&#x4EF6;&#x540C;&#x6B65;&#x5230;&#x96C6;&#x7FA4;node&#x7684;/etc/kubernetes/&#x4E0B;</li><li><h2 id="&#x521B;&#x5EFA;-kubectl-kubeconfig-&#x6587;&#x4EF6;"><a href="#&#x521B;&#x5EFA;-kubectl-kubeconfig-&#x6587;&#x4EF6;" class="headerlink" title="&#x521B;&#x5EFA; kubectl kubeconfig &#x6587;&#x4EF6;"></a>&#x521B;&#x5EFA; kubectl kubeconfig &#x6587;&#x4EF6;</h2></li></ul><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ export KUBE_APISERVER=&quot;https://192.168.77.201:6443&quot;</span><br><span class="line">$ # &#x8BBE;&#x7F6E;&#x96C6;&#x7FA4;&#x53C2;&#x6570;</span><br><span class="line">$ kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --server=${KUBE_APISERVER}</span><br><span class="line">$ # &#x8BBE;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x8BA4;&#x8BC1;&#x53C2;&#x6570;</span><br><span class="line">$ kubectl config set-credentials admin \</span><br><span class="line">  --client-certificate=/etc/kubernetes/ssl/admin.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --client-key=/etc/kubernetes/ssl/admin-key.pem</span><br><span class="line">$ # &#x8BBE;&#x7F6E;&#x4E0A;&#x4E0B;&#x6587;&#x53C2;&#x6570;</span><br><span class="line">$ kubectl config set-context kubernetes \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=admin</span><br><span class="line">$ # &#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x4E0A;&#x4E0B;&#x6587;</span><br><span class="line">$ kubectl config use-context kubernetes</span><br></pre></td></tr></tbody></table></figure><ul><li><code>admin.pem</code> &#x8BC1;&#x4E66; OU &#x5B57;&#x6BB5;&#x503C;&#x4E3A; <code>system:masters</code>&#xFF0C;<code>kube-apiserver</code> &#x9884;&#x5B9A;&#x4E49;&#x7684; RoleBinding <code>cluster-admin</code> &#x5C06; Group <code>system:masters</code> &#x4E0E; Role <code>cluster-admin</code> &#x7ED1;&#x5B9A;&#xFF0C;&#x8BE5; Role &#x6388;&#x4E88;&#x4E86;&#x8C03;&#x7528;<code>kube-apiserver</code> &#x76F8;&#x5173; API &#x7684;&#x6743;&#x9650;&#xFF1B;</li><li>&#x751F;&#x6210;&#x7684; kubeconfig &#x88AB;&#x4FDD;&#x5B58;&#x5230; <code>~/.kube/config</code> &#x6587;&#x4EF6;&#xFF1B;</li></ul><h3 id="&#x521B;&#x5EFA;-kubelet-&#x7684;-systemd-unit-&#x6587;&#x4EF6;"><a href="#&#x521B;&#x5EFA;-kubelet-&#x7684;-systemd-unit-&#x6587;&#x4EF6;" class="headerlink" title="&#x521B;&#x5EFA; kubelet &#x7684; systemd unit &#x6587;&#x4EF6;"></a>&#x521B;&#x5EFA; kubelet &#x7684; systemd unit &#x6587;&#x4EF6;</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /var/lib/kubelet # &#x5FC5;&#x987B;&#x5148;&#x521B;&#x5EFA;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;</span><br><span class="line">vim kubelet.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Kubelet</span><br><span class="line">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class="line">After=docker.service</span><br><span class="line">Requires=docker.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">WorkingDirectory=/var/lib/kubelet</span><br><span class="line">ExecStart=/root/local/bin/kubelet \</span><br><span class="line">  --address=192.168.77.202 \</span><br><span class="line">  --hostname-override=192.168.77.202 \</span><br><span class="line">  --pod-infra-container-image=registry.access.redhat.com/rhel7/pod-infrastructure:latest \</span><br><span class="line">  --experimental-bootstrap-kubeconfig=/etc/kubernetes/bootstrap.kubeconfig \</span><br><span class="line">  --kubeconfig=/etc/kubernetes/kubelet-kubeconfig \</span><br><span class="line">  --require-kubeconfig \</span><br><span class="line">  --cert-dir=/etc/kubernetes/ssl \</span><br><span class="line">  --container-runtime=docker \</span><br><span class="line">  --cluster-dns=10.254.0.2 \</span><br><span class="line">  --cluster-domain=cluster.local. \</span><br><span class="line">  --hairpin-mode promiscuous-bridge \</span><br><span class="line">  --allow-privileged=true \</span><br><span class="line">  --serialize-image-pulls=false \</span><br><span class="line">  --register-node=true \</span><br><span class="line">  --logtostderr=true \</span><br><span class="line">  --v=2</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure><h3 id="&#x901A;&#x8FC7;-kubelet-&#x7684;-TLS-&#x8BC1;&#x4E66;&#x8BF7;&#x6C42;"><a href="#&#x901A;&#x8FC7;-kubelet-&#x7684;-TLS-&#x8BC1;&#x4E66;&#x8BF7;&#x6C42;" class="headerlink" title="&#x901A;&#x8FC7; kubelet &#x7684; TLS &#x8BC1;&#x4E66;&#x8BF7;&#x6C42;"></a>&#x901A;&#x8FC7; kubelet &#x7684; TLS &#x8BC1;&#x4E66;&#x8BF7;&#x6C42;</h3><p>kubelet &#x9996;&#x6B21;&#x542F;&#x52A8;&#x65F6;&#x5411; kube-apiserver &#x53D1;&#x9001;&#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;&#xFF0C;&#x5FC5;&#x987B;&#x901A;&#x8FC7;&#x540E; kubernetes &#x7CFB;&#x7EDF;&#x624D;&#x4F1A;&#x5C06;&#x8BE5; Node &#x52A0;&#x5165;&#x5230;&#x96C6;&#x7FA4;&#x3002;</p><p>&#x67E5;&#x770B;&#x672A;&#x6388;&#x6743;&#x7684; CSR &#x8BF7;&#x6C42;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kubectl get csr</span><br><span class="line">NAME        AGE       REQUESTOR           CONDITION</span><br><span class="line">csr-279xz   22m       kubelet-bootstrap   Pending</span><br><span class="line">csr-2pt02   19m       kubelet-bootstrap   Pending</span><br><span class="line">csr-8z9n7   4m        kubelet-bootstrap   Pending</span><br><span class="line">csr-bzwk6   8m        kubelet-bootstrap   Pending</span><br><span class="line">csr-h84s6   8m        kubelet-bootstrap   Pending</span><br><span class="line">csr-jqpp4   17m       kubelet-bootstrap   Pending</span><br><span class="line">csr-k7413   18m       kubelet-bootstrap   Pending</span><br><span class="line">csr-qqc03   18m       kubelet-bootstrap   Pending</span><br><span class="line">csr-t0dzn   18m       kubelet-bootstrap   Pending</span><br><span class="line">kubectl get nodes</span><br><span class="line">No resources found.</span><br></pre></td></tr></tbody></table></figure><p>&#x901A;&#x8FC7; CSR &#x8BF7;&#x6C42;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl certificate approve csr-279xz</span><br><span class="line">certificatesigningrequest &quot;csr-279xz&quot; approved</span><br><span class="line">$ kubectl get nodes</span><br><span class="line">NAME        STATUS    AGE       VERSION</span><br><span class="line">10.64.3.7   Ready     49m       v1.6.2</span><br></pre></td></tr></tbody></table></figure><p>&#x81EA;&#x52A8;&#x751F;&#x6210;&#x4E86; kubelet kubeconfig &#x6587;&#x4EF6;&#x548C;&#x516C;&#x79C1;&#x94A5;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l /etc/kubernetes/kubelet.kubeconfig</span><br><span class="line">-rw------- 1 root root 2284 Apr  7 02:07 /etc/kubernetes/kubelet.kubeconfig</span><br><span class="line">$ ls -l /etc/kubernetes/ssl/kubelet*</span><br><span class="line">-rw-r--r-- 1 root root 1046 Apr  7 02:07 /etc/kubernetes/ssl/kubelet-client.crt</span><br><span class="line">-rw------- 1 root root  227 Apr  7 02:04 /etc/kubernetes/ssl/kubelet-client.key</span><br><span class="line">-rw-r--r-- 1 root root 1103 Apr  7 02:07 /etc/kubernetes/ssl/kubelet.crt</span><br><span class="line">-rw------- 1 root root 1675 Apr  7 02:07 /etc/kubernetes/ssl/kubelet.key</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x914D;&#x7F6E;-kube-proxy"><a href="#&#x914D;&#x7F6E;-kube-proxy" class="headerlink" title="&#x914D;&#x7F6E; kube-proxy"></a>&#x914D;&#x7F6E; kube-proxy</h2><h3 id="&#x521B;&#x5EFA;-kube-proxy-&#x8BC1;&#x4E66;"><a href="#&#x521B;&#x5EFA;-kube-proxy-&#x8BC1;&#x4E66;" class="headerlink" title="&#x521B;&#x5EFA; kube-proxy &#x8BC1;&#x4E66;"></a>&#x521B;&#x5EFA; kube-proxy &#x8BC1;&#x4E66;</h3><p>&#x521B;&#x5EFA; kube-proxy &#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vim kube-proxy-csr.json</span><br><span class="line">{</span><br><span class="line">  &quot;CN&quot;: &quot;system:kube-proxy&quot;,</span><br><span class="line">  &quot;hosts&quot;: [],</span><br><span class="line">  &quot;key&quot;: {</span><br><span class="line">    &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">    &quot;size&quot;: 2048</span><br><span class="line">  },</span><br><span class="line">  &quot;names&quot;: [</span><br><span class="line">    {</span><br><span class="line">      &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">      &quot;ST&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;O&quot;: &quot;k8s&quot;,</span><br><span class="line">      &quot;OU&quot;: &quot;System&quot;</span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>CN &#x6307;&#x5B9A;&#x8BE5;&#x8BC1;&#x4E66;&#x7684; User &#x4E3A; <code>system:kube-proxy</code>&#xFF1B;</li><li><code>kube-apiserver</code> &#x9884;&#x5B9A;&#x4E49;&#x7684; RoleBinding <code>system:node-proxier</code> &#x5C06;User <code>system:kube-proxy</code> &#x4E0E; Role <code>system:node-proxier</code> &#x7ED1;&#x5B9A;&#xFF0C;&#x8BE5; Role &#x6388;&#x4E88;&#x4E86;&#x8C03;&#x7528; <code>kube-apiserver</code> Proxy &#x76F8;&#x5173; API &#x7684;&#x6743;&#x9650;&#xFF1B;</li><li>hosts &#x5C5E;&#x6027;&#x503C;&#x4E3A;&#x7A7A;&#x5217;&#x8868;&#xFF1B;</li></ul><p>&#x751F;&#x6210; kube-proxy &#x5BA2;&#x6237;&#x7AEF;&#x8BC1;&#x4E66;&#x548C;&#x79C1;&#x94A5;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert -ca=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  -ca-key=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="line">  -config=/etc/kubernetes/ssl/ca-config.json \</span><br><span class="line">  -profile=kubernetes  kube-proxy-csr.json | cfssljson -bare kube-proxy</span><br><span class="line">$ ls kube-proxy*</span><br><span class="line">kube-proxy.csr  kube-proxy-csr.json  kube-proxy-key.pem  kube-proxy.pem</span><br><span class="line">cp kube-proxy*.pem /etc/kubernetes/ssl/</span><br><span class="line">scp kube-proxy*.pem root@node2/etc/kubernetes/ssl/</span><br><span class="line">scp kube-proxy*.pem root@node3/etc/kubernetes/ssl/</span><br><span class="line">$</span><br></pre></td></tr></tbody></table></figure><h3 id="&#x521B;&#x5EFA;-kube-proxy-kubeconfig-&#x6587;&#x4EF6;"><a href="#&#x521B;&#x5EFA;-kube-proxy-kubeconfig-&#x6587;&#x4EF6;" class="headerlink" title="&#x521B;&#x5EFA; kube-proxy kubeconfig &#x6587;&#x4EF6;"></a>&#x521B;&#x5EFA; kube-proxy kubeconfig &#x6587;&#x4EF6;</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ # &#x8BBE;&#x7F6E;&#x96C6;&#x7FA4;&#x53C2;&#x6570;</span><br><span class="line">$ kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --server=${KUBE_APISERVER} \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">$ # &#x8BBE;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x8BA4;&#x8BC1;&#x53C2;&#x6570;</span><br><span class="line">$ kubectl config set-credentials kube-proxy \</span><br><span class="line">  --client-certificate=/etc/kubernetes/ssl/kube-proxy.pem \</span><br><span class="line">  --client-key=/etc/kubernetes/ssl/kube-proxy-key.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">$ # &#x8BBE;&#x7F6E;&#x4E0A;&#x4E0B;&#x6587;&#x53C2;&#x6570;</span><br><span class="line">$ kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=kube-proxy \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">$ # &#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x4E0A;&#x4E0B;&#x6587;</span><br><span class="line">$ kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">$ mv kube-proxy.kubeconfig /etc/kubernetes/</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x8BBE;&#x7F6E;&#x96C6;&#x7FA4;&#x53C2;&#x6570;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x8BA4;&#x8BC1;&#x53C2;&#x6570;&#x65F6; <code>--embed-certs</code> &#x90FD;&#x4E3A; <code>true</code>&#xFF0C;&#x8FD9;&#x4F1A;&#x5C06; <code>certificate-authority</code>&#x3001;<code>client-certificate</code> &#x548C; <code>client-key</code> &#x6307;&#x5411;&#x7684;&#x8BC1;&#x4E66;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5199;&#x5165;&#x5230;&#x751F;&#x6210;&#x7684; <code>kube-proxy.kubeconfig</code> &#x6587;&#x4EF6;&#x4E2D;&#xFF1B;</li><li><code>kube-proxy.pem</code> &#x8BC1;&#x4E66;&#x4E2D; CN &#x4E3A; <code>system:kube-proxy</code>&#xFF0C;<code>kube-apiserver</code> &#x9884;&#x5B9A;&#x4E49;&#x7684; RoleBinding <code>cluster-admin</code> &#x5C06;User <code>system:kube-proxy</code> &#x4E0E; Role <code>system:node-proxier</code> &#x7ED1;&#x5B9A;&#xFF0C;&#x8BE5; Role &#x6388;&#x4E88;&#x4E86;&#x8C03;&#x7528; <code>kube-apiserver</code> Proxy &#x76F8;&#x5173; API &#x7684;&#x6743;&#x9650;&#xFF1B;</li></ul><h3 id="&#x521B;&#x5EFA;-kube-proxy-&#x7684;-systemd-unit-&#x6587;&#x4EF6;"><a href="#&#x521B;&#x5EFA;-kube-proxy-&#x7684;-systemd-unit-&#x6587;&#x4EF6;" class="headerlink" title="&#x521B;&#x5EFA; kube-proxy &#x7684; systemd unit &#x6587;&#x4EF6;"></a>&#x521B;&#x5EFA; kube-proxy &#x7684; systemd unit &#x6587;&#x4EF6;</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir -p /var/lib/kube-proxy # &#x5FC5;&#x987B;&#x5148;&#x521B;&#x5EFA;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;</span><br><span class="line">vim kube-proxy.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Kube-Proxy Server</span><br><span class="line">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/root/local/bin/kube-proxy \</span><br><span class="line">  --bind-address=192.168.77.201 \</span><br><span class="line">  --cluster-cidr=10.254.0.0/16 \</span><br><span class="line">  --hostname-override=192.168.77.201 \</span><br><span class="line">  --kubeconfig=/etc/kubernetes/kube-proxy.kubeconfig \</span><br><span class="line">  --logtostderr=true \</span><br><span class="line">  --v=2</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure><ul><li><code>--hostname-override</code> &#x53C2;&#x6570;&#x503C;&#x5FC5;&#x987B;&#x4E0E; kubelet &#x7684;&#x503C;&#x4E00;&#x81F4;&#xFF0C;&#x5426;&#x5219; kube-proxy &#x542F;&#x52A8;&#x540E;&#x4F1A;&#x627E;&#x4E0D;&#x5230;&#x8BE5; Node&#xFF0C;&#x4ECE;&#x800C;&#x4E0D;&#x4F1A;&#x521B;&#x5EFA;&#x4EFB;&#x4F55; iptables &#x89C4;&#x5219;&#xFF1B;</li><li><code>--cluster-cidr</code> &#x5FC5;&#x987B;&#x4E0E; kube-apiserver &#x7684; <code>--service-cluster-ip-range</code> &#x9009;&#x9879;&#x503C;&#x4E00;&#x81F4;&#xFF1B;</li><li>kube-proxy &#x6839;&#x636E; <code>--cluster-cidr</code> &#x5224;&#x65AD;&#x96C6;&#x7FA4;&#x5185;&#x90E8;&#x548C;&#x5916;&#x90E8;&#x6D41;&#x91CF;&#xFF0C;&#x6307;&#x5B9A; <code>--cluster-cidr</code> &#x6216; <code>--masquerade-all</code> &#x9009;&#x9879;&#x540E; kube-proxy &#x624D;&#x4F1A;&#x5BF9;&#x8BBF;&#x95EE; Service IP &#x7684;&#x8BF7;&#x6C42;&#x505A; SNAT&#xFF1B;</li><li><code>--kubeconfig</code> &#x6307;&#x5B9A;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5D4C;&#x5165;&#x4E86; kube-apiserver &#x7684;&#x5730;&#x5740;&#x3001;&#x7528;&#x6237;&#x540D;&#x3001;&#x8BC1;&#x4E66;&#x3001;&#x79D8;&#x94A5;&#x7B49;&#x8BF7;&#x6C42;&#x548C;&#x8BA4;&#x8BC1;&#x4FE1;&#x606F;&#xFF1B;</li><li>&#x9884;&#x5B9A;&#x4E49;&#x7684; RoleBinding <code>cluster-admin</code> &#x5C06;User <code>system:kube-proxy</code> &#x4E0E; Role <code>system:node-proxier</code> &#x7ED1;&#x5B9A;&#xFF0C;&#x8BE5; Role &#x6388;&#x4E88;&#x4E86;&#x8C03;&#x7528; <code>kube-apiserver</code> Proxy &#x76F8;&#x5173; API &#x7684;&#x6743;&#x9650;&#xFF1B;</li><li>&#x5B8C;&#x6574; unit &#x89C1; <a href="https://github.com/opsnull/follow-me-install-kubernetes-cluster/blob/master/systemd/kube-proxy.service" target="_blank" rel="noopener">kube-proxy.service</a></li></ul><h3 id="&#x542F;&#x52A8;-kube-proxy"><a href="#&#x542F;&#x52A8;-kube-proxy" class="headerlink" title="&#x542F;&#x52A8; kube-proxy"></a>&#x542F;&#x52A8; kube-proxy</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo cp kube-proxy.service /etc/systemd/system/</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl enable kube-proxy</span><br><span class="line">sudo systemctl start kube-proxy</span><br><span class="line">systemctl status kube-proxy</span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;kubernetes 集群（三）&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>centos一键安装l2tp</title>
    <link href="https://wolf-7.github.io/uncategorized/2017/01/24/centos%E4%B8%80%E9%94%AE%E5%AE%89%E8%A3%85l2tp.html"/>
    <id>https://wolf-7.github.io/uncategorized/2017/01/24/centos一键安装l2tp.html</id>
    <published>2017-01-24T07:40:40.000Z</published>
    <updated>2019-01-24T08:21:03.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><a id="more"></a><p>&#x4E0B;&#x8F7D;&#x811A;&#x672C;<br><code>wget --no-check-certificate https://raw.githubusercontent.com/teddysun/across/master/l2tp.sh</code></p><p>&#x6267;&#x884C;&#x5B89;&#x88C5;</p><p><code>chmod +x l2tp.sh</code></p><p>&#x9ED8;&#x8BA4;&#x5373;&#x53EF;&#xFF0C;&#x5728;PSK&#x8DDF;user&#x4E0E;password&#x5904;&#x6DFB;&#x52A0;&#x81EA;&#x5DF1;&#x7684;&#x7528;&#x6237;&#x540D;&#x5BC6;&#x7801;</p><p>&#x53E6;&#x5916;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x73B0;&#x4E0A;&#x4E0D;&#x4E86;&#x7F51;&#x7684;&#x539F;&#x56E0;&#x662F;iptables&#x89C4;&#x5219;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4FEE;&#x6539;/etc/sysconfig/iptables</p><p>&#x628A;-A POSTROUTING -s 192.168.18.0/24 -j SNAT &#x2013;to-source 52.80.74.49&#x66FF;&#x6362;&#x4E3A;-A POSTROUTING -s 192.168.18.0/24 -o eth0 -j MASQUERADE&#x5373;&#x53EF;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      
      
        &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>部署 kubernetes 集群 （二）</title>
    <link href="https://wolf-7.github.io/uncategorized/2017/01/23/%E9%83%A8%E7%BD%B2-kubernetes-%E9%9B%86%E7%BE%A4-%EF%BC%88%E4%BA%8C%EF%BC%89.html"/>
    <id>https://wolf-7.github.io/uncategorized/2017/01/23/部署-kubernetes-集群-（二）.html</id>
    <published>2017-01-23T07:50:42.000Z</published>
    <updated>2019-01-24T08:29:54.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>kubernetes &#x96C6;&#x7FA4;&#xFF08;&#x4E8C;&#xFF09;</p><a id="more"></a><h1 id="5-&#x90E8;&#x7F72;-Flannel-&#x7F51;&#x7EDC;"><a href="#5-&#x90E8;&#x7F72;-Flannel-&#x7F51;&#x7EDC;" class="headerlink" title="5.&#x90E8;&#x7F72; Flannel &#x7F51;&#x7EDC;"></a>5.&#x90E8;&#x7F72; Flannel &#x7F51;&#x7EDC;</h1><p>kubernetes &#x8981;&#x6C42;&#x96C6;&#x7FA4;&#x5185;&#x5404;&#x8282;&#x70B9;&#x80FD;&#x901A;&#x8FC7; Pod &#x7F51;&#x6BB5;&#x4E92;&#x8054;&#x4E92;&#x901A;&#xFF0C;&#x672C;&#x6587;&#x6863;&#x4ECB;&#x7ECD;&#x4F7F;&#x7528; Flannel &#x5728;<strong>&#x6240;&#x6709;&#x8282;&#x70B9;</strong> (Master&#x3001;Node) &#x4E0A;&#x521B;&#x5EFA;&#x4E92;&#x8054;&#x4E92;&#x901A;&#x7684; Pod &#x7F51;&#x6BB5;&#x7684;&#x6B65;&#x9AA4;&#x3002;</p><h2 id="&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;"><a href="#&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;" class="headerlink" title="&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;"></a>&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;</h2><p>&#x672C;&#x6587;&#x6863;&#x7528;&#x5230;&#x7684;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export NODE_IP=192.168.77.201 # &#x5F53;&#x524D;&#x90E8;&#x7F72;&#x8282;&#x70B9;&#x7684; IP</span><br><span class="line"># &#x5BFC;&#x5165;&#x7528;&#x5230;&#x7684;&#x5176;&#x5B83;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF1A;ETCD_ENDPOINTS&#x3001;FLANNEL_ETCD_PREFIX&#x3001;CLUSTER_CIDR</span><br><span class="line">source /root/local/bin/environment.sh</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x521B;&#x5EFA;-TLS-&#x79D8;&#x94A5;&#x548C;&#x8BC1;&#x4E66;"><a href="#&#x521B;&#x5EFA;-TLS-&#x79D8;&#x94A5;&#x548C;&#x8BC1;&#x4E66;" class="headerlink" title="&#x521B;&#x5EFA; TLS &#x79D8;&#x94A5;&#x548C;&#x8BC1;&#x4E66;"></a>&#x521B;&#x5EFA; TLS &#x79D8;&#x94A5;&#x548C;&#x8BC1;&#x4E66;</h2><p>etcd &#x96C6;&#x7FA4;&#x542F;&#x7528;&#x4E86;&#x53CC;&#x5411; TLS &#x8BA4;&#x8BC1;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x4E3A; flanneld &#x6307;&#x5B9A;&#x4E0E; etcd &#x96C6;&#x7FA4;&#x901A;&#x4FE1;&#x7684; CA &#x548C;&#x79D8;&#x94A5;&#x3002;</p><p>&#x521B;&#x5EFA; flanneld &#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vim flanneld-csr.json </span><br><span class="line">{</span><br><span class="line"> &quot;CN&quot;: &quot;flanneld&quot;,</span><br><span class="line"> &quot;hosts&quot;: [],</span><br><span class="line"> &quot;key&quot;: {</span><br><span class="line"> &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line"> &quot;size&quot;: 2048</span><br><span class="line"> },</span><br><span class="line"> &quot;names&quot;: [</span><br><span class="line"> {</span><br><span class="line"> &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line"> &quot;ST&quot;: &quot;BeiJing&quot;,</span><br><span class="line"> &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line"> &quot;O&quot;: &quot;k8s&quot;,</span><br><span class="line"> &quot;OU&quot;: &quot;System&quot;</span><br><span class="line"> }</span><br><span class="line"> ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>hosts &#x5B57;&#x6BB5;&#x4E3A;&#x7A7A;&#xFF1B;</li></ul><p>&#x751F;&#x6210; flanneld &#x8BC1;&#x4E66;&#x548C;&#x79C1;&#x94A5;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert -ca=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  -ca-key=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="line">  -config=/etc/kubernetes/ssl/ca-config.json \</span><br><span class="line">  -profile=kubernetes flanneld-csr.json | cfssljson -bare flanneld</span><br><span class="line">ls flanneld*</span><br><span class="line">flanneld.csr  flanneld-csr.json  flanneld-key.pem flanneld.pem</span><br><span class="line">sudo mkdir -p /etc/flanneld/ssl</span><br><span class="line">sudo mv flanneld*.pem /etc/flanneld/ssl</span><br><span class="line">rm flanneld.csr  flanneld-csr.json</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x5411;-etcd-&#x5199;&#x5165;&#x96C6;&#x7FA4;-Pod-&#x7F51;&#x6BB5;&#x4FE1;&#x606F;"><a href="#&#x5411;-etcd-&#x5199;&#x5165;&#x96C6;&#x7FA4;-Pod-&#x7F51;&#x6BB5;&#x4FE1;&#x606F;" class="headerlink" title="&#x5411; etcd &#x5199;&#x5165;&#x96C6;&#x7FA4; Pod &#x7F51;&#x6BB5;&#x4FE1;&#x606F;"></a>&#x5411; etcd &#x5199;&#x5165;&#x96C6;&#x7FA4; Pod &#x7F51;&#x6BB5;&#x4FE1;&#x606F;</h2><p>&#x6CE8;&#x610F;&#xFF1A;&#x672C;&#x6B65;&#x9AA4;&#x53EA;&#x9700;&#x5728;<strong>&#x7B2C;&#x4E00;&#x6B21;</strong>&#x90E8;&#x7F72; Flannel &#x7F51;&#x7EDC;&#x65F6;&#x6267;&#x884C;&#xFF0C;&#x540E;&#x7EED;&#x5728;&#x5176;&#x5B83;&#x8282;&#x70B9;&#x4E0A;&#x90E8;&#x7F72; Flannel &#x65F6;<strong>&#x65E0;&#x9700;</strong>&#x518D;&#x5199;&#x5165;&#x8BE5;&#x4FE1;&#x606F;&#xFF01;<br>&#x8C03;&#x6574;etcdctlapi&#x914D;&#x7F6E;&#x4F7F;&#x7528;<br><code>export ETCDCTL_API=2</code><br>etcd2&#x7684;&#x914D;&#x7F6E;&#x5199;&#x6CD5;<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ /root/local/bin/etcdctl \</span><br><span class="line">  --endpoints=${ETCD_ENDPOINTS} \</span><br><span class="line">  --ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --cert-file=/etc/flanneld/ssl/flanneld.pem \</span><br><span class="line">  --key-file=/etc/flanneld/ssl/flanneld-key.pem \</span><br><span class="line">  set ${FLANNEL_ETCD_PREFIX}/config &apos;{&quot;Network&quot;:&quot;&apos;${CLUSTER_CIDR}&apos;&quot;, &quot;SubnetLen&quot;: 24, &quot;Backend&quot;: {&quot;Type&quot;: &quot;vxlan&quot;}}&apos;</span><br></pre></td></tr></tbody></table></figure><p></p><p>etcd3&#x7684;&#x914D;&#x7F6E;&#x5199;&#x6CD5;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/root/<span class="built_in">local</span>/bin/etcdctl \</span><br><span class="line"> --endpoints=<span class="variable">${ETCD_ENDPOINTS}</span> \</span><br><span class="line"> --cacert=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line"> --cert=/etc/flanneld/ssl/flanneld.pem \</span><br><span class="line"> --key=/etc/flanneld/ssl/flanneld-key.pem \</span><br><span class="line"> put <span class="variable">${FLANNEL_ETCD_PREFIX}</span>/config <span class="string">&apos;{&quot;Network&quot;:&quot;&apos;</span><span class="variable">${CLUSTER_CIDR}</span><span class="string">&apos;&quot;, &quot;SubnetLen&quot;: 24, &quot;Backend&quot;: {&quot;Type&quot;: &quot;vxlan&quot;}}&apos;</span></span><br></pre></td></tr></tbody></table></figure><p></p><ul><li>flanneld <strong>&#x76EE;&#x524D;&#x7248;&#x672C; (v0.7.1) &#x4E0D;&#x652F;&#x6301; etcd v3</strong>&#xFF0C;&#x6545;&#x4F7F;&#x7528; etcd v2 API &#x5199;&#x5165;&#x914D;&#x7F6E; key &#x548C;&#x7F51;&#x6BB5;&#x6570;&#x636E;&#xFF1B;</li><li>&#x5199;&#x5165;&#x7684; Pod &#x7F51;&#x6BB5;(${CLUSTER_CIDR}&#xFF0C;172.30.0.0/16) &#x5FC5;&#x987B;&#x4E0E; kube-controller-manager &#x7684; <code>--cluster-cidr</code> &#x9009;&#x9879;&#x503C;&#x4E00;&#x81F4;&#xFF1B;</li></ul><h2 id="&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;-flanneld"><a href="#&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;-flanneld" class="headerlink" title="&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;-flanneld"></a>&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;-flanneld</h2><h2 id="&#x4E0B;&#x8F7D;-flanneld"><a href="#&#x4E0B;&#x8F7D;-flanneld" class="headerlink" title="&#x4E0B;&#x8F7D; flanneld"></a>&#x4E0B;&#x8F7D; flanneld</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir flannel</span><br><span class="line">$ wget https://github.com/coreos/flannel/releases/download/v0.7.1/flannel-v0.7.1-linux-amd64.tar.gz</span><br><span class="line">$ tar -xzvf flannel-v0.7.1-linux-amd64.tar.gz -C flannel</span><br><span class="line">cp flannel/{flanneld,mk-docker-opts.sh} /root/local/bin</span><br><span class="line">scp flannel/{flanneld,mk-docker-opts.sh} root@node2:/root/local/bin</span><br><span class="line">scp flannel/{flanneld,mk-docker-opts.sh} root@node3:/root/local/bin</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x521B;&#x5EFA;-flanneld-&#x7684;-systemd-unit-&#x6587;&#x4EF6;"><a href="#&#x521B;&#x5EFA;-flanneld-&#x7684;-systemd-unit-&#x6587;&#x4EF6;" class="headerlink" title="&#x521B;&#x5EFA; flanneld &#x7684; systemd unit &#x6587;&#x4EF6;"></a>&#x521B;&#x5EFA; flanneld &#x7684; systemd unit &#x6587;&#x4EF6;</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">vim flanneld.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Flanneld overlay address etcd agent</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line">After=etcd.service</span><br><span class="line">Before=docker.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">ExecStart=/root/local/bin/flanneld \</span><br><span class="line">  -etcd-cafile=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  -etcd-certfile=/etc/flanneld/ssl/flanneld.pem \</span><br><span class="line">  -etcd-keyfile=/etc/flanneld/ssl/flanneld-key.pem \</span><br><span class="line">  -etcd-endpoints=https://192.168.77.201:2379,https://192.168.77.201:2379,https://192.168.77.201:2379 \</span><br><span class="line">  -etcd-prefix=/kubernetes/network</span><br><span class="line">ExecStartPost=/root/local/bin/mk-docker-opts.sh -k DOCKER_NETWORK_OPTIONS -d /run/flannel/docker</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">RequiredBy=docker.service</span><br></pre></td></tr></tbody></table></figure><ul><li>mk-docker-opts.sh &#x811A;&#x672C;&#x5C06;&#x5206;&#x914D;&#x7ED9; flanneld &#x7684; Pod &#x5B50;&#x7F51;&#x7F51;&#x6BB5;&#x4FE1;&#x606F;&#x5199;&#x5165;&#x5230; <code>/run/flannel/docker</code> &#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x540E;&#x7EED; docker &#x542F;&#x52A8;&#x65F6;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#x53C2;&#x6570;&#x503C;&#x8BBE;&#x7F6E; docker0 &#x7F51;&#x6865;&#xFF1B;</li><li>flanneld &#x4F7F;&#x7528;&#x7CFB;&#x7EDF;&#x7F3A;&#x7701;&#x8DEF;&#x7531;&#x6240;&#x5728;&#x7684;&#x63A5;&#x53E3;&#x548C;&#x5176;&#x5B83;&#x8282;&#x70B9;&#x901A;&#x4FE1;&#xFF0C;&#x5BF9;&#x4E8E;&#x6709;&#x591A;&#x4E2A;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x7684;&#x673A;&#x5668;&#xFF08;&#x5982;&#xFF0C;&#x5185;&#x7F51;&#x548C;&#x516C;&#x7F51;&#xFF09;&#xFF0C;&#x53EF;&#x4EE5;&#x7528; <code>-iface</code> &#x9009;&#x9879;&#x503C;&#x6307;&#x5B9A;&#x901A;&#x4FE1;&#x63A5;&#x53E3;(&#x4E0A;&#x9762;&#x7684; systemd unit &#x6587;&#x4EF6;&#x6CA1;&#x6307;&#x5B9A;&#x8FD9;&#x4E2A;&#x9009;&#x9879;)&#xFF1B;</li><li>&#x6B64;&#x811A;&#x672C;&#x90E8;&#x7F72;&#x5404;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x505A;&#x4EFB;&#x4F55;&#x4FEE;&#x6539;<br>&#x5B8C;&#x6574; unit &#x89C1; <a href="https://github.com/opsnull/follow-me-install-kubernetes-cluster/blob/master/systemd/flanneld.service" target="_blank" rel="noopener">flanneld.service</a></li></ul><h2 id="&#x542F;&#x52A8;-flanneld"><a href="#&#x542F;&#x52A8;-flanneld" class="headerlink" title="&#x542F;&#x52A8; flanneld"></a>&#x542F;&#x52A8; flanneld</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp flanneld.service /etc/systemd/system/</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable flanneld</span><br><span class="line">systemctl start flanneld</span><br><span class="line">systemctl status flanneld</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x68C0;&#x67E5;-flanneld-&#x670D;&#x52A1;"><a href="#&#x68C0;&#x67E5;-flanneld-&#x670D;&#x52A1;" class="headerlink" title="&#x68C0;&#x67E5; flanneld &#x670D;&#x52A1;"></a>&#x68C0;&#x67E5; flanneld &#x670D;&#x52A1;</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">journalctl  -u flanneld |grep &apos;Lease acquired&apos;</span><br><span class="line">ifconfig flannel.1</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x68C0;&#x67E5;&#x5206;&#x914D;&#x7ED9;&#x5404;-flanneld-&#x7684;-Pod-&#x7F51;&#x6BB5;&#x4FE1;&#x606F;"><a href="#&#x68C0;&#x67E5;&#x5206;&#x914D;&#x7ED9;&#x5404;-flanneld-&#x7684;-Pod-&#x7F51;&#x6BB5;&#x4FE1;&#x606F;" class="headerlink" title="&#x68C0;&#x67E5;&#x5206;&#x914D;&#x7ED9;&#x5404; flanneld &#x7684; Pod &#x7F51;&#x6BB5;&#x4FE1;&#x606F;"></a>&#x68C0;&#x67E5;&#x5206;&#x914D;&#x7ED9;&#x5404; flanneld &#x7684; Pod &#x7F51;&#x6BB5;&#x4FE1;&#x606F;</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># &#x67E5;&#x770B;&#x96C6;&#x7FA4; Pod &#x7F51;&#x6BB5;(/16)</span><br><span class="line">/root/local/bin/etcdctl \</span><br><span class="line">  --endpoints=${ETCD_ENDPOINTS} \</span><br><span class="line">  --ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --cert-file=/etc/flanneld/ssl/flanneld.pem \</span><br><span class="line">  --key-file=/etc/flanneld/ssl/flanneld-key.pem \</span><br><span class="line">  get ${FLANNEL_ETCD_PREFIX}/config</span><br><span class="line">{&quot;Network&quot;:&quot;172.30.0.0/16&quot;, &quot;SubnetLen&quot;: 24, &quot;Backend&quot;: {&quot;Type&quot;: &quot;vxlan&quot;}}</span><br><span class="line"># &#x67E5;&#x770B;&#x5DF2;&#x5206;&#x914D;&#x7684; Pod &#x5B50;&#x7F51;&#x6BB5;&#x5217;&#x8868;(/24)</span><br><span class="line">/root/local/bin/etcdctl \</span><br><span class="line">  --endpoints=${ETCD_ENDPOINTS} \</span><br><span class="line">  --ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --cert-file=/etc/flanneld/ssl/flanneld.pem \</span><br><span class="line">  --key-file=/etc/flanneld/ssl/flanneld-key.pem \</span><br><span class="line">  ls ${FLANNEL_ETCD_PREFIX}/subnets</span><br><span class="line">2017-07-07 10:35:02.135669 I | warning: ignoring ServerName for user-provided CA for backwards compatibility is deprecated</span><br><span class="line">/kubernetes/network/subnets/172.30.15.0-24</span><br><span class="line">/kubernetes/network/subnets/172.30.18.0-24</span><br><span class="line">/kubernetes/network/subnets/172.30.98.0-24</span><br><span class="line"># &#x67E5;&#x770B;&#x67D0;&#x4E00; Pod &#x7F51;&#x6BB5;&#x5BF9;&#x5E94;&#x7684; flanneld &#x8FDB;&#x7A0B;&#x76D1;&#x542C;&#x7684; IP &#x548C;&#x7F51;&#x7EDC;&#x53C2;&#x6570;</span><br><span class="line">/root/local/bin/etcdctl \</span><br><span class="line">  --endpoints=${ETCD_ENDPOINTS} \</span><br><span class="line">  --ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --cert-file=/etc/flanneld/ssl/flanneld.pem \</span><br><span class="line">  --key-file=/etc/flanneld/ssl/flanneld-key.pem \</span><br><span class="line">  get ${FLANNEL_ETCD_PREFIX}/subnets/172.30.19.0-24</span><br><span class="line">2017-07-07 10:36:03.807463 I | warning: ignoring ServerName for user-provided CA for backwards compatibility is deprecated</span><br><span class="line">{&quot;PublicIP&quot;:&quot;192.168.77.201&quot;,&quot;BackendType&quot;:&quot;vxlan&quot;,&quot;BackendData&quot;:{&quot;VtepMAC&quot;:&quot;86:82:7c:7b:57:06&quot;}}</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x786E;&#x4FDD;&#x5404;&#x8282;&#x70B9;&#x95F4;-Pod-&#x7F51;&#x6BB5;&#x80FD;&#x4E92;&#x8054;&#x4E92;&#x901A;"><a href="#&#x786E;&#x4FDD;&#x5404;&#x8282;&#x70B9;&#x95F4;-Pod-&#x7F51;&#x6BB5;&#x80FD;&#x4E92;&#x8054;&#x4E92;&#x901A;" class="headerlink" title="&#x786E;&#x4FDD;&#x5404;&#x8282;&#x70B9;&#x95F4; Pod &#x7F51;&#x6BB5;&#x80FD;&#x4E92;&#x8054;&#x4E92;&#x901A;"></a>&#x786E;&#x4FDD;&#x5404;&#x8282;&#x70B9;&#x95F4; Pod &#x7F51;&#x6BB5;&#x80FD;&#x4E92;&#x8054;&#x4E92;&#x901A;</h2><p>&#x5728;<strong>&#x5404;&#x8282;&#x70B9;&#x4E0A;&#x90E8;&#x7F72;&#x5B8C;</strong> Flannel &#x540E;&#xFF0C;&#x67E5;&#x770B;&#x5DF2;&#x5206;&#x914D;&#x7684; Pod &#x5B50;&#x7F51;&#x6BB5;&#x5217;&#x8868;(/24)</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/root/local/bin/etcdctl \</span><br><span class="line">  --endpoints=${ETCD_ENDPOINTS} \</span><br><span class="line">  --ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --cert-file=/etc/flanneld/ssl/flanneld.pem \</span><br><span class="line">  --key-file=/etc/flanneld/ssl/flanneld-key.pem \</span><br><span class="line">  ls ${FLANNEL_ETCD_PREFIX}/subnets</span><br><span class="line">2017-07-07 10:36:32.737215 I | warning: ignoring ServerName for user-provided CA for backwards compatibility is deprecated</span><br><span class="line">/kubernetes/network/subnets/172.30.15.0-24</span><br><span class="line">/kubernetes/network/subnets/172.30.18.0-24</span><br><span class="line">/kubernetes/network/subnets/172.30.98.0-24</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x4FEE;&#x6539;Docker&#x53C2;&#x6570;-&#x6240;&#x6709;&#x8282;&#x70B9;&#x4FEE;&#x6539;&#x4E00;&#x4E0B;&#xFF0C;&#x4F5C;&#x4E3A;&#x6D4B;&#x8BD5;"><a href="#&#x4FEE;&#x6539;Docker&#x53C2;&#x6570;-&#x6240;&#x6709;&#x8282;&#x70B9;&#x4FEE;&#x6539;&#x4E00;&#x4E0B;&#xFF0C;&#x4F5C;&#x4E3A;&#x6D4B;&#x8BD5;" class="headerlink" title="&#x4FEE;&#x6539;Docker&#x53C2;&#x6570;[&#x6240;&#x6709;&#x8282;&#x70B9;&#x4FEE;&#x6539;&#x4E00;&#x4E0B;&#xFF0C;&#x4F5C;&#x4E3A;&#x6D4B;&#x8BD5;]"></a>&#x4FEE;&#x6539;Docker&#x53C2;&#x6570;[&#x6240;&#x6709;&#x8282;&#x70B9;&#x4FEE;&#x6539;&#x4E00;&#x4E0B;&#xFF0C;&#x4F5C;&#x4E3A;&#x6D4B;&#x8BD5;]</h2><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># &#x8981;&#x50CF;&#x4F7F;docker&#x4F7F;&#x7528;flannel&#x7684;&#x7F51;&#x7EDC;&#x4F20;&#x9012;&#x6570;&#x636E;&#xFF0C;&#x8981;&#x4FEE;&#x6539;&#x4E00;&#x4E9B;&#x542F;&#x52A8;&#x53C2;&#x6570;</span><br><span class="line"><span class="keyword">cd</span> /<span class="keyword">opt</span>/flannel/</span><br><span class="line"><span class="keyword">mk</span>-docker-opts.<span class="keyword">sh</span> -i</span><br><span class="line"># &#x901A;&#x8FC7;<span class="keyword">mk</span>-docker-opts.<span class="keyword">sh</span> --<span class="keyword">help</span>&#x53EF;&#x4E00;&#x76F4;&#x5230;&#x8FD9;&#x4E2A;&#x811A;&#x672C;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E9B;docker&#x53C2;&#x6570;&#xFF0C;&#x653E;&#x5230;/run/docker_opts.env&#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5C06;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#xFF0C;&#x52A0;&#x5165;&#x5230;docker&#x7684;&#x542F;&#x52A8;&#x53C2;&#x6570;</span><br><span class="line"><span class="keyword">cat</span> /etc/sysconfig/docker | <span class="keyword">grep</span> OPT</span><br><span class="line">OPTIONS=<span class="string">&apos;--selinux-enabled --bip=172.17.71.1/24 --ip-masq=true --mtu=1450&apos;</span></span><br></pre></td></tr></tbody></table></figure><p>&#x5F53;&#x524D;&#x4E09;&#x4E2A;&#x8282;&#x70B9;&#x5206;&#x914D;&#x7684; Pod &#x7F51;&#x6BB5;&#x5206;&#x522B;&#x662F;&#xFF1A;172.30.71.0-24&#x3001;172.30.36.0-24&#x3001;172.30.99.0-24&#x3002;</p><p>&#x5728;&#x5404;&#x8282;&#x70B9;&#x4E0A;&#x5206;&#x914D; ping &#x8FD9;&#x4E09;&#x4E2A;&#x7F51;&#x6BB5;&#x7684;&#x7F51;&#x5173;&#x5730;&#x5740;&#xFF0C;&#x786E;&#x4FDD;&#x80FD;&#x901A;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ping 172.30.71.1</span><br><span class="line">$ ping 172.30.36.1</span><br><span class="line">$ ping 172.30.98.1</span><br></pre></td></tr></tbody></table></figure><h1 id="6-&#x90E8;&#x7F72;-master-&#x8282;&#x70B9;"><a href="#6-&#x90E8;&#x7F72;-master-&#x8282;&#x70B9;" class="headerlink" title="6.&#x90E8;&#x7F72; master &#x8282;&#x70B9;"></a>6.&#x90E8;&#x7F72; master &#x8282;&#x70B9;</h1><p>kubernetes master &#x8282;&#x70B9;&#x5305;&#x542B;&#x7684;&#x7EC4;&#x4EF6;&#xFF1A;</p><ul><li>kube-apiserver</li><li>kube-scheduler</li><li>kube-controller-manager</li></ul><p>&#x76EE;&#x524D;&#x8FD9;&#x4E09;&#x4E2A;&#x7EC4;&#x4EF6;&#x9700;&#x8981;&#x90E8;&#x7F72;&#x5728;&#x540C;&#x4E00;&#x53F0;&#x673A;&#x5668;&#x4E0A;&#xFF1A;</p><ul><li><code>kube-scheduler</code>&#x3001;<code>kube-controller-manager</code> &#x548C; <code>kube-apiserver</code> &#x4E09;&#x8005;&#x7684;&#x529F;&#x80FD;&#x7D27;&#x5BC6;&#x76F8;&#x5173;&#xFF1B;</li><li>&#x540C;&#x65F6;&#x53EA;&#x80FD;&#x6709;&#x4E00;&#x4E2A; <code>kube-scheduler</code>&#x3001;<code>kube-controller-manager</code> &#x8FDB;&#x7A0B;&#x5904;&#x4E8E;&#x5DE5;&#x4F5C;&#x72B6;&#x6001;&#xFF0C;&#x5982;&#x679C;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x9009;&#x4E3E;&#x4EA7;&#x751F;&#x4E00;&#x4E2A; leader&#xFF1B;</li></ul><p>&#x672C;&#x6587;&#x6863;&#x4ECB;&#x7ECD;&#x90E8;&#x7F72;&#x5355;&#x673A; kubernetes master &#x8282;&#x70B9;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;<strong>&#x6CA1;&#x6709;&#x5B9E;&#x73B0;&#x9AD8;&#x53EF;&#x7528; master &#x96C6;&#x7FA4;</strong>&#x3002;</p><p>&#x8BA1;&#x5212;&#x540E;&#x7EED;&#x518D;&#x4ECB;&#x7ECD;&#x90E8;&#x7F72; LB &#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF; (kubectl&#x3001;kubelet&#x3001;kube-proxy) &#x4F7F;&#x7528; LB &#x7684; VIP &#x6765;&#x8BBF;&#x95EE; kube-apiserver&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x9AD8;&#x53EF;&#x7528; master &#x96C6;&#x7FA4;&#x3002;</p><p>master &#x8282;&#x70B9;&#x4E0E; node &#x8282;&#x70B9;&#x4E0A;&#x7684; Pods &#x901A;&#x8FC7; Pod &#x7F51;&#x7EDC;&#x901A;&#x4FE1;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5728; master &#x8282;&#x70B9;&#x4E0A;&#x90E8;&#x7F72; Flannel &#x7F51;&#x7EDC;&#x3002;</p><h2 id="&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;-1"><a href="#&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;-1" class="headerlink" title="&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;"></a>&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;</h2><p>&#x672C;&#x6587;&#x6863;&#x7528;&#x5230;&#x7684;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export MASTER_IP=192.168.77.201  # &#x66FF;&#x6362;&#x4E3A;&#x5F53;&#x524D;&#x90E8;&#x7F72;&#x7684; master &#x673A;&#x5668; IP</span><br><span class="line"># &#x5BFC;&#x5165;&#x7528;&#x5230;&#x7684;&#x5176;&#x5B83;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF1A;SERVICE_CIDR&#x3001;CLUSTER_CIDR&#x3001;NODE_PORT_RANGE&#x3001;ETCD_ENDPOINTS&#x3001;BOOTSTRAP_TOKEN</span><br><span class="line">source /root/local/bin/environment.sh</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7248;&#x672C;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;"><a href="#&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7248;&#x672C;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;" class="headerlink" title="&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7248;&#x672C;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;"></a>&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7248;&#x672C;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;</h2><p>&#x6709;&#x4E24;&#x79CD;&#x4E0B;&#x8F7D;&#x65B9;&#x5F0F;&#xFF1A;</p><p>1.&#x4ECE; <a href="https://github.com/kubernetes/kubernetes/releases" target="_blank" rel="noopener">github release &#x9875;&#x9762;</a> &#x4E0B;&#x8F7D;&#x53D1;&#x5E03;&#x7248; tarball&#xFF0C;&#x89E3;&#x538B;&#x540E;&#x518D;&#x6267;&#x884C;&#x4E0B;&#x8F7D;&#x811A;&#x672C;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/kubernetes/kubernetes/releases/download/v1.6.2/kubernetes.tar.gz</span><br><span class="line">tar -xzvf kubernetes.tar.gz</span><br><span class="line">...</span><br><span class="line">cd kubernetes</span><br><span class="line">./cluster/get-kube-binaries.sh</span><br></pre></td></tr></tbody></table></figure><p>2.&#x4ECE; <a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG.md" target="_blank" rel="noopener"><code>CHANGELOG</code>&#x9875;&#x9762;</a> &#x4E0B;&#x8F7D; <code>client</code> &#x6216; <code>server</code> tarball &#x6587;&#x4EF6;<br><code>server</code> &#x7684; tarball <code>kubernetes-server-linux-amd64.tar.gz</code> &#x5DF2;&#x7ECF;&#x5305;&#x542B;&#x4E86; <code>client</code>(<code>kubectl</code>) &#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x7528;&#x5355;&#x72EC;&#x4E0B;&#x8F7D;<code>kubernetes-client-linux-amd64.tar.gz</code>&#x6587;&#x4EF6;&#xFF1B;<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># wget https://dl.k8s.io/v1.6.2/kubernetes-client-linux-amd64.tar.gz</span><br><span class="line">wget https://dl.k8s.io/v1.6.2/kubernetes-server-linux-amd64.tar.gz</span><br><span class="line">tar -xzvf kubernetes-server-linux-amd64.tar.gz</span><br><span class="line">...</span><br><span class="line">cd kubernetes</span><br><span class="line">tar -xzvf  kubernetes-src.tar.gz</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5C06;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#x62F7;&#x8D1D;&#x5230;&#x6307;&#x5B9A;&#x8DEF;&#x5F84;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -r server/bin/{kube-apiserver,kube-controller-manager,kube-scheduler,kubectl,kube-proxy,kubelet} /root/local/bin/</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;-flanneld-1"><a href="#&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E;-flanneld-1" class="headerlink" title="&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E; flanneld"></a>&#x5B89;&#x88C5;&#x548C;&#x914D;&#x7F6E; flanneld</h2><p>&#x53C2;&#x8003; <a href="https://github.com/opsnull/follow-me-install-kubernetes-cluster/blob/master/05-%E9%83%A8%E7%BD%B2Flannel%E7%BD%91%E7%BB%9C.md" target="_blank" rel="noopener">05-&#x90E8;&#x7F72;Flannel&#x7F51;&#x7EDC;.md</a></p><h2 id="&#x521B;&#x5EFA;-kubernetes-&#x8BC1;&#x4E66;"><a href="#&#x521B;&#x5EFA;-kubernetes-&#x8BC1;&#x4E66;" class="headerlink" title="&#x521B;&#x5EFA; kubernetes &#x8BC1;&#x4E66;"></a>&#x521B;&#x5EFA; kubernetes &#x8BC1;&#x4E66;</h2><p>&#x521B;&#x5EFA; kubernetes &#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">vim kubernetes-csr.json </span><br><span class="line">{</span><br><span class="line"> &quot;CN&quot;: &quot;kubernetes&quot;,</span><br><span class="line"> &quot;hosts&quot;: [</span><br><span class="line"> &quot;127.0.0.1&quot;,</span><br><span class="line"> &quot;192.168.77.201&quot;,</span><br><span class="line"> &quot;10.254.0.1&quot;,</span><br><span class="line"> &quot;kubernetes&quot;,</span><br><span class="line"> &quot;kubernetes.default&quot;,</span><br><span class="line"> &quot;kubernetes.default.svc&quot;,</span><br><span class="line"> &quot;kubernetes.default.svc.cluster&quot;,</span><br><span class="line"> &quot;kubernetes.default.svc.cluster.local&quot;</span><br><span class="line"> ],</span><br><span class="line"> &quot;key&quot;: {</span><br><span class="line"> &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line"> &quot;size&quot;: 2048</span><br><span class="line"> },</span><br><span class="line"> &quot;names&quot;: [</span><br><span class="line"> {</span><br><span class="line"> &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line"> &quot;ST&quot;: &quot;BeiJing&quot;,</span><br><span class="line"> &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line"> &quot;O&quot;: &quot;k8s&quot;,</span><br><span class="line"> &quot;OU&quot;: &quot;System&quot;</span><br><span class="line"> }</span><br><span class="line"> ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li><p>&#x5982;&#x679C; hosts &#x5B57;&#x6BB5;&#x4E0D;&#x4E3A;&#x7A7A;&#x5219;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x6388;&#x6743;&#x4F7F;&#x7528;&#x8BE5;&#x8BC1;&#x4E66;&#x7684; <strong>IP &#x6216;&#x57DF;&#x540D;&#x5217;&#x8868;</strong>&#xFF0C;&#x6240;&#x4EE5;&#x4E0A;&#x9762;&#x5206;&#x522B;&#x6307;&#x5B9A;&#x4E86;&#x5F53;&#x524D;&#x90E8;&#x7F72;&#x7684; master &#x8282;&#x70B9;&#x4E3B;&#x673A; IP&#xFF1B;</p></li><li><p>&#x8FD8;&#x9700;&#x8981;&#x6DFB;&#x52A0; kube-apiserver &#x6CE8;&#x518C;&#x7684;&#x540D;&#x4E3A; <code>kubernetes</code> &#x7684;&#x670D;&#x52A1; IP (Service Cluster IP)&#xFF0C;&#x4E00;&#x822C;&#x662F; kube-apiserver <code>--service-cluster-ip-range</code> &#x9009;&#x9879;&#x503C;&#x6307;&#x5B9A;&#x7684;&#x7F51;&#x6BB5;&#x7684;<strong>&#x7B2C;&#x4E00;&#x4E2A;IP</strong>&#xFF0C;&#x5982; &#x201C;10.254.0.1&#x201D;&#xFF1B;</p></li></ul><p>&#x751F;&#x6210; kubernetes &#x8BC1;&#x4E66;&#x548C;&#x79C1;&#x94A5;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert -ca=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  -ca-key=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="line">  -config=/etc/kubernetes/ssl/ca-config.json \</span><br><span class="line">  -profile=kubernetes kubernetes-csr.json | cfssljson -bare kubernetes</span><br><span class="line">ls kubernetes*</span><br><span class="line">kubernetes.csr  kubernetes-csr.json  kubernetes-key.pem  kubernetes.pem</span><br><span class="line">mkdir -p /etc/kubernetes/ssl/</span><br><span class="line">cp kubernetes*.pem /etc/kubernetes/ssl/</span><br><span class="line">$ rm kubernetes.csr  kubernetes-csr.json</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x914D;&#x7F6E;&#x548C;&#x542F;&#x52A8;-kube-apiserver"><a href="#&#x914D;&#x7F6E;&#x548C;&#x542F;&#x52A8;-kube-apiserver" class="headerlink" title="&#x914D;&#x7F6E;&#x548C;&#x542F;&#x52A8; kube-apiserver"></a>&#x914D;&#x7F6E;&#x548C;&#x542F;&#x52A8; kube-apiserver</h2><h3 id="&#x521B;&#x5EFA;-kube-apiserver-&#x4F7F;&#x7528;&#x7684;&#x5BA2;&#x6237;&#x7AEF;-token-&#x6587;&#x4EF6;"><a href="#&#x521B;&#x5EFA;-kube-apiserver-&#x4F7F;&#x7528;&#x7684;&#x5BA2;&#x6237;&#x7AEF;-token-&#x6587;&#x4EF6;" class="headerlink" title="&#x521B;&#x5EFA; kube-apiserver &#x4F7F;&#x7528;&#x7684;&#x5BA2;&#x6237;&#x7AEF; token &#x6587;&#x4EF6;"></a>&#x521B;&#x5EFA; kube-apiserver &#x4F7F;&#x7528;&#x7684;&#x5BA2;&#x6237;&#x7AEF; token &#x6587;&#x4EF6;</h3><p>kubelet <strong>&#x9996;&#x6B21;&#x542F;&#x52A8;</strong>&#x65F6;&#x5411; kube-apiserver &#x53D1;&#x9001; TLS Bootstrapping &#x8BF7;&#x6C42;&#xFF0C;kube-apiserver &#x9A8C;&#x8BC1; kubelet &#x8BF7;&#x6C42;&#x4E2D;&#x7684; token &#x662F;&#x5426;&#x4E0E;&#x5B83;&#x914D;&#x7F6E;&#x7684; token.csv &#x4E00;&#x81F4;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x81F4;&#x5219;&#x81EA;&#x52A8;&#x4E3A; kubelet&#x751F;&#x6210;&#x8BC1;&#x4E66;&#x548C;&#x79D8;&#x94A5;&#x3002;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># &#x5BFC;&#x5165;&#x7684; environment.sh &#x6587;&#x4EF6;&#x5B9A;&#x4E49;&#x4E86; BOOTSTRAP_TOKEN &#x53D8;&#x91CF;</span><br><span class="line">vim token.csv </span><br><span class="line">${BOOTSTRAP_TOKEN},kubelet-bootstrap,10001,&quot;system:kubelet-bootstrap&quot;</span><br><span class="line">cp token.csv /etc/kubernetes/</span><br></pre></td></tr></tbody></table></figure><h3 id="&#x521B;&#x5EFA;-kube-apiserver-&#x7684;-systemd-unit-&#x6587;&#x4EF6;"><a href="#&#x521B;&#x5EFA;-kube-apiserver-&#x7684;-systemd-unit-&#x6587;&#x4EF6;" class="headerlink" title="&#x521B;&#x5EFA; kube-apiserver &#x7684; systemd unit &#x6587;&#x4EF6;"></a>&#x521B;&#x5EFA; kube-apiserver &#x7684; systemd unit &#x6587;&#x4EF6;</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">vim  kube-apiserver.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes API Server</span><br><span class="line">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">ExecStart=/root/local/bin/kube-apiserver \</span><br><span class="line">  --admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota \</span><br><span class="line">  --advertise-address=192.168.77.201 \</span><br><span class="line">  --allow-privileged=true \</span><br><span class="line">  --apiserver-count=3 \</span><br><span class="line">  --audit-log-maxage=30 \</span><br><span class="line">  --audit-log-maxbackup=3 \</span><br><span class="line">  --audit-log-maxsize=100 \</span><br><span class="line">  --audit-log-path=/var/lib/audit.log \</span><br><span class="line">  --authorization-mode=RBAC \</span><br><span class="line">  --bind-address=192.168.77.201 \</span><br><span class="line">  --client-ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --enable-swagger-ui=true \</span><br><span class="line">  --etcd-cafile=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --etcd-certfile=/etc/kubernetes/ssl/kubernetes.pem \</span><br><span class="line">  --etcd-keyfile=/etc/kubernetes/ssl/kubernetes-key.pem \</span><br><span class="line">  --etcd-servers=https://192.168.77.201:2379,https://192.168.77.202:2379,https://192.168.77.203:2379 \</span><br><span class="line">  --event-ttl=1h \</span><br><span class="line">  --kubelet-https=true \</span><br><span class="line">  --insecure-bind-address=192.168.77.201 \</span><br><span class="line">  --runtime-config=rbac.authorization.k8s.io/v1alpha1 \</span><br><span class="line">  --service-account-key-file=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="line">  --service-cluster-ip-range=10.254.0.0/16 \</span><br><span class="line">  --service-node-port-range=8400-9000 \</span><br><span class="line">  --tls-cert-file=/etc/kubernetes/ssl/kubernetes.pem \</span><br><span class="line">  --tls-private-key-file=/etc/kubernetes/ssl/kubernetes-key.pem \</span><br><span class="line">  --experimental-bootstrap-token-auth \</span><br><span class="line">  --token-auth-file=/etc/kubernetes/token.csv \</span><br><span class="line">  --v=2</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5</span><br><span class="line">Type=notify</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure><ul><li>kube-apiserver 1.6 &#x7248;&#x672C;&#x5F00;&#x59CB;&#x4F7F;&#x7528; etcd v3 API &#x548C;&#x5B58;&#x50A8;&#x683C;&#x5F0F;&#xFF1B;</li><li><code>--authorization-mode=RBAC</code> &#x6307;&#x5B9A;&#x5728;&#x5B89;&#x5168;&#x7AEF;&#x53E3;&#x4F7F;&#x7528; RBAC &#x6388;&#x6743;&#x6A21;&#x5F0F;&#xFF0C;&#x62D2;&#x7EDD;&#x672A;&#x901A;&#x8FC7;&#x6388;&#x6743;&#x7684;&#x8BF7;&#x6C42;&#xFF1B;</li><li>kube-scheduler&#x3001;kube-controller-manager &#x4E00;&#x822C;&#x548C; kube-apiserver &#x90E8;&#x7F72;&#x5728;&#x540C;&#x4E00;&#x53F0;&#x673A;&#x5668;&#x4E0A;&#xFF0C;&#x5B83;&#x4EEC;&#x4F7F;&#x7528;<strong>&#x975E;&#x5B89;&#x5168;&#x7AEF;&#x53E3;</strong>&#x548C; kube-apiserver&#x901A;&#x4FE1;;</li><li>kubelet&#x3001;kube-proxy&#x3001;kubectl &#x90E8;&#x7F72;&#x5728;&#x5176;&#x5B83; Node &#x8282;&#x70B9;&#x4E0A;&#xFF0C;&#x5982;&#x679C;&#x901A;&#x8FC7;<strong>&#x5B89;&#x5168;&#x7AEF;&#x53E3;</strong>&#x8BBF;&#x95EE; kube-apiserver&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x5148;&#x901A;&#x8FC7; TLS &#x8BC1;&#x4E66;&#x8BA4;&#x8BC1;&#xFF0C;&#x518D;&#x901A;&#x8FC7; RBAC &#x6388;&#x6743;&#xFF1B;</li><li>kube-proxy&#x3001;kubectl &#x901A;&#x8FC7;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x8BC1;&#x4E66;&#x91CC;&#x6307;&#x5B9A;&#x76F8;&#x5173;&#x7684; User&#x3001;Group &#x6765;&#x8FBE;&#x5230;&#x901A;&#x8FC7; RBAC &#x6388;&#x6743;&#x7684;&#x76EE;&#x7684;&#xFF1B;</li><li>&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E86; kubelet TLS Boostrap &#x673A;&#x5236;&#xFF0C;&#x5219;&#x4E0D;&#x80FD;&#x518D;&#x6307;&#x5B9A; <code>--kubelet-certificate-authority</code>&#x3001;<code>--kubelet-client-certificate</code> &#x548C; <code>--kubelet-client-key</code> &#x9009;&#x9879;&#xFF0C;&#x5426;&#x5219;&#x540E;&#x7EED; kube-apiserver &#x6821;&#x9A8C; kubelet &#x8BC1;&#x4E66;&#x65F6;&#x51FA;&#x73B0; &#x201D;x509: certificate signed by unknown authority&#x201C; &#x9519;&#x8BEF;&#xFF1B;</li><li><code>--admission-control</code> &#x503C;&#x5FC5;&#x987B;&#x5305;&#x542B; <code>ServiceAccount</code>&#xFF0C;&#x5426;&#x5219;&#x90E8;&#x7F72;&#x96C6;&#x7FA4;&#x63D2;&#x4EF6;&#x65F6;&#x4F1A;&#x5931;&#x8D25;&#xFF1B;</li><li><code>--bind-address</code> &#x4E0D;&#x80FD;&#x4E3A; <code>127.0.0.1</code>&#xFF1B;</li><li><code>--service-cluster-ip-range</code> &#x6307;&#x5B9A; Service Cluster IP &#x5730;&#x5740;&#x6BB5;&#xFF0C;&#x8BE5;&#x5730;&#x5740;&#x6BB5;&#x4E0D;&#x80FD;&#x8DEF;&#x7531;&#x53EF;&#x8FBE;&#xFF1B;</li><li><code>--service-node-port-range=${NODE_PORT_RANGE}</code> &#x6307;&#x5B9A; NodePort &#x7684;&#x7AEF;&#x53E3;&#x8303;&#x56F4;&#xFF1B;</li><li>&#x7F3A;&#x7701;&#x60C5;&#x51B5;&#x4E0B; kubernetes &#x5BF9;&#x8C61;&#x4FDD;&#x5B58;&#x5728; etcd <code>/registry</code> &#x8DEF;&#x5F84;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7; <code>--etcd-prefix</code> &#x53C2;&#x6570;&#x8FDB;&#x884C;&#x8C03;&#x6574;&#xFF1B;</li></ul><p>&#x5B8C;&#x6574; unit &#x89C1; <a href="https://github.com/opsnull/follow-me-install-kubernetes-cluster/blob/master/systemd/kube-apiserver.service" target="_blank" rel="noopener">kube-apiserver.service</a></p><h3 id="&#x542F;&#x52A8;-kube-apiserver"><a href="#&#x542F;&#x52A8;-kube-apiserver" class="headerlink" title="&#x542F;&#x52A8; kube-apiserver"></a>&#x542F;&#x52A8; kube-apiserver</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp kube-apiserver.service /lib/systemd/system/</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable kube-apiserver</span><br><span class="line">systemctl start kube-apiserver</span><br><span class="line">systemctl status kube-apiserver</span><br></pre></td></tr></tbody></table></figure><h3 id="&#x9A8C;&#x8BC1;"><a href="#&#x9A8C;&#x8BC1;" class="headerlink" title="&#x9A8C;&#x8BC1;"></a>&#x9A8C;&#x8BC1;</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc kubernetes</span><br><span class="line">NAME         CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes   10.254.0.1           443/TCP   1d</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x914D;&#x7F6E;&#x548C;&#x542F;&#x52A8;-kube-controller-manager"><a href="#&#x914D;&#x7F6E;&#x548C;&#x542F;&#x52A8;-kube-controller-manager" class="headerlink" title="&#x914D;&#x7F6E;&#x548C;&#x542F;&#x52A8; kube-controller-manager"></a>&#x914D;&#x7F6E;&#x548C;&#x542F;&#x52A8; kube-controller-manager</h2><h3 id="&#x521B;&#x5EFA;-kube-controller-manager-&#x7684;-systemd-unit-&#x6587;&#x4EF6;"><a href="#&#x521B;&#x5EFA;-kube-controller-manager-&#x7684;-systemd-unit-&#x6587;&#x4EF6;" class="headerlink" title="&#x521B;&#x5EFA; kube-controller-manager &#x7684; systemd unit &#x6587;&#x4EF6;"></a>&#x521B;&#x5EFA; kube-controller-manager &#x7684; systemd unit &#x6587;&#x4EF6;</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">vim  kube-controller-manager.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Controller Manager</span><br><span class="line">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/root/local/bin/kube-controller-manager \</span><br><span class="line">  --address=127.0.0.1 \</span><br><span class="line">  --allocate-node-cidrs=true \</span><br><span class="line">  --cluster-cidr=172.30.0.0/16 \</span><br><span class="line">  --cluster-name=kubernetes \</span><br><span class="line">  --cluster-signing-cert-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --cluster-signing-key-file=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="line">  --leader-elect=true \</span><br><span class="line">  --master=http://192.168.77.201:8080 \</span><br><span class="line">  --root-ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --service-account-private-key-file=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="line">  --service-cluster-ip-range=10.254.0.0/16 \</span><br><span class="line">  --v=2</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure><p><code>--address</code> &#x503C;&#x5FC5;&#x987B;&#x4E3A; <code>127.0.0.1</code>&#xFF0C;&#x56E0;&#x4E3A;&#x5F53;&#x524D; kube-apiserver &#x671F;&#x671B; scheduler &#x548C; controller-manager &#x5728;&#x540C;&#x4E00;&#x53F0;&#x673A;&#x5668;&#xFF0C;&#x5426;&#x5219;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get componentstatuses</span><br><span class="line">NAME                 STATUS      MESSAGE                                                                                        ERROR</span><br><span class="line">controller-manager   Unhealthy   Get http://127.0.0.1:10252/healthz: dial tcp 127.0.0.1:10252: getsockopt: connection refused</span><br><span class="line">scheduler            Unhealthy   Get http://127.0.0.1:10251/healthz: dial tcp 127.0.0.1:10251: getsockopt: connection refused</span><br></pre></td></tr></tbody></table></figure><p>&#x53C2;&#x8003;&#xFF1A;<a href="https://github.com/kubernetes-incubator/bootkube/issues/64" target="_blank" rel="noopener">https://github.com/kubernetes-incubator/bootkube/issues/64</a></p><ul><li><p><code>--master=http://{MASTER_IP}:8080</code>&#xFF1A;&#x4F7F;&#x7528;&#x975E;&#x5B89;&#x5168; 8080 &#x7AEF;&#x53E3;&#x4E0E; kube-apiserver &#x901A;&#x4FE1;&#xFF1B;</p></li><li><p><code>--cluster-cidr</code> &#x6307;&#x5B9A; Cluster &#x4E2D; Pod &#x7684; CIDR &#x8303;&#x56F4;&#xFF0C;&#x8BE5;&#x7F51;&#x6BB5;&#x5728;&#x5404; Node &#x95F4;&#x5FC5;&#x987B;&#x8DEF;&#x7531;&#x53EF;&#x8FBE;(flanneld&#x4FDD;&#x8BC1;)&#xFF1B;</p></li><li><p><code>--service-cluster-ip-range</code> &#x53C2;&#x6570;&#x6307;&#x5B9A; Cluster &#x4E2D; Service &#x7684;CIDR&#x8303;&#x56F4;&#xFF0C;&#x8BE5;&#x7F51;&#x7EDC;&#x5728;&#x5404; Node &#x95F4;&#x5FC5;&#x987B;&#x8DEF;&#x7531;&#x4E0D;&#x53EF;&#x8FBE;&#xFF0C;&#x5FC5;&#x987B;&#x548C; kube-apiserver &#x4E2D;&#x7684;&#x53C2;&#x6570;&#x4E00;&#x81F4;&#xFF1B;</p></li><li><p><code>--cluster-signing-*</code> &#x6307;&#x5B9A;&#x7684;&#x8BC1;&#x4E66;&#x548C;&#x79C1;&#x94A5;&#x6587;&#x4EF6;&#x7528;&#x6765;&#x7B7E;&#x540D;&#x4E3A; TLS BootStrap &#x521B;&#x5EFA;&#x7684;&#x8BC1;&#x4E66;&#x548C;&#x79C1;&#x94A5;&#xFF1B;</p></li><li><p><code>--root-ca-file</code> &#x7528;&#x6765;&#x5BF9; kube-apiserver &#x8BC1;&#x4E66;&#x8FDB;&#x884C;&#x6821;&#x9A8C;&#xFF0C;<strong>&#x6307;&#x5B9A;&#x8BE5;&#x53C2;&#x6570;&#x540E;&#xFF0C;&#x624D;&#x4F1A;&#x5728;Pod &#x5BB9;&#x5668;&#x7684; ServiceAccount &#x4E2D;&#x653E;&#x7F6E;&#x8BE5; CA &#x8BC1;&#x4E66;&#x6587;&#x4EF6;</strong>&#xFF1B;</p></li><li><p><code>--leader-elect=true</code> &#x90E8;&#x7F72;&#x591A;&#x53F0;&#x673A;&#x5668;&#x7EC4;&#x6210;&#x7684; master &#x96C6;&#x7FA4;&#x65F6;&#x9009;&#x4E3E;&#x4EA7;&#x751F;&#x4E00;&#x5904;&#x4E8E;&#x5DE5;&#x4F5C;&#x72B6;&#x6001;&#x7684; <code>kube-controller-manager</code> &#x8FDB;&#x7A0B;&#xFF1B;</p></li></ul><p>&#x5B8C;&#x6574; unit &#x89C1; <a href="https://github.com/opsnull/follow-me-install-kubernetes-cluster/blob/master/systemd/kube-controller-manager.service" target="_blank" rel="noopener">kube-controller-manager.service</a></p><h3 id="&#x542F;&#x52A8;-kube-controller-manager"><a href="#&#x542F;&#x52A8;-kube-controller-manager" class="headerlink" title="&#x542F;&#x52A8; kube-controller-manager"></a>&#x542F;&#x52A8; kube-controller-manager</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp kube-controller-manager.service /etc/systemd/system/</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable kube-controller-manager</span><br><span class="line">systemctl start kube-controller-manager</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x914D;&#x7F6E;&#x548C;&#x542F;&#x52A8;-kube-scheduler"><a href="#&#x914D;&#x7F6E;&#x548C;&#x542F;&#x52A8;-kube-scheduler" class="headerlink" title="&#x914D;&#x7F6E;&#x548C;&#x542F;&#x52A8; kube-scheduler"></a>&#x914D;&#x7F6E;&#x548C;&#x542F;&#x52A8; kube-scheduler</h2><h3 id="&#x521B;&#x5EFA;-kube-scheduler-&#x7684;-systemd-unit-&#x6587;&#x4EF6;"><a href="#&#x521B;&#x5EFA;-kube-scheduler-&#x7684;-systemd-unit-&#x6587;&#x4EF6;" class="headerlink" title="&#x521B;&#x5EFA; kube-scheduler &#x7684; systemd unit &#x6587;&#x4EF6;"></a>&#x521B;&#x5EFA; kube-scheduler &#x7684; systemd unit &#x6587;&#x4EF6;</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim kube-scheduler.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Scheduler</span><br><span class="line">Documentation=https://github.com/GoogleCloudPlatform/kubernetes</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/root/local/bin/kube-scheduler \</span><br><span class="line">  --leader-elect=true \</span><br><span class="line">  --master=http://192.168.77.201:8080 \</span><br><span class="line">  --address=127.0.0.1 \</span><br><span class="line">  --v=2</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure><ul><li><code>--address</code> &#x503C;&#x5FC5;&#x987B;&#x4E3A; <code>127.0.0.1</code>&#xFF0C;&#x56E0;&#x4E3A;&#x5F53;&#x524D; kube-apiserver &#x671F;&#x671B; scheduler &#x548C; controller-manager &#x5728;&#x540C;&#x4E00;&#x53F0;&#x673A;&#x5668;&#xFF1B;</li><li><code>--master=http://{MASTER_IP}:8080</code>&#xFF1A;&#x4F7F;&#x7528;&#x975E;&#x5B89;&#x5168; 8080 &#x7AEF;&#x53E3;&#x4E0E; kube-apiserver &#x901A;&#x4FE1;&#xFF1B;</li><li><code>--leader-elect=true</code> &#x90E8;&#x7F72;&#x591A;&#x53F0;&#x673A;&#x5668;&#x7EC4;&#x6210;&#x7684; master &#x96C6;&#x7FA4;&#x65F6;&#x9009;&#x4E3E;&#x4EA7;&#x751F;&#x4E00;&#x5904;&#x4E8E;&#x5DE5;&#x4F5C;&#x72B6;&#x6001;&#x7684; <code>kube-controller-manager</code> &#x8FDB;&#x7A0B;&#xFF1B;</li></ul><p>&#x5B8C;&#x6574; unit &#x89C1; <a href="https://github.com/opsnull/follow-me-install-kubernetes-cluster/blob/master/systemd/kube-scheduler.service" target="_blank" rel="noopener">kube-scheduler.service</a>&#x3002;</p><h3 id="&#x542F;&#x52A8;-kube-scheduler"><a href="#&#x542F;&#x52A8;-kube-scheduler" class="headerlink" title="&#x542F;&#x52A8; kube-scheduler"></a>&#x542F;&#x52A8; kube-scheduler</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp kube-scheduler.service /etc/systemd/system/</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable kube-scheduler</span><br><span class="line">systemctl start kube-scheduler</span><br></pre></td></tr></tbody></table></figure><h3 id="&#x9A8C;&#x8BC1;-master-&#x8282;&#x70B9;&#x529F;&#x80FD;"><a href="#&#x9A8C;&#x8BC1;-master-&#x8282;&#x70B9;&#x529F;&#x80FD;" class="headerlink" title="&#x9A8C;&#x8BC1; master &#x8282;&#x70B9;&#x529F;&#x80FD;"></a>&#x9A8C;&#x8BC1; master &#x8282;&#x70B9;&#x529F;&#x80FD;</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubectl get componentstatuses</span><br><span class="line">NAME                 STATUS    MESSAGE              ERROR</span><br><span class="line">controller-manager   Healthy   ok</span><br><span class="line">scheduler            Healthy   ok</span><br><span class="line">etcd-0               Healthy   {&quot;health&quot;: &quot;true&quot;}</span><br><span class="line">etcd-1               Healthy   {&quot;health&quot;: &quot;true&quot;}</span><br><span class="line">etcd-2               Healthy   {&quot;health&quot;: &quot;true&quot;}</span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;kubernetes 集群（二）&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>部署 kubernetes 集群 （一）</title>
    <link href="https://wolf-7.github.io/uncategorized/2017/01/22/%E9%83%A8%E7%BD%B2-kubernetes-%E9%9B%86%E7%BE%A4-%EF%BC%88%E4%B8%80%EF%BC%89.html"/>
    <id>https://wolf-7.github.io/uncategorized/2017/01/22/部署-kubernetes-集群-（一）.html</id>
    <published>2017-01-22T07:50:37.000Z</published>
    <updated>2019-01-24T08:30:07.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>kubernetes &#x96C6;&#x7FA4;&#xFF08;&#x4E00;&#xFF09;</p><a id="more"></a><h1 id="1-&#x7EC4;&#x4EF6;&#x7248;&#x672C;&#x548C;&#x96C6;&#x7FA4;&#x73AF;&#x5883;"><a href="#1-&#x7EC4;&#x4EF6;&#x7248;&#x672C;&#x548C;&#x96C6;&#x7FA4;&#x73AF;&#x5883;" class="headerlink" title="1.&#x7EC4;&#x4EF6;&#x7248;&#x672C;&#x548C;&#x96C6;&#x7FA4;&#x73AF;&#x5883;"></a>1.&#x7EC4;&#x4EF6;&#x7248;&#x672C;&#x548C;&#x96C6;&#x7FA4;&#x73AF;&#x5883;</h1><h2 id="&#x96C6;&#x7FA4;&#x7EC4;&#x4EF6;&#x548C;&#x7248;&#x672C;"><a href="#&#x96C6;&#x7FA4;&#x7EC4;&#x4EF6;&#x548C;&#x7248;&#x672C;" class="headerlink" title="&#x96C6;&#x7FA4;&#x7EC4;&#x4EF6;&#x548C;&#x7248;&#x672C;"></a>&#x96C6;&#x7FA4;&#x7EC4;&#x4EF6;&#x548C;&#x7248;&#x672C;</h2><ul><li>Kubernetes 1.6.2</li><li>Docker 17.06.0-ce</li><li>Etcd 3.1.6</li><li>Flanneld 0.7.1 vxlan &#x7F51;&#x7EDC;</li><li>TLS &#x8BA4;&#x8BC1;&#x901A;&#x4FE1; (&#x6240;&#x6709;&#x7EC4;&#x4EF6;&#xFF0C;&#x5982; etcd&#x3001;kubernetes master &#x548C; node)</li><li>RBAC &#x6388;&#x6743;</li><li>kubelet TLS BootStrapping</li><li>kubedns&#x3001;dashboard&#x3001;heapster (influxdb&#x3001;grafana)&#x3001;EFK (elasticsearch&#x3001;fluentd&#x3001;kibana) &#x63D2;&#x4EF6;</li><li>&#x79C1;&#x6709; docker registry&#xFF0C;&#x4F7F;&#x7528; ceph rgw &#x540E;&#x7AEF;&#x5B58;&#x50A8;&#xFF0C;TLS + HTTP Basic &#x8BA4;&#x8BC1;</li></ul><h2 id="&#x96C6;&#x7FA4;&#x673A;&#x5668;"><a href="#&#x96C6;&#x7FA4;&#x673A;&#x5668;" class="headerlink" title="&#x96C6;&#x7FA4;&#x673A;&#x5668;"></a>&#x96C6;&#x7FA4;&#x673A;&#x5668;</h2><ul><li>192.168.77.201</li><li>192.168.77.202</li><li>192.168.77.203</li></ul><p>&#x672C;&#x7740;&#x6D4B;&#x8BD5;&#x7684;&#x76EE;&#x7684;&#xFF0C;etcd &#x96C6;&#x7FA4;&#x3001;kubernetes master &#x96C6;&#x7FA4;&#x3001;kubernetes node &#x5747;&#x4F7F;&#x7528;&#x8FD9;&#x4E09;&#x53F0;&#x673A;&#x5668;&#x3002;</p><h2 id="&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x53D8;&#x91CF;"><a href="#&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x53D8;&#x91CF;" class="headerlink" title="&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x53D8;&#x91CF;"></a>&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x53D8;&#x91CF;</h2><p>&#x540E;&#x7EED;&#x7684;&#x90E8;&#x7F72;&#x6B65;&#x9AA4;&#x5C06;&#x4F7F;&#x7528;&#x4E0B;&#x9762;&#x5B9A;&#x4E49;&#x7684;&#x5168;&#x5C40;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x6839;&#x636E;<strong>&#x81EA;&#x5DF1;&#x7684;&#x673A;&#x5668;&#x3001;&#x7F51;&#x7EDC;&#x60C5;&#x51B5;</strong>&#x4FEE;&#x6539;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">NODE_NAME=etcd-host0 # &#x5F53;&#x524D;&#x90E8;&#x7F72;&#x7684;&#x673A;&#x5668;&#x540D;&#x79F0;(&#x968F;&#x4FBF;&#x5B9A;&#x4E49;&#xFF0C;&#x53EA;&#x8981;&#x80FD;&#x533A;&#x5206;&#x4E0D;&#x540C;&#x673A;&#x5668;&#x5373;&#x53EF;)</span><br><span class="line">NODE_IP=&quot;192.168.77.201&quot; # &#x5F53;&#x524D;&#x90E8;&#x7F72;&#x7684;&#x673A;&#x5668; IP</span><br><span class="line">NODE_IPS=&quot;192.168.77.201 192.168.77.202 192.168.77.203&quot; # etcd &#x96C6;&#x7FA4;&#x6240;&#x6709;&#x673A;&#x5668; IP</span><br><span class="line"># etcd &#x96C6;&#x7FA4;&#x95F4;&#x901A;&#x4FE1;&#x7684;IP&#x548C;&#x7AEF;&#x53E3;</span><br><span class="line">export ETCD_NODES=etcd-host0=https://192.168.77.201:2380,etcd-host1=192.168.77.202:2380,etcd-host2=https://192.168.77.203:2380</span><br><span class="line"></span><br><span class="line"># &#x5BFC;&#x5165;&#x7528;&#x5230;&#x7684;&#x5176;&#x5B83;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF1A;ETCD_ENDPOINTS&#x3001;FLANNEL_ETCD_PREFIX&#x3001;CLUSTER_CIDR</span><br><span class="line"># TLS Bootstrapping &#x4F7F;&#x7528;&#x7684; Token&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x547D;&#x4EE4; head -c 16 /dev/urandom | od -An -t x | tr -d &apos; &apos; &#x751F;&#x6210;</span><br><span class="line">BOOTSTRAP_TOKEN=&quot;5dedacd78457d0511e20e8b0832fc3bc&quot;</span><br><span class="line"></span><br><span class="line"># &#x5EFA;&#x8BAE;&#x7528; &#x672A;&#x7528;&#x7684;&#x7F51;&#x6BB5; &#x6765;&#x5B9A;&#x4E49;&#x670D;&#x52A1;&#x7F51;&#x6BB5;&#x548C; Pod &#x7F51;&#x6BB5;</span><br><span class="line"></span><br><span class="line"># &#x670D;&#x52A1;&#x7F51;&#x6BB5; (Service CIDR&#xFF09;&#xFF0C;&#x90E8;&#x7F72;&#x524D;&#x8DEF;&#x7531;&#x4E0D;&#x53EF;&#x8FBE;&#xFF0C;&#x90E8;&#x7F72;&#x540E;&#x96C6;&#x7FA4;&#x5185;&#x4F7F;&#x7528; IP:Port &#x53EF;&#x8FBE;</span><br><span class="line">SERVICE_CIDR=&quot;10.254.0.0/16&quot;</span><br><span class="line"></span><br><span class="line"># POD &#x7F51;&#x6BB5; (Cluster CIDR&#xFF09;&#xFF0C;&#x90E8;&#x7F72;&#x524D;&#x8DEF;&#x7531;&#x4E0D;&#x53EF;&#x8FBE;&#xFF0C;**&#x90E8;&#x7F72;&#x540E;**&#x8DEF;&#x7531;&#x53EF;&#x8FBE; (flanneld &#x4FDD;&#x8BC1;)</span><br><span class="line">CLUSTER_CIDR=&quot;172.30.0.0/16&quot;</span><br><span class="line"></span><br><span class="line"># &#x670D;&#x52A1;&#x7AEF;&#x53E3;&#x8303;&#x56F4; (NodePort Range)</span><br><span class="line">NODE_PORT_RANGE=&quot;8400-9000&quot;</span><br><span class="line"></span><br><span class="line"># etcd &#x96C6;&#x7FA4;&#x670D;&#x52A1;&#x5730;&#x5740;&#x5217;&#x8868;</span><br><span class="line">ETCD_ENDPOINTS=&quot;https://192.168.77.201:2379,https://192.168.77.202:2379,https://192.168.77.203:2379&quot;</span><br><span class="line"></span><br><span class="line"># flanneld &#x7F51;&#x7EDC;&#x914D;&#x7F6E;&#x524D;&#x7F00;</span><br><span class="line">FLANNEL_ETCD_PREFIX=&quot;/kubernetes/network&quot;</span><br><span class="line"></span><br><span class="line"># kubernetes &#x670D;&#x52A1; IP (&#x9884;&#x5206;&#x914D;&#xFF0C;&#x4E00;&#x822C;&#x662F; SERVICE_CIDR &#x4E2D;&#x7B2C;&#x4E00;&#x4E2A;IP)</span><br><span class="line">CLUSTER_KUBERNETES_SVC_IP=&quot;10.254.0.1&quot;</span><br><span class="line"></span><br><span class="line"># &#x96C6;&#x7FA4; DNS &#x670D;&#x52A1; IP (&#x4ECE; SERVICE_CIDR &#x4E2D;&#x9884;&#x5206;&#x914D;)</span><br><span class="line">CLUSTER_DNS_SVC_IP=&quot;10.254.0.2&quot;</span><br><span class="line"></span><br><span class="line"># &#x96C6;&#x7FA4; DNS &#x57DF;&#x540D;</span><br><span class="line">CLUSTER_DNS_DOMAIN=&quot;cluster.local.&quot;</span><br><span class="line"></span><br><span class="line"># &#x66FF;&#x6362;&#x4E3A; kubernetes master &#x96C6;&#x7FA4;&#x4EFB;&#x4E00;&#x673A;&#x5668; IP</span><br><span class="line">MASTER_IP=&quot;192.168.77.201&quot;</span><br><span class="line">KUBE_APISERVER=&quot;https://${MASTER_IP}:6443&quot;</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x6253;&#x5305;&#x540E;&#x7684;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x89C1; <a href="https://github.com/opsnull/follow-me-install-kubernetes-cluster/blob/master/manifests/environment.sh" target="_blank" rel="noopener">environment.sh</a>&#xFF0C;&#x540E;&#x7EED;&#x90E8;&#x7F72;&#x65F6;&#x4F1A;<strong>&#x63D0;&#x793A;&#x5BFC;&#x5165;</strong>&#x8BE5;&#x811A;&#x672C;&#xFF1B;</li></ul><h2 id="&#x5206;&#x53D1;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x811A;&#x672C;"><a href="#&#x5206;&#x53D1;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x811A;&#x672C;" class="headerlink" title="&#x5206;&#x53D1;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x811A;&#x672C;"></a>&#x5206;&#x53D1;&#x96C6;&#x7FA4;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x811A;&#x672C;</h2><p>&#x628A;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x811A;&#x672C;&#x62F7;&#x8D1D;&#x5230;<strong>&#x6240;&#x6709;</strong>&#x673A;&#x5668;&#x7684; <code>/root/local/bin</code> &#x76EE;&#x5F55;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp environment.sh /root/local/bin</span><br></pre></td></tr></tbody></table></figure><h1 id="2-&#x521B;&#x5EFA;CA&#x8BC1;&#x4E66;&#x548C;&#x79D8;&#x94A5;"><a href="#2-&#x521B;&#x5EFA;CA&#x8BC1;&#x4E66;&#x548C;&#x79D8;&#x94A5;" class="headerlink" title="2.&#x521B;&#x5EFA;CA&#x8BC1;&#x4E66;&#x548C;&#x79D8;&#x94A5;"></a>2.&#x521B;&#x5EFA;CA&#x8BC1;&#x4E66;&#x548C;&#x79D8;&#x94A5;</h1><h2 id="&#x521B;&#x5EFA;-CA-&#x8BC1;&#x4E66;&#x548C;&#x79D8;&#x94A5;"><a href="#&#x521B;&#x5EFA;-CA-&#x8BC1;&#x4E66;&#x548C;&#x79D8;&#x94A5;" class="headerlink" title="&#x521B;&#x5EFA; CA &#x8BC1;&#x4E66;&#x548C;&#x79D8;&#x94A5;"></a>&#x521B;&#x5EFA; CA &#x8BC1;&#x4E66;&#x548C;&#x79D8;&#x94A5;</h2><p><code>kubernetes</code> &#x7CFB;&#x7EDF;&#x5404;&#x7EC4;&#x4EF6;&#x9700;&#x8981;&#x4F7F;&#x7528; <code>TLS</code> &#x8BC1;&#x4E66;&#x5BF9;&#x901A;&#x4FE1;&#x8FDB;&#x884C;&#x52A0;&#x5BC6;&#xFF0C;&#x672C;&#x6587;&#x6863;&#x4F7F;&#x7528; <code>CloudFlare</code> &#x7684; PKI &#x5DE5;&#x5177;&#x96C6; <a href="https://github.com/cloudflare/cfssl" target="_blank" rel="noopener">cfssl</a> &#x6765;&#x751F;&#x6210; Certificate Authority (CA) &#x8BC1;&#x4E66;&#x548C;&#x79D8;&#x94A5;&#x6587;&#x4EF6;&#xFF0C;CA &#x662F;&#x81EA;&#x7B7E;&#x540D;&#x7684;&#x8BC1;&#x4E66;&#xFF0C;&#x7528;&#x6765;&#x7B7E;&#x540D;&#x540E;&#x7EED;&#x521B;&#x5EFA;&#x7684;&#x5176;&#x5B83; TLS &#x8BC1;&#x4E66;&#x3002;</p><h2 id="&#x5B89;&#x88C5;-CFSSL"><a href="#&#x5B89;&#x88C5;-CFSSL" class="headerlink" title="&#x5B89;&#x88C5; CFSSL"></a>&#x5B89;&#x88C5; <code>CFSSL</code></h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64</span><br><span class="line">chmod +x cfssl_linux-amd64</span><br><span class="line">sudo mv cfssl_linux-amd64 /root/local/bin/cfssl</span><br><span class="line"></span><br><span class="line">wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64</span><br><span class="line">chmod +x cfssljson_linux-amd64</span><br><span class="line">mv cfssljson_linux-amd64 /root/local/bin/cfssljson</span><br><span class="line"></span><br><span class="line">wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64</span><br><span class="line">chmod +x cfssl-certinfo_linux-amd64</span><br><span class="line">mv cfssl-certinfo_linux-amd64 /root/local/bin/cfssl-certinfo</span><br><span class="line">vim /etc/profile</span><br><span class="line">export PATH=/root/local/bin:$PATH</span><br><span class="line">mkdir ssl</span><br><span class="line">cd ssl</span><br><span class="line">cfssl print-defaults config &gt; config.json</span><br><span class="line">cfssl print-defaults csr &gt; csr.json</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x521B;&#x5EFA;-CA-Certificate-Authority"><a href="#&#x521B;&#x5EFA;-CA-Certificate-Authority" class="headerlink" title="&#x521B;&#x5EFA; CA (Certificate Authority)"></a>&#x521B;&#x5EFA; CA (Certificate Authority)</h2><p>&#x521B;&#x5EFA; CA &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">vim ca-config.json</span><br><span class="line">{</span><br><span class="line">  &quot;signing&quot;: {</span><br><span class="line">    &quot;default&quot;: {</span><br><span class="line">      &quot;expiry&quot;: &quot;8760h&quot;</span><br><span class="line">    },</span><br><span class="line">    &quot;profiles&quot;: {</span><br><span class="line">      &quot;kubernetes&quot;: {</span><br><span class="line">        &quot;usages&quot;: [</span><br><span class="line">            &quot;signing&quot;,</span><br><span class="line">            &quot;key encipherment&quot;,</span><br><span class="line">            &quot;server auth&quot;,</span><br><span class="line">            &quot;client auth&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;expiry&quot;: &quot;8760h&quot;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li><code>ca-config.json</code>&#xFF1A;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x591A;&#x4E2A; profiles&#xFF0C;&#x5206;&#x522B;&#x6307;&#x5B9A;&#x4E0D;&#x540C;&#x7684;&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#x3001;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x7B49;&#x53C2;&#x6570;&#xFF1B;&#x540E;&#x7EED;&#x5728;&#x7B7E;&#x540D;&#x8BC1;&#x4E66;&#x65F6;&#x4F7F;&#x7528;&#x67D0;&#x4E2A; profile&#xFF1B;</li><li><code>signing</code>&#xFF1A;&#x8868;&#x793A;&#x8BE5;&#x8BC1;&#x4E66;&#x53EF;&#x7528;&#x4E8E;&#x7B7E;&#x540D;&#x5176;&#x5B83;&#x8BC1;&#x4E66;&#xFF1B;&#x751F;&#x6210;&#x7684; ca.pem &#x8BC1;&#x4E66;&#x4E2D; <code>CA=TRUE</code>&#xFF1B;</li><li><code>server auth</code>&#xFF1A;&#x8868;&#x793A; client &#x53EF;&#x4EE5;&#x7528;&#x8BE5; CA &#x5BF9; server &#x63D0;&#x4F9B;&#x7684;&#x8BC1;&#x4E66;&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;&#xFF1B;</li><li><code>client auth</code>&#xFF1A;&#x8868;&#x793A; server &#x53EF;&#x4EE5;&#x7528;&#x8BE5; CA &#x5BF9; client &#x63D0;&#x4F9B;&#x7684;&#x8BC1;&#x4E66;&#x8FDB;&#x884C;&#x9A8C;&#x8BC1;&#xFF1B;</li></ul><p>&#x521B;&#x5EFA; CA &#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ cat ca-csr.json</span><br><span class="line">{</span><br><span class="line">  &quot;CN&quot;: &quot;kubernetes&quot;,</span><br><span class="line">  &quot;key&quot;: {</span><br><span class="line">    &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">    &quot;size&quot;: 2048</span><br><span class="line">  },</span><br><span class="line">  &quot;names&quot;: [</span><br><span class="line">    {</span><br><span class="line">      &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">      &quot;ST&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;O&quot;: &quot;k8s&quot;,</span><br><span class="line">      &quot;OU&quot;: &quot;System&quot;</span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x201C;CN&#x201D;&#xFF1A;<code>Common Name</code>&#xFF0C;kube-apiserver &#x4ECE;&#x8BC1;&#x4E66;&#x4E2D;&#x63D0;&#x53D6;&#x8BE5;&#x5B57;&#x6BB5;&#x4F5C;&#x4E3A;&#x8BF7;&#x6C42;&#x7684;&#x7528;&#x6237;&#x540D; (User Name)&#xFF1B;&#x6D4F;&#x89C8;&#x5668;&#x4F7F;&#x7528;&#x8BE5;&#x5B57;&#x6BB5;&#x9A8C;&#x8BC1;&#x7F51;&#x7AD9;&#x662F;&#x5426;&#x5408;&#x6CD5;&#xFF1B;</li><li>&#x201C;O&#x201D;&#xFF1A;<code>Organization</code>&#xFF0C;kube-apiserver &#x4ECE;&#x8BC1;&#x4E66;&#x4E2D;&#x63D0;&#x53D6;&#x8BE5;&#x5B57;&#x6BB5;&#x4F5C;&#x4E3A;&#x8BF7;&#x6C42;&#x7528;&#x6237;&#x6240;&#x5C5E;&#x7684;&#x7EC4; (Group)&#xFF1B;</li></ul><p>&#x751F;&#x6210; CA &#x8BC1;&#x4E66;&#x548C;&#x79C1;&#x94A5;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert -initca ca-csr.json | cfssljson -bare ca</span><br><span class="line">ls ca*</span><br><span class="line">ca-config.json  ca.csr  ca-csr.json  ca-key.pem  ca.pem</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x5206;&#x53D1;&#x8BC1;&#x4E66;"><a href="#&#x5206;&#x53D1;&#x8BC1;&#x4E66;" class="headerlink" title="&#x5206;&#x53D1;&#x8BC1;&#x4E66;"></a>&#x5206;&#x53D1;&#x8BC1;&#x4E66;</h2><p>&#x5C06;&#x751F;&#x6210;&#x7684; CA &#x8BC1;&#x4E66;&#x3001;&#x79D8;&#x94A5;&#x6587;&#x4EF6;&#x3001;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x62F7;&#x8D1D;&#x5230;<strong>&#x6240;&#x6709;&#x673A;&#x5668;</strong>&#x7684; <code>/etc/kubernetes/ssl</code> &#x76EE;&#x5F55;&#x4E0B;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir -p /etc/kubernetes/ssl</span><br><span class="line">$ sudo cp ca* /etc/kubernetes/ssl</span><br><span class="line">$</span><br></pre></td></tr></tbody></table></figure><p>&#x521B;&#x5EFA; kubernetes &#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;</p><figure class="highlight xquery"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ cat kubernetes-csr.json</span><br><span class="line">{</span><br><span class="line">    <span class="string">&quot;CN&quot;</span>: <span class="string">&quot;kubernetes&quot;</span>,</span><br><span class="line">    <span class="string">&quot;hosts&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;192.168.77.201&quot;</span>,</span><br><span class="line">      <span class="string">&quot;192.168.77.202&quot;</span>,</span><br><span class="line">      <span class="string">&quot;192.168.77.203&quot;</span>,</span><br><span class="line">      <span class="string">&quot;10.254.0.1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;kubernetes&quot;</span>,</span><br><span class="line">      <span class="string">&quot;kubernetes.default&quot;</span>,</span><br><span class="line">      <span class="string">&quot;kubernetes.default.svc&quot;</span>,</span><br><span class="line">      <span class="string">&quot;kubernetes.default.svc.cluster&quot;</span>,</span><br><span class="line">      <span class="string">&quot;kubernetes.default.svc.cluster.local&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;key&quot;</span>: {</span><br><span class="line">        <span class="string">&quot;algo&quot;</span>: <span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">        <span class="string">&quot;size&quot;</span>: <span class="number">2048</span></span><br><span class="line">    },</span><br><span class="line">    <span class="string">&quot;names&quot;</span>: [</span><br><span class="line">        {</span><br><span class="line">            <span class="string">&quot;C&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ST&quot;</span>: <span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">            <span class="string">&quot;L&quot;</span>: <span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">            <span class="string">&quot;O&quot;</span>: <span class="string">&quot;k8s&quot;</span>,</span><br><span class="line">            <span class="string">&quot;OU&quot;</span>: <span class="string">&quot;System&quot;</span></span><br><span class="line">        }</span><br><span class="line">    ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x5982;&#x679C; hosts &#x5B57;&#x6BB5;&#x4E0D;&#x4E3A;&#x7A7A;&#x5219;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x6388;&#x6743;&#x4F7F;&#x7528;&#x8BE5;&#x8BC1;&#x4E66;&#x7684; <strong>IP &#x6216;&#x57DF;&#x540D;&#x5217;&#x8868;</strong>&#xFF0C;&#x7531;&#x4E8E;&#x8BE5;&#x8BC1;&#x4E66;&#x540E;&#x7EED;&#x88AB; <code>etcd</code> &#x96C6;&#x7FA4;&#x548C; <code>kubernetes master</code> &#x96C6;&#x7FA4;&#x4F7F;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x4E0A;&#x9762;&#x5206;&#x522B;&#x6307;&#x5B9A;&#x4E86; <code>etcd</code> &#x96C6;&#x7FA4;&#x3001;<code>kubernetes master</code> &#x96C6;&#x7FA4;&#x7684;&#x4E3B;&#x673A; IP &#x548C; <strong><code>kubernetes</code> &#x670D;&#x52A1;&#x7684;&#x670D;&#x52A1; IP</strong>&#xFF08;&#x4E00;&#x822C;&#x662F; <code>kue-apiserver</code> &#x6307;&#x5B9A;&#x7684; <code>service-cluster-ip-range</code> &#x7F51;&#x6BB5;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;IP&#xFF0C;&#x5982; 10.254.0.1&#x3002;</li></ul><p><strong>&#x751F;&#x6210; kubernetes &#x8BC1;&#x4E66;&#x548C;&#x79C1;&#x94A5;</strong></p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cfssl gencert <span class="attribute">-ca</span>=ca.pem <span class="attribute">-ca-key</span>=ca-key.pem <span class="attribute">-config</span>=ca-config.json <span class="attribute">-profile</span>=kubernetes kubernetes-csr.json | cfssljson -bare kubernetes</span><br><span class="line">$ ls kubernetes*</span><br><span class="line">kubernetes.csr  kubernetes-csr.json  kubernetes-key.pem  kubernetes.pem</span><br></pre></td></tr></tbody></table></figure><p>&#x6216;&#x8005;&#x76F4;&#x63A5;&#x5728;&#x547D;&#x4EE4;&#x884C;&#x4E0A;&#x6307;&#x5B9A;&#x76F8;&#x5173;&#x53C2;&#x6570;&#xFF1A;</p><figure class="highlight stata"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ echo &apos;{<span class="string">&quot;CN&quot;</span>:<span class="string">&quot;kubernetes&quot;</span>,<span class="string">&quot;hosts&quot;</span>:[<span class="string">&quot;&quot;</span>],<span class="string">&quot;key&quot;</span>:{<span class="string">&quot;algo&quot;</span>:<span class="string">&quot;rsa&quot;</span>,<span class="string">&quot;size&quot;</span>:2048}}&apos; | cfssl gencert -<span class="keyword">ca</span>=<span class="keyword">ca</span>.pem -<span class="keyword">ca</span>-key=<span class="keyword">ca</span>-key.pem -config=<span class="keyword">ca</span>-config.json -profile=kubernetes -hostname=<span class="string">&quot;127.0.0.1,192.168.77.201,192.168.77.202,192.168.77.203,10.254.0.1,kubernetes,kubernetes.default&quot;</span> - | cfssljson -bare kubernetes</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x521B;&#x5EFA;-Admin-&#x8BC1;&#x4E66;"><a href="#&#x521B;&#x5EFA;-Admin-&#x8BC1;&#x4E66;" class="headerlink" title="&#x521B;&#x5EFA; Admin &#x8BC1;&#x4E66;"></a>&#x521B;&#x5EFA; Admin &#x8BC1;&#x4E66;</h2><p>&#x521B;&#x5EFA; admin &#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;</p><figure class="highlight xquery"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vim admin-csr.json</span><br><span class="line">{</span><br><span class="line">  <span class="string">&quot;CN&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">  <span class="string">&quot;hosts&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;key&quot;</span>: {</span><br><span class="line">    <span class="string">&quot;algo&quot;</span>: <span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;size&quot;</span>: <span class="number">2048</span></span><br><span class="line">  },</span><br><span class="line">  <span class="string">&quot;names&quot;</span>: [</span><br><span class="line">    {</span><br><span class="line">      <span class="string">&quot;C&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">      <span class="string">&quot;ST&quot;</span>: <span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">      <span class="string">&quot;L&quot;</span>: <span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">      <span class="string">&quot;O&quot;</span>: <span class="string">&quot;system:masters&quot;</span>,</span><br><span class="line">      <span class="string">&quot;OU&quot;</span>: <span class="string">&quot;System&quot;</span></span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x540E;&#x7EED; <code>kube-apiserver</code> &#x4F7F;&#x7528; <code>RBAC</code> &#x5BF9;&#x5BA2;&#x6237;&#x7AEF;(&#x5982; <code>kubelet</code>&#x3001;<code>kube-proxy</code>&#x3001;<code>Pod</code>)&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x6388;&#x6743;&#xFF1B;</li><li><code>kube-apiserver</code> &#x9884;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E9B; <code>RBAC</code> &#x4F7F;&#x7528;&#x7684; <code>RoleBindings</code>&#xFF0C;&#x5982; <code>cluster-admin</code> &#x5C06; Group<code>system:masters</code> &#x4E0E; Role <code>cluster-admin</code> &#x7ED1;&#x5B9A;&#xFF0C;&#x8BE5; Role &#x6388;&#x4E88;&#x4E86;&#x8C03;&#x7528;<code>kube-apiserver</code> &#x7684;<strong>&#x6240;&#x6709; API</strong>&#x7684;&#x6743;&#x9650;&#xFF1B;</li><li>OU &#x6307;&#x5B9A;&#x8BE5;&#x8BC1;&#x4E66;&#x7684; Group &#x4E3A; <code>system:masters</code>&#xFF0C;<code>kubelet</code> &#x4F7F;&#x7528;&#x8BE5;&#x8BC1;&#x4E66;&#x8BBF;&#x95EE; <code>kube-apiserver</code>&#x65F6; &#xFF0C;&#x7531;&#x4E8E;&#x8BC1;&#x4E66;&#x88AB; CA &#x7B7E;&#x540D;&#xFF0C;&#x6240;&#x4EE5;&#x8BA4;&#x8BC1;&#x901A;&#x8FC7;&#xFF0C;&#x540C;&#x65F6;&#x7531;&#x4E8E;&#x8BC1;&#x4E66;&#x7528;&#x6237;&#x7EC4;&#x4E3A;&#x7ECF;&#x8FC7;&#x9884;&#x6388;&#x6743;&#x7684;<code>system:masters</code>&#xFF0C;&#x6240;&#x4EE5;&#x88AB;&#x6388;&#x4E88;&#x8BBF;&#x95EE;&#x6240;&#x6709; API &#x7684;&#x6743;&#x9650;&#xFF1B;</li></ul><p>&#x751F;&#x6210; admin &#x8BC1;&#x4E66;&#x548C;&#x79C1;&#x94A5;</p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert <span class="attribute">-ca</span>=ca.pem <span class="attribute">-ca-key</span>=ca-key.pem <span class="attribute">-config</span>=ca-config.json <span class="attribute">-profile</span>=kubernetes admin-csr.json | cfssljson -bare admin</span><br><span class="line">ls admin*</span><br><span class="line">admin.csr  admin-csr.json  admin-key.pem  admin.pem</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x521B;&#x5EFA;-Kube-Proxy-&#x8BC1;&#x4E66;"><a href="#&#x521B;&#x5EFA;-Kube-Proxy-&#x8BC1;&#x4E66;" class="headerlink" title="&#x521B;&#x5EFA; Kube-Proxy &#x8BC1;&#x4E66;"></a>&#x521B;&#x5EFA; Kube-Proxy &#x8BC1;&#x4E66;</h2><p>&#x521B;&#x5EFA; kube-proxy &#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;</p><figure class="highlight xquery"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vim kube-proxy-csr.json</span><br><span class="line">{</span><br><span class="line">  <span class="string">&quot;CN&quot;</span>: <span class="string">&quot;system:kube-proxy&quot;</span>,</span><br><span class="line">  <span class="string">&quot;hosts&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;key&quot;</span>: {</span><br><span class="line">    <span class="string">&quot;algo&quot;</span>: <span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;size&quot;</span>: <span class="number">2048</span></span><br><span class="line">  },</span><br><span class="line">  <span class="string">&quot;names&quot;</span>: [</span><br><span class="line">    {</span><br><span class="line">      <span class="string">&quot;C&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">      <span class="string">&quot;ST&quot;</span>: <span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">      <span class="string">&quot;L&quot;</span>: <span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">      <span class="string">&quot;O&quot;</span>: <span class="string">&quot;k8s&quot;</span>,</span><br><span class="line">      <span class="string">&quot;OU&quot;</span>: <span class="string">&quot;System&quot;</span></span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>CN &#x6307;&#x5B9A;&#x8BE5;&#x8BC1;&#x4E66;&#x7684; User &#x4E3A; <code>system:kube-proxy</code>&#xFF1B;</li><li><code>kube-apiserver</code> &#x9884;&#x5B9A;&#x4E49;&#x7684; RoleBinding <code>cluster-admin</code> &#x5C06;User <code>system:kube-proxy</code> &#x4E0E; Role<code>system:node-proxier</code> &#x7ED1;&#x5B9A;&#xFF0C;&#x8BE5; Role &#x6388;&#x4E88;&#x4E86;&#x8C03;&#x7528; <code>kube-apiserver</code> Proxy &#x76F8;&#x5173; API &#x7684;&#x6743;&#x9650;&#xFF1B;</li></ul><p>&#x751F;&#x6210; kube-proxy &#x5BA2;&#x6237;&#x7AEF;&#x8BC1;&#x4E66;&#x548C;&#x79C1;&#x94A5;</p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert <span class="attribute">-ca</span>=ca.pem <span class="attribute">-ca-key</span>=ca-key.pem <span class="attribute">-config</span>=ca-config.json <span class="attribute">-profile</span>=kubernetes  kube-proxy-csr.json | cfssljson -bare kube-proxy</span><br><span class="line">ls kube-proxy*</span><br><span class="line">kube-proxy.csr  kube-proxy-csr.json  kube-proxy-key.pem  kube-proxy.pem</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x6821;&#x9A8C;&#x8BC1;&#x4E66;"><a href="#&#x6821;&#x9A8C;&#x8BC1;&#x4E66;" class="headerlink" title="&#x6821;&#x9A8C;&#x8BC1;&#x4E66;"></a>&#x6821;&#x9A8C;&#x8BC1;&#x4E66;</h2><p>&#x4EE5; kubernetes &#x8BC1;&#x4E66;&#x4E3A;&#x4F8B;</p><h3 id="&#x4F7F;&#x7528;-Opsnssl-&#x547D;&#x4EE4;"><a href="#&#x4F7F;&#x7528;-Opsnssl-&#x547D;&#x4EE4;" class="headerlink" title="&#x4F7F;&#x7528; Opsnssl &#x547D;&#x4EE4;"></a>&#x4F7F;&#x7528; <code>Opsnssl</code> &#x547D;&#x4EE4;</h3><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">openssl x509  -noout -text -in  kubernetes.pem</span><br><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">        Version: 3 (0x2)</span><br><span class="line">        Serial Number:</span><br><span class="line">            cc:f1:04:70:82:fb:9e:80:38:8d:9e:2a:a2:d6:c1:1d:b5:85:0a</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">        Issuer: <span class="attribute">C</span>=CN, <span class="attribute">ST</span>=BeiJing, <span class="attribute">L</span>=BeiJing, <span class="attribute">O</span>=k8s, <span class="attribute">OU</span>=System, <span class="attribute">CN</span>=kubernetes</span><br><span class="line">        Validity</span><br><span class="line">            <span class="keyword">Not</span> Before: Jul  6 03:05:00 2017 GMT</span><br><span class="line">            <span class="keyword">Not</span> After : Jul  6 03:05:00 2018 GMT</span><br><span class="line">        Subject: <span class="attribute">C</span>=CN, <span class="attribute">ST</span>=BeiJing, <span class="attribute">L</span>=BeiJing, <span class="attribute">O</span>=k8s, <span class="attribute">OU</span>=System, <span class="attribute">CN</span>=kubernetes</span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: rsaEncryption</span><br><span class="line">                Public-Key: (2048 bit)</span><br><span class="line">                Modulus:</span><br><span class="line"><span class="built_in">..</span>.</span><br><span class="line">                Exponent: 65537 (0x10001)</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Key Usage: critical</span><br><span class="line">                Digital Signature, Key Encipherment</span><br><span class="line">            X509v3 Extended Key Usage:</span><br><span class="line">                TLS Web<span class="built_in"> Server </span>Authentication, TLS Web<span class="built_in"> Client </span>Authentication</span><br><span class="line">            X509v3 Basic Constraints: critical</span><br><span class="line">                CA:FALSE</span><br><span class="line">            X509v3 Subject Key Identifier:</span><br><span class="line">                B3:F3:E3:4C:AD:86:FD:FE:5D:B5:E1:26:94:D3:E2:4C:AE:50:5B:C3</span><br><span class="line">            X509v3 Authority Key Identifier:</span><br><span class="line">                keyid:5D:A9:C1:8C:C3:1D:58:A8:6C:7B:C9:08:1D:3F:09:D3:CA:2B:F8:92</span><br><span class="line"></span><br><span class="line">            X509v3 Subject Alternative Name:</span><br><span class="line">                DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster, DNS:kubernetes.default.svc.cluster.local,<span class="built_in"> IP </span>Address:127.0.0.1,<span class="built_in"> IP </span>Address:192.168.77.201,<span class="built_in"> IP </span>Address:192.168.77.202,<span class="built_in"> IP </span>Address:192.168.77.203,<span class="built_in"> IP </span>Address:10.254.0.1</span><br><span class="line"><span class="built_in">..</span>.</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x786E;&#x8BA4; <code>Issuer</code> &#x5B57;&#x6BB5;&#x7684;&#x5185;&#x5BB9;&#x548C; <code>ca-csr.json</code> &#x4E00;&#x81F4;&#xFF1B;</li><li>&#x786E;&#x8BA4; <code>Subject</code> &#x5B57;&#x6BB5;&#x7684;&#x5185;&#x5BB9;&#x548C; <code>kubernetes-csr.json</code> &#x4E00;&#x81F4;&#xFF1B;</li><li>&#x786E;&#x8BA4; <code>X509v3 Subject Alternative Name</code> &#x5B57;&#x6BB5;&#x7684;&#x5185;&#x5BB9;&#x548C; <code>kubernetes-csr.json</code> &#x4E00;&#x81F4;&#xFF1B;</li><li>&#x786E;&#x8BA4; <code>X509v3 Key Usage&#x3001;Extended Key Usage</code> &#x5B57;&#x6BB5;&#x7684;&#x5185;&#x5BB9;&#x548C; <code>ca-config.json</code> &#x4E2D; <code>kubernetes</code>profile &#x4E00;&#x81F4;</li></ul><h3 id="&#x4F7F;&#x7528;-Cfssl-Certinfo-&#x547D;&#x4EE4;"><a href="#&#x4F7F;&#x7528;-Cfssl-Certinfo-&#x547D;&#x4EE4;" class="headerlink" title="&#x4F7F;&#x7528; Cfssl-Certinfo &#x547D;&#x4EE4;"></a>&#x4F7F;&#x7528; <code>Cfssl-Certinfo</code> &#x547D;&#x4EE4;</h3><figure class="highlight prolog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">cfssl-certinfo -cert kubernetes.pem</span><br><span class="line">...</span><br><span class="line">{</span><br><span class="line">  <span class="string">&quot;subject&quot;</span>: {</span><br><span class="line">    <span class="string">&quot;common_name&quot;</span>: <span class="string">&quot;kubernetes&quot;</span>,</span><br><span class="line">    <span class="string">&quot;country&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">    <span class="string">&quot;organization&quot;</span>: <span class="string">&quot;k8s&quot;</span>,</span><br><span class="line">    <span class="string">&quot;organizational_unit&quot;</span>: <span class="string">&quot;System&quot;</span>,</span><br><span class="line">    <span class="string">&quot;locality&quot;</span>: <span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">    <span class="string">&quot;province&quot;</span>: <span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">    <span class="string">&quot;names&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">      <span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">      <span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">      <span class="string">&quot;k8s&quot;</span>,</span><br><span class="line">      <span class="string">&quot;System&quot;</span>,</span><br><span class="line">      <span class="string">&quot;kubernetes&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  },</span><br><span class="line">  <span class="string">&quot;issuer&quot;</span>: {</span><br><span class="line">    <span class="string">&quot;common_name&quot;</span>: <span class="string">&quot;kubernetes&quot;</span>,</span><br><span class="line">    <span class="string">&quot;country&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">    <span class="string">&quot;organization&quot;</span>: <span class="string">&quot;k8s&quot;</span>,</span><br><span class="line">    <span class="string">&quot;organizational_unit&quot;</span>: <span class="string">&quot;System&quot;</span>,</span><br><span class="line">    <span class="string">&quot;locality&quot;</span>: <span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">    <span class="string">&quot;province&quot;</span>: <span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">    <span class="string">&quot;names&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">      <span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">      <span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">      <span class="string">&quot;k8s&quot;</span>,</span><br><span class="line">      <span class="string">&quot;System&quot;</span>,</span><br><span class="line">      <span class="string">&quot;kubernetes&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  },</span><br><span class="line">  <span class="string">&quot;serial_number&quot;</span>: <span class="string">&quot;4570347592092906586131725795238401977456362762&quot;</span>,</span><br><span class="line">  <span class="string">&quot;sans&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;kubernetes&quot;</span>,</span><br><span class="line">    <span class="string">&quot;kubernetes.default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;kubernetes.default.svc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;kubernetes.default.svc.cluster&quot;</span>,</span><br><span class="line">    <span class="string">&quot;kubernetes.default.svc.cluster.local&quot;</span>,</span><br><span class="line">    <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;192.168.77.201&quot;</span>,</span><br><span class="line">    <span class="string">&quot;192.168.77.202&quot;</span>,</span><br><span class="line">    <span class="string">&quot;192.168.77.203&quot;</span>,</span><br><span class="line">    <span class="string">&quot;10.254.0.1&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;not_before&quot;</span>: <span class="string">&quot;2017-07-06T03:05:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;not_after&quot;</span>: <span class="string">&quot;2018-07-06T03:05:00Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;sigalg&quot;</span>: <span class="string">&quot;SHA256WithRSA&quot;</span>,</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x5206;&#x53D1;&#x8BC1;&#x4E66;-1"><a href="#&#x5206;&#x53D1;&#x8BC1;&#x4E66;-1" class="headerlink" title="&#x5206;&#x53D1;&#x8BC1;&#x4E66;"></a>&#x5206;&#x53D1;&#x8BC1;&#x4E66;</h2><p>&#x5C06;&#x751F;&#x6210;&#x7684;&#x8BC1;&#x4E66;&#x548C;&#x79D8;&#x94A5;&#x6587;&#x4EF6;&#xFF08;&#x540E;&#x7F00;&#x540D;&#x4E3A;<code>.pem</code>&#xFF09;&#x62F7;&#x8D1D;&#x5230;&#x6240;&#x6709;&#x673A;&#x5668;&#x7684; <code>/etc/kubernetes/ssl</code> &#x76EE;&#x5F55;&#x4E0B;&#x5907;&#x7528;&#xFF1B;</p><figure class="highlight elixir"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/kubernetes/ssl</span><br><span class="line">cp *.pem /etc/kubernetes/ssl</span><br><span class="line">scp *.pem root<span class="variable">@node2</span><span class="symbol">:/etc/kubernetes/ssl</span></span><br><span class="line">scp *.pem root<span class="variable">@node3</span><span class="symbol">:/etc/kubernetes/ssl</span></span><br></pre></td></tr></tbody></table></figure><h1 id="3-&#x90E8;&#x7F72;&#x9AD8;&#x53EF;&#x7528;-etcd-&#x96C6;&#x7FA4;"><a href="#3-&#x90E8;&#x7F72;&#x9AD8;&#x53EF;&#x7528;-etcd-&#x96C6;&#x7FA4;" class="headerlink" title="3.&#x90E8;&#x7F72;&#x9AD8;&#x53EF;&#x7528; etcd &#x96C6;&#x7FA4;"></a>3.&#x90E8;&#x7F72;&#x9AD8;&#x53EF;&#x7528; etcd &#x96C6;&#x7FA4;</h1><p>kuberntes &#x7CFB;&#x7EDF;&#x4F7F;&#x7528; etcd &#x5B58;&#x50A8;&#x6240;&#x6709;&#x6570;&#x636E;&#xFF0C;&#x672C;&#x6587;&#x6863;&#x4ECB;&#x7ECD;&#x90E8;&#x7F72;&#x4E00;&#x4E2A;&#x4E09;&#x8282;&#x70B9;&#x9AD8;&#x53EF;&#x7528; etcd &#x96C6;&#x7FA4;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x8FD9;&#x4E09;&#x4E2A;&#x8282;&#x70B9;&#x590D;&#x7528; kubernetes master &#x673A;&#x5668;&#xFF0C;&#x5206;&#x522B;&#x547D;&#x540D;&#x4E3A;<code>etcd-host0</code>&#x3001;<code>etcd-host1</code>&#x3001;<code>etcd-host2</code>&#xFF1A;</p><ul><li>etcd-host0&#xFF1A;192.168.77.201</li><li>etcd-host1&#xFF1A;192.168.77.201</li><li>etcd-host2&#xFF1A;192.168.77.201</li></ul><h2 id="&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;"><a href="#&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;" class="headerlink" title="&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;"></a>&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;</h2><p>&#x672C;&#x6587;&#x6863;&#x7528;&#x5230;&#x7684;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export NODE_NAME=etcd-host0 # &#x5F53;&#x524D;&#x90E8;&#x7F72;&#x7684;&#x673A;&#x5668;&#x540D;&#x79F0;(&#x968F;&#x4FBF;&#x5B9A;&#x4E49;&#xFF0C;&#x53EA;&#x8981;&#x80FD;&#x533A;&#x5206;&#x4E0D;&#x540C;&#x673A;&#x5668;&#x5373;&#x53EF;)</span><br><span class="line">export NODE_IP=192.168.77.201 # &#x5F53;&#x524D;&#x90E8;&#x7F72;&#x7684;&#x673A;&#x5668; IP</span><br><span class="line">export NODE_IPS=&quot;192.168.77.201 192.168.77.202 192.168.77.203&quot; # etcd &#x96C6;&#x7FA4;&#x6240;&#x6709;&#x673A;&#x5668; IP</span><br><span class="line">export ETCD_NODES=etcd-host0=https://192.168.77.201:2380,etcd-host1=https://192.168.77.202:2380,etcd-host2=https://192.168.77.203:2380 #etcd &#x96C6;&#x7FA4;&#x95F4;&#x901A;&#x4FE1;&#x7684;IP&#x548C;&#x7AEF;&#x53E3;</span><br><span class="line">export ETCDCTL_API=3 #flannel&#x6682;&#x65F6;&#x4E0D;&#x652F;&#x6301;etcd3</span><br><span class="line">source /root/local/bin/environment.sh #&#x5BFC;&#x5165;&#x7528;&#x5230;&#x7684;&#x5176;&#x5B83;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF1A;ETCD_ENDPOINTS&#x3001;FLANNEL_ETCD_PREFIX&#x3001;CLUSTER_CIDR</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x4E0B;&#x8F7D;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;"><a href="#&#x4E0B;&#x8F7D;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;" class="headerlink" title="&#x4E0B;&#x8F7D;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;"></a>&#x4E0B;&#x8F7D;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;</h2><p>&#x5230; <code>https://github.com/coreos/etcd/releases</code> &#x9875;&#x9762;&#x4E0B;&#x8F7D;&#x6700;&#x65B0;&#x7248;&#x672C;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#x6587;&#x4EF6;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/coreos/etcd/releases/download/v3.1.6/etcd-v3.1.6-linux-amd64.tar.gz</span><br><span class="line">tar -xvf etcd-v3.1.6-linux-amd64.tar.gz</span><br><span class="line">sudo mv etcd-v3.1.6-linux-amd64/etcd* /root/local/bin</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x521B;&#x5EFA;-TLS-&#x79D8;&#x94A5;&#x548C;&#x8BC1;&#x4E66;"><a href="#&#x521B;&#x5EFA;-TLS-&#x79D8;&#x94A5;&#x548C;&#x8BC1;&#x4E66;" class="headerlink" title="&#x521B;&#x5EFA; TLS &#x79D8;&#x94A5;&#x548C;&#x8BC1;&#x4E66;"></a>&#x521B;&#x5EFA; TLS &#x79D8;&#x94A5;&#x548C;&#x8BC1;&#x4E66;</h2><p>&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x901A;&#x4FE1;&#x5B89;&#x5168;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;(&#x5982; etcdctl) &#x4E0E; etcd &#x96C6;&#x7FA4;&#x3001;etcd &#x96C6;&#x7FA4;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x9700;&#x8981;&#x4F7F;&#x7528; TLS &#x52A0;&#x5BC6;&#xFF0C;&#x672C;&#x8282;&#x521B;&#x5EFA; etcd TLS &#x52A0;&#x5BC6;&#x6240;&#x9700;&#x7684;&#x8BC1;&#x4E66;&#x548C;&#x79C1;&#x94A5;&#x3002;</p><p>&#x521B;&#x5EFA; etcd &#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">vim etcd-csr.json</span><br><span class="line">{</span><br><span class="line"> &quot;CN&quot;: &quot;etcd&quot;,</span><br><span class="line"> &quot;hosts&quot;: [</span><br><span class="line"> &quot;127.0.0.1&quot;,</span><br><span class="line"> &quot;192.168.77.201&quot;,</span><br><span class="line"> &quot;192.168.77.202&quot;,</span><br><span class="line"> &quot;192.168.77.203&quot;</span><br><span class="line"> ],</span><br><span class="line"> &quot;key&quot;: {</span><br><span class="line"> &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line"> &quot;size&quot;: 2048</span><br><span class="line"> },</span><br><span class="line"> &quot;names&quot;: [</span><br><span class="line"> {</span><br><span class="line"> &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line"> &quot;ST&quot;: &quot;BeiJing&quot;,</span><br><span class="line"> &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line"> &quot;O&quot;: &quot;k8s&quot;,</span><br><span class="line"> &quot;OU&quot;: &quot;System&quot;</span><br><span class="line"> }</span><br><span class="line"> ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>hosts &#x5B57;&#x6BB5;&#x6307;&#x5B9A;&#x6388;&#x6743;&#x4F7F;&#x7528;&#x8BE5;&#x8BC1;&#x4E66;&#x7684; etcd &#x8282;&#x70B9; IP&#xFF1B;</li></ul><p>&#x751F;&#x6210; etcd &#x8BC1;&#x4E66;&#x548C;&#x79C1;&#x94A5;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert -ca=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  -ca-key=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="line">  -config=/etc/kubernetes/ssl/ca-config.json \</span><br><span class="line">  -profile=kubernetes etcd-csr.json | cfssljson -bare etcd</span><br><span class="line">ls etcd*</span><br><span class="line">etcd.csr  etcd-csr.json  etcd-key.pem etcd.pem</span><br><span class="line">mkdir -p /etc/etcd/ssl</span><br><span class="line">cp etcd*.pem /etc/etcd/ssl</span><br><span class="line">scp etcd*.pem root@node2:/etc/etcd/ssl</span><br><span class="line">scp etcd*.pem root@node3:/etc/etcd/ssl</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x521B;&#x5EFA;-etcd-&#x7684;-systemd-unit-&#x6587;&#x4EF6;"><a href="#&#x521B;&#x5EFA;-etcd-&#x7684;-systemd-unit-&#x6587;&#x4EF6;" class="headerlink" title="&#x521B;&#x5EFA; etcd &#x7684; systemd unit &#x6587;&#x4EF6;"></a>&#x521B;&#x5EFA; etcd &#x7684; systemd unit &#x6587;&#x4EF6;</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/lib/etcd  # &#x5FC5;&#x987B;&#x5148;&#x521B;&#x5EFA;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;</span><br><span class="line">vim /lib/systemd/system/etcd.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Etcd Server</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line">Documentation=https://github.com/coreos</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">WorkingDirectory=/var/lib/etcd/</span><br><span class="line">ExecStart=/root/local/bin/etcd \</span><br><span class="line"> --name=${NODE_NAME} \</span><br><span class="line"> --cert-file=/etc/etcd/ssl/etcd.pem \</span><br><span class="line"> --key-file=/etc/etcd/ssl/etcd-key.pem \</span><br><span class="line"> --peer-cert-file=/etc/etcd/ssl/etcd.pem \</span><br><span class="line"> --peer-key-file=/etc/etcd/ssl/etcd-key.pem \</span><br><span class="line"> --trusted-ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line"> --peer-trusted-ca-file=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line"> --initial-advertise-peer-urls=https://${NODE_IP}:2380 \</span><br><span class="line"> --listen-peer-urls=https://${NODE_IP}:2380 \</span><br><span class="line"> --listen-client-urls=https://${NODE_IP}:2379,http://127.0.0.1:2379 \</span><br><span class="line"> --advertise-client-urls=https://${NODE_IP}:2379 \</span><br><span class="line"> --initial-cluster-token=etcd-cluster-0 \</span><br><span class="line"> --initial-cluster=${ETCD_NODES} \</span><br><span class="line"> --initial-cluster-state=new \</span><br><span class="line"> --data-dir=/var/lib/etcd</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure><p>&#x4E0A;&#x9762;&#x7684;&#x7684;&#x8BFB;&#x53D6;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x7684;&#x6709;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x6682;&#x65F6;&#x8FD8;&#x6CA1;&#x6709;&#x5904;&#x7406;&#x7528;&#x4EE5;&#x4E0B;&#x4F7F;&#x7528;&#x7EDD;&#x5BF9;&#x914D;&#x7F6E;&#x6CA1;&#x6709;&#x95EE;&#x9898;<br></p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line"><span class="attribute">Description</span>=Etcd Server</span><br><span class="line"><span class="attribute">After</span>=network.target</span><br><span class="line"><span class="attribute">After</span>=network-online.target</span><br><span class="line"><span class="attribute">Wants</span>=network-online.target</span><br><span class="line"><span class="attribute">Documentation</span>=https://github.com/coreos</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"><span class="attribute">Type</span>=notify</span><br><span class="line"><span class="attribute">WorkingDirectory</span>=/var/lib/etcd/</span><br><span class="line"><span class="attribute">EnvironmentFile</span>=-/etc/etcd/etcd.conf</span><br><span class="line"><span class="attribute">ExecStart</span>=/root/local/bin/etcd \</span><br><span class="line">              <span class="attribute">--name</span>=etcd-host0 \</span><br><span class="line">              <span class="attribute">--cert-file</span>=/etc/etcd/ssl/etcd.pem \</span><br><span class="line">              <span class="attribute">--key-file</span>=/etc/etcd/ssl/etcd-key.pem \</span><br><span class="line">              <span class="attribute">--peer-cert-file</span>=/etc/etcd/ssl/etcd.pem \</span><br><span class="line">              <span class="attribute">--peer-key-file</span>=/etc/etcd/ssl/etcd-key.pem \</span><br><span class="line">              <span class="attribute">--trusted-ca-file</span>=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">              <span class="attribute">--peer-trusted-ca-file</span>=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">              <span class="attribute">--initial-advertise-peer-urls</span>=https://192.168.77.201:2380 \</span><br><span class="line">              <span class="attribute">--listen-peer-urls</span>=https://192.168.77.201:2380 \</span><br><span class="line">              <span class="attribute">--listen-client-urls</span>=https://192.168.77.201:2379,http://127.0.0.1:2379 \</span><br><span class="line">              <span class="attribute">--advertise-client-urls</span>=https://192.168.77.201:2379 \</span><br><span class="line">              <span class="attribute">--initial-cluster-token</span>=etcd-cluster-0 \</span><br><span class="line">              <span class="attribute">--initial-cluster</span>=etcd-host0=https://192.168.77.201:2380,etcd-host1=https://192.168.77.202:2380,etcd-host2=https://192.168.77.203:2380 \</span><br><span class="line">              <span class="attribute">--initial-cluster-state</span>=new \</span><br><span class="line">              <span class="attribute">--data-dir</span>=/var/lib/etcd</span><br><span class="line"><span class="attribute">Restart</span>=on-failure</span><br><span class="line"><span class="attribute">RestartSec</span>=5</span><br><span class="line"><span class="attribute">LimitNOFILE</span>=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line"><span class="attribute">WantedBy</span>=multi-user.target</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E0A;&#x9762;&#x7684;etcd.service&#x9700;&#x8981;&#x590D;&#x5236;&#x5230;&#x96C6;&#x7FA4;&#x7684;2&#x53F0;node&#x8282;&#x70B9;&#xFF0C;&#x9664;&#x4E86;&#x2013;initial-cluster&#x4E0D;&#x9700;&#x8981;&#x52A8;&#xFF0C;&#x2013;name=etcd-host0&#x4FEE;&#x6539;&#x4E3A;&#x5BF9;&#x5E94;&#x7684;&#x8282;&#x70B9;&#x540D;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0D;&#x662F;hostname&#xFF0C;&#x5176;&#x4ED6;&#x53C2;&#x6570;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x6210;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;ip&#xFF1B;</p><ul><li>&#x6307;&#x5B9A; <code>etcd</code> &#x7684;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x548C;&#x6570;&#x636E;&#x76EE;&#x5F55;&#x4E3A; <code>/var/lib/etcd</code>&#xFF0C;&#x9700;&#x5728;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x524D;&#x521B;&#x5EFA;&#x8FD9;&#x4E2A;&#x76EE;&#x5F55;&#xFF1B;</li><li>&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x901A;&#x4FE1;&#x5B89;&#x5168;&#xFF0C;&#x9700;&#x8981;&#x6307;&#x5B9A; etcd &#x7684;&#x516C;&#x79C1;&#x94A5;(cert-file&#x548C;key-file)&#x3001;Peers &#x901A;&#x4FE1;&#x7684;&#x516C;&#x79C1;&#x94A5;&#x548C; CA &#x8BC1;&#x4E66;(peer-cert-file&#x3001;peer-key-file&#x3001;peer-trusted-ca-file)&#x3001;&#x5BA2;&#x6237;&#x7AEF;&#x7684;CA&#x8BC1;&#x4E66;&#xFF08;trusted-ca-file&#xFF09;&#xFF1B;</li><li><code>--initial-cluster-state</code> &#x503C;&#x4E3A; <code>new</code> &#x65F6;&#xFF0C;<code>--name</code> &#x7684;&#x53C2;&#x6570;&#x503C;&#x5FC5;&#x987B;&#x4F4D;&#x4E8E; <code>--initial-cluster</code> &#x5217;&#x8868;&#x4E2D;&#xFF1B;</li></ul><p>&#x5B8C;&#x6574; unit &#x6587;&#x4EF6;&#x89C1;&#xFF1A;<a href="https://github.com/opsnull/follow-me-install-kubernetes-cluster/blob/master/systemd/etcd.service" target="_blank" rel="noopener">etcd.service</a></p><h2 id="&#x542F;&#x52A8;-etcd-&#x670D;&#x52A1;"><a href="#&#x542F;&#x52A8;-etcd-&#x670D;&#x52A1;" class="headerlink" title="&#x542F;&#x52A8; etcd &#x670D;&#x52A1;"></a>&#x542F;&#x52A8; etcd &#x670D;&#x52A1;</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp etcd.service /etc/systemd/system/</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enable etcd</span><br><span class="line">systemctl start etcd</span><br><span class="line">systemctl status etcd</span><br></pre></td></tr></tbody></table></figure><p>&#x6700;&#x5148;&#x542F;&#x52A8;&#x7684; etcd &#x8FDB;&#x7A0B;&#x4F1A;&#x5361;&#x4F4F;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#xFF0C;&#x7B49;&#x5F85;&#x5176;&#x5B83;&#x8282;&#x70B9;&#x4E0A;&#x7684; etcd &#x8FDB;&#x7A0B;&#x52A0;&#x5165;&#x96C6;&#x7FA4;&#xFF0C;&#x4E3A;&#x6B63;&#x5E38;&#x73B0;&#x8C61;&#x3002;<br>&#x53E6;&#x5916;&#xFF0C;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x7684;&#x76F8;&#x5173;&#x53C2;&#x6570;<br>&#x5728;&#x6240;&#x6709;&#x7684; etcd &#x8282;&#x70B9;&#x91CD;&#x590D;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x76F4;&#x5230;&#x6240;&#x6709;&#x673A;&#x5668;&#x7684; etcd &#x670D;&#x52A1;&#x90FD;&#x5DF2;&#x542F;&#x52A8;&#x3002;</p><p>&#x5982;&#x679C;&#x6709;&#x9632;&#x706B;&#x5899;&#xFF0C;&#x9700;&#x8981;&#x5F00;&#x653E;2379&#xFF0C;2380<br><code>firewall-cmd --permanent --zone=public --add-port=2379/tcp</code><br><code>firewall-cmd --permanent --zone=public --add-port=2380/tcp</code></p><h2 id="&#x9A8C;&#x8BC1;&#x670D;&#x52A1;"><a href="#&#x9A8C;&#x8BC1;&#x670D;&#x52A1;" class="headerlink" title="&#x9A8C;&#x8BC1;&#x670D;&#x52A1;"></a>&#x9A8C;&#x8BC1;&#x670D;&#x52A1;</h2><p>&#x90E8;&#x7F72;&#x5B8C; etcd &#x96C6;&#x7FA4;&#x540E;&#xFF0C;&#x5728;&#x4EFB;&#x4E00; etcd &#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x4E0A;&#x6267;&#x884C;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for ip in ${NODE_IPS}; do</span><br><span class="line">  ETCDCTL_API=3 /root/local/bin/etcdctl \</span><br><span class="line">  --endpoints=https://${ip}:2379  \</span><br><span class="line">  --cacert=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --cert=/etc/etcd/ssl/etcd.pem \</span><br><span class="line">  --key=/etc/etcd/ssl/etcd-key.pem \</span><br><span class="line">  endpoint health; done</span><br></pre></td></tr></tbody></table></figure><p>&#x8FD4;&#x56DE;&#x4EE5;&#x4E0B;&#x4FE1;&#x606F;&#x5C31;&#x6210;&#x529F;&#x4E86;<br></p><figure class="highlight vim"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span>-<span class="number">07</span>-<span class="number">06</span> <span class="number">11</span>:<span class="number">49</span>:<span class="number">21.473944</span> I | warnin<span class="variable">g:</span> ignoring ServerName <span class="keyword">for</span> user-provided CA <span class="keyword">for</span> backwards compatibility <span class="keyword">is</span> deprecated</span><br><span class="line">http<span class="variable">s:</span>//<span class="number">192.168</span>.<span class="number">77.201</span>:<span class="number">2379</span> <span class="keyword">is</span> healthy: successfully committed proposa<span class="variable">l:</span> took = <span class="number">1.618919</span>ms</span><br><span class="line"><span class="number">2017</span>-<span class="number">07</span>-<span class="number">06</span> <span class="number">11</span>:<span class="number">49</span>:<span class="number">21.510179</span> I | warnin<span class="variable">g:</span> ignoring ServerName <span class="keyword">for</span> user-provided CA <span class="keyword">for</span> backwards compatibility <span class="keyword">is</span> deprecated</span><br><span class="line">http<span class="variable">s:</span>//<span class="number">192.168</span>.<span class="number">77.202</span>:<span class="number">2379</span> <span class="keyword">is</span> healthy: successfully committed proposa<span class="variable">l:</span> took = <span class="number">1.718529</span>ms</span><br><span class="line"><span class="number">2017</span>-<span class="number">07</span>-<span class="number">06</span> <span class="number">11</span>:<span class="number">49</span>:<span class="number">21.544829</span> I | warnin<span class="variable">g:</span> ignoring ServerName <span class="keyword">for</span> user-provided CA <span class="keyword">for</span> backwards compatibility <span class="keyword">is</span> deprecated</span><br><span class="line">http<span class="variable">s:</span>//<span class="number">192.168</span>.<span class="number">77.203</span>:<span class="number">2379</span> <span class="keyword">is</span> healthy: successfully committed proposa<span class="variable">l:</span> took = <span class="number">1.99899</span>ms</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E09;&#x53F0; etcd &#x7684;&#x8F93;&#x51FA;&#x5747;&#x4E3A; healthy &#x65F6;&#x8868;&#x793A;&#x96C6;&#x7FA4;&#x670D;&#x52A1;&#x6B63;&#x5E38;&#xFF08;&#x5FFD;&#x7565; warning &#x4FE1;&#x606F;&#xFF09;&#x3002;</p><h1 id="4-&#x90E8;&#x7F72;-kubectl-&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;"><a href="#4-&#x90E8;&#x7F72;-kubectl-&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;" class="headerlink" title="4.&#x90E8;&#x7F72; kubectl &#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;"></a>4.&#x90E8;&#x7F72; kubectl &#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177;</h1><p>kubectl &#x9ED8;&#x8BA4;&#x4ECE; <code>~/.kube/config</code> &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x83B7;&#x53D6;&#x8BBF;&#x95EE; kube-apiserver &#x5730;&#x5740;&#x3001;&#x8BC1;&#x4E66;&#x3001;&#x7528;&#x6237;&#x540D;&#x7B49;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x914D;&#x7F6E;&#x8BE5;&#x6587;&#x4EF6;&#xFF0C;&#x6267;&#x884C;&#x547D;&#x4EE4;&#x65F6;&#x51FA;&#x9519;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods</span><br><span class="line">The connection to the server localhost:8080 was refused - did you specify the right host or port?</span><br></pre></td></tr></tbody></table></figure><p>&#x672C;&#x6587;&#x6863;&#x4ECB;&#x7ECD;&#x4E0B;&#x8F7D;&#x548C;&#x914D;&#x7F6E; kubernetes &#x96C6;&#x7FA4;&#x547D;&#x4EE4;&#x884C;&#x5DE5;&#x5177; kubectl &#x7684;&#x6B65;&#x9AA4;&#x3002;</p><p>&#x9700;&#x8981;&#x5C06;&#x4E0B;&#x8F7D;&#x7684; kubectl &#x4E8C;&#x8FDB;&#x5236;&#x7A0B;&#x5E8F;&#x548C;&#x751F;&#x6210;&#x7684; <code>~/.kube/config</code> &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x62F7;&#x8D1D;&#x5230;<strong>&#x6240;&#x6709;&#x4F7F;&#x7528; kubectl &#x547D;&#x4EE4;&#x7684;&#x673A;&#x5668;</strong>&#x3002;</p><h2 id="&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;-1"><a href="#&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;-1" class="headerlink" title="&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;"></a>&#x4F7F;&#x7528;&#x7684;&#x53D8;&#x91CF;</h2><p>&#x672C;&#x6587;&#x6863;&#x7528;&#x5230;&#x7684;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># &#x66FF;&#x6362;&#x4E3A; kubernetes maste &#x96C6;&#x7FA4;&#x4EFB;&#x4E00;&#x673A;&#x5668; IP</span><br><span class="line">export MASTER_IP=192.168.77.201 </span><br><span class="line">export KUBE_APISERVER=&quot;https://${MASTER_IP}:6443&quot;</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x53D8;&#x91CF; KUBE_APISERVER &#x6307;&#x5B9A; kubelet &#x8BBF;&#x95EE;&#x7684; kube-apiserver &#x7684;&#x5730;&#x5740;&#xFF0C;&#x540E;&#x7EED;&#x88AB;&#x5199;&#x5165; <code>~/.kube/config</code> &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF1B;</li></ul><h2 id="&#x4E0B;&#x8F7D;-kubectl"><a href="#&#x4E0B;&#x8F7D;-kubectl" class="headerlink" title="&#x4E0B;&#x8F7D; kubectl"></a>&#x4E0B;&#x8F7D; kubectl</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.k8s.io/v1.6.2/kubernetes-client-linux-amd64.tar.gz</span><br><span class="line">tar -xzvf kubernetes-client-linux-amd64.tar.gz</span><br><span class="line">cp kubernetes/client/bin/kube* /root/local/bin/</span><br><span class="line">chmod a+x /root/local/bin/kube*</span><br><span class="line">export PATH=/root/local/bin:$PATH</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x521B;&#x5EFA;-admin-&#x8BC1;&#x4E66;"><a href="#&#x521B;&#x5EFA;-admin-&#x8BC1;&#x4E66;" class="headerlink" title="&#x521B;&#x5EFA;-admin-&#x8BC1;&#x4E66;"></a>&#x521B;&#x5EFA;-admin-&#x8BC1;&#x4E66;</h2><p>kubectl &#x4E0E; kube-apiserver &#x7684;&#x5B89;&#x5168;&#x7AEF;&#x53E3;&#x901A;&#x4FE1;&#xFF0C;&#x9700;&#x8981;&#x4E3A;&#x5B89;&#x5168;&#x901A;&#x4FE1;&#x63D0;&#x4F9B; TLS &#x8BC1;&#x4E66;&#x548C;&#x79D8;&#x94A5;&#x3002;</p><p>&#x521B;&#x5EFA; admin &#x8BC1;&#x4E66;&#x7B7E;&#x540D;&#x8BF7;&#x6C42;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vim admin-csr.json</span><br><span class="line">{</span><br><span class="line">  &quot;CN&quot;: &quot;admin&quot;,</span><br><span class="line">  &quot;hosts&quot;: [],</span><br><span class="line">  &quot;key&quot;: {</span><br><span class="line">    &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">    &quot;size&quot;: 2048</span><br><span class="line">  },</span><br><span class="line">  &quot;names&quot;: [</span><br><span class="line">    {</span><br><span class="line">      &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">      &quot;ST&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;O&quot;: &quot;system:masters&quot;,</span><br><span class="line">      &quot;OU&quot;: &quot;System&quot;</span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>&#x540E;&#x7EED; <code>kube-apiserver</code> &#x4F7F;&#x7528; <code>RBAC</code> &#x5BF9;&#x5BA2;&#x6237;&#x7AEF;(&#x5982; <code>kubelet</code>&#x3001;<code>kube-proxy</code>&#x3001;<code>Pod</code>)&#x8BF7;&#x6C42;&#x8FDB;&#x884C;&#x6388;&#x6743;&#xFF1B;</li><li><code>kube-apiserver</code> &#x9884;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E9B; <code>RBAC</code> &#x4F7F;&#x7528;&#x7684; <code>RoleBindings</code>&#xFF0C;&#x5982; <code>cluster-admin</code> &#x5C06; Group <code>system:masters</code> &#x4E0E; Role <code>cluster-admin</code> &#x7ED1;&#x5B9A;&#xFF0C;&#x8BE5; Role &#x6388;&#x4E88;&#x4E86;&#x8C03;&#x7528;<code>kube-apiserver</code> <strong>&#x6240;&#x6709; API</strong>&#x7684;&#x6743;&#x9650;&#xFF1B;</li><li>O &#x6307;&#x5B9A;&#x8BE5;&#x8BC1;&#x4E66;&#x7684; Group &#x4E3A; <code>system:masters</code>&#xFF0C;<code>kubelet</code> &#x4F7F;&#x7528;&#x8BE5;&#x8BC1;&#x4E66;&#x8BBF;&#x95EE; <code>kube-apiserver</code> &#x65F6; &#xFF0C;&#x7531;&#x4E8E;&#x8BC1;&#x4E66;&#x88AB; CA &#x7B7E;&#x540D;&#xFF0C;&#x6240;&#x4EE5;&#x8BA4;&#x8BC1;&#x901A;&#x8FC7;&#xFF0C;&#x540C;&#x65F6;&#x7531;&#x4E8E;&#x8BC1;&#x4E66;&#x7528;&#x6237;&#x7EC4;&#x4E3A;&#x7ECF;&#x8FC7;&#x9884;&#x6388;&#x6743;&#x7684; <code>system:masters</code>&#xFF0C;&#x6240;&#x4EE5;&#x88AB;&#x6388;&#x4E88;&#x8BBF;&#x95EE;&#x6240;&#x6709; API &#x7684;&#x6743;&#x9650;&#xFF1B;</li><li>hosts &#x5C5E;&#x6027;&#x503C;&#x4E3A;&#x7A7A;&#x5217;&#x8868;&#xFF1B;</li></ul><p>&#x751F;&#x6210; admin &#x8BC1;&#x4E66;&#x548C;&#x79C1;&#x94A5;&#xFF1A;</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert -ca=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  -ca-key=/etc/kubernetes/ssl/ca-key.pem \</span><br><span class="line">  -config=/etc/kubernetes/ssl/ca-config.json \</span><br><span class="line">  -profile=kubernetes admin-csr.json | cfssljson -bare admin</span><br><span class="line">ls admin*</span><br><span class="line">admin.csr  admin-csr.json  admin-key.pem  admin.pem</span><br><span class="line">cp admin*.pem /etc/kubernetes/ssl/</span><br><span class="line">rm admin.csr admin-csr.json</span><br></pre></td></tr></tbody></table></figure><h2 id="&#x521B;&#x5EFA;-kubectl-kubeconfig-&#x6587;&#x4EF6;"><a href="#&#x521B;&#x5EFA;-kubectl-kubeconfig-&#x6587;&#x4EF6;" class="headerlink" title="&#x521B;&#x5EFA; kubectl kubeconfig &#x6587;&#x4EF6;"></a>&#x521B;&#x5EFA; kubectl kubeconfig &#x6587;&#x4EF6;</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># &#x8BBE;&#x7F6E;&#x96C6;&#x7FA4;&#x53C2;&#x6570;</span><br><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/etc/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --server=${KUBE_APISERVER}</span><br><span class="line"># &#x8BBE;&#x7F6E;&#x5BA2;&#x6237;&#x7AEF;&#x8BA4;&#x8BC1;&#x53C2;&#x6570;</span><br><span class="line">kubectl config set-credentials admin \</span><br><span class="line">  --client-certificate=/etc/kubernetes/ssl/admin.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --client-key=/etc/kubernetes/ssl/admin-key.pem</span><br><span class="line"># &#x8BBE;&#x7F6E;&#x4E0A;&#x4E0B;&#x6587;&#x53C2;&#x6570;</span><br><span class="line">kubectl config set-context kubernetes \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=admin</span><br><span class="line"># &#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x4E0A;&#x4E0B;&#x6587;</span><br><span class="line">$ kubectl config use-context kubernetes</span><br></pre></td></tr></tbody></table></figure><ul><li><code>admin.pem</code> &#x8BC1;&#x4E66; O &#x5B57;&#x6BB5;&#x503C;&#x4E3A; <code>system:masters</code>&#xFF0C;<code>kube-apiserver</code> &#x9884;&#x5B9A;&#x4E49;&#x7684; RoleBinding <code>cluster-admin</code> &#x5C06; Group <code>system:masters</code> &#x4E0E; Role <code>cluster-admin</code> &#x7ED1;&#x5B9A;&#xFF0C;&#x8BE5; Role &#x6388;&#x4E88;&#x4E86;&#x8C03;&#x7528;<code>kube-apiserver</code> &#x76F8;&#x5173; API &#x7684;&#x6743;&#x9650;&#xFF1B;</li><li>&#x751F;&#x6210;&#x7684; kubeconfig &#x88AB;&#x4FDD;&#x5B58;&#x5230; <code>~/.kube/config</code> &#x6587;&#x4EF6;&#xFF1B;</li></ul><h2 id="&#x5206;&#x53D1;-kubeconfig-&#x6587;&#x4EF6;"><a href="#&#x5206;&#x53D1;-kubeconfig-&#x6587;&#x4EF6;" class="headerlink" title="&#x5206;&#x53D1; kubeconfig &#x6587;&#x4EF6;"></a>&#x5206;&#x53D1; kubeconfig &#x6587;&#x4EF6;</h2><p>&#x5C06; <code>~/.kube/config</code> &#x6587;&#x4EF6;&#x62F7;&#x8D1D;&#x5230;&#x8FD0;&#x884C; <code>kubelet</code> &#x547D;&#x4EE4;&#x7684;&#x673A;&#x5668;&#x7684; <code>~/.kube/</code> &#x76EE;&#x5F55;&#x4E0B;&#x3002;</p><blockquote><p>&#x5F85;&#x7EED;</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;kubernetes 集群（一）&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>如何接受一个新业务的运维工作？</title>
    <link href="https://wolf-7.github.io/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/2016/05/02/%E5%A6%82%E4%BD%95%E6%8E%A5%E5%8F%97%E4%B8%80%E4%B8%AA%E6%96%B0%E4%B8%9A%E5%8A%A1%E7%9A%84%E8%BF%90%E7%BB%B4%E5%B7%A5%E4%BD%9C.html"/>
    <id>https://wolf-7.github.io/职业规划/2016/05/02/如何接受一个新业务的运维工作.html</id>
    <published>2016-05-02T14:09:25.000Z</published>
    <updated>2019-01-16T03:26:43.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><font color="" size="3"> &#x5BF9;&#x4E11;&#x8BDD;&#x8BF4;&#x524D;&#x5934;&#xFF1A;<br>&#x5148;&#x8DDF;&#x7814;&#x53D1;leader&#x6C9F;&#x901A;&#xFF0C;&#x704C;&#x8F93;&#x8FD0;&#x7EF4;&#x7406;&#x5FF5;&#xFF0C;&#x4E11;&#x8BDD;&#x8BF4;&#x5728;&#x524D;&#x5934;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x505A;&#x4FDD;&#x59C6;&#x5F0F;&#x8FD0;&#x7EF4;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x81F4;&#x529B;&#x4E8E;&#x7EBF;&#x4E0A;&#x670D;&#x52A1;&#x5B89;&#x5168;&#x3001;&#x7A33;&#x5B9A;&#x3001;&#x4F4E;&#x6210;&#x672C;&#x3001;&#x5FEB;&#x901F;&#x8FED;&#x4EE3;&#xFF0C;&#x4ECE;&#x8FD0;&#x7EF4;&#x89C6;&#x89D2;&#x63D0;&#x9AD8;&#x4EA7;&#x54C1;&#x529B;&#x3002;&#x5F00;&#x53D1;&#x673A;&#x3001;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;&#xFF0C;&#x7814;&#x53D1;&#x81EA;&#x5DF1;&#x641E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x534F;&#x52A9;&#x5E2E;&#x5FD9;&#xFF0C;&#x505A;&#x4E13;&#x4E1A;&#x7684;&#x54A8;&#x8BE2;&#x670D;&#x52A1;&#xFF0C;&#x60F3;&#x8BA9;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x64CD;&#x5200;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#x7684;&#x53D8;&#x66F4;&#xFF0C;&#x514D;&#x8C08;&#xFF01;</font><hr><a id="more"></a><h3 id="&#x4E1A;&#x52A1;&#x6982;&#x8981;&#x4E86;&#x89E3;"><a href="#&#x4E1A;&#x52A1;&#x6982;&#x8981;&#x4E86;&#x89E3;" class="headerlink" title="&#x4E1A;&#x52A1;&#x6982;&#x8981;&#x4E86;&#x89E3;"></a>&#x4E1A;&#x52A1;&#x6982;&#x8981;&#x4E86;&#x89E3;</h3><p>&#x4E86;&#x89E3;&#x4E1A;&#x52A1;&#x76F8;&#x5173;&#x7684;&#x4EBA;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x7814;&#x53D1;&#x540C;&#x5B66;&#x3001;&#x7814;&#x53D1;leader&#x3001;&#x6D4B;&#x8BD5;&#x540C;&#x5B66;&#x3001;&#x6D4B;&#x8BD5;leader&#x3001;&#x4EA7;&#x54C1;&#x7ECF;&#x7406;&#x5206;&#x522B;&#x662F;&#x8C01;&#xFF0C;&#x8054;&#x7CFB;&#x65B9;&#x5F0F;&#x5B58;&#x4E0B;&#x6765;&#xFF0C;&#x62C9;&#x4E2A;&#x7FA4;&#xFF0C;&#x51FA;&#x4E86;&#x95EE;&#x9898;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x4EBA;&#x3002;</p><p>&#x4E86;&#x89E3;&#x670D;&#x52A1;&#x662F;&#x5E72;&#x5565;&#x7684;&#xFF0C;&#x89E3;&#x51B3;&#x4E86;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF0C;&#x4E1A;&#x754C;&#x6709;&#x5BF9;&#x6807;&#x7684;&#x5F00;&#x6E90;&#x4EA7;&#x54C1;&#x5417;&#xFF0C;&#x65B9;&#x4FBF;&#x6211;&#x4EEC;&#x5FEB;&#x901F;&#x8BA4;&#x8BC6;&#x8FD9;&#x4E2A;&#x4EA7;&#x54C1;&#x3002;</p><p>&#x4E86;&#x89E3;&#x670D;&#x52A1;&#x7684;&#x4E0A;&#x4E0B;&#x6E38;&#xFF0C;&#x4F9D;&#x8D56;&#x54EA;&#x4E9B;&#x670D;&#x52A1;&#xFF0C;&#x54EA;&#x4E9B;&#x670D;&#x52A1;&#x4F9D;&#x8D56;&#x6211;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x63A5;&#x53E3;&#x4EBA;&#x662F;&#x8C01;&#xFF0C;&#x8FD9;&#x91CC;&#x5148;&#x7B80;&#x5355;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x5373;&#x53EF;&#x3002;</p><p>&#x4E86;&#x89E3;&#x670D;&#x52A1;&#x90E8;&#x7F72;&#x60C5;&#x51B5;&#xFF0C;&#x90E8;&#x7F72;&#x5728;&#x54EA;&#x4E9B;&#x673A;&#x623F;&#xFF0C;&#x7528;&#x4EC0;&#x4E48;&#x8BED;&#x8A00;&#x7F16;&#x5199;&#x7684;&#xFF0C;&#x57FA;&#x7840;&#x7F51;&#x7EDC;&#x3001;&#x4E13;&#x7EBF;&#x5E26;&#x5BBD;&#x3001;&#x673A;&#x623F;&#x51FA;&#x53E3;&#x662F;&#x5426;&#x9760;&#x8C31;&#xFF0C;&#x662F;&#x5426;&#x66FE;&#x56E0;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x5BFC;&#x81F4;&#x8FC7;&#x95EE;&#x9898;&#xFF0C;&#x5F53;&#x524D;&#x4E3B;&#x8981;&#x75DB;&#x70B9;&#x662F;&#x4EC0;&#x4E48;&#x3002;</p><h3 id="&#x4E1A;&#x52A1;&#x4E32;&#x8BB2;"><a href="#&#x4E1A;&#x52A1;&#x4E32;&#x8BB2;" class="headerlink" title="&#x4E1A;&#x52A1;&#x4E32;&#x8BB2;"></a>&#x4E1A;&#x52A1;&#x4E32;&#x8BB2;</h3><p>&#x8981;&#x6C42;&#x7814;&#x53D1;&#x540C;&#x5B66;&#xFF08;&#x6216;&#x8005;&#x4E0A;&#x4E00;&#x4EFB;&#x8FD0;&#x7EF4;&#x540C;&#x5B66;&#xFF09;&#x51C6;&#x5907;PPT&#xFF0C;&#x505A;&#x4E00;&#x4E2A;&#x4E1A;&#x52A1;&#x4E32;&#x8BB2;&#xFF0C;&#x8BB2;&#x89E3;&#x4E00;&#x4E9B;&#x7814;&#x53D1;&#x540C;&#x5B66;&#x5E0C;&#x671B;&#x4F20;&#x8FBE;&#x7ED9;&#x8FD0;&#x7EF4;&#x540C;&#x5B66;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x8BB2;&#x89E3;&#x4E00;&#x4E9B;&#x8FD0;&#x7EF4;&#x540C;&#x5B66;&#x5E0C;&#x671B;&#x4ECE;&#x7814;&#x53D1;&#x8FD9;&#x5F97;&#x5230;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x6BD4;&#x5982;&#xFF1A;&#x8BE6;&#x7EC6;&#x90E8;&#x7F72;&#x62D3;&#x6251;&#x3001;&#x670D;&#x52A1;&#x6574;&#x4F53;&#x67B6;&#x6784;&#x3001;&#x6570;&#x636E;&#x6D41;&#x3001;&#x63D0;&#x6D4B;&#x53D8;&#x66F4;&#x6D41;&#x7A0B;&#x3001;&#x76D1;&#x63A7;&#x65B9;&#x5F0F;&#x3001;&#x90E8;&#x7F72;&#x5230;&#x4E86;&#x54EA;&#x4E9B;&#x673A;&#x5668;&#x3001;&#x673A;&#x5668;&#x767B;&#x5F55;&#x65B9;&#x5F0F;&#x3001;&#x6BCF;&#x4E2A;&#x673A;&#x5668;&#x4E0A;&#x662F;&#x4EC0;&#x4E48;&#x6A21;&#x5757;&#x3001;OS&#x53C2;&#x6570;&#x662F;&#x5426;&#x6709;&#x8C03;&#x4F18;&#xFF0C;&#x8003;&#x91CF;&#x662F;&#x4EC0;&#x4E48;&#x3001;&#x7528;&#x5230;&#x4E86;&#x54EA;&#x4E9B;&#x7B2C;&#x4E09;&#x65B9;&#x8F6F;&#x4EF6;&#xFF0C;&#x8003;&#x91CF;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x6BD4;&#x5982;&#x4E3A;&#x5565;&#x7528;&#x4E86;tomcat&#x800C;&#x4E0D;&#x662F;resin&#x3001;&#x76F8;&#x5173;wiki&#x3001;&#x6545;&#x969C;&#x5904;&#x7406;&#x9884;&#x6848;&#x3001;&#x5E38;&#x89C1;&#x6545;&#x969C;&#x3001;&#x5F53;&#x524D;&#x7EBF;&#x4E0A;&#x95EE;&#x9898;&#x2026;&#x2026;&#x7B49;&#x7B49;</p><p>&#x5982;&#x679C;&#x4E1A;&#x52A1;&#x6709;&#x5355;&#x70B9;&#xFF0C;&#x4E0D;&#x63A5;&#xFF0C;&#x8BA9;&#x7814;&#x53D1;&#x6539;&#x9020;&#x3002;&#x5982;&#x679C;&#x8FD0;&#x7EF4;&#x7684;&#x8001;&#x677F;&#x7684;&#x8001;&#x677F;&#x5F3A;&#x5236;&#x8981;&#x6C42;&#xFF0C;&#x4E11;&#x8BDD;&#x8BF4;&#x524D;&#x5934;&#xFF1A;&#x56E0;&#x5355;&#x70B9;&#x5BFC;&#x81F4;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8FD0;&#x7EF4;&#x4E0D;&#x80CC;&#x9505;&#x3002;</p><h3 id="&#x8D44;&#x4EA7;&#x68B3;&#x7406;"><a href="#&#x8D44;&#x4EA7;&#x68B3;&#x7406;" class="headerlink" title="&#x8D44;&#x4EA7;&#x68B3;&#x7406;"></a>&#x8D44;&#x4EA7;&#x68B3;&#x7406;</h3><p>&#x6B63;&#x5F0F;&#x51C6;&#x5907;&#x63A5;&#x624B;&#xFF0C;&#x7B2C;&#x4E00;&#x6B65;&#xFF0C;&#x68B3;&#x7406;&#x8D44;&#x4EA7;&#x3002;&#x6BD4;&#x5982;&#x7528;&#x5230;&#x4E86;&#x54EA;&#x4E9B;&#x57DF;&#x540D;&#xFF0C;&#x8FD9;&#x4E9B;&#x57DF;&#x540D;&#x5BF9;&#x5E94;&#x54EA;&#x4E9B;&#x4E1A;&#x52A1;&#x3001;&#x54EA;&#x4E9B;&#x865A;IP&#xFF0C;&#x5206;&#x522B;&#x662F;&#x63D0;&#x4F9B;&#x4E86;&#x4EC0;&#x4E48;&#x670D;&#x52A1;&#x3001;&#x54EA;&#x4E9B;&#x673A;&#x5668;&#xFF0C;&#x5206;&#x522B;&#x90E8;&#x7F72;&#x4E86;&#x4EC0;&#x4E48;&#x6A21;&#x5757;&#x3001;&#x4E1A;&#x52A1;&#x5728;&#x54EA;&#x4E9B;&#x673A;&#x623F;&#x3001;&#x7528;&#x4E86;&#x591A;&#x5C11;&#x5E26;&#x5BBD;&#x3001;&#x603B;&#x5E26;&#x5BBD;&#x60C5;&#x51B5;&#x3001;&#x662F;&#x5426;&#x6709;&#x5176;&#x4ED6;&#x4E1A;&#x52A1;&#x5171;&#x7528;&#x4E89;&#x62A2;&#x3002;</p><p>&#x673A;&#x5668;&#x9700;&#x8981;&#x62FF;&#x5230;&#x66F4;&#x8BE6;&#x5C3D;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x6BD4;&#x5982;&#x673A;&#x5668;&#x914D;&#x7F6E;&#x3001;&#x673A;&#x67B6;&#x4F4D;&#x3001;IP&#x3001;&#x7BA1;&#x7406;&#x5361;IP&#x7B49;&#x7B49;&#xFF0C;&#x516C;&#x53F8;&#x5E94;&#x8BE5;&#x6709;&#x4E2A;CMDB&#x4F9B;&#x67E5;&#x8BE2;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#xFF0C;&#x8FD0;&#x7EF4;&#x540C;&#x5B66;&#xFF0C;&#x9700;&#x8981;&#x4F60;&#x53BB;&#x6784;&#x5EFA;&#x8FD9;&#x4E2A;CMDB&#x3002;</p><p>&#x540E;&#x9762;&#x8981;&#x8003;&#x8651;&#x673A;&#x5668;&#x662F;&#x5426;&#x9700;&#x8981;&#x6709;&#x5907;&#x673A;&#x3001;&#x5907;&#x4EF6;&#xFF0C;&#x673A;&#x578B;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x7EDF;&#x4E00;&#x3002;</p><h3 id="&#x57FA;&#x7840;&#x76D1;&#x63A7;"><a href="#&#x57FA;&#x7840;&#x76D1;&#x63A7;" class="headerlink" title="&#x57FA;&#x7840;&#x76D1;&#x63A7;"></a>&#x57FA;&#x7840;&#x76D1;&#x63A7;</h3><p>&#x77E5;&#x9053;&#x6709;&#x54EA;&#x4E9B;&#x8D44;&#x4EA7;&#x4E86;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5BF9;&#x8FD9;&#x4E9B;&#x8D44;&#x4EA7;&#x505A;&#x76D1;&#x63A7;&#x4E86;&#xFF0C;&#x6BD4;&#x5982;&#x57DF;&#x540D;&#x8FDE;&#x901A;&#x6027;&#x76D1;&#x63A7;/&#x5EF6;&#x8FDF;&#x76D1;&#x63A7;&#x3001;&#x865A;IP&#x7684;&#x8FDE;&#x901A;&#x6027;&#x76D1;&#x63A7;/&#x5EF6;&#x8FDF;&#x76D1;&#x63A7;&#x3001;&#x673A;&#x5668;&#x5B95;&#x673A;&#x76D1;&#x63A7;&#x3001;&#x673A;&#x5668;&#x786C;&#x4EF6;&#x76D1;&#x63A7;&#x3001;sshd/crond&#x7B49;&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;&#x76D1;&#x63A7;&#x3001;&#x7CFB;&#x7EDF;&#x8FD0;&#x884C;&#x7684;&#x8FDB;&#x7A0B;&#x603B;&#x6570;&#x76D1;&#x63A7;&#x3001;&#x7CFB;&#x7EDF;&#x53C2;&#x6570;&#x914D;&#x7F6E;&#x76D1;&#x63A7;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x770B;&#x6211;&#x4E4B;&#x524D;&#x7684;&#x6587;&#x7AE0;&#x300A;&#x5B8C;&#x5907;&#x7684;&#x76D1;&#x63A7;&#x5E94;&#x8986;&#x76D6;&#x4EC0;&#x4E48;&#x300B;</p><h3 id="&#x670D;&#x52A1;&#x68B3;&#x7406;"><a href="#&#x670D;&#x52A1;&#x68B3;&#x7406;" class="headerlink" title="&#x670D;&#x52A1;&#x68B3;&#x7406;"></a>&#x670D;&#x52A1;&#x68B3;&#x7406;</h3><p>&#x5403;&#x900F;&#x4E4B;&#x524D;&#x4E32;&#x8BB2;&#x65F6;&#x7ED9;&#x7684;&#x67B6;&#x6784;&#x56FE;&#x3001;&#x6570;&#x636E;&#x6D41;&#x56FE;&#x3001;&#x90E8;&#x7F72;&#x62D3;&#x6251;&#x56FE;&#x3002;&#x4ECE;&#x8FD0;&#x7EF4;&#x5C42;&#x9762;&#xFF0C;&#x6700;&#x597D;&#x8FD8;&#x8981;&#x77E5;&#x9053;&#x516C;&#x53F8;&#x7F51;&#x7EDC;&#x62D3;&#x6251;&#x56FE;&#x3002;</p><p>&#x4E86;&#x89E3;&#x6BCF;&#x4E2A;&#x6A21;&#x5757;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x90E8;&#x7F72;&#x5728;&#x54EA;&#x4E9B;&#x673A;&#x5668;&#x4E0A;&#xFF0C;&#x90E8;&#x7F72;&#x5728;&#x54EA;&#x4E2A;&#x76EE;&#x5F55;&#xFF0C;&#x7528;&#x4EC0;&#x4E48;&#x8D26;&#x53F7;&#x542F;&#x52A8;&#x7684;&#xFF0C;&#x65E5;&#x5FD7;&#x6253;&#x5230;&#x54EA;&#x91CC;&#x4E86;&#xFF0C;&#x7528;&#x4EC0;&#x4E48;&#x8BED;&#x8A00;&#x7F16;&#x5199;&#x7684;&#xFF0C;&#x600E;&#x4E48;&#x4E0A;&#x7EBF;&#x7684;&#xFF0C;&#x4E3B;&#x8981;&#x5403;CPU&#x8D44;&#x6E90;&#x8FD8;&#x662F;&#x5185;&#x5B58;&#x8FD8;&#x662F;&#x78C1;&#x76D8;&#x8FD8;&#x662F;IO&#xFF0C;&#x9700;&#x8981;&#x9884;&#x7559;&#x591A;&#x5C11;&#x8D44;&#x6E90;&#xFF0C;&#x5E73;&#x65F6;&#x5229;&#x7528;&#x7387;&#x662F;&#x591A;&#x5C11;&#xFF0C;&#x5E94;&#x8BE5;&#x914D;&#x7F6E;&#x591A;&#x5927;&#x7684;&#x9608;&#x503C;&#x505A;&#x76D1;&#x63A7;&#xFF0C;&#x662F;&#x5426;&#x9700;&#x8981;watchdog&#x81EA;&#x52A8;&#x62C9;&#x8D77;&#xFF0C;&#x65E5;&#x5FD7;&#x91CC;&#x51FA;&#x73B0;&#x54EA;&#x4E9B;&#x5173;&#x952E;&#x5B57;&#x9700;&#x8981;&#x62A5;&#x8B66;&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x5404;&#x79CD;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x95EE;&#x9898;&#x3002;</p><h3 id="&#x4E1A;&#x52A1;&#x76D1;&#x63A7;"><a href="#&#x4E1A;&#x52A1;&#x76D1;&#x63A7;" class="headerlink" title="&#x4E1A;&#x52A1;&#x76D1;&#x63A7;"></a>&#x4E1A;&#x52A1;&#x76D1;&#x63A7;</h3><p>&#x57FA;&#x672C;&#x7684;&#x8FDB;&#x7A0B;&#x3001;&#x7AEF;&#x53E3;&#x5B58;&#x6D3B;&#x6027;&#x76D1;&#x63A7;&#xFF0C;&#x673A;&#x5668;&#x5229;&#x7528;&#x7387;&#x76D1;&#x63A7;&#x3001;&#x65E5;&#x5FD7;&#x5173;&#x952E;&#x5B57;&#x76D1;&#x63A7;&#x3001;&#x65E5;&#x5FD7;&#x4E0D;&#x6EDA;&#x52A8;&#x76D1;&#x63A7;&#x3001;&#x5173;&#x8054;&#x7684;&#x670D;&#x52A1;&#x7684;&#x76D1;&#x63A7;&#x7B49;&#x7B49;&#xFF0C;&#x540E;&#x9762;&#x4F1A;&#x505A;API&#x7C92;&#x5EA6;&#x7684;&#x76D1;&#x63A7;&#xFF0C;&#x6765;&#x63A8;&#x52A8;&#x4E1A;&#x52A1;&#x4F18;&#x5316;&#x3002;</p><h3 id="&#x6807;&#x51C6;&#x5316;&#x6539;&#x9020;"><a href="#&#x6807;&#x51C6;&#x5316;&#x6539;&#x9020;" class="headerlink" title="&#x6807;&#x51C6;&#x5316;&#x6539;&#x9020;"></a>&#x6807;&#x51C6;&#x5316;&#x6539;&#x9020;</h3><p>&#x673A;&#x5668;&#x547D;&#x540D;&#x65B9;&#x5F0F;&#x3001;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x53D1;&#x884C;&#x7248;&#x3001;OS&#x7248;&#x672C;&#x3001;&#x7B2C;&#x4E09;&#x65B9;&#x8F6F;&#x4EF6;&#xFF0C;&#x6BD4;&#x5982;jdk&#x3001;tomcat&#x3001;nginx&#xFF0C;&#x90FD;&#x8981;&#x7EDF;&#x4E00;&#xFF0C;&#x505A;&#x6807;&#x51C6;&#x5316;&#x65B9;&#x6848;&#x3002;</p><p>&#x670D;&#x52A1;&#x6269;&#x5BB9;&#x3001;&#x53D8;&#x66F4;&#x3001;&#x4E0B;&#x7EBF;&#x505A;&#x4E00;&#x952E;&#x5316;&#xFF0C;&#x6BCF;&#x6B21;&#x5347;&#x7EA7;&#x53EA;&#x9700;&#x8981;&#x7ED9;&#x4E2A;&#x7248;&#x672C;&#x53F7;&#x5373;&#x53EF;&#xFF0C;&#x6B64;&#x65F6;&#x7814;&#x53D1;&#x64CD;&#x4F5C;&#x8FD8;&#x662F;&#x8FD0;&#x7EF4;&#x64CD;&#x4F5C;&#x6548;&#x679C;&#x4E00;&#x6837;&#xFF0C;&#x6545;&#x800C;&#x53EF;&#x4EE5;&#x4EA4;&#x7ED9;&#x7814;&#x53D1;&#x4E0A;&#x7EBF;&#xFF0C;&#x91CA;&#x653E;&#x8FD0;&#x7EF4;&#x4EBA;&#x529B;&#xFF0C;&#x6743;&#x9650;&#x8981;&#x63A7;&#x5236;&#x597D;&#x3002;</p><p>&#x91CD;&#x590D;&#x7684;&#x5E38;&#x89C4;&#x64CD;&#x4F5C;&#x4E5F;&#x8981;&#x56FA;&#x5316;&#x6210;&#x811A;&#x672C;&#xFF0C;&#x4E00;&#x952E;&#x5B8C;&#x6210;&#x3002;</p><p>&#x68B3;&#x7406;&#x6545;&#x969C;&#x81EA;&#x6108;&#x573A;&#x666F;&#xFF0C;&#x770B;&#x5E73;&#x65F6;&#x6709;&#x54EA;&#x4E9B;&#x6545;&#x969C;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x662F;&#x56FA;&#x5B9A;&#x7684;&#xFF0C;&#x62BD;&#x8C61;&#x4E3A;&#x811A;&#x672C;&#xFF0C;&#x62A5;&#x8B66;&#x4E4B;&#x540E;&#x81EA;&#x52A8;&#x89E6;&#x53D1;&#xFF0C;&#x65E0;&#x4EBA;&#x503C;&#x5B88;&#x5904;&#x7406;&#x3002;</p><p>&#x516C;&#x53F8;&#x5982;&#x679C;&#x6709;&#x4E00;&#x4E9B;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#xFF0C;&#x6BD4;&#x5982;&#x540D;&#x5B57;&#x670D;&#x52A1;&#x3001;MQ&#x3001;&#x65E5;&#x5FD7;&#x5E73;&#x53F0;&#xFF0C;&#x63A8;&#x52A8;&#x7814;&#x53D1;&#x6539;&#x9020;&#xFF0C;&#x5C06;&#x65B0;&#x670D;&#x52A1;&#x63A5;&#x5165;&#x3002;&#x5982;&#x679C;&#x516C;&#x53F8;&#x8FD8;&#x6CA1;&#x6709;&#x8FD9;&#x4E9B;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#xFF0C;&#x4F5C;&#x4E3A;&#x8FD0;&#x7EF4;&#x8FD9;&#x4E2A;&#x89D2;&#x8272;&#xFF0C;&#x53EF;&#x4EE5;&#x7740;&#x624B;&#x641E;&#x8D77;&#x3002;</p><h3 id="SOP&#x68B3;&#x7406;"><a href="#SOP&#x68B3;&#x7406;" class="headerlink" title="SOP&#x68B3;&#x7406;"></a>SOP&#x68B3;&#x7406;</h3><p>&#x6545;&#x969C;&#x9884;&#x6848;&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x7EBF;&#x4E0A;&#x6CA1;&#x51FA;&#x6545;&#x969C;&#x4E4B;&#x524D;&#xFF0C;&#x5C31;&#x5E94;&#x8BE5;&#x63D0;&#x524D;&#x53BB;&#x60F3;&#xFF0C;&#x670D;&#x52A1;&#x53EF;&#x80FD;&#x4F1A;&#x51FA;&#x4EC0;&#x4E48;&#x6545;&#x969C;&#xFF0C;&#x5982;&#x679C;&#x771F;&#x51FA;&#x4E86;&#xFF0C;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x5904;&#x7406;&#xFF0C;&#x628A;&#x5904;&#x7406;&#x6B65;&#x9AA4;&#x63D0;&#x524D;&#x8BB0;&#x5F55;&#x4E0B;&#x6765;&#x3002;&#x6BD5;&#x7ADF;&#xFF0C;&#x7EBF;&#x4E0A;&#x51FA;&#x6545;&#x969C;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4EBA;&#x90FD;&#x6BD4;&#x8F83;&#x7D27;&#x5F20;&#xFF0C;&#x76F4;&#x63A5;&#x770B;&#x7740;&#x9884;&#x6848;&#x5904;&#x7406;&#xFF0C;&#x5C31;&#x8E0F;&#x5B9E;&#x4E0D;&#x5C11;&#xFF0C;&#x4E0D;&#x5BB9;&#x6613;&#x51FA;&#x9519;&#x3002;</p><h3 id="&#x6545;&#x969C;&#x6F14;&#x7EC3;"><a href="#&#x6545;&#x969C;&#x6F14;&#x7EC3;" class="headerlink" title="&#x6545;&#x969C;&#x6F14;&#x7EC3;"></a>&#x6545;&#x969C;&#x6F14;&#x7EC3;</h3><p>&#x5149;&#x6709;&#x9884;&#x6848;&#x6CA1;&#x6709;&#x6F14;&#x7EC3;&#xFF0C;&#x662F;&#x4E0D;&#x9760;&#x8C31;&#x7684;&#xFF0C;&#x6CA1;&#x6709;&#x7ECF;&#x8FC7;&#x9A8C;&#x8BC1;&#x7684;&#x9884;&#x6848;&#x662F;&#x4E0D;&#x53EF;&#x4FE1;&#x4EFB;&#x7684;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x641E;&#x4E2A;&#x653E;&#x706B;&#x6F14;&#x4E60;&#xFF0C;&#x628A;&#x6A21;&#x5757;&#x641E;&#x6302;&#x8BD5;&#x4E00;&#x628A;&#xFF0C;&#x628A;&#x673A;&#x5668;&#x641E;&#x6302;&#x8BD5;&#x4E00;&#x628A;&#xFF0C;&#x5BF9;&#x7EBF;&#x4E0A;&#x7A33;&#x5B9A;&#x6027;&#x7EDD;&#x5BF9;&#x4F1A;&#x6709;&#x63D0;&#x5347;&#x3002;</p><p>&#x7279;&#x522B;&#x662F;&#x7814;&#x53D1;&#x8BF4;&#x8FD9;&#x4E2A;&#x6A21;&#x5757;&#x6302;&#x6389;&#xFF0C;&#x53EF;&#x7528;&#x6027;&#x80AF;&#x5B9A;&#x6CA1;&#x5F71;&#x54CD;&#xFF0C;OK&#xFF0C;&#x641E;&#x6302;&#x8BD5;&#x8BD5;&#x5148;&#x3002;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x6253;&#x4ED6;&#x8138;&#xFF0C;-_-||</p><p>&#x6709;&#x4E9B;&#x573A;&#x666F;&#x6F14;&#x7EC3;&#x662F;&#x4F1A;&#x6709;&#x635F;&#x7684;&#x3002;&#x8FD9;&#x79CD;&#x573A;&#x666F;&#x8FD8;&#x8981;&#x4E0D;&#x8981;&#x6F14;&#x7EC3;&#xFF1F;&#x8FD9;&#x4E2A;&#x9700;&#x8981;case by case&#x7684;&#x770B;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x60C5;&#x51B5;&#x90FD;&#x662F;&#x8981;&#x505A;&#x6F14;&#x7EC3;&#x4F1A;&#x66F4;&#x597D;&#xFF0C;&#x6BD5;&#x7ADF;&#xFF0C;&#x4EBA;&#x5728;&#x8FD9;&#x76EF;&#x7740;&#x7684;&#x65F6;&#x5019;&#x51FA;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x665A;&#x4E0A;&#x7761;&#x7740;&#x4E86;&#x51FA;&#x4E86;&#x95EE;&#x9898;&#x8981;&#x5F3A;&#x592A;&#x591A;&#x3002;&#x5F53;&#x7136;&#xFF0C; &#x5927;&#x89C4;&#x6A21;&#x57FA;&#x7840;&#x7F51;&#x7EDC;&#x6545;&#x969C;&#x8FD9;&#x79CD;&#x6F14;&#x7EC3;&#xFF0C;&#x8FD8;&#x662F;&#x7B97;&#x4E86;&#x5427;&#xFF0C;&#x901A;&#x5E38;&#x7684;&#x4E1A;&#x52A1;&#x90FD;&#x662F;&#x4E0D;&#x5177;&#x5907;&#x673A;&#x623F;&#x7EA7;&#x5BB9;&#x707E;&#x7684;&#xFF0C;&#x5475;&#x5475;</p><p>&#x4E0A;&#x9762;&#x505A;&#x5B8C;&#x4E86;&#xFF0C;&#x57FA;&#x672C;&#x5DE5;&#x4F5C;&#x5C31;&#x5B8C;&#x6210;&#x4E86;&#x3002;&#x4E0A;&#x9762;&#x5F88;&#x591A;&#x4E8B;&#x60C5;&#x90FD;&#x662F;&#x4E00;&#x6B21;&#x6027;&#x7684;&#xFF0C;&#x90A3;&#x672A;&#x6765;&#x7684;&#x5927;&#x628A;&#x65F6;&#x95F4;&#x8FD0;&#x7EF4;&#x505A;&#x5565;&#xFF1F;</p><p>&#x9664;&#x4E86;&#x518D;&#x82B1;&#x8D39;&#x90E8;&#x5206;&#x65F6;&#x95F4;&#x505A;&#x7EBF;&#x4E0A;&#x95EE;&#x9898;&#x5904;&#x7406;&#xFF0C;&#x6211;&#x4EEC;&#x5E94;&#x8BE5;&#x628A;&#x4E3B;&#x8981;&#x7CBE;&#x529B;&#x6765;&#x63D0;&#x5347;&#x4E1A;&#x52A1;&#x4EA7;&#x54C1;&#x529B;&#x3002;&#x505A;&#x7CBE;&#x7EC6;&#x5316;&#x8FD0;&#x7EF4;&#xFF0C;&#x8FD8;&#x8BB0;&#x5F97;&#x8FD0;&#x7EF4;&#x4E5D;&#x5B57;&#x771F;&#x8A00;&#x4E48;&#xFF1F;&#x201C;&#x5B89;&#x5168;&#x7A33;&#x5B9A;&#x9AD8;&#x6548;&#x4F4E;&#x6210;&#x672C;&#x201D;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5411;&#x3002;&#x4E0B;&#x9762;&#x4E3E;&#x51E0;&#x4E2A;&#x4F8B;&#x5B50;&#x3002;</p><h3 id="&#x518D;&#x8C08;&#x4E1A;&#x52A1;&#x76D1;&#x63A7;"><a href="#&#x518D;&#x8C08;&#x4E1A;&#x52A1;&#x76D1;&#x63A7;" class="headerlink" title="&#x518D;&#x8C08;&#x4E1A;&#x52A1;&#x76D1;&#x63A7;"></a>&#x518D;&#x8C08;&#x4E1A;&#x52A1;&#x76D1;&#x63A7;</h3><p>&#x4E0A;&#x9762;&#x8C08;&#x5230;&#x8FC7;&#x4E00;&#x6B21;&#x4E1A;&#x52A1;&#x76D1;&#x63A7;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x4E00;&#x4E9B;&#x901A;&#x7528;&#x7684;&#x76D1;&#x63A7;&#x6307;&#x6807;&#x3002;&#x6211;&#x4EEC;&#x5BF9;&#x4EA7;&#x54C1;&#x4E86;&#x89E3;&#x8DB3;&#x591F;&#x4E4B;&#x540E;&#xFF0C;&#x5E94;&#x8BE5;&#x505A;&#x4E00;&#x4E9B;&#x4E1A;&#x52A1;&#x7279;&#x6709;&#x7684;&#x76D1;&#x63A7;&#xFF0C;&#x63A8;&#x52A8;&#x7814;&#x53D1;&#x53BB;&#x505A;&#x4E5F;&#x53EF;&#x4EE5;&#xFF0C;&#x8FBE;&#x5230;&#x6548;&#x679C;&#x5C31;&#x597D;&#x3002;</p><p>&#x6BD4;&#x5982;&#x4F60;&#x8FD0;&#x7EF4;&#x4E86;&#x4E00;&#x4E2A;MQ&#xFF0C;&#x6D88;&#x606F;&#x5806;&#x79EF;&#x91CF;&#x662F;&#x9700;&#x8981;&#x76D1;&#x63A7;&#x6EF4;&#xFF1B;&#x6BD4;&#x5982;&#x4F60;&#x8FD0;&#x7EF4;&#x4E86;&#x4E00;&#x4E2A;RPC&#x670D;&#x52A1;&#xFF0C;&#x63D0;&#x4F9B;&#x4E86;&#x4E09;&#x4E2A;&#x63A5;&#x53E3;&#xFF0C;&#x8FD9;&#x4E09;&#x4E2A;&#x63A5;&#x53E3;&#x7684;&#x54CD;&#x5E94;&#x65F6;&#x957F;&#x3001;&#x6210;&#x529F;&#x7387;&#x662F;&#x9700;&#x8981;&#x76D1;&#x63A7;&#x6EF4;&#xFF1B;&#x6BD4;&#x5982;&#x4F60;&#x8FD0;&#x7EF4;&#x4E86;&#x4E00;&#x4E2A;S3&#x670D;&#x52A1;&#xFF0C;&#x6BCF;&#x4E2A;&#x6876;&#x7684;&#x77ED;&#x671F;&#x5E26;&#x5BBD;&#x589E;&#x91CF;&#x4F60;&#x662F;&#x9700;&#x8981;&#x76D1;&#x63A7;&#x6EF4;&#xFF1B;&#x6709;&#x90A3;&#x4E48;&#x70B9;&#x611F;&#x89C9;&#x4E86;&#x4E48;&#xFF1F; :)</p><h3 id="API&#x6210;&#x529F;&#x7387;&#x3001;&#x5EF6;&#x8FDF;&#x7EDF;&#x8BA1;"><a href="#API&#x6210;&#x529F;&#x7387;&#x3001;&#x5EF6;&#x8FDF;&#x7EDF;&#x8BA1;" class="headerlink" title="API&#x6210;&#x529F;&#x7387;&#x3001;&#x5EF6;&#x8FDF;&#x7EDF;&#x8BA1;"></a>API&#x6210;&#x529F;&#x7387;&#x3001;&#x5EF6;&#x8FDF;&#x7EDF;&#x8BA1;</h3><p>&#x5728;&#x6D41;&#x91CF;&#x5165;&#x53E3;&#x7684;nginx&#x505A;&#x6240;&#x6709;&#x4E1A;&#x52A1;&#x7EBF;&#x7684;&#x6240;&#x6709;API&#x7684;&#x6210;&#x529F;&#x7387;&#x548C;&#x5EF6;&#x8FDF;&#x7EDF;&#x8BA1;&#xFF0C;&#x662F;&#x975E;&#x5E38;&#x6709;&#x5FC5;&#x8981;&#x7684;&#x3002;&#x628A;&#x6210;&#x529F;&#x7387;&#x6BD4;&#x8F83;&#x4F4E;&#x7684;TopN&#x627E;&#x51FA;&#x6765;&#xFF0C;&#x628A;&#x5EF6;&#x8FDF;&#x6BD4;&#x8F83;&#x5927;&#x7684;TopN&#x627E;&#x51FA;&#x6765;&#xFF0C;&#x8BA9;&#x4E1A;&#x52A1;&#x53BB;&#x4F18;&#x5316;&#x3002;&#x8001;&#x677F;&#x4F1A;&#x559C;&#x6B22;&#x8FD9;&#x4E2A;&#x7684;&#x3002;</p><h3 id="&#x7EBF;&#x4E0A;&#x95EE;&#x9898;&#x68B3;&#x7406;"><a href="#&#x7EBF;&#x4E0A;&#x95EE;&#x9898;&#x68B3;&#x7406;" class="headerlink" title="&#x7EBF;&#x4E0A;&#x95EE;&#x9898;&#x68B3;&#x7406;"></a>&#x7EBF;&#x4E0A;&#x95EE;&#x9898;&#x68B3;&#x7406;</h3><p>&#x6574;&#x7406;&#x7EBF;&#x4E0A;&#x6240;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x6328;&#x4E2A;&#x89E3;&#x51B3;&#xFF0C;&#x8FD0;&#x7EF4;&#x53EF;&#x4EE5;&#x641E;&#x5B9A;&#x7684;&#x8FD0;&#x7EF4;&#x641E;&#x5B9A;&#xFF0C;&#x8FD0;&#x7EF4;&#x641E;&#x4E0D;&#x5B9A;&#x7684;&#x627E;&#x7814;&#x53D1;&#x8981;&#x6392;&#x671F;&#xFF0C;&#x6BCF;&#x5468;&#x89E3;&#x51B3;&#x4E86;&#x591A;&#x5C11;&#x95EE;&#x9898;&#xFF0C;&#x8FD8;&#x6709;&#x591A;&#x5C11;&#x95EE;&#x9898;&#x5F85;&#x89E3;&#x51B3;&#xFF0C;&#x7528;&#x5468;&#x62A5;&#x7684;&#x65B9;&#x5F0F;&#x4F53;&#x73B0;&#x51FA;&#x6765;&#x3002;</p><h3 id="&#x6210;&#x672C;&#x4F18;&#x5316;"><a href="#&#x6210;&#x672C;&#x4F18;&#x5316;" class="headerlink" title="&#x6210;&#x672C;&#x4F18;&#x5316;"></a>&#x6210;&#x672C;&#x4F18;&#x5316;</h3><p>&#x901A;&#x8FC7;&#x670D;&#x52A1;&#x6DF7;&#x90E8;&#x3001;&#x6216;&#x8005;&#x7EDF;&#x4E00;&#x7684;&#x8D44;&#x6E90;&#x8C03;&#x5EA6;&#x5E73;&#x53F0;&#x6765;&#x8282;&#x7701;&#x673A;&#x5668;&#x8D44;&#x6E90;&#xFF0C;&#x4E00;&#x53F0;&#x673A;&#x5668;&#x4FBF;&#x5B9C;&#x7684;&#x4E5F;&#x597D;&#x51E0;&#x4E07;&#x5462;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E8B;&#x662F;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x6709;&#x4EA7;&#x51FA;&#x7684;&#x3002;</p><h3 id="&#x5BB9;&#x91CF;&#x89C4;&#x5212;"><a href="#&#x5BB9;&#x91CF;&#x89C4;&#x5212;" class="headerlink" title="&#x5BB9;&#x91CF;&#x89C4;&#x5212;"></a>&#x5BB9;&#x91CF;&#x89C4;&#x5212;</h3><p>&#x5BB9;&#x91CF;&#x89C4;&#x5212;&#x548C;&#x6210;&#x672C;&#x4F18;&#x5316;&#x5B9E;&#x9645;&#x662F;&#x7D27;&#x5BC6;&#x76F8;&#x5173;&#x7684;&#xFF0C;&#x5BB9;&#x91CF;&#x89C4;&#x5212;&#x7684;&#x91CD;&#x70B9;&#x662F;&#x6839;&#x636E;&#x81EA;&#x7136;&#x589E;&#x91CF;&#x548C;&#x8FD0;&#x8425;&#x9700;&#x6C42;&#xFF0C;&#x63D0;&#x524D;&#x89C4;&#x5212;&#x51C6;&#x5907;&#x76F8;&#x5E94;&#x7684;&#x5BB9;&#x91CF;&#xFF0C;&#x5BB9;&#x91CF;&#x53EF;&#x80FD;&#x5305;&#x62EC;&#x5E26;&#x5BBD;&#x3001;&#x4E13;&#x7EBF;&#x3001;&#x7F51;&#x7EDC;&#x8BBE;&#x5907;&#x3001;&#x673A;&#x5668;&#x7B49;&#x7B49;&#xFF1B;&#x5F53;&#x4E1A;&#x52A1;&#x91CF;&#x4E0B;&#x6765;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x53EF;&#x4EE5;&#x817E;&#x632A;&#x76F8;&#x5173;&#x8D44;&#x6E90;&#x652F;&#x6301;&#x5176;&#x4ED6;&#x4E1A;&#x52A1;&#x7EBF;&#xFF0C;&#x8BA9;&#x8FD9;&#x4E9B;&#x786C;&#x4EF6;&#x5C3D;&#x91CF;&#x6EE1;&#x8D1F;&#x8377;&#x8FD0;&#x8F6C;&#xFF0C;&#x7269;&#x6709;&#x6240;&#x503C;&#x3002;</p><p>&#x4E1A;&#x52A1;&#x7CBE;&#x7EC6;&#x5316;&#x8FD0;&#x7EF4;&#x53EF;&#x4EE5;&#x60F3;&#x51FA;&#x5404;&#x79CD;&#x4E8B;&#x60C5;&#x6765;&#x641E;&#xFF0C;&#x9664;&#x4E86;&#x505A;&#x8FD9;&#x4E8B;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x9700;&#x8981;&#x957F;&#x671F;&#x6295;&#x5165;&#x7684;&#x662F;&#x6784;&#x5EFA;&#x8FD0;&#x7EF4;&#x57FA;&#x7840;&#x5E73;&#x53F0;&#xFF0C;&#x50CF;&#x4EC0;&#x4E48;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x3001;&#x90E8;&#x7F72;&#x7CFB;&#x7EDF;&#x3001;&#x4EA7;&#x54C1;&#x5E93;&#x3001;&#x8D44;&#x6E90;&#x5229;&#x7528;&#x7387;&#x5E73;&#x53F0;&#x3001;&#x57DF;&#x540D;&#x7BA1;&#x7406;&#x3001;&#x56DB;&#x4E03;&#x5C42;&#x63A5;&#x5165;&#x914D;&#x7F6E;&#x5E73;&#x53F0;&#x3001;&#x65E5;&#x5FD7;&#x5E73;&#x53F0;&#x3001;Trace&#x7CFB;&#x7EDF;&#x7B49;&#x7B49;&#x7B49;&#x7B49;&#xFF0C;&#x55EF;&#xFF0C;&#x5176;&#x5B9E;&#x8FD0;&#x7EF4;&#x8FD8;&#x662F;&#x633A;&#x5FD9;&#x7684;&#x3002;</p><h3 id="&#x5173;&#x4E8E;&#x6C9F;&#x901A;"><a href="#&#x5173;&#x4E8E;&#x6C9F;&#x901A;" class="headerlink" title="&#x5173;&#x4E8E;&#x6C9F;&#x901A;"></a>&#x5173;&#x4E8E;&#x6C9F;&#x901A;</h3><p>&#x6700;&#x540E;&#x8BF4;&#x4E00;&#x70B9;&#xFF0C;&#x63A5;&#x624B;&#x4E00;&#x4E2A;&#x65B0;&#x4E1A;&#x52A1;&#x8FD0;&#x7EF4;&#xFF0C;&#x52BF;&#x5FC5;&#x4E0E;&#x7814;&#x53D1;&#x6709;&#x5404;&#x79CD;&#x6C9F;&#x901A;&#xFF0C;&#x6BCF;&#x6B21;&#x6C9F;&#x901A;&#x90FD;&#x8981;&#x5199;&#x4F1A;&#x8BAE;&#x7EAA;&#x8981;&#xFF0C;&#x53D1;&#x90AE;&#x4EF6;&#x51FA;&#x6765;&#xFF0C;&#x8DDF;&#x8FDB;&#x4EBA;&#x662F;&#x8C01;&#xFF0C;&#x65F6;&#x95F4;&#x70B9;&#x662F;&#x5565;&#x65F6;&#x5019;&#x90FD;&#x8981;&#x5199;&#x660E;&#x767D;&#xFF0C;&#x90AE;&#x4EF6;&#x53D1;&#x9001;&#x53CC;&#x65B9;&#x56E2;&#x961F;&#x90AE;&#x4EF6;&#x7EC4;&#xFF0C;cc&#x5404;&#x65B9;&#x8001;&#x5927;&#x3002;&#x4E8B;&#x540E;&#x5173;&#x952E;&#x8282;&#x70B9;&#x505A;check&#xFF0C;&#x5982;&#x672A;&#x5B8C;&#x6210;&#xFF0C;&#x7EBF;&#x4E0B;&#x6C9F;&#x901A;&#xFF0C;&#x8FBE;&#x6210;&#x4E00;&#x81F4;&#x540E;&#x8FFD;&#x6B64;&#x90AE;&#x4EF6;&#x7ED9;&#x7ED3;&#x8BBA;&#xFF0C;&#x8BF4;&#x660E;&#x5EF6;&#x671F;&#x539F;&#x56E0;&#x4EE5;&#x53CA;&#x65B0;&#x7684;&#x65F6;&#x95F4;&#x70B9;&#x3002;&#x5982;&#x679C;&#x6C9F;&#x901A;&#x4E0D;&#x7545;&#xFF0C;&#x8BA9;&#x8001;&#x5927;&#x53BB;&#x534F;&#x8C03;&#x3002;</p><p><img src="/images/sh7.jpg" width="100%" height="80%"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;font color=&quot;&quot; size=&quot;3&quot;&gt; 对丑话说前头：&lt;br&gt;先跟研发leader沟通，灌输运维理念，丑话说在前头，我们不做保姆式运维，我们会致力于线上服务安全、稳定、低成本、快速迭代，从运维视角提高产品力。开发机、测试环境，研发自己搞，我们可以协助帮忙，做专业的咨询服务，想让我们直接操刀开发环境的变更，免谈！&lt;/font&gt;

&lt;hr&gt;
    
    </summary>
    
      <category term="职业规划" scheme="https://wolf-7.github.io/categories/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/"/>
    
    
      <category term="职业规划" scheme="https://wolf-7.github.io/tags/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/"/>
    
  </entry>
  
  <entry>
    <title>完备的监控应覆盖什么？</title>
    <link href="https://wolf-7.github.io/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/2016/03/03/%E5%AE%8C%E5%A4%87%E7%9A%84%E7%9B%91%E6%8E%A7%E5%BA%94%E8%A6%86%E7%9B%96%E4%BB%80%E4%B9%88.html"/>
    <id>https://wolf-7.github.io/职业规划/2016/03/03/完备的监控应覆盖什么.html</id>
    <published>2016-03-03T13:23:23.000Z</published>
    <updated>2019-01-16T03:26:40.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><p><font color="" size="3"> &#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x4E92;&#x8054;&#x7F51;&#x516C;&#x53F8;&#xFF0C;&#x8981;&#x5BF9;&#x54EA;&#x4E9B;&#x65B9;&#x9762;&#x505A;&#x4E86;&#x76D1;&#x63A7;&#xFF0C;&#x624D;&#x80FD;&#x79F0;&#x5F97;&#x4E0A;&#x5B8C;&#x5907;&#xFF1F;&#x4ECA;&#x5929;&#x7B14;&#x8005;&#x629B;&#x7816;&#x5F15;&#x7389;&#xFF0C;&#x7ED9;&#x51FA;&#x4E00;&#x4E2A;&#x5217;&#x8868;&#xFF0C;&#x4E0D;&#x8DB3;&#x4E4B;&#x5904;&#xFF0C;&#x6B22;&#x8FCE;&#x4E1A;&#x754C;&#x540C;&#x4EC1;&#x8865;&#x5145;&#xFF0C;&#x5171;&#x540C;&#x8FDB;&#x6B65;:)</font>&#x2003;</p><hr><a id="more"></a><h3 id="&#x7F51;&#x7EDC;&#x76D1;&#x63A7;"><a href="#&#x7F51;&#x7EDC;&#x76D1;&#x63A7;" class="headerlink" title="&#x7F51;&#x7EDC;&#x76D1;&#x63A7;"></a>&#x7F51;&#x7EDC;&#x76D1;&#x63A7;</h3><p>&#x7EC8;&#x7AEF;&#x5BA2;&#x6237;&#x8981;&#x60F3;&#x8BBF;&#x95EE;&#x4F60;&#x7684;&#x670D;&#x52A1;&#xFF0C;&#x52BF;&#x5FC5;&#x8981;&#x7ECF;&#x8FC7;&#x4E00;&#x7CFB;&#x5217;&#x7F51;&#x7EDC;&#x94FE;&#x8DEF;&#xFF0C;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x7740;&#x773C;&#x70B9;</p><h3 id="&#x7F51;&#x7EDC;&#x8D28;&#x91CF;"><a href="#&#x7F51;&#x7EDC;&#x8D28;&#x91CF;" class="headerlink" title="&#x7F51;&#x7EDC;&#x8D28;&#x91CF;"></a>&#x7F51;&#x7EDC;&#x8D28;&#x91CF;</h3><p>&#x5168;&#x56FD;&#x5404;&#x5730;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x5730;&#x533A;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x8FD0;&#x8425;&#x5546;&#xFF0C;&#x8BBF;&#x95EE;&#x4F60;&#x7684;&#x7F51;&#x7AD9;&#x7684;&#x8D28;&#x91CF;&#xFF0C;&#x6BD4;&#x5982;&#x5EF6;&#x8FDF;&#x662F;&#x591A;&#x5C11;&#xFF0C;&#x662F;&#x5426;&#x4E0D;&#x901A;&#x4E86;</p><h3 id="&#x516C;&#x7F51;&#x51FA;&#x53E3;"><a href="#&#x516C;&#x7F51;&#x51FA;&#x53E3;" class="headerlink" title="&#x516C;&#x7F51;&#x51FA;&#x53E3;"></a>&#x516C;&#x7F51;&#x51FA;&#x53E3;</h3><p>&#x670D;&#x52A1;&#x90E8;&#x7F72;&#x5728;&#x67D0;&#x4E2A;IDC&#xFF0C;IDC&#x7684;&#x516C;&#x7F51;&#x51FA;&#x53E3;&#x662F;&#x4E0D;&#x662F;&#x62E5;&#x585E;&#x4E86;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x65AD;&#x4E86;</p><h3 id="&#x4E13;&#x7EBF;&#x5E26;&#x5BBD;"><a href="#&#x4E13;&#x7EBF;&#x5E26;&#x5BBD;" class="headerlink" title="&#x4E13;&#x7EBF;&#x5E26;&#x5BBD;"></a>&#x4E13;&#x7EBF;&#x5E26;&#x5BBD;</h3><p>&#x670D;&#x52A1;&#x53EF;&#x80FD;&#x662F;&#x4F9D;&#x8D56;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x7684;&#xFF0C;&#x800C;&#x88AB;&#x4F9D;&#x8D56;&#x7684;&#x670D;&#x52A1;&#x5374;&#x4E0D;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x673A;&#x623F;&#xFF0C;&#x4E2D;&#x95F4;&#x901A;&#x8FC7;&#x4E13;&#x7EBF;&#x8FDE;&#x901A;&#xFF0C;&#x90A3;&#x4E48;&#x4E13;&#x7EBF;&#x7684;&#x8D28;&#x91CF;&#x5C31;&#x9700;&#x8981;&#x5173;&#x6CE8;&#x4E86;&#xFF0C;&#x5178;&#x578B;&#x7684;&#x6BD4;&#x5982;&#x4E22;&#x5305;&#x60C5;&#x51B5;&#xFF0C;&#x662F;&#x5426;&#x8FDE;&#x901A;&#xFF0C;&#x5E26;&#x5BBD;&#x662F;&#x5426;&#x5230;&#x8FBE;&#x4E0A;&#x9650;</p><h3 id="&#x7F51;&#x7EDC;&#x8BBE;&#x5907;"><a href="#&#x7F51;&#x7EDC;&#x8BBE;&#x5907;" class="headerlink" title="&#x7F51;&#x7EDC;&#x8BBE;&#x5907;"></a>&#x7F51;&#x7EDC;&#x8BBE;&#x5907;</h3><p>&#x5404;&#x79CD;&#x4EA4;&#x6362;&#x673A;&#x3001;&#x8DEF;&#x7531;&#x5668;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x6302;&#x4E86;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x4E22;&#x5305;&#x4E86;&#xFF0C;&#x786C;&#x4EF6;&#x662F;&#x5426;&#x6545;&#x969C;&#x4E86;</p><h3 id="&#x673A;&#x5668;&#x76D1;&#x63A7;"><a href="#&#x673A;&#x5668;&#x76D1;&#x63A7;" class="headerlink" title="&#x673A;&#x5668;&#x76D1;&#x63A7;"></a>&#x673A;&#x5668;&#x76D1;&#x63A7;</h3><p>&#x8FD9;&#x4E2A;&#x5927;&#x5BB6;&#x901A;&#x5E38;&#x4E0D;&#x4F1A;&#x5FFD;&#x7565;&#xFF0C;&#x6BD5;&#x7ADF;&#x4F60;&#x7684;&#x670D;&#x52A1;&#x662F;&#x5728;&#x673A;&#x5668;&#x4E0A;&#x8DD1;&#x7684;&#x561B;&#xFF0C;&#x7B80;&#x5355;&#x5520;&#x53E8;&#x4E00;&#x4E0B;</p><h3 id="&#x673A;&#x5668;&#x786C;&#x4EF6;"><a href="#&#x673A;&#x5668;&#x786C;&#x4EF6;" class="headerlink" title="&#x673A;&#x5668;&#x786C;&#x4EF6;"></a>&#x673A;&#x5668;&#x786C;&#x4EF6;</h3><p>&#x6BD4;&#x5982;&#x78C1;&#x76D8;&#x662F;&#x4E0D;&#x662F;&#x53EA;&#x8BFB;&#x4E86;&#xFF0C;raid&#x662F;&#x4E0D;&#x662F;&#x6545;&#x969C;&#x4E86;&#xFF0C;&#x5185;&#x5B58;&#x662F;&#x4E0D;&#x662F;&#x6545;&#x969C;&#x4E86;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x8FDC;&#x7A0B;&#x63A7;&#x5236;&#x5361;&#x7BA1;&#x7406;</p><h3 id="&#x673A;&#x5668;&#x8FD0;&#x884C;&#x6001;"><a href="#&#x673A;&#x5668;&#x8FD0;&#x884C;&#x6001;" class="headerlink" title="&#x673A;&#x5668;&#x8FD0;&#x884C;&#x6001;"></a>&#x673A;&#x5668;&#x8FD0;&#x884C;&#x6001;</h3><p>&#x6BD4;&#x5982;&#x78C1;&#x76D8;&#x662F;&#x4E0D;&#x662F;&#x6EE1;&#x4E86;&#xFF0C;CPU&#x662F;&#x4E0D;&#x662F;&#x6301;&#x7EED;&#x8DD1;&#x6EE1;&#xFF0C;&#x5185;&#x5B58;&#x662F;&#x4E0D;&#x662F;&#x5FEB;&#x5403;&#x5149;&#x4E86;&#xFF0C;IO&#x6301;&#x7EED;100%&#xFF0C;&#x7F51;&#x5361;&#x662F;&#x4E0D;&#x662F;&#x4E22;&#x5305;&#x4E86;&#xFF0C;&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;&#x603B;&#x6570;&#x662F;&#x4E0D;&#x662F;&#x8FC7;&#x591A;&#x4E86;&#xFF0C;&#x6253;&#x5F00;&#x7684;&#x6587;&#x4EF6;&#x53E5;&#x67C4;&#x662F;&#x4E0D;&#x662F;&#x8FC7;&#x591A;&#x4E86;&#x3002;</p><h3 id="&#x673A;&#x5668;&#x914D;&#x7F6E;"><a href="#&#x673A;&#x5668;&#x914D;&#x7F6E;" class="headerlink" title="&#x673A;&#x5668;&#x914D;&#x7F6E;"></a>&#x673A;&#x5668;&#x914D;&#x7F6E;</h3><p>&#x6BD4;&#x5982;ulimit&#x914D;&#x7F6E;&#x662F;&#x5426;&#x5408;&#x7406;&#xFF0C;&#x4E00;&#x4E9B;&#x7CFB;&#x7EDF;&#x53C2;&#x6570;&#x6BD4;&#x5982;nf_conntrack_max&#x914D;&#x7F6E;&#x662F;&#x5426;&#x5408;&#x7406;&#x3002;</p><h3 id="&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;"><a href="#&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;" class="headerlink" title="&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;"></a>&#x7CFB;&#x7EDF;&#x8FDB;&#x7A0B;</h3><p>&#x6BD4;&#x5982;ntp&#x662F;&#x5426;&#x5DE5;&#x4F5C;&#x6B63;&#x5E38;&#xFF0C;&#x7CFB;&#x7EDF;&#x65F6;&#x95F4;&#x662F;&#x5426;&#x504F;&#x5DEE;&#x592A;&#x5927;&#xFF0C;sshd&#x8FDB;&#x7A0B;&#x662F;&#x5426;&#x5DE5;&#x4F5C;&#x6B63;&#x5E38;&#xFF0C;crond&#x662F;&#x5426;&#x6302;&#x4E86;</p><h3 id="&#x4E1A;&#x52A1;&#x76D1;&#x63A7;"><a href="#&#x4E1A;&#x52A1;&#x76D1;&#x63A7;" class="headerlink" title="&#x4E1A;&#x52A1;&#x76D1;&#x63A7;"></a>&#x4E1A;&#x52A1;&#x76D1;&#x63A7;</h3><p>&#x670D;&#x52A1;&#x672C;&#x8EAB;&#x8FD0;&#x884C;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x81EA;&#x7136;&#x4E5F;&#x662F;&#x8981;&#x76D1;&#x63A7;&#x7684;</p><h3 id="&#x5B58;&#x6D3B;&#x6027;"><a href="#&#x5B58;&#x6D3B;&#x6027;" class="headerlink" title="&#x5B58;&#x6D3B;&#x6027;"></a>&#x5B58;&#x6D3B;&#x6027;</h3><p>&#x8FDB;&#x7A0B;&#x662F;&#x5426;&#x8FD8;&#x5728;&#xFF0C;&#x7AEF;&#x53E3;&#x662F;&#x5426;&#x8FD8;&#x5728;&#x76D1;&#x542C;&#xFF0C;LOG&#x662F;&#x5426;&#x4E0D;&#x518D;&#x6EDA;&#x52A8;</p><h3 id="&#x5F02;&#x5E38;&#x65E5;&#x5FD7;"><a href="#&#x5F02;&#x5E38;&#x65E5;&#x5FD7;" class="headerlink" title="&#x5F02;&#x5E38;&#x65E5;&#x5FD7;"></a>&#x5F02;&#x5E38;&#x65E5;&#x5FD7;</h3><p>&#x6BD4;&#x5982;&#x629B;&#x4E86;Exception&#xFF0C;&#x51FA;&#x73B0;&#x4E86;ERROR&#x3001;FATAL&#x3001;ALERT&#x7B49;&#x5173;&#x952E;&#x5B57;</p><h3 id="&#x5065;&#x5EB7;&#x6307;&#x6807;"><a href="#&#x5065;&#x5EB7;&#x6307;&#x6807;" class="headerlink" title="&#x5065;&#x5EB7;&#x6307;&#x6807;"></a>&#x5065;&#x5EB7;&#x6307;&#x6807;</h3><p>&#x8FD9;&#x4E2A;&#x7ECF;&#x5E38;&#x5BB9;&#x6613;&#x5FFD;&#x89C6;&#xFF0C;&#x9700;&#x8981;&#x7814;&#x53D1;&#x914D;&#x5408;&#xFF0C;&#x80FD;&#x591F;&#x53CD;&#x6620;&#x670D;&#x52A1;&#x81EA;&#x8EAB;&#x5065;&#x5EB7;&#x72B6;&#x51B5;&#x7684;&#x6307;&#x6807;&#xFF0C;&#x8DDF;&#x4E1A;&#x52A1;&#x81EA;&#x8EAB;&#x76F8;&#x5173;&#x3002;&#x6BD4;&#x5982;MQ&#xFF0C;&#x80FD;&#x591F;&#x53CD;&#x6620;MQ&#x5065;&#x5EB7;&#x72B6;&#x51B5;&#x7684;&#x53EF;&#x80FD;&#x662F;&#x6D88;&#x606F;&#x5806;&#x79EF;&#x91CF;&#x3002;</p><h3 id="&#x63A5;&#x53E3;&#x76D1;&#x63A7;"><a href="#&#x63A5;&#x53E3;&#x76D1;&#x63A7;" class="headerlink" title="&#x63A5;&#x53E3;&#x76D1;&#x63A7;"></a>&#x63A5;&#x53E3;&#x76D1;&#x63A7;</h3><p>&#x670D;&#x52A1;&#x5BF9;&#x5916;&#x63D0;&#x4F9B;&#x7684;API&#xFF0C;&#x5176;&#x6210;&#x529F;&#x7387;&#x3001;&#x5EF6;&#x8FDF;&#x60C5;&#x51B5;&#x3001;QPS&#x7B49;&#x7B49;&#x3002;&#x4E00;&#x4E9B;&#x4EBA;&#x505A;&#x7684;&#x57DF;&#x540D;&#x76D1;&#x63A7;&#x4E5F;&#x53EF;&#x4EE5;&#x5F52;&#x5230;&#x8FD9;&#x91CC;&#x3002;</p><h3 id="&#x5468;&#x8FB9;&#x4F9D;&#x8D56;"><a href="#&#x5468;&#x8FB9;&#x4F9D;&#x8D56;" class="headerlink" title="&#x5468;&#x8FB9;&#x4F9D;&#x8D56;"></a>&#x5468;&#x8FB9;&#x4F9D;&#x8D56;</h3><p>&#x6BD4;&#x5982;&#x4F60;&#x4F9D;&#x8D56;&#x7684;&#x5176;&#x4ED6;&#x670D;&#x52A1;&#x662F;&#x5426;&#x5065;&#x5EB7;&#xFF0C;&#x6BD4;&#x5982;&#x7528;&#x5230;&#x7684;HTTPS&#x8BC1;&#x4E66;&#x662F;&#x5426;&#x8FC7;&#x671F;</p><p><img src="/images/sh4.jpg" width="100%" height="80%"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;&lt;font color=&quot;&quot; size=&quot;3&quot;&gt; 对于一个互联网公司，要对哪些方面做了监控，才能称得上完备？今天笔者抛砖引玉，给出一个列表，不足之处，欢迎业界同仁补充，共同进步:)&lt;/font&gt;&amp;emsp;&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="职业规划" scheme="https://wolf-7.github.io/categories/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/"/>
    
    
      <category term="职业规划" scheme="https://wolf-7.github.io/tags/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/"/>
    
  </entry>
  
  <entry>
    <title>Firewalld Rich and Direct Rules: Setting up RHEL 7 Server as a Router</title>
    <link href="https://wolf-7.github.io/Linux/2016/02/12/Firewalld-Rich-and-Direct-Rules-Setting-up-RHEL-7-Server-as-a-Router.html"/>
    <id>https://wolf-7.github.io/Linux/2016/02/12/Firewalld-Rich-and-Direct-Rules-Setting-up-RHEL-7-Server-as-a-Router.html</id>
    <published>2016-02-12T11:21:54.000Z</published>
    <updated>2019-01-14T11:59:08.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><p><a href="https://www.lisenet.com/2016/firewalld-rich-and-direct-rules-setup-rhel-7-server-as-a-router/#comment-1771" target="_blank" rel="noopener">Document links</a></p><hr><a id="more"></a><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;&lt;a href=&quot;https://www.lisenet.com/2016/firewalld-rich-and-direct-rules-setup-rhel-7-server-as-a-router/#comment-1771&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Document links&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://wolf-7.github.io/categories/Linux/"/>
    
    
      <category term="route" scheme="https://wolf-7.github.io/tags/route/"/>
    
  </entry>
  
  <entry>
    <title>Setting up a MariaDB Server with SELinux on RHEL 7</title>
    <link href="https://wolf-7.github.io/RHCE/2016/02/10/Setting-up-a-MariaDB-Server-with-SELinux-on-RHEL-7.html"/>
    <id>https://wolf-7.github.io/RHCE/2016/02/10/Setting-up-a-MariaDB-Server-with-SELinux-on-RHEL-7.html</id>
    <published>2016-02-10T11:21:54.000Z</published>
    <updated>2019-01-14T11:59:08.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><p><a href="https://www.lisenet.com/2016/mariadb-server-with-selinux-on-rhel-7/" target="_blank" rel="noopener">Document links</a></p><hr><a id="more"></a><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;&lt;a href=&quot;https://www.lisenet.com/2016/mariadb-server-with-selinux-on-rhel-7/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Document links&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="RHCE" scheme="https://wolf-7.github.io/categories/RHCE/"/>
    
    
  </entry>
  
  <entry>
    <title>Configure Aggregated Network Links on RHEL 7: Bonding and Teaming</title>
    <link href="https://wolf-7.github.io/RHCE/2016/02/06/Configure-Aggregated-Network-Links-on-RHEL-7-Bonding-and-Teaming.html"/>
    <id>https://wolf-7.github.io/RHCE/2016/02/06/Configure-Aggregated-Network-Links-on-RHEL-7-Bonding-and-Teaming.html</id>
    <published>2016-02-06T11:35:48.000Z</published>
    <updated>2019-01-24T08:20:59.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><font color="" size="3"> Configure network bonding and teaming on RHEL 7. </font><hr><a id="more"></a><p>Aggregated Network Links<br>There are two ways to configure aggregated network links on RHEL 7, via bonding or via teaming.</p><p>Network bonding enables two or more network interfaces to act as one, simultaneously increasing the bandwidth and providing redundancy.</p><p>Network teaming is designed to implement the concept in a different way by providing a small kernel driver to implement the fast handling of packet flows, and various user-space applications to do everything else in user space. The existing bonding driver is unaffected, network teaming is offered as an alternative and does not replace bonding in RHEL 7.</p><h3 id="Before-We-Begin"><a href="#Before-We-Begin" class="headerlink" title="Before We Begin"></a>Before We Begin</h3><p>We have two virtual machines in our lab, with two network interfaces each. One machine will be configured for network bonding, and one for network teaming. Basic IPv6 configuration for network teaming will be covered.</p><p>To avoid problems, we are going to configure networking from the console and not from Secure Shell (SSH). If we do something wrong, at least we won&#x2019;t lose connectivity.</p><h3 id="Caveat-for-VirtualBox"><a href="#Caveat-for-VirtualBox" class="headerlink" title="Caveat for VirtualBox"></a>Caveat for VirtualBox</h3><p>For those using VirtualBox to configure bonding or teaming, ensure that network adapters have promiscuous mode set to &#x201C;Allow All&#x201D;, and then enable promisc mode on the links, for example:<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip link set eth0 promisc on</span></span><br><span class="line"><span class="comment"># ip link set eth1 promisc on</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>The above works OK for testing, but won&#x2019;t persist after reboot. Either add to /etc/rc.local, or write a systemd service to handle it.</p><h3 id="Configure-Network-Bonding"><a href="#Configure-Network-Bonding" class="headerlink" title="Configure Network Bonding"></a>Configure Network Bonding</h3><p>Ensure that the bonding module is loaded:<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># modprobe bonding</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>While not required, feel free to check nmcli examples, where example 6 is about adding a bonding master and two slaves. You may find them useful.<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># man 5 nmcli-examples</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>A bond interface can be created with either the nmcli or the nmtui utilities. We use nmcli since we find it faster and easier to use.</p><p>We are going to delete any existing network configuration to save ourselves some headache:<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nmcli c</span></span><br><span class="line">NAME     UUID                                  TYPE            DEVICE</span><br><span class="line">enp0s8   00cb8299-feb9-55b6-a378-3fdc720e0bc6  802-3-ethernet  enp0s8</span><br><span class="line">enp0s17  8512e951-6012-c639-73b1-5b4d7b469f7f  802-3-ethernet  enp0s17</span><br></pre></td></tr></tbody></table></figure><p></p><p>We see that we have two network cards with predictable network interface names configured. Delete exiting configuration:<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nmcli c del enp0s8 enp0s17</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>Create a bonding interface named mybond0 with an active-backup mode:<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nmcli c add type bond ifname mybond0 con-name mybond0 mode active-backup</span></span><br></pre></td></tr></tbody></table></figure><p></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;font color=&quot;&quot; size=&quot;3&quot;&gt; Configure network bonding and teaming on RHEL 7. &lt;/font&gt;

&lt;hr&gt;
    
    </summary>
    
      <category term="RHCE" scheme="https://wolf-7.github.io/categories/RHCE/"/>
    
    
  </entry>
  
  <entry>
    <title>一台电脑绑定多个GitHub帐号教程</title>
    <link href="https://wolf-7.github.io/Git/2016/02/02/%E4%B8%80%E5%8F%B0%E7%94%B5%E8%84%91%E7%BB%91%E5%AE%9A%E5%A4%9A%E4%B8%AAgithub%E5%B8%90%E5%8F%B7%E6%95%99%E7%A8%8B.html"/>
    <id>https://wolf-7.github.io/Git/2016/02/02/一台电脑绑定多个github帐号教程.html</id>
    <published>2016-02-02T11:21:54.000Z</published>
    <updated>2019-01-16T03:32:06.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><h3 id="&#x601D;&#x8DEF;"><a href="#&#x601D;&#x8DEF;" class="headerlink" title="&#x601D;&#x8DEF;"></a>&#x601D;&#x8DEF;</h3><p>ssh &#x65B9;&#x5F0F;&#x94FE;&#x63A5;&#x5230; Github&#xFF0C;&#x9700;&#x8981;&#x552F;&#x4E00;&#x7684;&#x516C;&#x94A5;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x540C;&#x4E00;&#x53F0;&#x7535;&#x8111;&#x7ED1;&#x5B9A;&#x4E24;&#x4E2A;Github &#x5E10;&#x53F7;&#xFF0C;&#x9700;&#x8981;&#x4E24;&#x4E2A;&#x6761;&#x4EF6;:<br>1.&#x80FD;&#x591F;&#x751F;&#x6210;&#x4E24;&#x5BF9; &#x79C1;&#x94A5;/&#x516C;&#x94A5;<br>2.push &#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x533A;&#x5206;&#x4E24;&#x4E2A;&#x8D26;&#x6237;&#xFF0C;&#x63A8;&#x9001;&#x5230;&#x76F8;&#x5E94;&#x7684;&#x4ED3;&#x5E93;</p><hr><a id="more"></a><p><img src="/images/git.png" width="100%" height="70%"></p><h3 id="&#x89E3;&#x51B3;&#x65B9;&#x6848;"><a href="#&#x89E3;&#x51B3;&#x65B9;&#x6848;" class="headerlink" title="&#x89E3;&#x51B3;&#x65B9;&#x6848;:"></a>&#x89E3;&#x51B3;&#x65B9;&#x6848;:</h3><p>1.&#x751F;&#x6210; &#x79C1;&#x94A5;/&#x516C;&#x94A5; &#x65F6;&#xFF0C;&#x5BC6;&#x94A5;&#x6587;&#x4EF6;&#x547D;&#x540D;&#x907F;&#x514D;&#x91CD;&#x590D;<br>2.&#x8BBE;&#x7F6E;&#x4E0D;&#x540C; Host &#x5BF9;&#x5E94;&#x540C;&#x4E00; HostName &#x4F46;&#x5BC6;&#x94A5;&#x4E0D;&#x540C;<br>3.&#x53D6;&#x6D88; git &#x5168;&#x5C40;&#x7528;&#x6237;&#x540D;/&#x90AE;&#x7BB1;&#x8BBE;&#x7F6E;&#xFF0C;&#x4E3A;&#x6BCF;&#x4E2A;&#x4ED3;&#x5E93;&#x72EC;&#x7ACB;&#x8BBE;&#x7F6E; &#x7528;&#x6237;&#x540D;/&#x90AE;&#x7BB1;</p><h3 id="&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;"><a href="#&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;" class="headerlink" title="&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;"></a>&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;</h3><p>1.&#x67E5;&#x770B;&#x5DF2;&#x6709; &#x5BC6;&#x94A5;<br>Mac &#x4E0B;&#x8F93;&#x5165;&#x547D;&#x4EE4; ls ~/.ssh/&#xFF0C;&#x770B;&#x5230; id_rsa &#x4E0E; id_rsa_pub &#x5219;&#x8BF4;&#x660E;&#x5DF2;&#x7ECF;&#x6709;&#x4E00;&#x5BF9;&#x5BC6;&#x94A5;&#x3002;<br>2.&#x751F;&#x6210;&#x65B0;&#x7684;&#x516C;&#x94A5;&#xFF0C;&#x5E76;&#x547D;&#x540D;&#x4E3A; id_rsa_2 (&#x4FDD;&#x8BC1;&#x4E0E;&#x4E4B;&#x524D;&#x5BC6;&#x94A5;&#x6587;&#x4EF6;&#x540D;&#x79F0;&#x4E0D;&#x540C;&#x5373;&#x53EF;)<br>ssh-keygen -t rsa -f ~/.ssh/id_rsa_2 -C &#x201C;yourmail@xxx.com&#x201D;<br>3.&#x5728; .ssh &#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x65B0;&#x5EFA; config &#x6587;&#x4EF6;&#x5E76;&#x7F16;&#x8F91;&#xFF0C;&#x53E6;&#x4E0D;&#x540C; Host &#x5B9E;&#x9645;&#x6620;&#x5C04;&#x5230;&#x540C;&#x4E00; HostName&#xFF0C;<br>&#x4F46;&#x5BC6;&#x94A5;&#x6587;&#x4EF6;&#x4E0D;&#x540C;&#x3002;Host &#x524D;&#x7F00;&#x53EF;&#x81EA;&#x5B9A;&#x4E49;&#xFF0C;&#x4F8B;&#x5B50;&#x4E2D;wolf7<br></p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># default                                                                       </span></span><br><span class="line">Host github.com</span><br><span class="line">HostName github.com</span><br><span class="line">User git</span><br><span class="line">IdentityFile ~/.ssh/id_rsa</span><br><span class="line"><span class="comment"># rzxwang                                                                           </span></span><br><span class="line">Host rzxwang.github.com</span><br><span class="line">HostName github.com</span><br><span class="line">User git</span><br><span class="line">IdentityFile ~/.ssh/id_rsa_2</span><br></pre></td></tr></tbody></table></figure><p></p><p>4.&#x5C06;&#x751F;&#x6210;&#x7684; id_rsa.pub&#xFF0C;id_rsa_2.pub&#x5185;&#x5BB9;copy &#x5230;&#x5BF9;&#x5E94;&#x7684;GitHub Repository SSH-KEY&#x4E2D;<br>5.&#x6D4B;&#x8BD5; ssh &#x94FE;&#x63A5;<br></p><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x6B64;&#x5904;&#x6D4B;&#x8BD5;&#x4E3A;&#x9ED8;&#x8BA4;&#x914D;&#x7F6E;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;KEY&#x662F;id_rsa</span></span><br><span class="line"><span class="attribute">ssh</span> -T git<span class="variable">@github</span>.com</span><br><span class="line"><span class="comment"># &#x6B64;&#x5904;&#x6D4B;&#x8BD5;&#x4E3A;rzxwang.github.com&#x914D;&#x7F6E;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;KEY&#x662F;id_rsa_2</span></span><br><span class="line">ssh -T git<span class="variable">@rzxwang</span>.github.com</span><br><span class="line"><span class="comment"># Hi rzxwang! You&apos;ve successfully authenticated, but GitHub does not provide shell access.</span></span><br><span class="line"><span class="comment"># &#x51FA;&#x73B0;&#x4E0A;&#x8FB9;&#x8FD9;&#x53E5;&#xFF0C;&#x8868;&#x793A;&#x94FE;&#x63A5;&#x6210;&#x529F;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>6.&#x5C06;&#x9879;&#x76EE; clone &#x5230;&#x672C;&#x5730;&#xFF0C; folder-name &#x662F;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x5939;&#x8DEF;&#x5F84;<br></p><figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@rzxwang<span class="selector-class">.github</span><span class="selector-class">.com</span>:rzxwang/rzxwang<span class="selector-class">.github</span><span class="selector-class">.io</span><span class="selector-class">.git</span> wofl7.org</span><br></pre></td></tr></tbody></table></figure><p></p><p>7.&#x53D6;&#x6D88;&#x5168;&#x5C40; &#x7528;&#x6237;&#x540D;/&#x90AE;&#x7BB1;&#x8BBE;&#x7F6E;&#xFF0C;&#x5E76;&#x8FDB;&#x5165;&#x9879;&#x76EE;&#x6587;&#x4EF6;&#x5939;&#x5355;&#x72EC;&#x8BBE;&#x7F6E;<br></p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x53D6;&#x6D88;&#x5168;&#x5C40; &#x7528;&#x6237;&#x540D;/&#x90AE;&#x7BB1; &#x914D;&#x7F6E;</span></span><br><span class="line">git<span class="built_in"> config </span>&#x2013;global &#x2013;unset user.name</span><br><span class="line">git<span class="built_in"> config </span>&#x2013;global &#x2013;unset user.email</span><br><span class="line"><span class="comment"># &#x5355;&#x72EC;&#x8BBE;&#x7F6E;&#x6BCF;&#x4E2A;repo &#x7528;&#x6237;&#x540D;/&#x90AE;&#x7BB1;</span></span><br><span class="line">git<span class="built_in"> config </span>user.email &#x201C;xxxx@xx.com&#x201D;</span><br><span class="line">git<span class="built_in"> config </span>user.name &#x201C;xxxx&#x201D;</span><br></pre></td></tr></tbody></table></figure><p></p><p>8.&#x547D;&#x4EE4;&#x884C;&#x8FDB;&#x5165;&#x9879;&#x76EE;&#x76EE;&#x5F55;&#xFF0C;&#x91CD;&#x5EFA; origin (rzxwang &#x4E3A;&#x76F8;&#x5E94;&#x9879;&#x76EE;&#x5730;&#x5740;)<br></p><figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote rm origin</span><br><span class="line">git remote add origin git@rzxwang<span class="selector-class">.github</span><span class="selector-class">.com</span>:rzxwang/rzxwang<span class="selector-class">.github</span><span class="selector-class">.io</span><span class="selector-class">.git</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>9.&#x6210;&#x529F;&#xFF0C;&#x53EF;&#x4EE5; push &#x6D4B;&#x8BD5;&#x4E00;&#x4E0B;.<br></p><figure class="highlight maxima"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">push</span> <span class="built_in">origin</span> master</span><br></pre></td></tr></tbody></table></figure><p></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;h3 id=&quot;思路&quot;&gt;&lt;a href=&quot;#思路&quot; class=&quot;headerlink&quot; title=&quot;思路&quot;&gt;&lt;/a&gt;思路&lt;/h3&gt;&lt;p&gt;ssh 方式链接到 Github，需要唯一的公钥，如果想同一台电脑绑定两个Github 帐号，需要两个条件:&lt;br&gt;1.能够生成两对 私钥/公钥&lt;br&gt;2.push 时，可以区分两个账户，推送到相应的仓库&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="Git" scheme="https://wolf-7.github.io/categories/Git/"/>
    
    
      <category term="Git" scheme="https://wolf-7.github.io/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>使用 NGINX 流控和 fail2ban 防止 CC 攻击</title>
    <link href="https://wolf-7.github.io/uncategorized/2016/01/24/%E4%BD%BF%E7%94%A8-NGINX-%E6%B5%81%E6%8E%A7%E5%92%8C-fail2ban-%E9%98%B2%E6%AD%A2-CC-%E6%94%BB%E5%87%BB.html"/>
    <id>https://wolf-7.github.io/uncategorized/2016/01/24/使用-NGINX-流控和-fail2ban-防止-CC-攻击.html</id>
    <published>2016-01-24T07:54:01.000Z</published>
    <updated>2019-01-24T08:19:33.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="&#x80CC;&#x666F;&#x77E5;&#x8BC6;"><a href="#&#x80CC;&#x666F;&#x77E5;&#x8BC6;" class="headerlink" title="&#x80CC;&#x666F;&#x77E5;&#x8BC6;"></a>&#x80CC;&#x666F;&#x77E5;&#x8BC6;</h2><h3 id="CC-&#x653B;&#x51FB;"><a href="#CC-&#x653B;&#x51FB;" class="headerlink" title="CC &#x653B;&#x51FB;"></a>CC &#x653B;&#x51FB;</h3><p>&#x653B;&#x51FB;&#x8005;&#x901A;&#x8FC7;&#x521B;&#x5EFA;&#x5927;&#x91CF;&#x8BF7;&#x6C42;&#x5BFC;&#x81F4;&#x670D;&#x52A1;&#x5668;&#x8D44;&#x6E90;&#x8017;&#x5C3D;&#xFF0C;&#x4E3B;&#x8981;&#x9488;&#x5BF9;&#x7279;&#x5B9A;&#x670D;&#x52A1;&#x63A5;&#x53E3;&#xFF0C;&#x5C5E;&#x4E8E;&#x5B9E;&#x73B0; DoS &#x653B;&#x51FB;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#xFF08;DoS &#x653B;&#x51FB;&#x66F4;&#x591A;&#x662F;&#x9488;&#x5BF9;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5177;&#x4F53;&#x670D;&#x52A1;&#x63A5;&#x53E3;&#xFF09;&#x3002;</p><h3 id="NGINX-&#x6D41;&#x63A7;"><a href="#NGINX-&#x6D41;&#x63A7;" class="headerlink" title="NGINX &#x6D41;&#x63A7;"></a>NGINX &#x6D41;&#x63A7;</h3><ul><li>limit_req_zone&#xFF1A;&#x901A;&#x8FC7;&#x201C;&#x6F0F;&#x6876;&#x201D;&#x7B97;&#x6CD5;&#x9650;&#x5236;&#x6BCF;&#x4E2A; IP &#x53D1;&#x8D77;&#x7684;&#x8BF7;&#x6C42;&#x9891;&#x7387;&#x3002;</li><li>limit_conn_zone&#xFF1A;&#x9650;&#x5236;&#x6BCF;&#x4E2A; IP &#x53D1;&#x8D77;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#x3002;<h3 id="fail2ban"><a href="#fail2ban" class="headerlink" title="fail2ban"></a>fail2ban</h3>&#x901A;&#x8FC7;&#x5339;&#x914D;&#x670D;&#x52A1;&#x5668;&#x65E5;&#x5FD7;&#x64CD;&#x4F5C; iptables &#x6765;&#x9650;&#x5236;&#x5BA2;&#x6237;&#x7AEF;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x3002;</li></ul><a id="more"></a><h2 id="&#x5B9E;&#x8DF5;&#x914D;&#x7F6E;"><a href="#&#x5B9E;&#x8DF5;&#x914D;&#x7F6E;" class="headerlink" title="&#x5B9E;&#x8DF5;&#x914D;&#x7F6E;"></a>&#x5B9E;&#x8DF5;&#x914D;&#x7F6E;</h2><h3 id="NGINX-&#x90E8;&#x5206;"><a href="#NGINX-&#x90E8;&#x5206;" class="headerlink" title="NGINX &#x90E8;&#x5206;"></a>NGINX &#x90E8;&#x5206;</h3><p>&#x5728; http &#x90E8;&#x5206;&#x4E2D;&#x914D;&#x7F6E;&#xFF1A;</p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">limit_req_zone <span class="variable">$binary_remote_addr</span> <span class="attribute">zone</span>=sym:10m <span class="attribute">rate</span>=5r/s;</span><br><span class="line">limit_conn_zone <span class="variable">$binary_remote_addr</span> <span class="attribute">zone</span>=conn_sym:10m;</span><br></pre></td></tr></tbody></table></figure><p>&#x7136;&#x540E;&#x5728;&#x9700;&#x8981;&#x6D41;&#x63A7;&#x7684; location &#x90E8;&#x5206;&#x914D;&#x7F6E;&#xFF1A;</p><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">limit_req <span class="attribute">zone</span>=sym <span class="attribute">burst</span>=5;</span><br><span class="line">limit_conn conn_sym 10;</span><br></pre></td></tr></tbody></table></figure><p>&#x91CD;&#x542F; NGINX &#x540E;&#x5F53;&#x6709;&#x8D85;&#x6D41;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x65F6;&#x5C06;&#x5728; NGINX error.log&#xFF08;&#x9ED8;&#x8BA4;&#x5728; <code>/var/log/nginx/error.log</code>&#xFF09; &#x4E2D;&#x770B;&#x5230;&#x7C7B;&#x4F3C;&#x8BB0;&#x5F55;&#xFF1A;<br></p><figure class="highlight accesslog"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span>/<span class="number">02</span>/<span class="number">12</span> <span class="number">18</span>:<span class="number">03</span>:<span class="number">57</span> <span class="string">[error]</span><span class="number">15965</span>#<span class="number">15965</span>: *<span class="number">61240</span> limiting requests, excess: <span class="number">6</span>.<span class="number">000</span> by zone <span class="string">&quot;sym&quot;</span>, client: <span class="number">121.41.106.121</span>, server: hacpai.com, request: <span class="string">&quot;<span class="keyword">GET</span> / HTTP/1.0&quot;</span>, host: <span class="string">&quot;hacpai.com&quot;</span></span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x6B64;&#x65F6;&#x8BF7;&#x6C42;&#x5DF2;&#x7ECF;&#x88AB; NGINX &#x9650;&#x6D41;&#xFF0C;&#x4F46;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x4ECD;&#x7136;&#x80FD;&#x591F;&#x7EE7;&#x7EED;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#xFF0C;&#x5360;&#x7528;&#x670D;&#x52A1;&#x5668;&#x8D44;&#x6E90;&#x3002;</p><h3 id="fail2ban-&#x90E8;&#x5206;"><a href="#fail2ban-&#x90E8;&#x5206;" class="headerlink" title="fail2ban &#x90E8;&#x5206;"></a>fail2ban &#x90E8;&#x5206;</h3><p>&#x65B0;&#x5EFA; <code>/etc/fail2ban/jail.d/sym.conf</code> &#x6587;&#x4EF6;&#xFF0C;&#x52A0;&#x5165;&#x5982;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;<br></p><figure class="highlight makefile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[sym-cc]</span><br><span class="line">enabled  = true</span><br><span class="line">port     = https,http</span><br><span class="line">filter   = sym</span><br><span class="line">logpath  = /var/log/nginx/*error.log</span><br><span class="line">maxretry = 120</span><br><span class="line">findtime = 60</span><br><span class="line">bantime  = 120</span><br><span class="line">action   = iptables-multiport[name=Sym, port=<span class="string">&quot;https,http&quot;</span>, protocol=tcp]</span><br><span class="line">           sendmail-whois-lines[name=Sym, dest=youremail@gmail.com]</span><br></pre></td></tr></tbody></table></figure><p></p><p>findtime 60 &#x79D2;&#x5185;&#x5982;&#x679C;&#x6709;&#x8D85;&#x8FC7; maxretry 120 &#x6B21;&#x5339;&#x914D;&#x5230;&#x5219;&#x7981;&#x6B62;&#x8FDE;&#x63A5; bantime 120 &#x79D2;&#x3002;&#x7981;&#x6B62;&#x8FDE;&#x63A5;&#x901A;&#x8FC7;&#x64CD;&#x4F5C; iptables &#x5B9E;&#x73B0; &#x3002;&#xFF08;&#x8981;&#x53D1;&#x9001;&#x90AE;&#x4EF6;&#xFF0C;&#x9700;&#x8981;&#x5B89;&#x88C5;&#x914D;&#x7F6E;&#x597D; sendmail&#xFF09;</p><p>&#x91CD;&#x542F; fail2ban &#x540E;&#x5F53;&#x53D1;&#x751F;&#x8D85;&#x6D41;&#x65F6;&#x53EF;&#x4EE5;&#x5728; <code>/var/log/fail2ban.log</code> &#x4E2D;&#x770B;&#x5230;&#x7C7B;&#x4F3C;&#x8BB0;&#x5F55;&#xFF1A;</p><figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2017<span class="selector-tag">-02-12</span> 18<span class="selector-pseudo">:01</span><span class="selector-pseudo">:26</span>,968 <span class="selector-tag">fail2ban</span><span class="selector-class">.actions</span>: <span class="selector-tag">WARNING</span> <span class="selector-attr">[sym-cc]</span> <span class="selector-tag">Ban</span> 121<span class="selector-class">.41</span><span class="selector-class">.106</span><span class="selector-class">.121</span></span><br></pre></td></tr></tbody></table></figure><p>&#x53E6;&#x5916;&#xFF1A;</p><ul><li><code>fail2ban-client status</code>&#x3001;<code>fail2ban-client status sym-cc</code> &#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x5F53;&#x524D;&#x7981;&#x6B62;&#x4FE1;&#x606F;</li><li><code>fail2ban-regex /var/log/nginx/error.log /etc/fail2ban/filter.d/sym.conf</code> &#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x914D;&#x7F6E;&#x5339;&#x914D;&#x60C5;&#x51B5;&#x3002;<h2 id="&#x6CE8;&#x610F;&#x4E8B;&#x9879;"><a href="#&#x6CE8;&#x610F;&#x4E8B;&#x9879;" class="headerlink" title="&#x6CE8;&#x610F;&#x4E8B;&#x9879;"></a>&#x6CE8;&#x610F;&#x4E8B;&#x9879;</h2></li></ul><h3 id="fail2ban-1"><a href="#fail2ban-1" class="headerlink" title="fail2ban"></a>fail2ban</h3><ul><li>&#x670D;&#x52A1;&#x91CD;&#x542F;&#x53EF;&#x80FD;&#x8F83;&#x6162;&#xFF0C;&#x8010;&#x5FC3;&#x7B49;&#x5F85;</li><li>findtime &#x4E0D;&#x8981;&#x5C0F;&#x4E8E; 60 &#x79D2;</li><li>action &#x7528; iptables-multiport &#x540C;&#x65F6;&#x8BBE;&#x7F6E; HTTPS &#x548C; HTTP</li><li>&#x53EF;&#x80FD;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x624B;&#x52A8;&#x52A0;&#x5165;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x9879;</li></ul><p>&#x5982;&#x679C; NGINX &#x5F00;&#x4E86; <code>access_log</code>&#xFF0C;&#x5176;&#x5B9E;&#x4E5F;&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7C97;&#x66B4;&#x4E00;&#x70B9;&#x76F4;&#x63A5;&#x5C06; fail2ban &#x914D;&#x7F6E;&#x5230;&#x8BBF;&#x95EE;&#x65E5;&#x5FD7;&#x4E0A;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x4E0D;&#x7528;&#x914D;&#x7F6E; NGINX &#x6D41;&#x63A7;&#x6A21;&#x5757;&#x4E86;&#xFF0C;&#x4E0D;&#x8FC7;&#x7F3A;&#x70B9;&#x662F;&#x5931;&#x53BB;&#x4E86;&#x201C;&#x5F39;&#x6027;&#x201D;&#x3002;</p><h3 id="NGINX"><a href="#NGINX" class="headerlink" title="NGINX"></a>NGINX</h3><p>&#x4E0A;&#x9762;&#x63D0;&#x5230;&#x7684; NGINX &#x6D41;&#x63A7;&#x6A21;&#x5757;&#x7684;&#x201C;&#x5F39;&#x6027;&#x201D;&#x4E3B;&#x8981;&#x6307;&#x7684;&#x662F; <code>limit_req_zone</code> &#x6A21;&#x5757;&#x4E2D; <code>burst</code> &#x548C; <code>nodelay</code>&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x7EC4;&#x5408;&#x4F7F;&#x7528;&#x3002;</p><ul><li><code>rate</code>&#xFF1A;&#x6309;&#x7167;&#x56FA;&#x5B9A;&#x901F;&#x7387;&#x201C;&#x6F0F;&#x8BF7;&#x6C42;&#x201D;&#x7ED9;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x5668;</li><li><code>burst</code>&#xFF1A;&#x53EF;&#x7406;&#x89E3;&#x4E3A;&#x6876;&#x5927;&#x5C0F;&#xFF0C;&#x80FD;&#x88C5;&#x591A;&#x5C11;&#x4E2A;&#x8BF7;&#x6C42;</li><li><code>nodelay</code>&#xFF1A;&#x5E26;&#x4E86;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x8BDD;&#x5728;&#x6876;&#x88C5;&#x4E0D;&#x4E0B;&#x65F6;&#x5C06;&#x8BF7;&#x6C42;&#x201C;&#x5168;&#x90E8;&#x5012;&#x7ED9;&#x201D;&#x540E;&#x7AEF;&#x670D;&#x52A1;&#x5668;&#xFF1B;&#x5982;&#x679C;&#x4E0D;&#x5E26;&#x7684;&#x8BDD;&#x8BF7;&#x6C42;&#x8FD8;&#x662F;&#x6309;&#x7167;&#x901F;&#x7387;&#x6162;&#x6162;&#x6F0F;<h3 id="&#x65E5;&#x5FD7;&#x6E05;&#x7406;"><a href="#&#x65E5;&#x5FD7;&#x6E05;&#x7406;" class="headerlink" title="&#x65E5;&#x5FD7;&#x6E05;&#x7406;"></a>&#x65E5;&#x5FD7;&#x6E05;&#x7406;</h3></li></ul><p>&#x9700;&#x8981;&#x5B9A;&#x65F6;&#x6E05;&#x7406; NGINX&#x3001;fail2ban &#x65E5;&#x5FD7;&#xFF0C;&#x9632;&#x6B62;&#x78C1;&#x76D8;&#x7A7A;&#x95F4;&#x5360;&#x7528;&#x8FC7;&#x5927;&#x3002;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;背景知识&quot;&gt;&lt;a href=&quot;#背景知识&quot; class=&quot;headerlink&quot; title=&quot;背景知识&quot;&gt;&lt;/a&gt;背景知识&lt;/h2&gt;&lt;h3 id=&quot;CC-攻击&quot;&gt;&lt;a href=&quot;#CC-攻击&quot; class=&quot;headerlink&quot; title=&quot;CC 攻击&quot;&gt;&lt;/a&gt;CC 攻击&lt;/h3&gt;&lt;p&gt;攻击者通过创建大量请求导致服务器资源耗尽，主要针对特定服务接口，属于实现 DoS 攻击的一种方式（DoS 攻击更多是针对网络端口，而不是具体服务接口）。&lt;/p&gt;
&lt;h3 id=&quot;NGINX-流控&quot;&gt;&lt;a href=&quot;#NGINX-流控&quot; class=&quot;headerlink&quot; title=&quot;NGINX 流控&quot;&gt;&lt;/a&gt;NGINX 流控&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;limit_req_zone：通过“漏桶”算法限制每个 IP 发起的请求频率。&lt;/li&gt;
&lt;li&gt;limit_conn_zone：限制每个 IP 发起的连接数。&lt;h3 id=&quot;fail2ban&quot;&gt;&lt;a href=&quot;#fail2ban&quot; class=&quot;headerlink&quot; title=&quot;fail2ban&quot;&gt;&lt;/a&gt;fail2ban&lt;/h3&gt;通过匹配服务器日志操作 iptables 来限制客户端网络连接。&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>jetbrains 激活服务器搭建</title>
    <link href="https://wolf-7.github.io/uncategorized/2016/01/24/jetbrains-%E6%BF%80%E6%B4%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA.html"/>
    <id>https://wolf-7.github.io/uncategorized/2016/01/24/jetbrains-激活服务器搭建.html</id>
    <published>2016-01-24T07:38:32.000Z</published>
    <updated>2019-01-24T08:20:29.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><p>&#x4E00;&#x53F0;VPS<br>&#x8FDE;vps&#x90FD;&#x6CA1;&#x6709;&#xFF0C;&#x5C0F;&#x62F3;&#x5934;&#x4F60;&#x6015;&#x4E0D;&#x6015;(&#xE07; &#x2022;&#x300;_&#x2022;&#x301;)&#xE07; &#x3002; &#x90A3;&#x4F60;&#x7528;&#x6211;&#x7684;&#x5427;&#xFF0C;&#x256E;(&#x256F;&#x25BD;&#x2570;)&#x256D; &#x3002;</p><hr><a id="more"></a><p>&#x4E00;&#x952E;&#x811A;&#x672C;<br>&#x5EFA;&#x8BAE;&#x5728;&#x7279;&#x6743;&#x6A21;&#x5F0F;&#x4E0B;&#x8FD0;&#x884C;&#xFF0C;&#x5373;sudo -s&#x4E00;&#x4E0B;</p><p><code>wget http://home.ustc.edu.cn/~mmmwhy/jetbrain.sh &amp;&amp; sh ./jetbrain.sh</code><br>&#x811A;&#x672C;&#x5185;&#x5BB9;<br></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">curl -o 86 <span class="string">&quot;http://home.ustc.edu.cn/~mmmwhy/86&quot;</span></span><br><span class="line">chmod 777 86</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&#x8BF7;&#x8F93;&#x5165;jetbains&#x6FC0;&#x6D3B;&#x670D;&#x52A1;&#x5668;&#x7684;&#x7AEF;&#x53E3; [1-65535]:&quot;</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;(&#x9ED8;&#x8BA4;&#x7AEF;&#x53E3;: 104):&quot;</span> httpport</span><br><span class="line">[ -z <span class="string">&quot;<span class="variable">$httpport</span>&quot;</span> ] &amp;&amp; httpport=<span class="string">&quot;104&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&#x8BF7;&#x8F93;&#x5165;jetbains&#x7528;&#x6237;&#x540D;(&#x4EC5;&#x82F1;&#x6587;):&quot;</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;(&#x9ED8;&#x8BA4;&#x7528;&#x6237;&#x540D;: feiyang):&quot;</span> name</span><br><span class="line">[ -z <span class="string">&quot;<span class="variable">$name</span>&quot;</span> ] &amp;&amp; name=<span class="string">&quot;feiyang&quot;</span></span><br><span class="line">ip=`curl -m 10 -s http://members.3322.org/dyndns/getip`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&#x60A8;&#x9009;&#x62E9;&#x7684;&#x7AEF;&#x53E3;&#x662F;&#xFF1A;<span class="variable">${httpport}</span>,&#x7528;&#x6237;&#x540D;&#x662F;&#xFF1A;<span class="variable">${name}</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;&#x672C;&#x5730; IP : \033[41;37m <span class="variable">${ip}</span> \033[0m&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;                                                  &quot;</span></span><br><span class="line"><span class="built_in">echo</span>  -e <span class="string">&quot;  License sever&#x5730;&#x5740;&#x586B;&#x5199;&#x4E3A; \033[41;37m  http://<span class="variable">${ip}</span>:<span class="variable">${httpport}</span> \033[0m&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;                                                  &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;                                                  &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;                                                  &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;                                                  &quot;</span></span><br><span class="line">screen -dmS IntelliJIDEALicenseServer -d -m ./86 -p <span class="variable">${httpport}</span> -u <span class="variable">${name}</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br></pre></td></tr></tbody></table></figure><p></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;一台VPS&lt;br&gt;连vps都没有，小拳头你怕不怕(ง •̀_•́)ง 。 那你用我的吧，╮(╯▽╰)╭ 。&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Linux启动流程</title>
    <link href="https://wolf-7.github.io/uncategorized/2015/01/24/Linux%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B.html"/>
    <id>https://wolf-7.github.io/uncategorized/2015/01/24/Linux启动流程.html</id>
    <published>2015-01-24T07:44:30.000Z</published>
    <updated>2019-01-24T08:20:08.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><a href="http://oqfz9mxmq.bkt.clouddn.com/20170624-Linuxboot-1.jpeg" target="_blank" rel="noopener"><img src="http://oqfz9mxmq.bkt.clouddn.com/20170624-Linuxboot-1.jpeg" alt=""></a><br><strong>&#x80CC;&#x666F;&#x6545;&#x4E8B;&#xFF1A;</strong>&#x4E3A;&#x5565;&#x60F3;&#x8D77;&#x6765;&#x5199;Linux&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x4E86;&#x5462;&#xFF0C;&#x8FD9;&#x4E2A;&#x5462;&#x8981;&#x4ECE;&#x4E00;&#x4E2A;&#x6708;&#x4EE5;&#x524D;&#x8BF4;&#x8D77;&#xFF0C;&#x871C;&#x6C41;&#x5C34;&#x5C2C;~~~&#x3002;&#x6211;&#x5AB3;&#x5987;&#x7528;&#x7684;Ubuntu&#xFF0C;&#x7136;&#x540E;&#x5979;&#x9700;&#x8981;&#x88C5;&#x5F88;&#x591A;&#x73AF;&#x5883;&#xFF0C;&#x4E0D;&#x77E5;&#x9053;&#x4E3A;&#x4F55;&#x5185;&#x6838;&#x8001;&#x662F;&#x66F4;&#x65B0;&#xFF0C;&#x7ED3;&#x679C;&#x5C31;&#x662F;&#x540E;&#x9762;&#x88C5;&#x4E1C;&#x897F;&#x7684;&#x65F6;&#x5019;&#x63D0;&#x793A;/boot&#x5206;&#x533A;&#x7A7A;&#x95F4;&#x4E0D;&#x8DB3;&#x65E0;&#x6CD5;&#x5B89;&#x88C5;&#xFF0C;&#x4F46;&#x6211;&#x5929;&#x771F;&#x53EF;&#x7231;&#x7684;&#x5AB3;&#x5987;&#x4E0D;&#x4F1A;&#x6E05;&#x5440;&#xFF0C;&#x7136;&#x540E;&#x6211;&#x5C31;&#x6765;&#x4E86;&#xFF0C;&#x4E00;&#x770B;&#x7B80;&#x5355;&#x554A;&#xFF0C;&#x5220;&#x5457;&#xFF0C;&#x51E1;&#x4E8B;&#x603B;&#x6709;<strong>BUT</strong>&#xFF0C;&#x6211;&#x89C9;&#x5F97;&#x8FD9;&#x4E2A;&#x4E8B;&#x60C5;&#x561B;&#x8981;&#x6E05;&#x5C31;&#x8981;&#x6E05;&#x5F7B;&#x5E95;&#xFF0C;&#x5C31;&#x4E0D;rm-rf&#x4E86;&#xFF0C;&#x76F4;&#x63A5;&#x5378;&#x5B89;&#x88C5;&#x5305;&#x591A;&#x6E05;&#x723D;&#xFF0C;&#x4E8E;&#x662F;&#x4E4E;&#x7CFB;&#x7EDF;&#x6302;&#x4E86;&#xFF0C;&#x5241;&#x624B;&#x554A;&#x6253;&#x4EC0;&#x4E48;&#x901A;&#x914D;&#x7B26;&#x3002;&#x3002;&#x3002;&#x4E0D;&#x8FC7;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x8FD8;&#x662F;&#x5BF9;&#x7CFB;&#x7EDF;&#x5C42;&#x8BA4;&#x8BC6;&#x4E0D;&#x591F;&#x751F;&#x52A8;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x8865;&#x4E00;&#x7BC7;&#x65E5;&#x5FD7;&#xFF0C;&#x4E07;&#x4E00;&#x6211;&#x6700;&#x68D2;&#x7684;&#x5AB3;&#x5987;&#x770B;&#x5230;&#x4E86;&#x5462;&#xFF0C;&#x90A3;&#x5C31;&#x70B9;&#x70B9;&#x70B9;~</p><a id="more"></a><h3 id="&#x8BA1;&#x7B97;&#x673A;&#x5982;&#x4F55;&#x542F;&#x52A8;&#x7684;"><a href="#&#x8BA1;&#x7B97;&#x673A;&#x5982;&#x4F55;&#x542F;&#x52A8;&#x7684;" class="headerlink" title="&#x8BA1;&#x7B97;&#x673A;&#x5982;&#x4F55;&#x542F;&#x52A8;&#x7684;"></a>&#x8BA1;&#x7B97;&#x673A;&#x5982;&#x4F55;&#x542F;&#x52A8;&#x7684;</h3><p>&#x53C8;&#x770B;&#x4E86;&#x4E00;&#x904D;&#x962E;&#x4E00;&#x5CF0;&#x5173;&#x4E8E;&#x8FD9;&#x4E2A;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x89C9;&#x5F97;&#x81EA;&#x5DF1;&#x5C31;&#x5148;&#x4E0D;&#x5199;&#x4E86;&#xFF0C;&#x540E;&#x7EED;&#x81EA;&#x5DF1;&#x518D;&#x7406;&#x89E3;&#x7740;&#x5199;&#x5427;&#x3002;&#x3002;&#x65F6;&#x95F4;&#x6709;&#x9650;&#x554A;&#xFF0C;&#x53C2;&#x8003;<a href="http://www.ruanyifeng.com/blog/2013/02/booting.html" target="_blank" rel="noopener">&#x8BA1;&#x7B97;&#x673A;&#x662F;&#x5982;&#x4F55;&#x542F;&#x52A8;&#x7684;</a></p><h3 id="&#x7CFB;&#x7EDF;&#x5982;&#x4F55;&#x542F;&#x52A8;&#x7684;"><a href="#&#x7CFB;&#x7EDF;&#x5982;&#x4F55;&#x542F;&#x52A8;&#x7684;" class="headerlink" title="&#x7CFB;&#x7EDF;&#x5982;&#x4F55;&#x542F;&#x52A8;&#x7684;"></a>&#x7CFB;&#x7EDF;&#x5982;&#x4F55;&#x542F;&#x52A8;&#x7684;</h3><p><strong>&#x8BF4;&#x660E;&#x4E00;&#x4E0B;</strong>&#x8FD9;&#x4E9B;&#x56FE;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x641C;&#x7D22;&#x5F15;&#x64CE;&#x6293;&#x8FC7;&#x6765;&#x7684;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x6211;&#x753B;&#x7684;&#x3002;&#x66F4;&#x8BE6;&#x7EC6;&#x7684;&#x8BF4;&#x660E;&#x770B;&#x53C2;&#x8003;&#x5730;&#x5740;&#x91CC;&#x7684;&#x6587;&#x7AE0;&#x91CC;&#x9762;&#x5199;&#x7684;&#x5F88;&#x597D;&#x3002;<br><a href="http://oqfz9mxmq.bkt.clouddn.com/20170624-Linuxboot-3.png" target="_blank" rel="noopener"><img src="http://oqfz9mxmq.bkt.clouddn.com/20170624-Linuxboot-3.png" alt=""></a><br><strong>&#x6765;&#x770B;&#x770B;&#x4E0A;&#x56FE;</strong>&#xFF0C;&#x8FD9;&#x4E2A;&#x5C31;&#x662F;Linux&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x7684;&#x6D41;&#x7A0B;&#x4E0D;&#x8FC7;&#x6BD4;&#x8F83;&#x7B80;&#x7565;&#xFF0C;&#x4F46;&#x8981;&#x70B9;&#x90FD;&#x5728;&#xFF0C;&#x4E0B;&#x5F20;&#x56FE;&#x4F1A;&#x66F4;&#x8BE6;&#x5C3D;&#x4E00;&#x70B9;&#xFF0C;&#x63A5;&#x7740;&#x770B;&#x5427;<br><a href="http://oqfz9mxmq.bkt.clouddn.com/20170624-Linuxboot-2.png" target="_blank" rel="noopener"><img src="http://oqfz9mxmq.bkt.clouddn.com/20170624-Linuxboot-2.png" alt=""></a><br>&#x8FD9;&#x5F20;&#x56FE;&#x5C31;&#x66F4;&#x8BE6;&#x7EC6;&#x70B9;&#x4E86;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD8;&#x6709;&#x66F4;&#x8BE6;&#x5C3D;&#x7684;&#xFF0C;Look&#x4E0B;&#x9762;<br><a href="http://oqfz9mxmq.bkt.clouddn.com/20170624-Linuxboot-4.jpeg" target="_blank" rel="noopener"><img src="http://oqfz9mxmq.bkt.clouddn.com/20170624-Linuxboot-4.jpeg" alt=""></a><br>&#x55EF;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x5F88;&#x5C34;&#x5C2C;&#x4E86;&#xFF0C;&#x611F;&#x89C9;&#x770B;&#x56FE;&#x5C31;&#x591F;&#x4E86;&#xFF0C;&#x6211;&#x4E5F;&#x5C31;&#x4E0D;&#x5570;&#x55E6;&#x4E86;&#xFF0C;&#x86EE;&#x597D;~~</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;http://oqfz9mxmq.bkt.clouddn.com/20170624-Linuxboot-1.jpeg&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;img src=&quot;http://oqfz9mxmq.bkt.clouddn.com/20170624-Linuxboot-1.jpeg&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;br&gt;&lt;strong&gt;背景故事：&lt;/strong&gt;为啥想起来写Linux启动流程了呢，这个呢要从一个月以前说起，蜜汁尴尬~~~。我媳妇用的Ubuntu，然后她需要装很多环境，不知道为何内核老是更新，结果就是后面装东西的时候提示/boot分区空间不足无法安装，但我天真可爱的媳妇不会清呀，然后我就来了，一看简单啊，删呗，凡事总有&lt;strong&gt;BUT&lt;/strong&gt;，我觉得这个事情嘛要清就要清彻底，就不rm-rf了，直接卸安装包多清爽，于是乎系统挂了，剁手啊打什么通配符。。。不过总结一下还是对系统层认识不够生动，所以就补一篇日志，万一我最棒的媳妇看到了呢，那就点点点~&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>运维蓝图思考</title>
    <link href="https://wolf-7.github.io/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/2015/01/02/%E8%BF%90%E7%BB%B4%E8%93%9D%E5%9B%BE%E6%80%9D%E8%80%83.html"/>
    <id>https://wolf-7.github.io/职业规划/2015/01/02/运维蓝图思考.html</id>
    <published>2015-01-02T13:09:25.000Z</published>
    <updated>2019-01-16T03:32:07.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><hr><p><font color="" size="3"> &#x6700;&#x8FD1;&#x5728;&#x505A;2015&#x5E74;&#x89C4;&#x5212;&#xFF0C;&#x601D;&#x8003;&#x8FD0;&#x7EF4;&#x5230;&#x5E95;&#x5E94;&#x8BE5;&#x5E72;&#x54EA;&#x4E9B;&#x4E8B;&#xFF0C;&#x5F97;&#x51FA;&#x5982;&#x4E0B;&#x56FE;&#x8868;&#x4E00;&#x5F20;&#xFF0C;&#x6B22;&#x8FCE;&#x5404;&#x4F4D;&#x540C;&#x4EC1;&#x4E00;&#x8D77;&#x8BA8;&#x8BBA;&#x3002;</font>&#x2003;</p><hr><a id="more"></a><p><font color="red" size="4"> <strong> &#x8FD0;&#x7EF4;&#x84DD;&#x56FE; </strong> </font><br><img src="/images/operation-1.jpg" width="100%" height="80%"></p><h4 id="&#x5B9A;&#x6807;&#x51C6;"><a href="#&#x5B9A;&#x6807;&#x51C6;" class="headerlink" title="&#x5B9A;&#x6807;&#x51C6;"></a>&#x5B9A;&#x6807;&#x51C6;</h4><p>&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x7EBF;&#x4E0A;&#x73AF;&#x5883;&#x662F;&#x7EDF;&#x4E00;&#x7684;&#x3001;&#x5E72;&#x51C0;&#x7684;&#x3001;&#x89C4;&#x8303;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x8981;&#x5B9A;&#x6807;&#x51C6;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p><ul><li><p>&#x673A;&#x578B;&#xFF1A;&#x7EBF;&#x4E0A;&#x673A;&#x578B;&#x5C3D;&#x91CF;&#x5C11;&#xFF0C;&#x7701;&#x5F97;&#x5149;&#x5404;&#x79CD;&#x673A;&#x578B;&#x7684;&#x5907;&#x673A;&#x5C31;&#x4E00;&#x5927;&#x5806;&#xFF0C;&#x6D6A;&#x8D39;&#x6210;&#x672C;&#xFF0C;&#x9488;&#x5BF9;&#x5C11;&#x91CF;&#x673A;&#x578B;&#x505A;&#x7CBE;&#xFF0C;&#x7A33;&#x5B9A;&#x6027;&#x4E5F;&#x66F4;&#x5BB9;&#x6613;&#x505A;</p></li><li><p>OS&#xFF1A;&#x6BD4;&#x5982;&#x7EDF;&#x4E00;CentOS6.8&#xFF0C;&#x7EDF;&#x4E00;kernel&#xFF0C;&#x7EDF;&#x4E00;&#x5404;&#x79CD;&#x4F18;&#x5316;&#x914D;&#x7F6E;&#xFF0C;&#x66F4;&#x5B89;&#x5168;&#xFF0C;&#x66F4;&#x7A33;&#x5B9A;</p></li><li><p>&#x7B2C;&#x4E09;&#x65B9;&#x8F6F;&#x4EF6;&#xFF1A;&#x6BD4;&#x5982;MySQL&#x3001;Tomcat&#x3001;Nginx&#xFF0C;&#x5C3D;&#x91CF;&#x7EDF;&#x4E00;&#x7248;&#x672C;&#xFF0C;&#x7EDF;&#x4E00;&#x6269;&#x5C55;&#xFF0C;&#x7EDF;&#x4E00;&#x90E8;&#x7F72;&#x65B9;&#x5F0F;&#xFF0C;&#x7EDF;&#x4E00;&#x76D1;&#x63A7;&#x65B9;&#x5F0F;</p></li><li><p>&#x53D1;&#x5E03;&#x6807;&#x51C6;&#xFF1A;&#x6BD4;&#x5982;&#x542F;&#x505C;&#x811A;&#x672C;&#xFF0C;&#x542F;&#x52A8;&#x8D26;&#x53F7;&#xFF0C;LOG&#x683C;&#x5F0F;&#x3001;&#x5207;&#x5206;&#x65B9;&#x5F0F;&#xFF0C;&#x90E8;&#x7F72;&#x8DEF;&#x5F84;&#xFF0C;watchdog</p></li><li><p>&#x76D1;&#x63A7;&#x6807;&#x51C6;&#xFF1A;&#x5236;&#x5B9A;&#x6307;&#x6807;&#x9EC4;&#x9875;&#xFF0C;&#x673A;&#x5668;&#x3001;&#x7F51;&#x7EDC;&#x3001;&#x4E1A;&#x52A1;&#x7A0B;&#x5E8F;&#x3001;&#x4E2D;&#x95F4;&#x4EF6;&#x7B49;&#x7B49;&#x90FD;&#x8981;&#x5982;&#x4F55;&#x76D1;&#x63A7;&#xFF0C;&#x7A0B;&#x5E8F;&#x5982;&#x4F55;&#x5410;&#x51FA;&#x53CD;&#x5E94;&#x81EA;&#x8EAB;&#x5065;&#x5EB7;&#x72B6;&#x51B5;&#x7684;&#x6307;&#x6807;&#x5747;&#x8981;&#x5B9A;&#x89C4;&#x8303;</p></li></ul><h4 id="&#x8D44;&#x6E90;&#x7BA1;&#x7406;"><a href="#&#x8D44;&#x6E90;&#x7BA1;&#x7406;" class="headerlink" title="&#x8D44;&#x6E90;&#x7BA1;&#x7406;"></a>&#x8D44;&#x6E90;&#x7BA1;&#x7406;</h4><p>&#x8FD0;&#x7EF4;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x652F;&#x6491;&#x6027;&#x7684;&#x90E8;&#x95E8;&#xFF0C;&#x6CA1;&#x529E;&#x6CD5;&#x8D5A;&#x94B1;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x7701;&#x94B1;&#xFF0C;&#x628A;&#x8D44;&#x6E90;&#x5C3D;&#x91CF;&#x5408;&#x7406;&#x5229;&#x7528;&#x8D77;&#x6765;&#xFF0C;&#x82B1;&#x66F4;&#x5C11;&#x7684;&#x94B1;&#x529E;&#x66F4;&#x591A;&#x7684;&#x4E8B;</p><ul><li><p>&#x505A;&#x597D;&#x9884;&#x7B97;&#xFF0C;&#x5BB9;&#x91CF;&#x89C4;&#x5212;&#xFF0C;&#x770B;&#x4E1A;&#x52A1;&#x589E;&#x91CF;&#x5F97;&#x51FA;&#x9884;&#x7B97;&#x673A;&#x5668;&#x91CF;</p></li><li><p>&#x5404;&#x79CD;&#x673A;&#x578B;&#x9700;&#x8981;&#x5907;&#x673A;&#x914D;&#x6BD4;&#xFF0C;&#x907F;&#x514D;&#x67D0;&#x673A;&#x5668;&#x574F;&#x4E86;&#x4E4B;&#x540E;&#x627E;&#x4E0D;&#x5230;&#x5907;&#x673A;&#x53EF;&#x6362;</p></li><li><p>&#x673A;&#x5668;&#x751F;&#x547D;&#x5468;&#x671F;&#x7BA1;&#x7406;&#xFF0C;&#x6D41;&#x8F6C;&#x6D41;&#x7A0B;&#xFF0C;&#x6BD4;&#x5982;&#x4E0A;&#x7EBF;&#xFF0C;&#x4E0B;&#x7EBF;&#xFF0C;&#x6545;&#x969C;&#xFF0C;&#x501F;&#x7528;&#x7B49;&#x7B49;</p></li><li><p>&#x901A;&#x8FC7;&#x7C7B;&#x4F3C;&#x670D;&#x52A1;&#x6811;&#x8FD9;&#x6837;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x5206;&#x95E8;&#x522B;&#x7C7B;&#x7684;&#x7BA1;&#x7406;&#x673A;&#x5668;&#xFF0C;&#x77E5;&#x9053;&#x6BCF;&#x4E2A;&#x673A;&#x5668;&#x7684;&#x7528;&#x9014;</p></li><li><p>&#x901A;&#x8FC7;&#x7C7B;&#x4F3C;Borg&#x8FD9;&#x6837;&#x7684;&#x7EDF;&#x4E00;&#x8C03;&#x5EA6;&#x7CFB;&#x7EDF;&#xFF0C;&#x6DF7;&#x90E8;&#x670D;&#x52A1;&#xFF0C;&#x63D0;&#x5347;&#x8D44;&#x6E90;&#x5229;&#x7528;&#x7387;</p></li></ul><h4 id="&#x76D1;&#x63A7;"><a href="#&#x76D1;&#x63A7;" class="headerlink" title="&#x76D1;&#x63A7;"></a>&#x76D1;&#x63A7;</h4><p>&#x76D1;&#x63A7;&#x4F5C;&#x4E3A;&#x8FD0;&#x7EF4;&#x7684;&#x773C;&#x775B;&#xFF0C;&#x7A33;&#x5B9A;&#x6027;&#x7684;&#x5FC5;&#x8981;&#x4FDD;&#x969C;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x505A;&#x597D;&#xFF0C;&#x505A;&#x5168;&#x9762;&#xFF0C;&#x505A;&#x7A33;&#x5B9A;&#xFF0C;&#x6240;&#x6709;&#x670D;&#x52A1;&#x90FD;&#x6302;&#x4E86;&#xFF0C;&#x76D1;&#x63A7;&#x4E0D;&#x80FD;&#x6302;</p><ul><li><p>&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x81EA;&#x8EAB;&#x6784;&#x5EFA;&#xFF0C;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x91CF;&#x6BD4;&#x8F83;&#x5927;&#xFF0C;&#x662F;&#x8FD0;&#x7EF4;&#x7CFB;&#x7EDF;&#x4E2D;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x6709;&#x96BE;&#x5EA6;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x7684;&#x6BD4;&#x5982;Borgmon&#x3001;Gorilla&#x3001;OpenTSDB&#x3001;Zabbix+Grafana&#x3001;Ganglia&#x7B49;</p></li><li><p>&#x673A;&#x5668;&#x6027;&#x80FD;&#x76D1;&#x63A7;&#x3001;&#x57FA;&#x7840;&#x73AF;&#x5883;&#x76D1;&#x63A7;&#x3001;&#x65E5;&#x5FD7;&#x76D1;&#x63A7;&#x3001;&#x7F51;&#x7EDC;&#x76D1;&#x63A7;&#x3001;&#x8BBF;&#x95EE;&#x8D28;&#x91CF;&#x76D1;&#x63A7;&#x3001;&#x4E1A;&#x52A1;&#x76D1;&#x63A7;&#xFF0C;&#x7B49;&#x7B49;&#x7B49;&#x7B49;&#xFF0C;&#x6CA1;&#x6709;&#x6700;&#x5168;&#xFF0C;&#x53EA;&#x6709;&#x66F4;&#x5168;</p></li><li><p>&#x90E8;&#x5206;&#x95EE;&#x9898;&#x62A5;&#x8B66;&#x4E4B;&#x540E;&#xFF0C;&#x5904;&#x7406;&#x6B65;&#x9AA4;&#x662F;&#x91CD;&#x590D;&#x7684;&#x56FA;&#x5316;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x573A;&#x666F;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x6545;&#x969C;&#x81EA;&#x6108;&#xFF0C;&#x65E0;&#x4EBA;&#x503C;&#x5B88;&#x81EA;&#x52A8;&#x5904;&#x7406;&#xFF0C;&#x5373;&#x4F7F;&#x65E0;&#x6CD5;&#x81EA;&#x52A8;&#x5904;&#x7406;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x6293;&#x73B0;&#x573A;&#xFF0C;&#x63D0;&#x4F9B;&#x540E;&#x7EED;&#x5206;&#x6790;&#x4F9D;&#x636E;</p></li></ul><h4 id="&#x5B89;&#x5168;"><a href="#&#x5B89;&#x5168;" class="headerlink" title="&#x5B89;&#x5168;"></a>&#x5B89;&#x5168;</h4><p>&#x6240;&#x8C13;&#x5B89;&#x5168;&#x65E0;&#x5C0F;&#x4E8B;&#xFF0C;&#x5B89;&#x5168;&#x76F4;&#x63A5;&#x5173;&#x7CFB;&#x5230;&#x4E00;&#x4E2A;&#x516C;&#x53F8;&#x7684;&#x5B58;&#x4EA1;&#xFF0C;&#x6709;&#x7684;&#x516C;&#x53F8;&#x4F1A;&#x628A;&#x5B89;&#x5168;&#x56E2;&#x961F;&#x653E;&#x5230;&#x8FD0;&#x7EF4;&#x90E8;&#x95E8;&#x4E0B;&#x9762;&#xFF0C;&#x6709;&#x7684;&#x662F;&#x5355;&#x62CE;&#x51FA;&#x6765;&#xFF0C;&#x4E0D;&#x7BA1;&#x7EC4;&#x7EC7;&#x7ED3;&#x6784;&#x600E;&#x4E48;&#x5212;&#x5206;&#xFF0C;&#x5B89;&#x5168;&#x90FD;&#x662F;&#x8FD0;&#x7EF4;&#x4E00;&#x5B9A;&#x8981;&#x91CD;&#x70B9;&#x5173;&#x6CE8;&#x7684;</p><ul><li><p>&#x767B;&#x5F55;&#x63A7;&#x5236;&#x548C;&#x64CD;&#x4F5C;&#x5BA1;&#x8BA1;&#xFF0C;&#x6BD4;&#x5982;&#x5404;&#x4E2A;&#x516C;&#x53F8;&#x505A;&#x7684;&#x5821;&#x5792;&#x673A;&#x3001;&#x8DF3;&#x677F;&#x673A;&#xFF0C;&#x63A7;&#x5236;&#x54EA;&#x4E9B;&#x4EBA;&#x53EF;&#x4EE5;&#x767B;&#x5F55;&#x54EA;&#x4E9B;&#x673A;&#x5668;&#xFF0C;&#x800C;&#x4E14;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x5747;&#x6709;&#x8BB0;&#x5F55;&#xFF0C;&#x5747;&#x53EF;&#x5BA1;&#x8BA1;</p></li><li><p>&#x5B89;&#x5168;&#x63A5;&#x5165;&#xFF0C;&#x6BD4;&#x5982;&#x9632;DDOS&#xFF0C;&#x6D41;&#x91CF;&#x6E05;&#x6D17;&#xFF0C;&#x5728;&#x516C;&#x53F8;&#x6240;&#x6709;&#x670D;&#x52A1;&#x4E4B;&#x524D;&#xFF0C;&#x653E;&#x7F6E;&#x4E00;&#x9053;&#x8BA9;&#x4EBA;&#x4FE1;&#x8D56;&#x7684;&#x957F;&#x57CE;</p></li><li><p>&#x670D;&#x52A1;&#x5B89;&#x5168;&#xFF0C;&#x6BD4;&#x5982;&#x7814;&#x53D1;&#x540C;&#x5B66;&#x4F7F;&#x7528;&#x7EDF;&#x4E00;&#x7684;&#x6846;&#x67B6;&#xFF0C;&#x907F;&#x514D;&#x4E00;&#x4E9B;&#x7F16;&#x7801;&#x4E0A;&#x7684;&#x5B89;&#x5168;&#x6F0F;&#x6D1E;&#xFF0C;&#x518D;&#x7ECF;&#x5E38;&#x505A;&#x4E00;&#x4E0B;&#x6F0F;&#x6D1E;&#x626B;&#x63CF;&#xFF0C;&#x626B;&#x626B;&#x66F4;&#x5065;&#x5EB7;</p></li></ul><h4 id="&#x707E;&#x96BE;&#x7BA1;&#x7406;"><a href="#&#x707E;&#x96BE;&#x7BA1;&#x7406;" class="headerlink" title="&#x707E;&#x96BE;&#x7BA1;&#x7406;"></a>&#x707E;&#x96BE;&#x7BA1;&#x7406;</h4><p>&#x7EBF;&#x4E0A;&#x670D;&#x52A1;&#x7A33;&#x5B9A;&#x6027;&#x662F;&#x8FD0;&#x7EF4;&#x540C;&#x5B66;&#x7684;&#x7B2C;&#x4E00;&#x8981;&#x52A1;&#xFF0C;&#x707E;&#x96BE;&#x7BA1;&#x7406;&#xFF0C;&#x662F;&#x5176;&#x4E2D;&#x91CD;&#x8981;&#x4E00;&#x73AF;</p><ul><li><p>&#x9996;&#x5148;&#x670D;&#x52A1;&#x67B6;&#x6784;&#x672C;&#x8EAB;&#xFF0C;&#x4E0A;&#x7EBF;&#x4E4B;&#x524D;&#x5C31;&#x8981;&#x8003;&#x8651;&#x597D;&#x600E;&#x4E48;&#x505A;&#x5BB9;&#x707E;&#xFF0C;&#x6709;&#x5355;&#x70B9;&#x7684;&#x7CFB;&#x7EDF;&#x663E;&#x7136;&#x662F;&#x8FC7;&#x4E0D;&#x4E86;&#x51C6;&#x5165;&#x7684;&#xFF0C;&#x8FD0;&#x7EF4;&#x540C;&#x5B66;&#x4E0D;&#x80FD;&#x63A5;</p></li><li><p>&#x91CD;&#x8981;&#x6570;&#x636E;&#x5FC5;&#x987B;&#x505A;&#x597D;&#x5907;&#x4EFD;&#xFF0C;&#x53EA;&#x5907;&#x4EFD;&#x6CA1;&#x6F14;&#x7EC3;&#x53EF;&#x80FD;&#x4F1A;&#x6B65;&#x4E86;gitlab&#x7684;&#x540E;&#x5C18;&#xFF0C;&#x6240;&#x4EE5;&#x5B9A;&#x671F;&#x6F14;&#x7EC3;&#x5FC5;&#x4E0D;&#x53EF;&#x5C11;&#xFF0C;&#x53E6;&#x5916;&#x63D0;&#x524D;&#x627E;&#x597D;&#x64C5;&#x957F;&#x6570;&#x636E;&#x6062;&#x590D;&#x7684;&#x4F19;&#x4F34;&#xFF0C;&#x7701;&#x5F97;&#x4E34;&#x65F6;&#x62B1;&#x4F5B;&#x811A;</p></li><li><p>&#x7EBF;&#x4E0A;&#x6240;&#x6709;&#x53D8;&#x66F4;&#x64CD;&#x4F5C;&#xFF0C;&#x6545;&#x969C;&#x5904;&#x7406;&#xFF0C;&#x9700;&#x6C42;&#x5904;&#x7406;&#x90FD;&#x8981;&#x6709;&#x5B8C;&#x5584;&#x7684;SOP&#xFF0C;&#x65B0;&#x4EBA;&#x6765;&#x4E86;&#xFF0C;&#x770B;&#x7740;SOP&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x641E;&#x5B9A;</p></li><li><p>&#x5B95;&#x673A;&#x6F14;&#x7EC3;&#xFF0C;&#x5B9A;&#x671F;&#x5DE1;&#x68C0;&#x8981;&#x5E38;&#x505A;&#xFF0C;&#x9884;&#x6599;&#x5916;&#x7684;&#x6545;&#x969C;&#x662F;&#x6211;&#x4EEC;&#x6700;&#x4E0D;&#x5E0C;&#x671B;&#x770B;&#x5230;&#x7684;</p></li></ul><h4 id="&#x8BBF;&#x95EE;&#x8D28;&#x91CF;"><a href="#&#x8BBF;&#x95EE;&#x8D28;&#x91CF;" class="headerlink" title="&#x8BBF;&#x95EE;&#x8D28;&#x91CF;"></a>&#x8BBF;&#x95EE;&#x8D28;&#x91CF;</h4><p>&#x516C;&#x53F8;&#x505A;&#x7684;&#x4E1A;&#x52A1;&#x5982;&#x679C;&#x662F;To C&#x7684;&#xFF0C;&#x8FD9;&#x5757;&#x5C31;&#x91CD;&#x8981;&#x4E86;&#xFF0C;&#x4E92;&#x8054;&#x7F51;&#x5BA2;&#x6237;&#x90FD;&#x6CA1;&#x591A;&#x5C11;&#x8010;&#x5FC3;&#xFF0C;&#x4E0D;&#x8981;&#x8BA9;&#x5BA2;&#x6237;&#x611F;&#x89C9;&#x7F51;&#x7AD9;&#x54CD;&#x5E94;&#x6162;&#xFF0C;&#x8FD9;&#x4F1A;&#x76F4;&#x63A5;&#x5BFC;&#x81F4;&#x5BA2;&#x6237;&#x6D41;&#x5931;</p><ul><li><p>&#x8BBF;&#x95EE;&#x8D28;&#x91CF;&#x8981;&#x505A;&#x5168;&#x56FD;&#x751A;&#x81F3;&#x5168;&#x7403;&#x76D1;&#x63A7;&#xFF0C;&#x5404;&#x4E2A;&#x7701;&#x5E02;&#xFF0C;&#x5404;&#x4E2A;&#x4E3B;&#x8981;&#x94FE;&#x8DEF;&#xFF0C;&#x641E;&#x4E2A;&#x5927;&#x5C4F;&#xFF0C;&#x5168;&#x56FD;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x8D28;&#x91CF;&#x6E05;&#x6670;&#x53EF;&#x89C1;</p></li><li><p>&#x901A;&#x8FC7;CDN&#xFF0C;&#x56FE;&#x7247;&#x4F18;&#x5316;&#xFF0C;&#x7F13;&#x5B58;&#x7B56;&#x7565;&#xFF0C;&#x6D41;&#x91CF;&#x8C03;&#x5EA6;&#x7B49;&#x7B49;&#x624B;&#x6BB5;&#xFF0C;&#x8BA9;&#x7F51;&#x7AD9;&#x8BBF;&#x95EE;&#x901F;&#x5EA6;&#x53D8;&#x6210;&#x4E0E;&#x53CB;&#x5546;&#x7ADE;&#x4E89;&#x7684;&#x4E00;&#x5927;&#x4F18;&#x52BF;</p></li></ul><h4 id="&#x53D8;&#x66F4;&#x7BA1;&#x7406;"><a href="#&#x53D8;&#x66F4;&#x7BA1;&#x7406;" class="headerlink" title="&#x53D8;&#x66F4;&#x7BA1;&#x7406;"></a>&#x53D8;&#x66F4;&#x7BA1;&#x7406;</h4><p>&#x5BF9;&#x7EBF;&#x4E0A;&#x505A;&#x53D8;&#x66F4;&#xFF0C;&#x662F;&#x5BFC;&#x81F4;&#x7EBF;&#x4E0A;&#x95EE;&#x9898;&#x7684;&#x4E00;&#x5927;&#x6E90;&#x5934;&#xFF0C;&#x8FD9;&#x5757;&#x8981;&#x5355;&#x72EC;&#x62CE;&#x51FA;&#x6765;&#x8BF4;&#x8BF4;</p><ul><li><p>&#x7CFB;&#x7EDF;&#x7EC4;&#x4EA4;&#x4ED8;&#x673A;&#x5668;&#x4E4B;&#x540E;&#xFF0C;&#x9996;&#x5148;&#x8981;&#x6839;&#x636E;&#x81EA;&#x8EAB;&#x4E1A;&#x52A1;&#x7279;&#x70B9;&#x505A;&#x4E00;&#x6B21;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x5BF9;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x505A;&#x4E00;&#x4E9B;&#x914D;&#x7F6E;&#xFF0C;&#x5B89;&#x88C5;&#x4E00;&#x4E9B;&#x5FC5;&#x8981;&#x7684;&#x8F6F;&#x4EF6;&#xFF0C;&#x6BD4;&#x5982;&#x673A;&#x5668;&#x6302;&#x8F7D;&#x5230;&#x670D;&#x52A1;&#x6811;&#x81EA;&#x52A8;&#x89E6;&#x53D1;&#x521D;&#x59CB;&#x5316;&#x7B56;&#x7565;</p></li><li><p>&#x5927;&#x70B9;&#x7684;&#x516C;&#x53F8;&#xFF0C;&#x6BCF;&#x5929;&#x51E0;&#x5343;&#x6B21;&#x53D1;&#x5E03;&#x5F88;&#x6B63;&#x5E38;&#xFF0C;&#x6709;&#x4E2A;&#x90E8;&#x7F72;&#x5E73;&#x53F0;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x5386;&#x53F2;&#x7248;&#x672C;&#x8981;&#x53EF;&#x56DE;&#x6EAF;&#xFF0C;&#x4E00;&#x952E;&#x56DE;&#x6EDA;&#xFF0C;&#x652F;&#x6301;&#x5404;&#x79CD;&#x7B56;&#x7565;&#x5404;&#x79CD;&#x5E76;&#x53D1;&#x5EA6;&#x4E0A;&#x7EBF;&#xFF0C;&#x5177;&#x5907;&#x5206;&#x53D1;&#x5927;&#x6587;&#x4EF6;&#x5230;&#x51E0;&#x4E07;&#x751A;&#x81F3;&#x51E0;&#x5341;&#x4E07;&#x53F0;&#x673A;&#x5668;&#x7684;&#x80FD;&#x529B;</p></li><li><p>&#x5173;&#x8054;&#x5173;&#x7CFB;&#x7C7B;&#x578B;&#x7684;&#x914D;&#x7F6E;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x7EDF;&#x4E00;&#x7684;&#x540D;&#x5B57;&#x670D;&#x52A1;&#x89E3;&#x51B3;&#xFF0C;&#x5F00;&#x5173;&#x7C7B;&#x7684;&#x914D;&#x7F6E;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x4E2D;&#x5FC3;&#x5316;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x6216;&#x8005;&#x91C7;&#x7528;&#x4E00;&#x6B21;&#x53D1;&#x5E03;&#x89E3;&#x51B3;&#xFF0C;&#x6BCF;&#x4E2A;&#x7A0B;&#x5E8F;&#x5982;&#x679C;&#x90FD;&#x652F;&#x6301;reload&#x914D;&#x7F6E;&#x5012;&#x662F;&#x4E0D;&#x9519;</p></li></ul><h4 id="&#x7F16;&#x7A0B;&#x6846;&#x67B6;"><a href="#&#x7F16;&#x7A0B;&#x6846;&#x67B6;" class="headerlink" title="&#x7F16;&#x7A0B;&#x6846;&#x67B6;"></a>&#x7F16;&#x7A0B;&#x6846;&#x67B6;</h4><p>&#x7F16;&#x7A0B;&#x6846;&#x67B6;&#x597D;&#x50CF;&#x8DDF;&#x8FD0;&#x7EF4;&#x65E0;&#x5173;&#xFF0C;&#x5B9E;&#x5219;&#x4E0D;&#x7136;&#x3002;&#x7EDF;&#x4E00;&#x7684;&#x7F16;&#x7A0B;&#x6846;&#x67B6;&#x4F1A;&#x8BA9;&#x8FD0;&#x7EF4;&#x590D;&#x6742;&#x5EA6;&#x964D;&#x4F4E;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x5728;&#x6846;&#x67B6;&#x4E2D;&#x5D4C;&#x5165;&#x8FD0;&#x7EF4;&#x903B;&#x8F91;&#xFF0C;&#x4E0D;&#x8003;&#x8651;&#x8FD0;&#x7EF4;&#x7684;&#x67B6;&#x6784;&#x5E08;&#x4E0D;&#x662F;&#x597D;&#x67B6;&#x6784;&#x5E08;</p><ul><li><p>&#x7EDF;&#x4E00;RPC&#x6846;&#x67B6;&#xFF0C;&#x7EDF;&#x4E00;&#x91CD;&#x8BD5;&#x7B56;&#x7565;&#xFF0C;&#x7EDF;&#x4E00;&#x540D;&#x5B57;&#x670D;&#x52A1;&#xFF0C;&#x7EDF;&#x4E00;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#xFF0C;&#x7EDF;&#x4E00;watchdog&#xFF0C;&#x7EDF;&#x4E00;&#x76D1;&#x63A7;&#x65B9;&#x5F0F;&#xFF0C;&#x7EDF;&#x4E00;&#x65E5;&#x5FD7;&#x6253;&#x5370;&#x2026;</p></li><li><p>&#x591A;&#x73AF;&#x5883;&#x652F;&#x6301;&#xFF1A;&#x5F00;&#x53D1;&#x73AF;&#x5883;&#xFF0C;&#x5355;&#x6D4B;&#x73AF;&#x5883;&#xFF0C;&#x96C6;&#x6D4B;&#x73AF;&#x5883;&#xFF0C;&#x5C0F;&#x6D41;&#x91CF;&#x73AF;&#x5883;&#xFF0C;&#x7EBF;&#x4E0A;&#x73AF;&#x5883;&#x2026;&#x7528;&#x540C;&#x4E00;&#x4E2A;&#x53D1;&#x5E03;&#x5305;&#x4E0A;&#x7EBF;&#xFF0C;&#x641E;&#x5B9A;&#x914D;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x95EE;&#x9898;</p></li><li><p>&#x670D;&#x52A1;&#x6CBB;&#x7406;&#x65B9;&#x9762;&#xFF0C;&#x6BD4;&#x5982;&#x63A5;&#x53E3;&#x6743;&#x9650;&#x63A7;&#x5236;&#xFF0C;&#x63A5;&#x53E3;&#x7248;&#x672C;&#x7BA1;&#x7406;&#xFF0C;&#x6D41;&#x63A7;&#xFF0C;&#x8DEF;&#x7531;&#x89C4;&#x5219;&#xFF0C;&#x7B49;&#x7B49;</p></li></ul><h4 id="&#x81EA;&#x52A8;&#x5316;&#x5E73;&#x53F0;"><a href="#&#x81EA;&#x52A8;&#x5316;&#x5E73;&#x53F0;" class="headerlink" title="&#x81EA;&#x52A8;&#x5316;&#x5E73;&#x53F0;"></a>&#x81EA;&#x52A8;&#x5316;&#x5E73;&#x53F0;</h4><p>&#x8FD0;&#x7EF4;&#x8FD9;&#x4E2A;&#x884C;&#x5F53;&#xFF0C;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;console&#x4E00;&#x4E2A;pash&#x5C31;&#x4E07;&#x4E8B;&#x5927;&#x5409;&#x7684;&#xFF0C;&#x4E5F;&#x9700;&#x8981;&#x76F8;&#x5173;&#x7CFB;&#x7EDF;&#x7684;&#x652F;&#x6301;&#xFF0C;&#x63D0;&#x9AD8;&#x5DE5;&#x4F5C;&#x6548;&#x7387;&#xFF0C;&#x63D0;&#x9AD8;&#x7A33;&#x5B9A;&#x6027;</p><ul><li><p>&#x53D1;&#x5E03;&#x4E4B;&#x524D;&#xFF1A;&#x7248;&#x672C;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#xFF0C;&#x6BD4;&#x5982;gitlab&#x3001;&#x7F16;&#x8BD1;&#x6253;&#x5305;&#x5E73;&#x53F0;&#x3001;&#x5236;&#x54C1;&#x7BA1;&#x7406;&#x4ED3;&#x5E93;</p></li><li><p>&#x53D1;&#x5E03;&#x4E2D;&#xFF1A;&#x673A;&#x5668;&#x7BA1;&#x7406;&#x5206;&#x7EC4;&#x7CFB;&#x7EDF;&#xFF0C;&#x90E8;&#x7F72;&#x7CFB;&#x7EDF;&#xFF0C;&#x5927;&#x6587;&#x4EF6;&#x5206;&#x53D1;&#x5DE5;&#x5177;</p></li><li><p>&#x53D1;&#x5E03;&#x4E4B;&#x540E;&#xFF1A;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#xFF0C;&#x8D44;&#x6E90;&#x5229;&#x7528;&#x7387;&#x5E73;&#x53F0;</p></li><li><p>&#x65E5;&#x5E38;&#x5DE5;&#x4F5C;&#xFF1A;&#x521D;&#x59CB;&#x5316;&#x5E73;&#x53F0;&#x6765;&#x521D;&#x59CB;&#x5316;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF0C;&#x8DF3;&#x677F;&#x673A;&#x3001;&#x5821;&#x5792;&#x673A;&#x63A7;&#x5236;&#x767B;&#x5F55;&#xFF0C;&#x5DE5;&#x5355;&#x7CFB;&#x7EDF;&#x7B49;&#x7B49;</p></li></ul><h4 id="&#x7ED3;&#x8BED;"><a href="#&#x7ED3;&#x8BED;" class="headerlink" title="&#x7ED3;&#x8BED;"></a>&#x7ED3;&#x8BED;</h4><p>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x516C;&#x53F8;&#x6CE8;&#x91CD;&#x670D;&#x52A1;&#x7A33;&#x5B9A;&#x6027;&#x3001;&#x5B89;&#x5168;&#x6027;&#xFF0C;&#x6CE8;&#x91CD;&#x6210;&#x672C;&#x63A7;&#x5236;&#xFF0C;&#x90A3;&#x5C31;&#x5E94;&#x8BE5;&#x6CE8;&#x91CD;&#x8FD0;&#x7EF4;&#xFF0C;&#x8FD9;&#x7FA4;&#x9ED8;&#x9ED8;&#x5DE5;&#x4F5C;&#x5728;&#x670D;&#x52A1;&#x80CC;&#x540E;&#x7684;&#x80CC;&#x9505;&#x4FA0;&#xFF0C;&#x8BF7;&#x73CD;&#x60DC;&#xFF01;</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;hr&gt;
&lt;p&gt;&lt;font color=&quot;&quot; size=&quot;3&quot;&gt; 最近在做2015年规划，思考运维到底应该干哪些事，得出如下图表一张，欢迎各位同仁一起讨论。&lt;/font&gt;&amp;emsp;&lt;/p&gt;
&lt;hr&gt;
    
    </summary>
    
      <category term="职业规划" scheme="https://wolf-7.github.io/categories/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/"/>
    
    
      <category term="职业规划" scheme="https://wolf-7.github.io/tags/%E8%81%8C%E4%B8%9A%E8%A7%84%E5%88%92/"/>
    
  </entry>
  
</feed>
